<!DOCTYPE html>
<html>

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <title>%这是标题%</title>
    <style>
        /**
         * Skipped minification because the original files appears to be already minified.
         * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
         */
        .chimee-container container{position:relative;display:block;width:100%;height:100%}.chimee-container video{display:block;width:100%;height:100%;background:#000;outline:0}.chimee-container video:focus{outline:0}.chimee-container chimee-center-state-loading{box-sizing:initial}
        container{position:relative}container,video{display:block;width:100%;height:100%;background:#000;outline:none}video:focus{outline:none}:root{--barColor:#de698c;--trackColor:#4c4c4c}.chimee-flex-component svg:hover g,.chimee-flex-component svg g{fill:#fff;stroke:#fff}chimee-clarity-list,chimee-control-state-pause,chimee-control-state-play,chimee-playbackrate-list,chimee-progressbar-tip,chimee-screen-full,chimee-screen-small,chimee-volume-state-high,chimee-volume-state-low,chimee-volume-state-mute{display:none}chimee-control.full chimee-screen-full,chimee-control.pause chimee-control-state-pause,chimee-control.play chimee-control-state-play,chimee-control.small chimee-screen-small,chimee-volume.high chimee-volume-state-high,chimee-volume.low chimee-volume-state-low,chimee-volume.mute chimee-volume-state-mute{display:inline-block;width:1.4em;height:100%}chimee-control{display:block;height:100%;line-height:2em;font-size:14px;user-select:none;overflow:hidden;font-family:Roboto,Arial,Helvetica,sans-serif;transition:visibility .5s ease}chimee-control,chimee-control-wrap{position:absolute;bottom:0;left:0;width:100%}chimee-control-wrap{height:2.2em;display:flex;flex-flow:row nowrap;justify-content:flex-start;align-items:flex-start;background:rgba(0,0,0,.5);transition:bottom .5s ease;pointer-events:auto}.chimee-flex-component{order:1;flex-grow:0;height:2em;cursor:pointer}.chimee-flex-component svg{vertical-align:middle;width:2em;height:1.5em}chimee-control-state.chimee-flex-component{flex-basis:3em;text-align:right;margin-right:1em}chimee-control-state .left,chimee-control-state .right{transition:d .2s ease-in-out}chimee-progresstime.chimee-flex-component{color:#fff;font-weight:400;text-align:center;white-space:nowrap}chimee-progresstime-pass,chimee-progresstime-total{display:inline}chimee-progressbar.chimee-flex-component{position:relative;flex-grow:1}chimee-progressbar-wrap{display:inline-block;height:100%;position:absolute;left:1em;right:1em;top:0;pointer-events:none}chimee-progressbar.progressbar-layout-top{position:static}chimee-progressbar.progressbar-layout-top chimee-progressbar-wrap{top:-1.6em;height:1.6em;left:0;right:0}chimee-progressbar.progressbar-layout-top .chimee-progressbar-line{left:0;top:.8em}.chimee-progressbar-line{position:absolute;top:.9em;left:0;display:inline-block;height:3px}chimee-progressbar-bg{width:100%;background:var(--trackColor)}chimee-progressbar-buffer{width:0;background:#6f6f6f}chimee-progressbar-all{background:var(--barColor)}chimee-progressbar-ball{content:"";position:absolute;right:-.8em;top:-.3em;display:inline-block;width:.8em;height:.8em;border-radius:.8em;background:#fff;pointer-events:none}chimee-progressbar-tip{position:absolute;bottom:.5em;top:-1.5em;left:0;z-index:10;padding:0 .5em;height:1.5em;background:#fff;line-height:1.5em;border-radius:4px;color:#000;text-align:center}chimee-volume.chimee-flex-component{cursor:pointer;padding:0;flex-basis:7em;white-space:nowrap;margin-right:1em;position:relative}chimee-volume.chimee-flex-component.vertical{padding-right:1em;flex-basis:2em}chimee-volume-state{display:inline-block;width:2em;vertical-align:top}chimee-volume .line,chimee-volume .ring1,chimee-volume .ring2{stroke-dasharray:150;stroke-dashoffset:150;transition:stroke-dashoffset .7s ease-in-out}chimee-volume.high .ring1,chimee-volume.high .ring2,chimee-volume.low .ring2,chimee-volume.mute .line,chimee-volume.mute .ring1,chimee-volume.mute .ring2{stroke-dashoffset:0}chimee-volume.vertical:hover chimee-volume-bar{display:inline-block}chimee-volume.vertical chimee-volume-bar{position:absolute;top:-7em;left:-.2em;width:2em;height:4em;padding-bottom:3em;display:none;vertical-align:middle}chimee-volume.vertical chimee-volume-bar:before{content:"";position:absolute;left:0;right:0;top:0;bottom:1em;background:#212121;border-radius:4px}chimee-volume.vertical chimee-volume-bar-wrap{display:inline-block;position:absolute;bottom:1em;left:0;top:1em;right:0;height:4em}chimee-volume.vertical chimee-volume-bar-all,chimee-volume.vertical chimee-volume-bar-bg{position:absolute;bottom:0;left:1em;display:inline-block;width:2px;border-radius:4px}chimee-volume.vertical chimee-volume-bar-bg{height:4em;background:var(--trackColor);opacity:.5}chimee-volume.vertical chimee-volume-bar-all{background:var(--barColor)}chimee-volume.vertical chimee-volume-bar-all:after{content:"";position:absolute;right:-.34em;top:-.4em;display:inline-block;width:.8em;height:.8em;border-radius:.8em;background:#fff;pointer-events:none}chimee-volume.horizonal chimee-volume-bar{position:relative;height:1.2em;width:4em;display:inline-block;vertical-align:middle}chimee-volume.horizonal chimee-volume-bar-all,chimee-volume.horizonal chimee-volume-bar-bg{position:absolute;top:.4em;left:0;display:inline-block;height:2px}chimee-volume.horizonal chimee-volume-bar-bg{width:4em;background:var(--trackColor);opacity:.5}chimee-volume.horizonal chimee-volume-bar-all{background:var(--barColor)}chimee-volume.horizonal chimee-volume-bar-all:after{content:"";position:absolute;right:-.4em;top:-.3em;display:inline-block;width:.8em;height:.8em;border-radius:.8em;background:#fff;pointer-events:none}chimee-screen.chimee-flex-component{flex-basis:3em;text-align:left}chimee-clarity.chimee-flex-component,chimee-playbackrate.chimee-flex-component{position:relative;color:#fff;width:6em;height:1.75em;padding:0 1em;text-align:center;vertical-align:middle;font-size:16px}chimee-clarity.chimee-flex-component:hover chimee-clarity-list,chimee-playbackrate.chimee-flex-component:hover chimee-playbackrate-list{display:inline-block}chimee-clarity.chimee-flex-component svg,chimee-playbackrate.chimee-flex-component svg{width:auto;height:auto}chimee-clarity-list,chimee-playbackrate-list{position:absolute;left:0;bottom:1em;width:100%;padding-bottom:1.5em;opacity:.8;box-sizing:content-box;line-height:0}chimee-clarity-list ul,chimee-playbackrate-list ul{margin:0;padding:.5em 0;background:#292929;line-height:2em}chimee-clarity-list li,chimee-playbackrate-list li{list-style-type:none}chimee-clarity-list li.active,chimee-clarity-list li:hover,chimee-playbackrate-list li.active,chimee-playbackrate-list li:hover{color:var(--barColor)}chimee-clarity-list-arrow,chimee-playbackrate-list-arrow{position:absolute;bottom:1.5em;width:100%}
        chimee-menu{position:absolute;color:#fff;background-color:rgba(37,37,37,.7);font-size:13px;font-family:sans-serif;border:1px solid hsla(0,0%,100%,.08);border-radius:2px;padding:2px;box-shadow:0 1px 4px rgba(0,0,0,.6)}chimee-menu ul{margin:0;padding:0;font-size:12px}chimee-menu li{cursor:pointer;padding:0 4px;line-height:24px;list-style:none;white-space:nowrap;margin:0;border:0;font-size:12px;font-weight:400}chimee-menu li:hover{background-color:hsla(0,0%,100%,.1)}chimee-menu li[disable]{opacity:.5;cursor:default}chimee-menu li a{color:#fff;text-decoration:none}chimee-menu li a:hover{color:#fff}
        chimee-center-state{position:absolute}@keyframes animate{0%{opacity:1}to{transform:scale(2);opacity:0}}@keyframes loading{0%{transform:rotate(0)}to{transform:rotate(1turn)}}chimee-center-state-correct,chimee-center-state-error,chimee-center-state-loading,chimee-center-state-tip{display:none}chimee-center-state.correct chimee-center-state-correct,chimee-center-state.error chimee-center-state-error,chimee-center-state.loading chimee-center-state-loading,chimee-center-state.tip chimee-center-state-tip{display:inline-block}chimee-center-state-correct{width:104px;height:104px}chimee-center-state-tip{position:absolute;left:26px;bottom:26px;width:52px;height:52px;border-radius:26px;background:rgba(0,0,0,.5);animation:animate .5s linear 1 normal forwards}chimee-center-state.play span{background-image:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDIiIGhlaWdodD0iNTEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZmlsbD0iI0ZGRiIgZD0iTTQxLjUgMjUuNWwtNDEgMjVWLjV6IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=")}chimee-center-state.pause span{background-image:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iI0ZGRiIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMCAwaDIwdjUwSDB6TTMwIDBoMjB2NTBIMzB6Ii8+PC9nPjwvc3ZnPg==")}chimee-center-state.back span{background-image:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNzMxIiBoZWlnaHQ9Ijg4NCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBzdHJva2U9IiNmZmYiIGZpbGw9IiNmZmYiIGZpbGwtcnVsZT0iZXZlbm9kZCI+PHBhdGggZD0iTTI1Ljg4MSA0OTIuNDE0YzE0LjEzIDAgMjUuNTgzIDExLjQ1NCAyNS41ODMgMjUuNTgzIDAgMTczLjA2MyAxNDAuNzk5IDMxMy44NjIgMzEzLjg2MiAzMTMuODYyIDE3My4wNjUgMCAzMTMuODYyLTE0MC43OTkgMzEzLjg2Mi0zMTMuODYyIDAtMTYyLjk1OS0xMjQuODQtMjk3LjI5LTI4My45MDItMzEyLjQyNGwxMTIuMTEzIDExMi4xMTRjOS45OSA5Ljk5IDkuOTkgMjYuMTg4IDAgMzYuMTc5YTI1LjUwNiAyNS41MDYgMCAwIDEtMTguMDkgNy40OTIgMjUuNTA2IDI1LjUwNiAwIDAgMS0xOC4wOS03LjQ5MkwzMTYuMjYzIDE5OC45MWMtOS45OS05Ljk5MS05Ljk5LTI2LjE4OSAwLTM2LjE4TDQ3MS4yMiA3Ljc3NWM5Ljk5Mi05Ljk5IDI2LjE4OS05Ljk5IDM2LjE4IDAgOS45OSA5Ljk5IDkuOTkgMjYuMTg5IDAgMzYuMThsLTExMC4zOTEgMTEwLjM5YzM4LjA5IDMuMjU5IDc1LjEwOSAxMi4zOSAxMTAuNDEgMjcuMzIgNDMuNDcgMTguMzg4IDgyLjUwNSA0NC43MDQgMTE2LjAyIDc4LjIyIDMzLjUxNSAzMy41MTUgNTkuODMyIDcyLjU0OSA3OC4yMTkgMTE2LjAyIDE5LjA0IDQ1LjAxOCAyOC42OTUgOTIuODI2IDI4LjY5NSAxNDIuMDkyIDAgNDkuMjY4LTkuNjU1IDk3LjA3NC0yOC42OTUgMTQyLjA5My0xOC4zODcgNDMuNDctNDQuNzA0IDgyLjUwNS03OC4yMTkgMTE2LjAyLTMzLjUxNSAzMy41MTYtNzIuNTUgNTkuODMyLTExNi4wMiA3OC4yMTgtNDUuMDE5IDE5LjA0Mi05Mi44MjUgMjguNjk2LTE0Mi4wOTMgMjguNjk2LTQ5LjI2OCAwLTk3LjA3My05LjY1NC0xNDIuMDkzLTI4LjY5Ni00My40NjktMTguMzg2LTgyLjUwNS00NC43MDItMTE2LjAyLTc4LjIxOC0zMy41MTYtMzMuNTE1LTU5LjgzMi03Mi41NS03OC4yMTgtMTE2LjAyQzkuOTU0IDYxNS4wNy4zIDU2Ny4yNjMuMyA1MTcuOTk2YzAtMTQuMTI4IDExLjQ1My0yNS41ODIgMjUuNTgyLTI1LjU4MnoiIGZpbGwtcnVsZT0ibm9uemVybyIvPjx0ZXh0IGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMjg4Ij48dHNwYW4geD0iMjExIiB5PSI2MzQiPjEwPC90c3Bhbj48L3RleHQ+PC9nPjwvc3ZnPg==")}chimee-center-state.forward span{background-image:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNzMxIiBoZWlnaHQ9Ijg4NCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBzdHJva2U9IiNmZmYiIGZpbGw9IiNmZmYiIGZpbGwtcnVsZT0iZXZlbm9kZCI+PHBhdGggZD0iTTcwNS4xMTkgNDkyLjQxNGMtMTQuMTMgMC0yNS41ODMgMTEuNDU0LTI1LjU4MyAyNS41ODMgMCAxNzMuMDYzLTE0MC43OTkgMzEzLjg2Mi0zMTMuODYyIDMxMy44NjItMTczLjA2NSAwLTMxMy44NjItMTQwLjc5OS0zMTMuODYyLTMxMy44NjIgMC0xNjIuOTU5IDEyNC44NC0yOTcuMjkgMjgzLjkwMi0zMTIuNDI0TDIyMy42MDEgMzE3LjY4N2MtOS45OSA5Ljk5LTkuOTkgMjYuMTg4IDAgMzYuMTc5YTI1LjUwNiAyNS41MDYgMCAwIDAgMTguMDkgNy40OTIgMjUuNTA2IDI1LjUwNiAwIDAgMCAxOC4wOS03LjQ5Mkw0MTQuNzM3IDE5OC45MWM5Ljk5LTkuOTkxIDkuOTktMjYuMTg5IDAtMzYuMThMMjU5Ljc4IDcuNzc1Yy05Ljk5Mi05Ljk5LTI2LjE4OS05Ljk5LTM2LjE4IDAtOS45OSA5Ljk5LTkuOTkgMjYuMTg5IDAgMzYuMThsMTEwLjM5MSAxMTAuMzljLTM4LjA5IDMuMjU5LTc1LjEwOSAxMi4zOS0xMTAuNDEgMjcuMzItNDMuNDcgMTguMzg4LTgyLjUwNSA0NC43MDQtMTE2LjAyIDc4LjIyLTMzLjUxNSAzMy41MTUtNTkuODMyIDcyLjU0OS03OC4yMTkgMTE2LjAyQzEwLjMwMiA0MjAuOTIyLjY0NyA0NjguNzMuNjQ3IDUxNy45OTZjMCA0OS4yNjggOS42NTUgOTcuMDc0IDI4LjY5NSAxNDIuMDkzIDE4LjM4NyA0My40NyA0NC43MDQgODIuNTA1IDc4LjIxOSAxMTYuMDIgMzMuNTE1IDMzLjUxNiA3Mi41NSA1OS44MzIgMTE2LjAyIDc4LjIxOCA0NS4wMTkgMTkuMDQyIDkyLjgyNSAyOC42OTYgMTQyLjA5MyAyOC42OTYgNDkuMjY4IDAgOTcuMDczLTkuNjU0IDE0Mi4wOTMtMjguNjk2IDQzLjQ2OS0xOC4zODYgODIuNTA1LTQ0LjcwMiAxMTYuMDItNzguMjE4IDMzLjUxNi0zMy41MTUgNTkuODMyLTcyLjU1IDc4LjIxOC0xMTYuMDIgMTkuMDQxLTQ1LjAyIDI4LjY5Ni05Mi44MjYgMjguNjk2LTE0Mi4wOTMgMC0xNC4xMjgtMTEuNDUzLTI1LjU4Mi0yNS41ODItMjUuNTgyeiIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHRleHQgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIyODgiPjx0c3BhbiB4PSIyMTEiIHk9IjYzNCI+MTA8L3RzcGFuPjwvdGV4dD48L2c+PC9zdmc+")}chimee-center-state.volume-high span{background-image:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTA3IiBoZWlnaHQ9IjEwMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBzdHJva2U9IiNGRkYiPjxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik0xLjQwNyAzMEgyOC42NUw1OC4zNzQgMGwxLjEwMiAxMDBMMjguNjUgNzBIMS40MDd6Ii8+PHBhdGggZD0iTTY0LjYxMiA1LjAxYzYuMDk2LS4yMjQgMTMuMDQzIDMuMzk5IDIwLjg0IDEwLjg2NyAxMS42OTcgMTEuMjAzIDE2LjUxOSAxOC45MiAxNi41MTkgMzUuMDg0IDAgMTYuMTYzLTQuNjgyIDIyLjgzLTE2LjUxOCAzMi44Ny03Ljg5MSA2LjY5My0xNC44MzggMTAuMjAxLTIwLjg0MSAxMC41MjQiIHN0cm9rZS13aWR0aD0iMTAiLz48cGF0aCBkPSJNNjYuODUgMjkuNDkzYzIuNjg3LS4xIDUuNzQ4IDEuNTE3IDkuMTg0IDQuODUgNS4xNTUgNSA3LjI4IDguNDQ0IDcuMjggMTUuNjU3IDAgNy4yMTMtMi4wNjQgMTAuMTg5LTcuMjggMTQuNjctMy40NzcgMi45ODYtNi41MzggNC41NTItOS4xODMgNC42OTYiIHN0cm9rZS13aWR0aD0iMTAiLz48L2c+PC9zdmc+")}chimee-center-state.volume-low span{background-image:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODkiIGhlaWdodD0iMTAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxnIHN0cm9rZT0iI0ZGRiI+PHBhdGggZmlsbD0iI2ZmZiIgZD0iTTEuNDA3IDMwSDI4LjY1TDU4LjM3NCAwbDEuMTAyIDEwMEwyOC42NSA3MEgxLjQwN3oiLz48cGF0aCBkPSJNNjYuODUgMjkuNDkzYzIuNjg3LS4xIDUuNzQ4IDEuNTE3IDkuMTg0IDQuODUgNS4xNTUgNSA3LjI4IDguNDQ0IDcuMjggMTUuNjU3IDAgNy4yMTMtMi4wNjQgMTAuMTg5LTcuMjggMTQuNjctMy40NzcgMi45ODYtNi41MzggNC41NTItOS4xODMgNC42OTYiIHN0cm9rZS13aWR0aD0iMTAiLz48L2c+PC9zdmc+")}chimee-center-state-tip span{display:inline-block;width:24px;height:24px;margin:14px;background-origin:content-box;background-size:auto 100%;background-repeat:no-repeat;background-position:50%;box-sizing:initial}chimee-center-state.play span{background-position:110% 50%}chimee-center-state-loading{width:52px;height:52px;padding:26px;background-image:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEwIC0xMCkiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0iI0ZGRiI+PHJlY3QgeD0iNDciIHk9IjEwIiB3aWR0aD0iNiIgaGVpZ2h0PSIyMCIgcng9IjMiLz48cmVjdCBmaWxsLW9wYWNpdHk9Ii45IiB0cmFuc2Zvcm09InJvdGF0ZSgzMCA2NSAyNC4wMikiIHg9IjYyIiB5PSIxNC4wMTkiIHdpZHRoPSI2IiBoZWlnaHQ9IjIwIiByeD0iMyIvPjxyZWN0IGZpbGwtb3BhY2l0eT0iLjgiIHRyYW5zZm9ybT0icm90YXRlKDYwIDc1Ljk4IDM1KSIgeD0iNzIuOTgxIiB5PSIyNSIgd2lkdGg9IjYiIGhlaWdodD0iMjAiIHJ4PSIzIi8+PHJlY3QgZmlsbC1vcGFjaXR5PSIuNyIgdHJhbnNmb3JtPSJyb3RhdGUoOTAgODAgNTApIiB4PSI3NyIgeT0iNDAiIHdpZHRoPSI2IiBoZWlnaHQ9IjIwIiByeD0iMyIvPjxyZWN0IGZpbGwtb3BhY2l0eT0iLjYiIHRyYW5zZm9ybT0icm90YXRlKDEyMCA3NS45OCA2NSkiIHg9IjcyLjk4MSIgeT0iNTUiIHdpZHRoPSI2IiBoZWlnaHQ9IjIwIiByeD0iMyIvPjxyZWN0IGZpbGwtb3BhY2l0eT0iLjUiIHRyYW5zZm9ybT0icm90YXRlKDE1MCA2NSA3NS45OCkiIHg9IjYyIiB5PSI2NS45ODEiIHdpZHRoPSI2IiBoZWlnaHQ9IjIwIiByeD0iMyIvPjxyZWN0IGZpbGwtb3BhY2l0eT0iLjQiIHRyYW5zZm9ybT0icm90YXRlKDE4MCA1MCA4MCkiIHg9IjQ3IiB5PSI3MCIgd2lkdGg9IjYiIGhlaWdodD0iMjAiIHJ4PSIzIi8+PHJlY3QgZmlsbC1vcGFjaXR5PSIuMyIgdHJhbnNmb3JtPSJyb3RhdGUoLTE1MCAzNSA3NS45OCkiIHg9IjMyIiB5PSI2NS45ODEiIHdpZHRoPSI2IiBoZWlnaHQ9IjIwIiByeD0iMyIvPjxyZWN0IGZpbGwtb3BhY2l0eT0iLjIiIHRyYW5zZm9ybT0icm90YXRlKC0xMjAgMjQuMDIgNjUpIiB4PSIyMS4wMTkiIHk9IjU1IiB3aWR0aD0iNiIgaGVpZ2h0PSIyMCIgcng9IjMiLz48cmVjdCBmaWxsLW9wYWNpdHk9Ii4zIiB0cmFuc2Zvcm09InJvdGF0ZSgtOTAgMjAgNTApIiB4PSIxNyIgeT0iNDAiIHdpZHRoPSI2IiBoZWlnaHQ9IjIwIiByeD0iMyIvPjxyZWN0IGZpbGwtb3BhY2l0eT0iLjQiIHRyYW5zZm9ybT0icm90YXRlKC02MCAyNC4wMiAzNSkiIHg9IjIxLjAxOSIgeT0iMjUiIHdpZHRoPSI2IiBoZWlnaHQ9IjIwIiByeD0iMyIvPjxyZWN0IGZpbGwtb3BhY2l0eT0iLjUiIHRyYW5zZm9ybT0icm90YXRlKC0zMCAzNSAyNC4wMikiIHg9IjMyIiB5PSIxNC4wMTkiIHdpZHRoPSI2IiBoZWlnaHQ9IjIwIiByeD0iMyIvPjwvZz48L3N2Zz4=");background-origin:content-box;background-size:auto 100%;background-repeat:no-repeat;background-position:50%;animation:loading 1.2s linear infinite}chimee-center-state-error{display:none;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:180px;font-size:16px;z-index:9;color:#ffcf00;text-shadow:0 0 3px red;font-weight:100;text-align:center}
        chimee-popup{position:absolute;color:#fff;background-color:rgba(88,88,88,.5);font-size:13px;font-family:sans-serif;border:1px solid hsla(0,0%,100%,.08);padding:3px}chimee-popup cm-pp-close{float:right;color:#fff;text-decoration:none;line-height:14px;text-shadow:0 0 1px #000;font-size:15px;padding:0 3px;cursor:pointer;opacity:.8}chimee-popup cm-pp-close:hover{opacity:1}chimee-popup cm-pp-body,chimee-popup cm-pp-head{display:block;padding:3px 3px 6px}chimee-popup cm-pp-head{font-weight:700;border-bottom:1px solid hsla(0,0%,100%,.18);padding:0 5px 4px;margin-bottom:5px}chimee-popup cm-pp-body{font-size:12px}
    </style>
    <script>
        /**
         * Minified by jsDelivr using Terser v3.14.1.
         * Original file: /npm/chimee-player@1.4.8/lib/chimee-player.browser.js
         * 
         * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
         */
        !function (e, t) { "object" == typeof exports && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define(t) : e.ChimeePlayer = t() }(this, function () { "use strict"; var e = function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }, t = "undefined" != typeof window ? window : "undefined" != typeof global ? global : "undefined" != typeof self ? self : {}; function r(e) { return e && e.__esModule && Object.prototype.hasOwnProperty.call(e, "default") ? e.default : e } function n(e, t) { return e(t = { exports: {} }, t.exports), t.exports } var i = n(function (e) { function t(e) { return (t = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } function r(n) { return "function" == typeof Symbol && "symbol" === t(Symbol.iterator) ? e.exports = r = function (e) { return t(e) } : e.exports = r = function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : t(e) }, r(n) } e.exports = r }); var o = function (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e }; var a = function (e, t) { return !t || "object" !== i(t) && "function" != typeof t ? o(e) : t }, s = n(function (e) { function t(r) { return e.exports = t = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, t(r) } e.exports = t }), u = n(function (e) { function t(r, n) { return e.exports = t = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, t(r, n) } e.exports = t }); var l = function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && u(e, t) }, c = Math.ceil, f = Math.floor, d = function (e) { return isNaN(e = +e) ? 0 : (e > 0 ? f : c)(e) }, h = function (e) { if (null == e) throw TypeError("Can't call method on  " + e); return e }, p = n(function (e) { var t = e.exports = "undefined" != typeof window && window.Math == Math ? window : "undefined" != typeof self && self.Math == Math ? self : Function("return this")(); "number" == typeof __g && (__g = t) }), m = n(function (e) { var t = e.exports = { version: "2.5.7" }; "number" == typeof __e && (__e = t) }), y = (m.version, function (e) { if ("function" != typeof e) throw TypeError(e + " is not a function!"); return e }), g = function (e, t, r) { if (y(e), void 0 === t) return e; switch (r) { case 1: return function (r) { return e.call(t, r) }; case 2: return function (r, n) { return e.call(t, r, n) }; case 3: return function (r, n, i) { return e.call(t, r, n, i) } }return function () { return e.apply(t, arguments) } }, b = function (e) { return "object" == typeof e ? null !== e : "function" == typeof e }, _ = function (e) { if (!b(e)) throw TypeError(e + " is not an object!"); return e }, w = function (e) { try { return !!e() } catch (e) { return !0 } }, E = !w(function () { return 7 != Object.defineProperty({}, "a", { get: function () { return 7 } }).a }), S = p.document, k = b(S) && b(S.createElement), T = function (e) { return k ? S.createElement(e) : {} }, A = !E && !w(function () { return 7 != Object.defineProperty(T("div"), "a", { get: function () { return 7 } }).a }), R = function (e, t) { if (!b(e)) return e; var r, n; if (t && "function" == typeof (r = e.toString) && !b(n = r.call(e))) return n; if ("function" == typeof (r = e.valueOf) && !b(n = r.call(e))) return n; if (!t && "function" == typeof (r = e.toString) && !b(n = r.call(e))) return n; throw TypeError("Can't convert object to primitive value") }, O = Object.defineProperty, L = { f: E ? Object.defineProperty : function (e, t, r) { if (_(e), t = R(t, !0), _(r), A) try { return O(e, t, r) } catch (e) { } if ("get" in r || "set" in r) throw TypeError("Accessors not supported!"); return "value" in r && (e[t] = r.value), e } }, x = function (e, t) { return { enumerable: !(1 & e), configurable: !(2 & e), writable: !(4 & e), value: t } }, P = E ? function (e, t, r) { return L.f(e, t, x(1, r)) } : function (e, t, r) { return e[t] = r, e }, C = {}.hasOwnProperty, D = function (e, t) { return C.call(e, t) }, I = function (e, t, r) { var n, i, o, a = e & I.F, s = e & I.G, u = e & I.S, l = e & I.P, c = e & I.B, f = e & I.W, d = s ? m : m[t] || (m[t] = {}), h = d.prototype, v = s ? p : u ? p[t] : (p[t] || {}).prototype; for (n in s && (r = t), r) (i = !a && v && void 0 !== v[n]) && D(d, n) || (o = i ? v[n] : r[n], d[n] = s && "function" != typeof v[n] ? r[n] : c && i ? g(o, p) : f && v[n] == o ? function (e) { var t = function (t, r, n) { if (this instanceof e) { switch (arguments.length) { case 0: return new e; case 1: return new e(t); case 2: return new e(t, r) }return new e(t, r, n) } return e.apply(this, arguments) }; return t.prototype = e.prototype, t }(o) : l && "function" == typeof o ? g(Function.call, o) : o, l && ((d.virtual || (d.virtual = {}))[n] = o, e & I.R && h && !h[n] && P(h, n, o))) }; I.F = 1, I.G = 2, I.S = 4, I.P = 8, I.B = 16, I.W = 32, I.U = 64, I.R = 128; var M, N = I, F = P, B = {}, U = {}.toString, j = function (e) { return U.call(e).slice(8, -1) }, G = Object("z").propertyIsEnumerable(0) ? Object : function (e) { return "String" == j(e) ? e.split("") : Object(e) }, $ = function (e) { return G(h(e)) }, z = Math.min, K = function (e) { return e > 0 ? z(d(e), 9007199254740991) : 0 }, V = Math.max, W = Math.min, H = n(function (e) { var t = p["__core-js_shared__"] || (p["__core-js_shared__"] = {}); (e.exports = function (e, r) { return t[e] || (t[e] = void 0 !== r ? r : {}) })("versions", []).push({ version: m.version, mode: "pure", copyright: "© 2018 Denis Pushkarev (zloirock.ru)" }) }), q = 0, Y = Math.random(), X = function (e) { return "Symbol(".concat(void 0 === e ? "" : e, ")_", (++q + Y).toString(36)) }, Q = H("keys"), J = function (e) { return Q[e] || (Q[e] = X(e)) }, Z = (M = !1, function (e, t, r) { var n, i = $(e), o = K(i.length), a = function (e, t) { return (e = d(e)) < 0 ? V(e + t, 0) : W(e, t) }(r, o); if (M && t != t) { for (; o > a;)if ((n = i[a++]) != n) return !0 } else for (; o > a; a++)if ((M || a in i) && i[a] === t) return M || a || 0; return !M && -1 }), ee = J("IE_PROTO"), te = function (e, t) { var r, n = $(e), i = 0, o = []; for (r in n) r != ee && D(n, r) && o.push(r); for (; t.length > i;)D(n, r = t[i++]) && (~Z(o, r) || o.push(r)); return o }, re = "constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","), ne = Object.keys || function (e) { return te(e, re) }, ie = E ? Object.defineProperties : function (e, t) { _(e); for (var r, n = ne(t), i = n.length, o = 0; i > o;)L.f(e, r = n[o++], t[r]); return e }, oe = p.document, ae = oe && oe.documentElement, se = J("IE_PROTO"), ue = function () { }, le = function () { var e, t = T("iframe"), r = re.length; for (t.style.display = "none", ae.appendChild(t), t.src = "javascript:", (e = t.contentWindow.document).open(), e.write("<script>document.F=Object<\/script>"), e.close(), le = e.F; r--;)delete le.prototype[re[r]]; return le() }, ce = Object.create || function (e, t) { var r; return null !== e ? (ue.prototype = _(e), r = new ue, ue.prototype = null, r[se] = e) : r = le(), void 0 === t ? r : ie(r, t) }, fe = n(function (e) { var t = H("wks"), r = p.Symbol, n = "function" == typeof r; (e.exports = function (e) { return t[e] || (t[e] = n && r[e] || (n ? r : X)("Symbol." + e)) }).store = t }), de = L.f, he = fe("toStringTag"), pe = function (e, t, r) { e && !D(e = r ? e : e.prototype, he) && de(e, he, { configurable: !0, value: t }) }, ve = {}; P(ve, fe("iterator"), function () { return this }); var me, ye = function (e, t, r) { e.prototype = ce(ve, { next: x(1, r) }), pe(e, t + " Iterator") }, ge = function (e) { return Object(h(e)) }, be = J("IE_PROTO"), _e = Object.prototype, we = Object.getPrototypeOf || function (e) { return e = ge(e), D(e, be) ? e[be] : "function" == typeof e.constructor && e instanceof e.constructor ? e.constructor.prototype : e instanceof Object ? _e : null }, Ee = fe("iterator"), Se = !([].keys && "next" in [].keys()), ke = function () { return this }, Te = function (e, t, r, n, i, o, a) { ye(r, t, n); var s, u, l, c = function (e) { if (!Se && e in p) return p[e]; switch (e) { case "keys": case "values": return function () { return new r(this, e) } }return function () { return new r(this, e) } }, f = t + " Iterator", d = "values" == i, h = !1, p = e.prototype, v = p[Ee] || p["@@iterator"] || i && p[i], m = v || c(i), y = i ? d ? c("entries") : m : void 0, g = "Array" == t && p.entries || v; if (g && (l = we(g.call(new e))) !== Object.prototype && l.next && pe(l, f, !0), d && v && "values" !== v.name && (h = !0, m = function () { return v.call(this) }), a && (Se || h || !p[Ee]) && P(p, Ee, m), B[t] = m, B[f] = ke, i) if (s = { values: d ? m : c("values"), keys: o ? m : c("keys"), entries: y }, a) for (u in s) u in p || F(p, u, s[u]); else N(N.P + N.F * (Se || h), t, s); return s }, Ae = (me = !0, function (e, t) { var r, n, i = String(h(e)), o = d(t), a = i.length; return o < 0 || o >= a ? me ? "" : void 0 : (r = i.charCodeAt(o)) < 55296 || r > 56319 || o + 1 === a || (n = i.charCodeAt(o + 1)) < 56320 || n > 57343 ? me ? i.charAt(o) : r : me ? i.slice(o, o + 2) : n - 56320 + (r - 55296 << 10) + 65536 }); Te(String, "String", function (e) { this._t = String(e), this._i = 0 }, function () { var e, t = this._t, r = this._i; return r >= t.length ? { value: void 0, done: !0 } : (e = Ae(t, r), this._i += e.length, { value: e, done: !1 }) }); var Re = function (e, t) { return { value: t, done: !!e } }; Te(Array, "Array", function (e, t) { this._t = $(e), this._i = 0, this._k = t }, function () { var e = this._t, t = this._k, r = this._i++; return !e || r >= e.length ? (this._t = void 0, Re(1)) : Re(0, "keys" == t ? r : "values" == t ? e[r] : [r, e[r]]) }, "values"); B.Arguments = B.Array; for (var Oe = fe("toStringTag"), Le = "CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","), xe = 0; xe < Le.length; xe++) { var Pe = Le[xe], Ce = p[Pe], De = Ce && Ce.prototype; De && !De[Oe] && P(De, Oe, Pe), B[Pe] = B.Array } var Ie = { f: fe }, Me = Ie.f("iterator"), Ne = n(function (e) { e.exports = { default: Me, __esModule: !0 } }); r(Ne); var Fe = n(function (e) { var t = X("meta"), r = L.f, n = 0, i = Object.isExtensible || function () { return !0 }, o = !w(function () { return i(Object.preventExtensions({})) }), a = function (e) { r(e, t, { value: { i: "O" + ++n, w: {} } }) }, s = e.exports = { KEY: t, NEED: !1, fastKey: function (e, r) { if (!b(e)) return "symbol" == typeof e ? e : ("string" == typeof e ? "S" : "P") + e; if (!D(e, t)) { if (!i(e)) return "F"; if (!r) return "E"; a(e) } return e[t].i }, getWeak: function (e, r) { if (!D(e, t)) { if (!i(e)) return !0; if (!r) return !1; a(e) } return e[t].w }, onFreeze: function (e) { return o && s.NEED && i(e) && !D(e, t) && a(e), e } } }), Be = (Fe.KEY, Fe.NEED, Fe.fastKey, Fe.getWeak, Fe.onFreeze, L.f), Ue = function (e) { var t = m.Symbol || (m.Symbol = {}); "_" == e.charAt(0) || e in t || Be(t, e, { value: Ie.f(e) }) }, je = { f: Object.getOwnPropertySymbols }, Ge = { f: {}.propertyIsEnumerable }, $e = Array.isArray || function (e) { return "Array" == j(e) }, ze = re.concat("length", "prototype"), Ke = { f: Object.getOwnPropertyNames || function (e) { return te(e, ze) } }, Ve = Ke.f, We = {}.toString, He = "object" == typeof window && window && Object.getOwnPropertyNames ? Object.getOwnPropertyNames(window) : [], qe = { f: function (e) { return He && "[object Window]" == We.call(e) ? function (e) { try { return Ve(e) } catch (e) { return He.slice() } }(e) : Ve($(e)) } }, Ye = Object.getOwnPropertyDescriptor, Xe = { f: E ? Ye : function (e, t) { if (e = $(e), t = R(t, !0), A) try { return Ye(e, t) } catch (e) { } if (D(e, t)) return x(!Ge.f.call(e, t), e[t]) } }, Qe = Fe.KEY, Je = Xe.f, Ze = L.f, et = qe.f, tt = p.Symbol, rt = p.JSON, nt = rt && rt.stringify, it = fe("_hidden"), ot = fe("toPrimitive"), at = {}.propertyIsEnumerable, st = H("symbol-registry"), ut = H("symbols"), lt = H("op-symbols"), ct = Object.prototype, ft = "function" == typeof tt, dt = p.QObject, ht = !dt || !dt.prototype || !dt.prototype.findChild, pt = E && w(function () { return 7 != ce(Ze({}, "a", { get: function () { return Ze(this, "a", { value: 7 }).a } })).a }) ? function (e, t, r) { var n = Je(ct, t); n && delete ct[t], Ze(e, t, r), n && e !== ct && Ze(ct, t, n) } : Ze, vt = function (e) { var t = ut[e] = ce(tt.prototype); return t._k = e, t }, mt = ft && "symbol" == typeof tt.iterator ? function (e) { return "symbol" == typeof e } : function (e) { return e instanceof tt }, yt = function (e, t, r) { return e === ct && yt(lt, t, r), _(e), t = R(t, !0), _(r), D(ut, t) ? (r.enumerable ? (D(e, it) && e[it][t] && (e[it][t] = !1), r = ce(r, { enumerable: x(0, !1) })) : (D(e, it) || Ze(e, it, x(1, {})), e[it][t] = !0), pt(e, t, r)) : Ze(e, t, r) }, gt = function (e, t) { _(e); for (var r, n = function (e) { var t = ne(e), r = je.f; if (r) for (var n, i = r(e), o = Ge.f, a = 0; i.length > a;)o.call(e, n = i[a++]) && t.push(n); return t }(t = $(t)), i = 0, o = n.length; o > i;)yt(e, r = n[i++], t[r]); return e }, bt = function (e) { var t = at.call(this, e = R(e, !0)); return !(this === ct && D(ut, e) && !D(lt, e)) && (!(t || !D(this, e) || !D(ut, e) || D(this, it) && this[it][e]) || t) }, _t = function (e, t) { if (e = $(e), t = R(t, !0), e !== ct || !D(ut, t) || D(lt, t)) { var r = Je(e, t); return !r || !D(ut, t) || D(e, it) && e[it][t] || (r.enumerable = !0), r } }, wt = function (e) { for (var t, r = et($(e)), n = [], i = 0; r.length > i;)D(ut, t = r[i++]) || t == it || t == Qe || n.push(t); return n }, Et = function (e) { for (var t, r = e === ct, n = et(r ? lt : $(e)), i = [], o = 0; n.length > o;)!D(ut, t = n[o++]) || r && !D(ct, t) || i.push(ut[t]); return i }; ft || (F((tt = function () { if (this instanceof tt) throw TypeError("Symbol is not a constructor!"); var e = X(arguments.length > 0 ? arguments[0] : void 0), t = function (r) { this === ct && t.call(lt, r), D(this, it) && D(this[it], e) && (this[it][e] = !1), pt(this, e, x(1, r)) }; return E && ht && pt(ct, e, { configurable: !0, set: t }), vt(e) }).prototype, "toString", function () { return this._k }), Xe.f = _t, L.f = yt, Ke.f = qe.f = wt, Ge.f = bt, je.f = Et, Ie.f = function (e) { return vt(fe(e)) }), N(N.G + N.W + N.F * !ft, { Symbol: tt }); for (var St = "hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","), kt = 0; St.length > kt;)fe(St[kt++]); for (var Tt = ne(fe.store), At = 0; Tt.length > At;)Ue(Tt[At++]); N(N.S + N.F * !ft, "Symbol", { for: function (e) { return D(st, e += "") ? st[e] : st[e] = tt(e) }, keyFor: function (e) { if (!mt(e)) throw TypeError(e + " is not a symbol!"); for (var t in st) if (st[t] === e) return t }, useSetter: function () { ht = !0 }, useSimple: function () { ht = !1 } }), N(N.S + N.F * !ft, "Object", { create: function (e, t) { return void 0 === t ? ce(e) : gt(ce(e), t) }, defineProperty: yt, defineProperties: gt, getOwnPropertyDescriptor: _t, getOwnPropertyNames: wt, getOwnPropertySymbols: Et }), rt && N(N.S + N.F * (!ft || w(function () { var e = tt(); return "[null]" != nt([e]) || "{}" != nt({ a: e }) || "{}" != nt(Object(e)) })), "JSON", { stringify: function (e) { for (var t, r, n = [e], i = 1; arguments.length > i;)n.push(arguments[i++]); if (r = t = n[1], (b(t) || void 0 !== e) && !mt(e)) return $e(t) || (t = function (e, t) { if ("function" == typeof r && (t = r.call(this, e, t)), !mt(t)) return t }), n[1] = t, nt.apply(rt, n) } }), tt.prototype[ot] || P(tt.prototype, ot, tt.prototype.valueOf), pe(tt, "Symbol"), pe(Math, "Math", !0), pe(p.JSON, "JSON", !0), Ue("asyncIterator"), Ue("observable"); var Rt = m.Symbol, Ot = n(function (e) { e.exports = { default: Rt, __esModule: !0 } }); r(Ot); var Lt = n(function (e, t) { t.__esModule = !0; var r = o(Ne), n = o(Ot), i = "function" == typeof n.default && "symbol" == typeof r.default ? function (e) { return typeof e } : function (e) { return e && "function" == typeof n.default && e.constructor === n.default && e !== n.default.prototype ? "symbol" : typeof e }; function o(e) { return e && e.__esModule ? e : { default: e } } t.default = "function" == typeof n.default && "symbol" === i(r.default) ? function (e) { return void 0 === e ? "undefined" : i(e) } : function (e) { return e && "function" == typeof n.default && e.constructor === n.default && e !== n.default.prototype ? "symbol" : void 0 === e ? "undefined" : i(e) } }), xt = r(Lt), Pt = function (e, t) { var r = (m.Object || {})[e] || Object[e], n = {}; n[e] = t(r), N(N.S + N.F * w(function () { r(1) }), "Object", n) }; Pt("getPrototypeOf", function () { return function (e) { return we(ge(e)) } }); var Ct = m.Object.getPrototypeOf, Dt = n(function (e) { e.exports = { default: Ct, __esModule: !0 } }), It = r(Dt), Mt = r(n(function (e, t) { t.__esModule = !0, t.default = function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } })), Nt = r(n(function (e, t) { t.__esModule = !0; var r, n = (r = Lt) && r.__esModule ? r : { default: r }; t.default = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" !== (void 0 === t ? "undefined" : (0, n.default)(t)) && "function" != typeof t ? e : t } })); N(N.S + N.F * !E, "Object", { defineProperty: L.f }); var Ft = m.Object, Bt = function (e, t, r) { return Ft.defineProperty(e, t, r) }, Ut = n(function (e) { e.exports = { default: Bt, __esModule: !0 } }), jt = r(Ut), Gt = r(n(function (e, t) { t.__esModule = !0; var r, n = (r = Ut) && r.__esModule ? r : { default: r }; t.default = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var i = t[r]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), (0, n.default)(e, i.key, i) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }() })), $t = function (e, t) { if (_(e), !b(t) && null !== t) throw TypeError(t + ": can't set as prototype!") }, zt = { set: Object.setPrototypeOf || ("__proto__" in {} ? function (e, t, r) { try { (r = g(Function.call, Xe.f(Object.prototype, "__proto__").set, 2))(e, []), t = !(e instanceof Array) } catch (e) { t = !0 } return function (e, n) { return $t(e, n), t ? e.__proto__ = n : r(e, n), e } }({}, !1) : void 0), check: $t }; N(N.S, "Object", { setPrototypeOf: zt.set }); var Kt = m.Object.setPrototypeOf, Vt = n(function (e) { e.exports = { default: Kt, __esModule: !0 } }); r(Vt), N(N.S, "Object", { create: ce }); var Wt = m.Object, Ht = function (e, t) { return Wt.create(e, t) }, qt = n(function (e) { e.exports = { default: Ht, __esModule: !0 } }), Yt = r(qt), Xt = r(n(function (e, t) { t.__esModule = !0; var r = o(Vt), n = o(qt), i = o(Lt); function o(e) { return e && e.__esModule ? e : { default: e } } t.default = function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + (void 0 === t ? "undefined" : (0, i.default)(t))); e.prototype = (0, n.default)(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (r.default ? (0, r.default)(e, t) : e.__proto__ = t) } })); Pt("keys", function () { return function (e) { return ne(ge(e)) } }); var Qt = m.Object.keys, Jt = r(n(function (e) { e.exports = { default: Qt, __esModule: !0 } })), Zt = Math.floor; N(N.S, "Number", { isInteger: function (e) { return !b(e) && isFinite(e) && Zt(e) === e } }); var er = m.Number.isInteger, tr = r(n(function (e) { e.exports = { default: er, __esModule: !0 } })), rr = "\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff", nr = "[" + rr + "]", ir = RegExp("^" + nr + nr + "*"), or = RegExp(nr + nr + "*$"), ar = function (e, t, r) { var n = {}, i = w(function () { return !!rr[e]() || "​" != "​"[e]() }), o = n[e] = i ? t(sr) : rr[e]; r && (n[r] = o), N(N.P + N.F * i, "String", n) }, sr = ar.trim = function (e, t) { return e = String(h(e)), 1 & t && (e = e.replace(ir, "")), 2 & t && (e = e.replace(or, "")), e }, ur = ar, lr = p.parseFloat, cr = ur.trim, fr = 1 / lr(rr + "-0") != -1 / 0 ? function (e) { var t = cr(String(e), 3), r = lr(t); return 0 === r && "-" == t.charAt(0) ? -0 : r } : lr; N(N.S + N.F * (Number.parseFloat != fr), "Number", { parseFloat: fr }); var dr = m.Number.parseFloat, hr = r(n(function (e) { e.exports = { default: dr, __esModule: !0 } })); function pr(e) { return void 0 !== e } function vr(e) { return null == e } function mr(e) { return Array.isArray(e) } function yr(e) { return "function" == typeof e } function gr(e) { return Object(e) === e && "[object Object]" === String(e) && !yr(e) && !mr(e) } function br(e) { return "number" == typeof e } function _r(e) { return tr(e) } function wr(e) { return mr(e) ? 0 === e.length : gr(e) ? 0 === Jt(e).length : !e } function Er(e) { return e instanceof Event || (e && e.originalEvent) instanceof Event } function Sr(e) { return "string" == typeof e || e instanceof String } function kr(e) { return "boolean" == typeof e } function Tr(e) { return !!e && ("object" === (void 0 === e ? "undefined" : xt(e)) || "function" == typeof e) && "function" == typeof e.then } function Ar(e) { return vr(e) || kr(e) || Sr(e) || br(e) } function Rr(e) { return !!("object" === ("undefined" == typeof Node ? "undefined" : xt(Node)) ? e instanceof Node : e && "object" === (void 0 === e ? "undefined" : xt(e)) && "number" == typeof e.nodeType && "string" == typeof e.nodeName) } function Or(e) { return !!("object" === ("undefined" == typeof HTMLElement ? "undefined" : xt(HTMLElement)) ? e instanceof HTMLElement : e && "object" === (void 0 === e ? "undefined" : xt(e)) && null !== e && 1 === e.nodeType && "string" == typeof e.nodeName) } function Lr(e, t) { if (!Rr(e) || !Rr(t)) return !1; for (; t.parentNode;)if ((t = t.parentNode) === e) return !0; return !1 } function xr(e) { return e instanceof Error } function Pr(e, t) { if (!Sr(e)) throw new TypeError("Log's method only acccept string as argument, but not " + e + " in " + (void 0 === e ? "undefined" : xt(e))); return Sr(t) ? "[" + (e = Cr.FORCE_GLOBAL_TAG ? Cr.GLOBAL_TAG : e || Cr.GLOBAL_TAG) + "] > " + t : "[" + Cr.GLOBAL_TAG + "] > " + e } var Cr = function () { function e() { Mt(this, e) } return Gt(e, null, [{ key: "error", value: function (t, r) { e.ENABLE_ERROR && (console.error || console.warn || console.log).call(console, Pr(t, r)) } }, { key: "info", value: function (t, r) { e.ENABLE_INFO && (console.info || console.log).call(console, Pr(t, r)) } }, { key: "warn", value: function (t, r) { e.ENABLE_WARN && (console.warn || console.log).call(console, Pr(t, r)) } }, { key: "debug", value: function (t, r) { e.ENABLE_DEBUG && (console.debug || console.log).call(console, Pr(t, r)) } }, { key: "verbose", value: function (t, r) { e.ENABLE_VERBOSE && console.log(Pr(t, r)) } }]), e }(); Cr.GLOBAL_TAG = "chimee", Cr.FORCE_GLOBAL_TAG = !1, Cr.ENABLE_ERROR = !0, Cr.ENABLE_INFO = !0, Cr.ENABLE_WARN = !0, Cr.ENABLE_DEBUG = !0, Cr.ENABLE_VERBOSE = !0; n(function (e, r) { !function (t, n) { var i = "model", o = "name", a = "type", s = "vendor", u = "version", l = "mobile", c = "tablet", f = { extend: function (e, t) { var r = {}; for (var n in e) t[n] && t[n].length % 2 == 0 ? r[n] = t[n].concat(e[n]) : r[n] = e[n]; return r }, has: function (e, t) { return "string" == typeof e && -1 !== t.toLowerCase().indexOf(e.toLowerCase()) }, lowerize: function (e) { return e.toLowerCase() }, major: function (e) { return "string" == typeof e ? e.replace(/[^\d\.]/g, "").split(".")[0] : void 0 }, trim: function (e) { return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, "") } }, d = { rgx: function (e, t) { for (var r, n, i, o, a, s, u = 0; u < t.length && !a;) { var l = t[u], c = t[u + 1]; for (r = n = 0; r < l.length && !a;)if (a = l[r++].exec(e)) for (i = 0; i < c.length; i++)s = a[++n], "object" == typeof (o = c[i]) && o.length > 0 ? 2 == o.length ? "function" == typeof o[1] ? this[o[0]] = o[1].call(this, s) : this[o[0]] = o[1] : 3 == o.length ? "function" != typeof o[1] || o[1].exec && o[1].test ? this[o[0]] = s ? s.replace(o[1], o[2]) : void 0 : this[o[0]] = s ? o[1].call(this, s, o[2]) : void 0 : 4 == o.length && (this[o[0]] = s ? o[3].call(this, s.replace(o[1], o[2])) : void 0) : this[o] = s || void 0; u += 2 } }, str: function (e, t) { for (var r in t) if ("object" == typeof t[r] && t[r].length > 0) { for (var n = 0; n < t[r].length; n++)if (f.has(t[r][n], e)) return "?" === r ? void 0 : r } else if (f.has(t[r], e)) return "?" === r ? void 0 : r; return e } }, h = { browser: { oldsafari: { version: { "1.0": "/8", 1.2: "/1", 1.3: "/3", "2.0": "/412", "2.0.2": "/416", "2.0.3": "/417", "2.0.4": "/419", "?": "/" } } }, device: { amazon: { model: { "Fire Phone": ["SD", "KF"] } }, sprint: { model: { "Evo Shift 4G": "7373KT" }, vendor: { HTC: "APA", Sprint: "Sprint" } } }, os: { windows: { version: { ME: "4.90", "NT 3.11": "NT3.51", "NT 4.0": "NT4.0", 2000: "NT 5.0", XP: ["NT 5.1", "NT 5.2"], Vista: "NT 6.0", 7: "NT 6.1", 8: "NT 6.2", 8.1: "NT 6.3", 10: ["NT 6.4", "NT 10.0"], RT: "ARM" } } } }, p = { browser: [[/(opera\smini)\/([\w\.-]+)/i, /(opera\s[mobiletab]+).+version\/([\w\.-]+)/i, /(opera).+version\/([\w\.]+)/i, /(opera)[\/\s]+([\w\.]+)/i], [o, u], [/(opios)[\/\s]+([\w\.]+)/i], [[o, "Opera Mini"], u], [/\s(opr)\/([\w\.]+)/i], [[o, "Opera"], u], [/(kindle)\/([\w\.]+)/i, /(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i, /(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i, /(?:ms|\()(ie)\s([\w\.]+)/i, /(rekonq)\/([\w\.]*)/i, /(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark)\/([\w\.-]+)/i], [o, u], [/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i], [[o, "IE"], u], [/(edge|edgios|edga)\/((\d+)?[\w\.]+)/i], [[o, "Edge"], u], [/(yabrowser)\/([\w\.]+)/i], [[o, "Yandex"], u], [/(puffin)\/([\w\.]+)/i], [[o, "Puffin"], u], [/(focus)\/([\w\.]+)/i], [[o, "Firefox Focus"], u], [/(opt)\/([\w\.]+)/i], [[o, "Opera Touch"], u], [/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i], [[o, "UCBrowser"], u], [/(comodo_dragon)\/([\w\.]+)/i], [[o, /_/g, " "], u], [/(micromessenger)\/([\w\.]+)/i], [[o, "WeChat"], u], [/(brave)\/([\w\.]+)/i], [[o, "Brave"], u], [/(qqbrowserlite)\/([\w\.]+)/i], [o, u], [/(QQ)\/([\d\.]+)/i], [o, u], [/m?(qqbrowser)[\/\s]?([\w\.]+)/i], [o, u], [/(BIDUBrowser)[\/\s]?([\w\.]+)/i], [o, u], [/(2345Explorer)[\/\s]?([\w\.]+)/i], [o, u], [/(MetaSr)[\/\s]?([\w\.]+)/i], [o], [/(LBBROWSER)/i], [o], [/xiaomi\/miuibrowser\/([\w\.]+)/i], [u, [o, "MIUI Browser"]], [/;fbav\/([\w\.]+);/i], [u, [o, "Facebook"]], [/safari\s(line)\/([\w\.]+)/i, /android.+(line)\/([\w\.]+)\/iab/i], [o, u], [/headlesschrome(?:\/([\w\.]+)|\s)/i], [u, [o, "Chrome Headless"]], [/\swv\).+(chrome)\/([\w\.]+)/i], [[o, /(.+)/, "$1 WebView"], u], [/((?:oculus|samsung)browser)\/([\w\.]+)/i], [[o, /(.+(?:g|us))(.+)/, "$1 $2"], u], [/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i], [u, [o, "Android Browser"]], [/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i], [o, u], [/(dolfin)\/([\w\.]+)/i], [[o, "Dolphin"], u], [/((?:android.+)crmo|crios)\/([\w\.]+)/i], [[o, "Chrome"], u], [/(coast)\/([\w\.]+)/i], [[o, "Opera Coast"], u], [/fxios\/([\w\.-]+)/i], [u, [o, "Firefox"]], [/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i], [u, [o, "Mobile Safari"]], [/version\/([\w\.]+).+?(mobile\s?safari|safari)/i], [u, o], [/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i], [[o, "GSA"], u], [/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i], [o, [u, d.str, h.browser.oldsafari.version]], [/(konqueror)\/([\w\.]+)/i, /(webkit|khtml)\/([\w\.]+)/i], [o, u], [/(navigator|netscape)\/([\w\.-]+)/i], [[o, "Netscape"], u], [/(swiftfox)/i, /(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i, /(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i, /(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i, /(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i, /(links)\s\(([\w\.]+)/i, /(gobrowser)\/?([\w\.]*)/i, /(ice\s?browser)\/v?([\w\._]+)/i, /(mosaic)[\/\s]([\w\.]+)/i], [o, u]], cpu: [[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i], [["architecture", "amd64"]], [/(ia32(?=;))/i], [["architecture", f.lowerize]], [/((?:i[346]|x)86)[;\)]/i], [["architecture", "ia32"]], [/windows\s(ce|mobile);\sppc;/i], [["architecture", "arm"]], [/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i], [["architecture", /ower/, "", f.lowerize]], [/(sun4\w)[;\)]/i], [["architecture", "sparc"]], [/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+[;l]))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i], [["architecture", f.lowerize]]], device: [[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i], [i, s, [a, c]], [/applecoremedia\/[\w\.]+ \((ipad)/], [i, [s, "Apple"], [a, c]], [/(apple\s{0,1}tv)/i], [[i, "Apple TV"], [s, "Apple"]], [/(archos)\s(gamepad2?)/i, /(hp).+(touchpad)/i, /(hp).+(tablet)/i, /(kindle)\/([\w\.]+)/i, /\s(nook)[\w\s]+build\/(\w+)/i, /(dell)\s(strea[kpr\s\d]*[\dko])/i], [s, i, [a, c]], [/(kf[A-z]+)\sbuild\/.+silk\//i], [i, [s, "Amazon"], [a, c]], [/(sd|kf)[0349hijorstuw]+\sbuild\/.+silk\//i], [[i, d.str, h.device.amazon.model], [s, "Amazon"], [a, l]], [/android.+aft([bms])\sbuild/i], [i, [s, "Amazon"], [a, "smarttv"]], [/\((ip[honed|\s\w*]+);.+(apple)/i], [i, s, [a, l]], [/\((ip[honed|\s\w*]+);/i], [i, [s, "Apple"], [a, l]], [/(blackberry)[\s-]?(\w+)/i, /(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i, /(hp)\s([\w\s]+\w)/i, /(asus)-?(\w+)/i], [s, i, [a, l]], [/\(bb10;\s(\w+)/i], [i, [s, "BlackBerry"], [a, l]], [/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i], [i, [s, "Asus"], [a, c]], [/(sony)\s(tablet\s[ps])\sbuild\//i, /(sony)?(?:sgp.+)\sbuild\//i], [[s, "Sony"], [i, "Xperia Tablet"], [a, c]], [/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i], [i, [s, "Sony"], [a, l]], [/\s(ouya)\s/i, /(nintendo)\s([wids3u]+)/i], [s, i, [a, "console"]], [/android.+;\s(shield)\sbuild/i], [i, [s, "Nvidia"], [a, "console"]], [/(playstation\s[34portablevi]+)/i], [i, [s, "Sony"], [a, "console"]], [/(sprint\s(\w+))/i], [[s, d.str, h.device.sprint.vendor], [i, d.str, h.device.sprint.model], [a, l]], [/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i], [s, i, [a, c]], [/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i, /(zte)-(\w*)/i, /(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i], [s, [i, /_/g, " "], [a, l]], [/(nexus\s9)/i], [i, [s, "HTC"], [a, c]], [/d\/huawei([\w\s-]+)[;\)]/i, /(nexus\s6p)/i], [i, [s, "Huawei"], [a, l]], [/(microsoft);\s(lumia[\s\w]+)/i], [s, i, [a, l]], [/[\s\(;](xbox(?:\sone)?)[\s\);]/i], [i, [s, "Microsoft"], [a, "console"]], [/(kin\.[onetw]{3})/i], [[i, /\./g, " "], [s, "Microsoft"], [a, l]], [/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i, /mot[\s-]?(\w*)/i, /(XT\d{3,4}) build\//i, /(nexus\s6)/i], [i, [s, "Motorola"], [a, l]], [/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i], [i, [s, "Motorola"], [a, c]], [/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i], [[s, f.trim], [i, f.trim], [a, "smarttv"]], [/hbbtv.+maple;(\d+)/i], [[i, /^/, "SmartTV"], [s, "Samsung"], [a, "smarttv"]], [/\(dtv[\);].+(aquos)/i], [i, [s, "Sharp"], [a, "smarttv"]], [/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i, /((SM-T\w+))/i], [[s, "Samsung"], i, [a, c]], [/smart-tv.+(samsung)/i], [s, [a, "smarttv"], i], [/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i, /(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i, /sec-((sgh\w+))/i], [[s, "Samsung"], i, [a, l]], [/sie-(\w*)/i], [i, [s, "Siemens"], [a, l]], [/(maemo|nokia).*(n900|lumia\s\d+)/i, /(nokia)[\s_-]?([\w-]*)/i], [[s, "Nokia"], i, [a, l]], [/android\s3\.[\s\w;-]{10}(a\d{3})/i], [i, [s, "Acer"], [a, c]], [/android.+([vl]k\-?\d{3})\s+build/i], [i, [s, "LG"], [a, c]], [/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i], [[s, "LG"], i, [a, c]], [/(lg) netcast\.tv/i], [s, i, [a, "smarttv"]], [/(nexus\s[45])/i, /lg[e;\s\/-]+(\w*)/i, /android.+lg(\-?[\d\w]+)\s+build/i], [i, [s, "LG"], [a, l]], [/android.+(ideatab[a-z0-9\-\s]+)/i], [i, [s, "Lenovo"], [a, c]], [/linux;.+((jolla));/i], [s, i, [a, l]], [/((pebble))app\/[\d\.]+\s/i], [s, i, [a, "wearable"]], [/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i], [s, i, [a, l]], [/crkey/i], [[i, "Chromecast"], [s, "Google"]], [/android.+;\s(glass)\s\d/i], [i, [s, "Google"], [a, "wearable"]], [/android.+;\s(pixel c)[\s)]/i], [i, [s, "Google"], [a, c]], [/android.+;\s(pixel( [23])?( xl)?)\s/i], [i, [s, "Google"], [a, l]], [/android.+;\s(\w+)\s+build\/hm\1/i, /android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i, /android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d?\w?)[\s_]*(?:plus)?)\s+build/i, /android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+))\s+build/i], [[i, /_/g, " "], [s, "Xiaomi"], [a, l]], [/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+))\s+build/i], [[i, /_/g, " "], [s, "Xiaomi"], [a, c]], [/android.+;\s(m[1-5]\snote)\sbuild/i], [i, [s, "Meizu"], [a, c]], [/(mz)-([\w-]{2,})/i], [[s, "Meizu"], i, [a, l]], [/android.+a000(1)\s+build/i, /android.+oneplus\s(a\d{4})\s+build/i], [i, [s, "OnePlus"], [a, l]], [/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i], [i, [s, "RCA"], [a, c]], [/android.+[;\/\s]+(Venue[\d\s]{2,7})\s+build/i], [i, [s, "Dell"], [a, c]], [/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i], [i, [s, "Verizon"], [a, c]], [/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i], [[s, "Barnes & Noble"], i, [a, c]], [/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i], [i, [s, "NuVision"], [a, c]], [/android.+;\s(k88)\sbuild/i], [i, [s, "ZTE"], [a, c]], [/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i], [i, [s, "Swiss"], [a, l]], [/android.+[;\/]\s*(zur\d{3})\s+build/i], [i, [s, "Swiss"], [a, c]], [/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i], [i, [s, "Zeki"], [a, c]], [/(android).+[;\/]\s+([YR]\d{2})\s+build/i, /android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i], [[s, "Dragon Touch"], i, [a, c]], [/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i], [i, [s, "Insignia"], [a, c]], [/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i], [i, [s, "NextBook"], [a, c]], [/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i], [[s, "Voice"], i, [a, l]], [/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i], [[s, "LvTel"], i, [a, l]], [/android.+;\s(PH-1)\s/i], [i, [s, "Essential"], [a, l]], [/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i], [i, [s, "Envizen"], [a, c]], [/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i], [s, i, [a, c]], [/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i], [i, [s, "MachSpeed"], [a, c]], [/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i], [s, i, [a, c]], [/android.+[;\/]\s*TU_(1491)\s+build/i], [i, [s, "Rotor"], [a, c]], [/android.+(KS(.+))\s+build/i], [i, [s, "Amazon"], [a, c]], [/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i], [s, i, [a, c]], [/\s(tablet|tab)[;\/]/i, /\s(mobile)(?:[;\/]|\ssafari)/i], [[a, f.lowerize], s, i], [/(android[\w\.\s\-]{0,9});.+build/i], [i, [s, "Generic"]]], engine: [[/windows.+\sedge\/([\w\.]+)/i], [u, [o, "EdgeHTML"]], [/(presto)\/([\w\.]+)/i, /(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i, /(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i, /(icab)[\/\s]([23]\.[\d\.]+)/i], [o, u], [/rv\:([\w\.]{1,9}).+(gecko)/i], [u, o]], os: [[/microsoft\s(windows)\s(vista|xp)/i], [o, u], [/(windows)\snt\s6\.2;\s(arm)/i, /(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i, /(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i], [o, [u, d.str, h.os.windows.version]], [/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i], [[o, "Windows"], [u, d.str, h.os.windows.version]], [/\((bb)(10);/i], [[o, "BlackBerry"], u], [/(blackberry)\w*\/?([\w\.]*)/i, /(tizen)[\/\s]([\w\.]+)/i, /(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]*)/i, /linux;.+(sailfish);/i], [o, u], [/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i], [[o, "Symbian"], u], [/\((series40);/i], [o], [/mozilla.+\(mobile;.+gecko.+firefox/i], [[o, "Firefox OS"], u], [/(nintendo|playstation)\s([wids34portablevu]+)/i, /(mint)[\/\s\(]?(\w*)/i, /(mageia|vectorlinux)[;\s]/i, /(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i, /(hurd|linux)\s?([\w\.]*)/i, /(gnu)\s?([\w\.]*)/i], [o, u], [/(cros)\s[\w]+\s([\w\.]+\w)/i], [[o, "Chromium OS"], u], [/(sunos)\s?([\w\.\d]*)/i], [[o, "Solaris"], u], [/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i], [o, u], [/(haiku)\s(\w+)/i], [o, u], [/cfnetwork\/.+darwin/i, /ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i], [[u, /_/g, "."], [o, "iOS"]], [/(mac\sos\sx)\s?([\w\s\.]*)/i, /(macintosh|mac(?=_powerpc)\s)/i], [[o, "Mac OS"], [u, /_/g, "."]], [/((?:open)?solaris)[\/\s-]?([\w\.]*)/i, /(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i, /(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i, /(unix)\s?([\w\.]*)/i], [o, u]] }, v = function (e, r) { if ("object" == typeof e && (r = e, e = void 0), !(this instanceof v)) return new v(e, r).getResult(); var n = e || (t && t.navigator && t.navigator.userAgent ? t.navigator.userAgent : ""), i = r ? f.extend(p, r) : p; return this.getBrowser = function () { var e = { name: void 0, version: void 0 }; return d.rgx.call(e, n, i.browser), e.major = f.major(e.version), e }, this.getCPU = function () { var e = { architecture: void 0 }; return d.rgx.call(e, n, i.cpu), e }, this.getDevice = function () { var e = { vendor: void 0, model: void 0, type: void 0 }; return d.rgx.call(e, n, i.device), e }, this.getEngine = function () { var e = { name: void 0, version: void 0 }; return d.rgx.call(e, n, i.engine), e }, this.getOS = function () { var e = { name: void 0, version: void 0 }; return d.rgx.call(e, n, i.os), e }, this.getResult = function () { return { ua: this.getUA(), browser: this.getBrowser(), engine: this.getEngine(), os: this.getOS(), device: this.getDevice(), cpu: this.getCPU() } }, this.getUA = function () { return n }, this.setUA = function (e) { return n = e, this }, this }; v.VERSION = "0.7.19", v.BROWSER = { NAME: o, MAJOR: "major", VERSION: u }, v.CPU = { ARCHITECTURE: "architecture" }, v.DEVICE = { MODEL: i, VENDOR: s, TYPE: a, CONSOLE: "console", MOBILE: l, SMARTTV: "smarttv", TABLET: c, WEARABLE: "wearable", EMBEDDED: "embedded" }, v.ENGINE = { NAME: o, VERSION: u }, v.OS = { NAME: o, VERSION: u }, e.exports && (r = e.exports = v), r.UAParser = v; var m = t && (t.jQuery || t.Zepto); if (void 0 !== m && !m.ua) { var y = new v; m.ua = y.getResult(), m.ua.get = function () { return y.getUA() }, m.ua.set = function (e) { y.setUA(e); var t = y.getResult(); for (var r in t) m.ua[r] = t[r] } } }("object" == typeof window ? window : t) }).UAParser; var Dr = function (e, t, r, n) { try { return n ? t(_(r)[0], r[1]) : t(r) } catch (t) { var i = e.return; throw void 0 !== i && _(i.call(e)), t } }, Ir = fe("iterator"), Mr = Array.prototype, Nr = function (e) { return void 0 !== e && (B.Array === e || Mr[Ir] === e) }, Fr = function (e, t, r) { t in e ? L.f(e, t, x(0, r)) : e[t] = r }, Br = fe("toStringTag"), Ur = "Arguments" == j(function () { return arguments }()), jr = function (e) { var t, r, n; return void 0 === e ? "Undefined" : null === e ? "Null" : "string" == typeof (r = function (e, t) { try { return e[t] } catch (e) { } }(t = Object(e), Br)) ? r : Ur ? j(t) : "Object" == (n = j(t)) && "function" == typeof t.callee ? "Arguments" : n }, Gr = fe("iterator"), $r = m.getIteratorMethod = function (e) { if (null != e) return e[Gr] || e["@@iterator"] || B[jr(e)] }, zr = fe("iterator"), Kr = !1; try { [7][zr]().return = function () { Kr = !0 } } catch (e) { } var Vr = function (e, t) { if (!t && !Kr) return !1; var r = !1; try { var n = [7], i = n[zr](); i.next = function () { return { done: r = !0 } }, n[zr] = function () { return i }, e(n) } catch (e) { } return r }; N(N.S + N.F * !Vr(function (e) { }), "Array", { from: function (e) { var t, r, n, i, o = ge(e), a = "function" == typeof this ? this : Array, s = arguments.length, u = s > 1 ? arguments[1] : void 0, l = void 0 !== u, c = 0, f = $r(o); if (l && (u = g(u, s > 2 ? arguments[2] : void 0, 2)), null == f || a == Array && Nr(f)) for (r = new a(t = K(o.length)); t > c; c++)Fr(r, c, l ? u(o[c], c) : o[c]); else for (i = f.call(o), r = new a; !(n = i.next()).done; c++)Fr(r, c, l ? Dr(i, u, [n.value, c], !0) : n.value); return r.length = c, r } }); var Wr = m.Array.from, Hr = n(function (e) { e.exports = { default: Wr, __esModule: !0 } }), qr = r(Hr), Yr = r(n(function (e, t) { t.__esModule = !0; var r, n = (r = Hr) && r.__esModule ? r : { default: r }; t.default = function (e) { if (Array.isArray(e)) { for (var t = 0, r = Array(e.length); t < e.length; t++)r[t] = e[t]; return r } return (0, n.default)(e) } })); var Xr = function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : function (e, t, r) { e[t] = r }; return function r(n, i, o) { if (mr(n) || gr(n)) { for (var a in i = Ar(i) ? gr(n) ? {} : [] : i, n) t(i, a, r(n[a], i[a], a)); return i } return e(n, i, o) } }(function (e) { return e }); function Qr(e) { if (Ar(e)) throw new TypeError("deepClone only accept non primitive type"); return Xr(e) } function Jr() { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; if (t.length < 2) throw new Error("deepAssign accept two and more argument"); for (var n = t.length - 1; n > -1; n--)if (Ar(t[n])) throw new TypeError("deepAssign only accept non primitive type"); var i = t.shift(); return t.forEach(function (e) { return Xr(e, i) }), i } function Zr(e, t) { return e.replace(/(^|[^a-zA-Z]+)([a-zA-Z])/g, function (e, r, n, i) { return t || 0 !== i ? n.toUpperCase() : n.toLowerCase() }) } function en(e, t) { return e.bind ? e.bind(t) : e.apply ? function () { for (var r = arguments.length, n = Array(r), i = 0; i < r; i++)n[i] = arguments[i]; return e.apply(t, n) } : function () { for (var r = arguments.length, n = Array(r), i = 0; i < r; i++)n[i] = arguments[i]; return e.call.apply(e, [t].concat(Yr(n))) } } function tn() { return (65536 * (1 + Math.random()) | 0).toString(16).substring(1) } var rn, nn, on, an = function (e, t, r, n) { if (!(e instanceof t) || void 0 !== n && n in e) throw TypeError(r + ": incorrect invocation!"); return e }, sn = n(function (e) { var t = {}, r = {}, n = e.exports = function (e, n, i, o, a) { var s, u, l, c, f = a ? function () { return e } : $r(e), d = g(i, o, n ? 2 : 1), h = 0; if ("function" != typeof f) throw TypeError(e + " is not iterable!"); if (Nr(f)) { for (s = K(e.length); s > h; h++)if ((c = n ? d(_(u = e[h])[0], u[1]) : d(e[h])) === t || c === r) return c } else for (l = f.call(e); !(u = l.next()).done;)if ((c = Dr(l, d, u.value, n)) === t || c === r) return c }; n.BREAK = t, n.RETURN = r }), un = fe("species"), ln = function (e, t) { var r, n = _(e).constructor; return void 0 === n || null == (r = _(n)[un]) ? t : y(r) }, cn = p.process, fn = p.setImmediate, dn = p.clearImmediate, hn = p.MessageChannel, pn = p.Dispatch, vn = 0, mn = {}, yn = function () { var e = +this; if (mn.hasOwnProperty(e)) { var t = mn[e]; delete mn[e], t() } }, gn = function (e) { yn.call(e.data) }; fn && dn || (fn = function (e) { for (var t = [], r = 1; arguments.length > r;)t.push(arguments[r++]); return mn[++vn] = function () { !function (e, t, r) { var n = void 0 === r; switch (t.length) { case 0: return n ? e() : e.call(r); case 1: return n ? e(t[0]) : e.call(r, t[0]); case 2: return n ? e(t[0], t[1]) : e.call(r, t[0], t[1]); case 3: return n ? e(t[0], t[1], t[2]) : e.call(r, t[0], t[1], t[2]); case 4: return n ? e(t[0], t[1], t[2], t[3]) : e.call(r, t[0], t[1], t[2], t[3]) }e.apply(r, t) }("function" == typeof e ? e : Function(e), t) }, rn(vn), vn }, dn = function (e) { delete mn[e] }, "process" == j(cn) ? rn = function (e) { cn.nextTick(g(yn, e, 1)) } : pn && pn.now ? rn = function (e) { pn.now(g(yn, e, 1)) } : hn ? (on = (nn = new hn).port2, nn.port1.onmessage = gn, rn = g(on.postMessage, on, 1)) : p.addEventListener && "function" == typeof postMessage && !p.importScripts ? (rn = function (e) { p.postMessage(e + "", "*") }, p.addEventListener("message", gn, !1)) : rn = "onreadystatechange" in T("script") ? function (e) { ae.appendChild(T("script")).onreadystatechange = function () { ae.removeChild(this), yn.call(e) } } : function (e) { setTimeout(g(yn, e, 1), 0) }); var bn = { set: fn, clear: dn }, _n = bn.set, wn = p.MutationObserver || p.WebKitMutationObserver, En = p.process, Sn = p.Promise, kn = "process" == j(En); function Tn(e) { var t, r; this.promise = new e(function (e, n) { if (void 0 !== t || void 0 !== r) throw TypeError("Bad Promise constructor"); t = e, r = n }), this.resolve = y(t), this.reject = y(r) } var An, Rn, On, Ln, xn = { f: function (e) { return new Tn(e) } }, Pn = function (e) { try { return { e: !1, v: e() } } catch (e) { return { e: !0, v: e } } }, Cn = p.navigator, Dn = Cn && Cn.userAgent || "", In = function (e, t) { if (_(e), b(t) && t.constructor === e) return t; var r = xn.f(e); return (0, r.resolve)(t), r.promise }, Mn = function (e, t, r) { for (var n in t) r && e[n] ? e[n] = t[n] : P(e, n, t[n]); return e }, Nn = fe("species"), Fn = function (e) { var t = "function" == typeof m[e] ? m[e] : p[e]; E && t && !t[Nn] && L.f(t, Nn, { configurable: !0, get: function () { return this } }) }, Bn = bn.set, Un = function () { var e, t, r, n = function () { var n, i; for (kn && (n = En.domain) && n.exit(); e;) { i = e.fn, e = e.next; try { i() } catch (n) { throw e ? r() : t = void 0, n } } t = void 0, n && n.enter() }; if (kn) r = function () { En.nextTick(n) }; else if (!wn || p.navigator && p.navigator.standalone) if (Sn && Sn.resolve) { var i = Sn.resolve(void 0); r = function () { i.then(n) } } else r = function () { _n.call(p, n) }; else { var o = !0, a = document.createTextNode(""); new wn(n).observe(a, { characterData: !0 }), r = function () { a.data = o = !o } } return function (n) { var i = { fn: n, next: void 0 }; t && (t.next = i), e || (e = i, r()), t = i } }(), jn = p.TypeError, Gn = p.process, $n = Gn && Gn.versions, zn = $n && $n.v8 || "", Kn = p.Promise, Vn = "process" == jr(Gn), Wn = function () { }, Hn = Rn = xn.f, qn = !!function () { try { var e = Kn.resolve(1), t = (e.constructor = {})[fe("species")] = function (e) { e(Wn, Wn) }; return (Vn || "function" == typeof PromiseRejectionEvent) && e.then(Wn) instanceof t && 0 !== zn.indexOf("6.6") && -1 === Dn.indexOf("Chrome/66") } catch (e) { } }(), Yn = function (e) { var t; return !(!b(e) || "function" != typeof (t = e.then)) && t }, Xn = function (e, t) { if (!e._n) { e._n = !0; var r = e._c; Un(function () { for (var n = e._v, i = 1 == e._s, o = 0, a = function (t) { var r, o, a, s = i ? t.ok : t.fail, u = t.resolve, l = t.reject, c = t.domain; try { s ? (i || (2 == e._h && Zn(e), e._h = 1), !0 === s ? r = n : (c && c.enter(), r = s(n), c && (c.exit(), a = !0)), r === t.promise ? l(jn("Promise-chain cycle")) : (o = Yn(r)) ? o.call(r, u, l) : u(r)) : l(n) } catch (e) { c && !a && c.exit(), l(e) } }; r.length > o;)a(r[o++]); e._c = [], e._n = !1, t && !e._h && Qn(e) }) } }, Qn = function (e) { Bn.call(p, function () { var t, r, n, i = e._v, o = Jn(e); if (o && (t = Pn(function () { Vn ? Gn.emit("unhandledRejection", i, e) : (r = p.onunhandledrejection) ? r({ promise: e, reason: i }) : (n = p.console) && n.error && n.error("Unhandled promise rejection", i) }), e._h = Vn || Jn(e) ? 2 : 1), e._a = void 0, o && t.e) throw t.v }) }, Jn = function (e) { return 1 !== e._h && 0 === (e._a || e._c).length }, Zn = function (e) { Bn.call(p, function () { var t; Vn ? Gn.emit("rejectionHandled", e) : (t = p.onrejectionhandled) && t({ promise: e, reason: e._v }) }) }, ei = function (e) { var t = this; t._d || (t._d = !0, (t = t._w || t)._v = e, t._s = 2, t._a || (t._a = t._c.slice()), Xn(t, !0)) }, ti = function (e) { var t, r = this; if (!r._d) { r._d = !0, r = r._w || r; try { if (r === e) throw jn("Promise can't be resolved itself"); (t = Yn(e)) ? Un(function () { var n = { _w: r, _d: !1 }; try { t.call(e, g(ti, n, 1), g(ei, n, 1)) } catch (e) { ei.call(n, e) } }) : (r._v = e, r._s = 1, Xn(r, !1)) } catch (e) { ei.call({ _w: r, _d: !1 }, e) } } }; qn || (Kn = function (e) { an(this, Kn, "Promise", "_h"), y(e), An.call(this); try { e(g(ti, this, 1), g(ei, this, 1)) } catch (e) { ei.call(this, e) } }, (An = function (e) { this._c = [], this._a = void 0, this._s = 0, this._d = !1, this._v = void 0, this._h = 0, this._n = !1 }).prototype = Mn(Kn.prototype, { then: function (e, t) { var r = Hn(ln(this, Kn)); return r.ok = "function" != typeof e || e, r.fail = "function" == typeof t && t, r.domain = Vn ? Gn.domain : void 0, this._c.push(r), this._a && this._a.push(r), this._s && Xn(this, !1), r.promise }, catch: function (e) { return this.then(void 0, e) } }), On = function () { var e = new An; this.promise = e, this.resolve = g(ti, e, 1), this.reject = g(ei, e, 1) }, xn.f = Hn = function (e) { return e === Kn || e === Ln ? new On(e) : Rn(e) }), N(N.G + N.W + N.F * !qn, { Promise: Kn }), pe(Kn, "Promise"), Fn("Promise"), Ln = m.Promise, N(N.S + N.F * !qn, "Promise", { reject: function (e) { var t = Hn(this); return (0, t.reject)(e), t.promise } }), N(N.S + !0 * N.F, "Promise", { resolve: function (e) { return In(this === Ln ? Kn : this, e) } }), N(N.S + N.F * !(qn && Vr(function (e) { Kn.all(e).catch(Wn) })), "Promise", { all: function (e) { var t = this, r = Hn(t), n = r.resolve, i = r.reject, o = Pn(function () { var r = [], o = 0, a = 1; sn(e, !1, function (e) { var s = o++, u = !1; r.push(void 0), a++, t.resolve(e).then(function (e) { u || (u = !0, r[s] = e, --a || n(r)) }, i) }), --a || n(r) }); return o.e && i(o.v), r.promise }, race: function (e) { var t = this, r = Hn(t), n = r.reject, i = Pn(function () { sn(e, !1, function (e) { t.resolve(e).then(r.resolve, n) }) }); return i.e && n(i.v), r.promise } }), N(N.P + N.R, "Promise", { finally: function (e) { var t = ln(this, m.Promise || p.Promise), r = "function" == typeof e; return this.then(r ? function (r) { return In(t, e()).then(function () { return r }) } : e, r ? function (r) { return In(t, e()).then(function () { throw r }) } : e) } }), N(N.S, "Promise", { try: function (e) { var t = xn.f(this), r = Pn(e); return (r.e ? t.reject : t.resolve)(r.v), t.promise } }); var ri = m.Promise, ni = n(function (e) { e.exports = { default: ri, __esModule: !0 } }), ii = r(ni), oi = "undefined" != typeof window && "[object Object]" !== Object.prototype.toString.call(window); function ai(e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : function (e, t) { return +e - +t }; return Jt(e).sort(t).reduce(function (t, r) { return t.concat(e[r]) }, []) } function si(e) { for (var t = arguments.length, r = Array(t > 1 ? t - 1 : 0), n = 1; n < t; n++)r[n - 1] = arguments[n]; return new ii(function (t, n) { !function i(o) { if (!(o >= e.length)) { var a = yr(e[o]) ? e[o].apply(e, Yr(r)) : e[o]; return !1 === a ? n("stop") : ii.resolve(a).then(function () { return i(o + 1) }).catch(function (e) { return n(e || "stop") }) } t() }(0) }) } function ui(e) { for (var t = arguments.length, r = Array(t > 1 ? t - 1 : 0), n = 1; n < t; n++)r[n - 1] = arguments[n]; return function t(n) { return n >= e.length || !1 !== (yr(e[n]) ? e[n].apply(e, Yr(r)) : e[n]) && t(++n) }(0) } oi && (window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || window.oRequestAnimationFrame), oi && (window.cancelAnimationFrame || window.mozCancelAnimationFrame || window.webkitCancelAnimationFrame || window.webkitCancelRequestAnimationFrame || window.msCancelAnimationFrame || window.oCancelAnimationFrame); function li(e, t) { var r = t, n = (e = "" + (e || "")).length; return (((t = (t || n) - n) > 0 ? e.repeat ? "0".repeat(t) : new Array(t + 1).join("0") : "") + e).slice(0, r) } function ci(e) { var t = Math.floor(e / 3600); e = Math.floor(e % 3600); var r = li(Math.floor(e / 60), 2), n = li(e = Math.floor(e % 60), 2); return t >= 1 ? t + ":" + r + ":" + n : r + ":" + n } function fi(e) { try { return window.localStorage.getItem(e) } catch (r) { try { var t = document.cookie.match(new RegExp("(^| )" + e + "=([^;]*)(;|$)")); return mr(t) ? unescape(t[2]) : "" } catch (e) { return "" } } } function di(e, t) { try { window.localStorage.setItem(e, t) } catch (n) { var r = new Date; r.setTime(r.getTime() + 2592e7); try { document.cookie = e + "=" + escape(t) + ";expires=" + r.toUTCString() + ";path=/;" } catch (e) { console.error(e) } } } var hi = Object.assign, pi = !hi || w(function () { var e = {}, t = {}, r = Symbol(), n = "abcdefghijklmnopqrst"; return e[r] = 7, n.split("").forEach(function (e) { t[e] = e }), 7 != hi({}, e)[r] || Object.keys(hi({}, t)).join("") != n }) ? function (e, t) { for (var r = ge(e), n = arguments.length, i = 1, o = je.f, a = Ge.f; n > i;)for (var s, u = G(arguments[i++]), l = o ? ne(u).concat(o(u)) : ne(u), c = l.length, f = 0; c > f;)a.call(u, s = l[f++]) && (r[s] = u[s]); return r } : hi; N(N.S + N.F, "Object", { assign: pi }); var vi = m.Object.assign, mi = r(n(function (e) { e.exports = { default: vi, __esModule: !0 } })), yi = Yt(null); function gi(e, t) { var r = e.__evt_id; r || (Object.defineProperty(e, "__evt_id", { writable: !0, enumerable: !1, configurable: !0 }), r = e.__evt_id = ++yi.count); var n = r + "_" + t, i = yi[n]; return i || (i = yi[n] = []), i } function bi(e, t, r) { var n = arguments.length > 3 && void 0 !== arguments[3] && arguments[3], i = arguments[4]; yr(n) && !i && (i = n, n = void 0); var o = [r, void 0, n]; n && !i && (i = function () { _i(e, t, r, n); for (var i = arguments.length, o = Array(i), a = 0; a < i; a++)o[a] = arguments[a]; r.apply(e, o) }), i && (o[1] = i), gi(e, t).push(o) } function _i(e, t, r) { var n = arguments.length > 3 && void 0 !== arguments[3] && arguments[3], i = gi(e, t); if (r || n) { var o = -1, a = void 0; return i.find(function (e, t) { if ((!r || e[0] === r) && (!n || e[2])) return o = t, a = e[1], !0 }), -1 !== o && i.splice(o, 1), a } i.length = 0 } yi.count = 0; var wi = function () { function e(t, r) { var n = this; if (Mt(this, e), Object.defineProperty(this, "__target", { writable: !0, enumerable: !1, configurable: !0 }), this.__target = this, t) { if ("object" !== (void 0 === t ? "undefined" : xt(t))) throw new Error("CusEvent target are not object"); this.__target = t, r && ["on", "once", "off", "emit"].forEach(function (e) { t[e] = n[e] }) } } return Gt(e, [{ key: "on", value: function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] && arguments[2]; return bi(this.__target, e, t, r), this } }, { key: "once", value: function (e, t) { return this.on(e, t, !0) } }, { key: "off", value: function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] && arguments[2]; return _i(this.__target, e, t, r), this } }, { key: "emit", value: function (e, t) { return function (e, t, r) { var n = Yt(null); n.type = t, n.target = e, r && mi(n, gr(r) ? r : { data: r }), gi(e, t).forEach(function (t) { (t[1] || t[0]).apply(e, [n]) }) }(this.__target, e, { data: t }), this } }]), e }(), Ei = oi ? document.createElement("div") : {}, Si = "innerText"; "textContent" in Ei && (Si = "textContent"); var ki = Array.prototype; function Ti(e, t) { return e.getAttribute(t) } function Ai(e, t, r) { void 0 === r ? e.removeAttribute(t) : e.setAttribute(t, r) } function Ri(e, t) { if (t && (t = t.trim())) { var r = t.split(/\s+/); if (e.classList) r.forEach(function (t) { return e.classList.add(t) }); else { var n = " " + (e.className || "") + " "; r.forEach(function (e) { -1 === n.indexOf(" " + e + " ") && (n += " " + e) }), e.className = n.trim() } } } function Oi(e, t) { if (t && (t = t.trim())) { var r = t.split(/\s+/); if (e.classList) r.forEach(function (t) { return e.classList.remove(t) }); else { var n = " " + e.className + " "; r.forEach(function (e) { for (var t = " " + e + " "; -1 !== n.indexOf(t);)n = n.replace(t, " ") }), e.className = n.trim() } } } var Li = !1; try { var xi = Object.defineProperty({}, "passive", { get: function () { Li = !0 } }); oi && window.addEventListener("test", null, xi) } catch (e) { console.error(e) } function Pi(e, t, r) { var n = arguments.length > 3 && void 0 !== arguments[3] && arguments[3], i = arguments.length > 4 && void 0 !== arguments[4] && arguments[4]; if (void 0 !== i && !kr(i) && Li && (i = { passive: !0 }), n) { var o = _i(e, t + "_once", r); o && (r = o) } e.removeEventListener(t, r, i) } function Ci(e, t, r) { var n = arguments.length > 3 && void 0 !== arguments[3] && arguments[3], i = arguments.length > 4 && void 0 !== arguments[4] && arguments[4]; if (void 0 !== i && !kr(i) && Li && (i = { passive: !0 }), n) { var o = r; r = function () { for (var a = arguments.length, s = Array(a), u = 0; u < a; u++)s[u] = arguments[u]; o.apply(this, s), Pi(e, t, r, n, i) }, bi(e, t + "_once", o, r) } e.addEventListener(t, r, i) } function Di(e, t, r, n) { var i = arguments.length > 4 && void 0 !== arguments[4] && arguments[4]; void 0 !== i && !kr(i) && Li && (i = { passive: !0 }); var o = function (r) { var i = function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null, r = arguments[2], n = arguments[3], i = []; r && i.push(e); for (; e && e.parentNode !== t;)(e = e.parentNode) && i.push(e); n && i.push(t); return i }(r.target || r.srcElement, e, !0), o = Ni(t, e, !0), a = void 0; o.find ? a = o.find(function (e) { return i.find(function (t) { return e === t }) }) : o.forEach(function (e) { return !a && i.forEach(function (t) { a || e !== t || (a = t) }) }), a && n.apply(a, arguments) }; bi(e, r + "_delegate_" + t, n, o), e.addEventListener(r, o, i) } function Ii(e, t) { return (e.currentStyle || document.defaultView.getComputedStyle(e, null))[t] || e.style[t] } function Mi(e, t, r) { if (gr(t)) for (var n in t) Mi(e, n, t[n]); else e.style[t] = r } function Ni(e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : document, r = arguments[2], n = t.querySelectorAll(e); return r ? qr(n) : n } var Fi = function () { function e(t) { var r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : document; Mt(this, e); this.selector = t; var n = void 0; t && t.constructor === NodeList ? n = qr(t) : mr(t) ? n = t : Sr(t) ? 0 === t.indexOf("<") ? (Ei.innerHTML = t, n = Ni("*", Ei, !0)) : n = Ni(t, r, !0) : n = [t], mi(this, n), this.length = n.length } return Gt(e, [{ key: "each", value: function () { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; return ki.forEach.apply(this, t), this } }, { key: "push", value: function () { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; return ki.push.apply(this, t), this } }, { key: "splice", value: function () { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; return Bi(ki.splice.apply(this, t)) } }, { key: "find", value: function (e) { var t = []; this.each(function (r) { t = t.concat(Ni(e, r, !0)) }); var r = Bi(t); return r.parent = this, r.selector = e, r } }, { key: "append", value: function (e) { var t = Bi(e), r = this[0]; return t.each(function (e) { return r.appendChild(e) }), this } }, { key: "appendTo", value: function (e) { return Bi(e).append(this), this } }, { key: "text", value: function (e) { return 0 === arguments.length ? this[0][Si] : this.each(function (t) { t[Si] = e }) } }, { key: "html", value: function (e) { return 0 === arguments.length ? this[0].innerHTML : this.each(function (t) { t.innerHTML = e }) } }, { key: "attr", value: function (e, t) { return 1 === arguments.length ? Ti(this[0], e) : this.each(function (r) { return Ai(r, e, t) }) } }, { key: "data", value: function (e, t) { return 0 === arguments.length ? this[0].dataset || {} : 1 === arguments.length ? (this[0].dataset || {})[e] : this.each(function (r) { (r.dataset || (r.dataset = {}))[e] = t }) } }, { key: "css", value: function (e, t) { return 1 !== arguments.length || gr(e) ? this.each(function (r) { return Mi(r, e, t) }) : Ii(this[0], e) } }, { key: "addClass", value: function (e) { return this.each(function (t) { return Ri(t, e) }) } }, { key: "removeClass", value: function (e) { return this.each(function (t) { return Oi(t, e) }) } }, { key: "hasClass", value: function (e) { return t = this[0], new RegExp("(?:^|\\s)" + e + "(?=\\s|$)").test(t.className); var t } }, { key: "on", value: function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] && arguments[2], n = arguments.length > 3 && void 0 !== arguments[3] && arguments[3]; return this.each(function (i) { return Ci(i, e, t, r, n) }) } }, { key: "off", value: function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] && arguments[2], n = arguments.length > 3 && void 0 !== arguments[3] && arguments[3]; return this.each(function (i) { return Pi(i, e, t, r, n) }) } }, { key: "delegate", value: function (e, t, r) { var n = arguments.length > 3 && void 0 !== arguments[3] && arguments[3]; return this.each(function (i) { return Di(i, e, t, r, n) }) } }, { key: "undelegate", value: function (e, t, r) { var n = arguments.length > 3 && void 0 !== arguments[3] && arguments[3]; return this.each(function (i) { return function (e, t, r, n) { var i = arguments.length > 4 && void 0 !== arguments[4] && arguments[4]; void 0 !== i && !kr(i) && Li && (i = { passive: !0 }); var o = _i(e, r + "_delegate_" + t, n); o && e.removeEventListener(r, o, i) }(i, e, t, r, n) }) } }, { key: "remove", value: function () { return this.each(function (e) { return function (e) { e.parentNode.removeChild(e) }(e) }) } }]), e }(); function Bi(e, t) { return e.constructor === Fi ? e : new Fi(e, t) } N(N.S, "Number", { isNaN: function (e) { return e != e } }); var Ui = m.Number.isNaN, ji = r(n(function (e) { e.exports = { default: Ui, __esModule: !0 } })), Gi = p.Reflect, $i = Gi && Gi.ownKeys || function (e) { var t = Ke.f(_(e)), r = je.f; return r ? t.concat(r(e)) : t }; N(N.S, "Object", { getOwnPropertyDescriptors: function (e) { for (var t, r, n = $(e), i = Xe.f, o = $i(n), a = {}, s = 0; o.length > s;)void 0 !== (r = i(n, t = o[s++])) && Fr(a, t, r); return a } }); var zi = m.Object.getOwnPropertyDescriptors, Ki = r(n(function (e) { e.exports = { default: zi, __esModule: !0 } })), Vi = m.Object.getOwnPropertySymbols, Wi = r(n(function (e) { e.exports = { default: Vi, __esModule: !0 } })); Pt("getOwnPropertyNames", function () { return qe.f }); var Hi = m.Object, qi = function (e) { return Hi.getOwnPropertyNames(e) }, Yi = r(n(function (e) { e.exports = { default: qi, __esModule: !0 } })), Xi = Xe.f; Pt("getOwnPropertyDescriptor", function () { return function (e, t) { return Xi($(e), t) } }); var Qi = m.Object, Ji = function (e, t) { return Qi.getOwnPropertyDescriptor(e, t) }, Zi = n(function (e) { e.exports = { default: Ji, __esModule: !0 } }), eo = r(Zi); function to(e, t) { return e.bind ? e.bind(t) : e.apply ? function () { for (var r = arguments.length, n = Array(r), i = 0; i < r; i++)n[i] = arguments[i]; return e.apply(t, n) } : function () { for (var r = arguments.length, n = Array(r), i = 0; i < r; i++)n[i] = arguments[i]; return e.call.apply(e, [t].concat(Yr(n))) } } function ro(e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}, n = r.throwError, i = void 0 !== n && n, o = r.backup; if (Sr(t) && (t = t.split(".")), !mr(t)) throw new TypeError("keys of getDeepProperty must be string or Array<string>"); for (var a = [], s = e, u = 0, l = t.length; u < l; u++) { var c = t[u]; if (vr(s)) { if (i) throw new Error("obj" + (a.length > 0 ? "." + a.join(".") : " itself") + " is " + s); return o } s = s[c], a.push(c) } return s } var no = fe("iterator"), io = m.isIterable = function (e) { var t = Object(e); return void 0 !== t[no] || "@@iterator" in t || B.hasOwnProperty(jr(t)) }, oo = n(function (e) { e.exports = { default: io, __esModule: !0 } }); r(oo); var ao = m.getIterator = function (e) { var t = $r(e); if ("function" != typeof t) throw TypeError(e + " is not iterable!"); return _(t.call(e)) }, so = n(function (e) { e.exports = { default: ao, __esModule: !0 } }), uo = r(so), lo = r(n(function (e, t) { t.__esModule = !0; var r = i(oo), n = i(so); function i(e) { return e && e.__esModule ? e : { default: e } } t.default = function () { return function (e, t) { if (Array.isArray(e)) return e; if ((0, r.default)(Object(e))) return function (e, t) { var r = [], i = !0, o = !1, a = void 0; try { for (var s, u = (0, n.default)(e); !(i = (s = u.next()).done) && (r.push(s.value), !t || r.length !== t); i = !0); } catch (e) { o = !0, a = e } finally { try { !i && u.return && u.return() } finally { if (o) throw a } } return r }(e, t); throw new TypeError("Invalid attempt to destructure non-iterable instance") } }() })), co = fe("species"), fo = function (e, t) { return new (function (e) { var t; return $e(e) && ("function" != typeof (t = e.constructor) || t !== Array && !$e(t.prototype) || (t = void 0), b(t) && null === (t = t[co]) && (t = void 0)), void 0 === t ? Array : t }(e))(t) }, ho = function (e, t) { var r = 1 == e, n = 2 == e, i = 3 == e, o = 4 == e, a = 6 == e, s = 5 == e || a, u = t || fo; return function (t, l, c) { for (var f, d, h = ge(t), p = G(h), v = g(l, c, 3), m = K(p.length), y = 0, b = r ? u(t, m) : n ? u(t, 0) : void 0; m > y; y++)if ((s || y in p) && (d = v(f = p[y], y, h), e)) if (r) b[y] = d; else if (d) switch (e) { case 3: return !0; case 5: return f; case 6: return y; case 2: b.push(f) } else if (o) return !1; return a ? -1 : i || o ? o : b } }, po = function (e, t) { if (!b(e) || e._t !== t) throw TypeError("Incompatible receiver, " + t + " required!"); return e }, vo = Fe.getWeak, mo = ho(5), yo = ho(6), go = 0, bo = function (e) { return e._l || (e._l = new _o) }, _o = function () { this.a = [] }, wo = function (e, t) { return mo(e.a, function (e) { return e[0] === t }) }; _o.prototype = { get: function (e) { var t = wo(this, e); if (t) return t[1] }, has: function (e) { return !!wo(this, e) }, set: function (e, t) { var r = wo(this, e); r ? r[1] = t : this.a.push([e, t]) }, delete: function (e) { var t = yo(this.a, function (t) { return t[0] === e }); return ~t && this.a.splice(t, 1), !!~t } }; var Eo = { getConstructor: function (e, t, r, n) { var i = e(function (e, o) { an(e, i, t, "_i"), e._t = t, e._i = go++, e._l = void 0, null != o && sn(o, r, e[n], e) }); return Mn(i.prototype, { delete: function (e) { if (!b(e)) return !1; var r = vo(e); return !0 === r ? bo(po(this, t)).delete(e) : r && D(r, this._i) && delete r[this._i] }, has: function (e) { if (!b(e)) return !1; var r = vo(e); return !0 === r ? bo(po(this, t)).has(e) : r && D(r, this._i) } }), i }, def: function (e, t, r) { var n = vo(_(t), !0); return !0 === n ? bo(e).set(t, r) : n[e._i] = r, e }, ufstore: bo }, So = L.f, ko = ho(0), To = function (e, t, r, n, i, o) { var a = p[e], s = a, u = i ? "set" : "add", l = s && s.prototype, c = {}; return E && "function" == typeof s && (o || l.forEach && !w(function () { (new s).entries().next() })) ? (s = t(function (t, r) { an(t, s, e, "_c"), t._c = new a, null != r && sn(r, i, t[u], t) }), ko("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","), function (e) { var t = "add" == e || "set" == e; e in l && (!o || "clear" != e) && P(s.prototype, e, function (r, n) { if (an(this, s, e), !t && o && !b(r)) return "get" == e && void 0; var i = this._c[e](0 === r ? 0 : r, n); return t ? this : i }) }), o || So(s.prototype, "size", { get: function () { return this._c.size } })) : (s = n.getConstructor(t, e, i, u), Mn(s.prototype, r), Fe.NEED = !0), pe(s, e), c[e] = s, N(N.G + N.W + N.F, c), o || n.setStrong(s, e, i), s }, Ao = (n(function (e) { var t, r = ho(0), n = Fe.getWeak, i = Object.isExtensible, o = Eo.ufstore, a = {}, s = function (e) { return function () { return e(this, arguments.length > 0 ? arguments[0] : void 0) } }, u = { get: function (e) { if (b(e)) { var t = n(e); return !0 === t ? o(po(this, "WeakMap")).get(e) : t ? t[this._i] : void 0 } }, set: function (e, t) { return Eo.def(po(this, "WeakMap"), e, t) } }, l = e.exports = To("WeakMap", s, u, Eo, !0, !0); w(function () { return 7 != (new l).set((Object.freeze || Object)(a), 7).get(a) }) && (t = Eo.getConstructor(s, "WeakMap"), pi(t.prototype, u), Fe.NEED = !0, r(["delete", "has", "get", "set"], function (e) { var r = l.prototype, n = r[e]; F(r, e, function (r, o) { if (b(r) && !i(r)) { this._f || (this._f = new t); var a = this._f[e](r, o); return "set" == e ? this : a } return n.call(this, r, o) }) })) }), function (e) { N(N.S, e, { of: function () { for (var e = arguments.length, t = new Array(e); e--;)t[e] = arguments[e]; return new this(t) } }) }); Ao("WeakMap"); var Ro = function (e) { N(N.S, e, { from: function (e) { var t, r, n, i, o = arguments[1]; return y(this), (t = void 0 !== o) && y(o), null == e ? new this : (r = [], t ? (n = 0, i = g(o, arguments[2], 2), sn(e, !1, function (e) { r.push(i(e, n++)) })) : sn(e, !1, r.push, r), new this(r)) } }) }; Ro("WeakMap"); var Oo = m.WeakMap, Lo = r(n(function (e) { e.exports = { default: Oo, __esModule: !0 } })), xo = r(n(function (e, t) { t.__esModule = !0; var r, n = (r = Ut) && r.__esModule ? r : { default: r }; t.default = function (e, t, r) { return t in e ? (0, n.default)(e, t, { value: r, enumerable: !0, configurable: !0, writable: !0 }) : e[t] = r, e } })), Po = Fe.onFreeze; Pt("preventExtensions", function (e) { return function (t) { return e && b(t) ? e(Po(t)) : t } }); var Co = m.Object.preventExtensions; r(n(function (e) { e.exports = { default: Co, __esModule: !0 } })); var Do = eo; function Io(e) { if (!e || !e.hasOwnProperty) return !1; for (var t = ["value", "initializer", "get", "set"], r = 0, n = t.length; r < n; r++)if (e.hasOwnProperty(t[r])) return !0; return !1 } function Mo(e) { return !!e && (yr(e.get) || yr(e.set)) && kr(e.configurable) && kr(e.enumerable) && void 0 === e.writable } function No(e) { return !!e && yr(e.initializer) && kr(e.configurable) && kr(e.enumerable) && kr(e.writable) } function Fo(e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "You must pass me an array of function"; if (!mr(e) || e.length < 1) throw new TypeError(t); if (1 === e.length) { if (!yr(e[0])) throw new TypeError(t); return e[0] } return e.reduce(function (e, r) { if (!yr(r) || !yr(e)) throw new TypeError(t); return function (t) { return to(r, this)(to(e, this)(t)) } }) } var Bo = function () { var e = Yi, t = Wi; return yr(t) ? function (r) { return qr(e(r).concat(t(r))) } : e }(); var Uo = yr(Ki) ? Ki : function (e) { return Bo(e).reduce(function (t, r) { return t[r] = Do(e, r), t }, {}) }; function jo() { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; if (!t.length) throw new TypeError("You must pass in decorators in compressMultipleDecorators"); return t.forEach(function (e) { if (!yr(e)) throw new TypeError('Decorators must be a function, but not "' + e + '" in ' + (void 0 === e ? "undefined" : xt(e))) }), 1 === t.length ? t[0] : function (e, r, n) { return t.reduce(function (t, n) { return n(e, r, t) }, n) } } function Go() { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, t = e.get, r = e.set, n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}, i = n.preGet, o = void 0 !== i && i, a = n.preSet, s = void 0 === a || a; if (!(yr(t) || yr(r) || mr(t) && t.length > 0 || mr(r) && r.length > 0)) throw new TypeError("@accessor need a getter or setter. If you don't need to add setter/getter. You should remove @accessor"); var u = "@accessor only accept function or array of function as getter/setter"; return t = mr(t) ? Fo(t, u) : t, r = mr(r) ? Fo(r, u) : r, function (e, n, i) { var a = i || {}, u = a.configurable, l = void 0 === u || u, c = a.enumerable, f = void 0 === c || c, d = yr(t), h = yr(r), p = function (e) { return d ? to(t, this)(e) : e }, v = function (e) { return h ? to(r, this)(e) : e }; if (Mo(i)) { var m = i.get, y = i.set, g = yr(m), b = yr(y); return { get: g || d ? function () { var e = this, t = to(p, this), r = function () { return g ? to(m, e)() : void 0 }; return (o ? [t, r] : [r, t]).reduce(function (e, t) { return t(e) }, void 0) } : void 0, set: b || h ? function (e) { var t = this, r = to(v, this), n = function (e) { return b ? to(y, t)(e) : e }; return (s ? [r, n] : [n, r]).reduce(function (e, t) { return t(e) }, e) } : void 0, configurable: l, enumerable: f } } if (No(i)) { var _ = i.initializer, w = void 0, E = !1; return { get: function () { var e = to(p, this); return E ? e(w) : (w = to(_, this)(), E = !0, e(w)) }, set: function (e) { var t = to(v, this); return w = s ? t(e) : e, E = !0, s || t(w), w }, configurable: l, enumerable: f } } var S = (i || {}).value; return { get: function () { return to(p, this)(S) }, set: function (e) { var t = to(v, this); return S = s ? t(e) : e, s || t(S), S }, configurable: l, enumerable: f } } } function $o() { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; if (0 === t.length) throw new Error("@before accept at least one parameter. If you don't need to preprocess before your function, do not add @before decorators"); if (t.length > 2 && Io(t[2])) throw new Error("You may use @before straightly, @before return decorators, you should call it before you set it as decorator."); for (var n = t.length - 1; n > -1; n--)if (!yr(t[n])) throw new TypeError("@before only accept function parameter"); return function (e, r, n) { var i = n || {}, o = i.value, a = i.configurable, s = i.enumerable, u = i.writable; if (!yr(o)) throw new TypeError('@before can only be used on function, please check the property "' + r + '" is a method or not.'); return { value: function () { for (var e = this, r = arguments.length, n = Array(r), i = 0; i < r; i++)n[i] = arguments[i]; var a = t.reduce(function (t, r) { var n = to(r, e).apply(void 0, Yr(t)); return void 0 === n ? t : mr(n) ? n : [n] }, n); return to(o, this).apply(void 0, Yr(a)) }, configurable: a, enumerable: s, writable: u } } } function zo() { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; if (0 === t.length) throw new Error("@initialize accept at least one parameter. If you don't need to initialize your value, do not add @initialize."); if (t.length > 2 && Io(t[2])) throw new Error("You may use @initialize straightly, @initialize return decorators, you need to call it"); var n = Fo(t, "@initialize only accept function parameter"); return function (e, t, r) { if (void 0 === r) return { value: to(n, e)(), configurable: !0, writable: !0, enumerable: !0 }; if (Mo(r)) { var i = !1; return Go({ get: function (e) { return i ? e : to(n, this)(e) }, set: r.set ? function (e) { return i = !0, e } : void 0 })(e, t, r) } if (No(r)) { var o = r.initializer; return { initializer: function () { return to(n, this)(to(o, this)()) }, configurable: r.configurable, writable: r.writable, enumerable: r.enumerable } } return { value: to(n, this)(r.value), writable: r.writable, configurable: r.configurable, enumerable: r.enumerable } } } var Ko = eo, Vo = jt; function Wo(e, t, r, n, i, o) { var a = r.configurable, s = r.enumerable, u = o.force, l = o.omit, c = Ko(n, i); if (void 0 !== c) { if (l) return; if (!u) throw new Error('"' + t + '" is an existing property, if you want to override it, please set "force" true in @alias option.'); if (!c.configurable) throw new Error('property "' + t + '" is unconfigurable.') } Vo(n, i, { get: function () { return e[t] }, set: function (r) { return e[t] = r, t }, configurable: a, enumerable: s }) } function Ho(e, t, r) { if (2 === arguments.length ? Sr(e) && (r = t, t = e, e = void 0) : 1 === arguments.length && (t = e, e = void 0), !Sr(t)) throw new TypeError("@alias need a string as a key to find the porperty to set alias on"); var n = "If you want to use @alias to set alias on other instance, you must pass in a legal instance"; if (void 0 !== e && Ar(e)) throw new TypeError(n); var i = gr(r) ? r : { force: !1, omit: !1 }, o = i.force, a = i.omit; return function (r, i, s) { function u(e, t, r) { var i = Ar(e) ? t : e, o = r.split("."), a = o.slice(-1), s = lo(a, 1)[0]; if (Ar(i = ro(i, o.slice(0, -1), { throwError: !0 }))) throw new TypeError(n); return { target: i, name: s } } if (No(s = s || { value: void 0, configurable: !0, writable: !0, enumerable: !0 })) return zo(function (r) { var n = u(e, this, t), l = n.target, c = n.name; return Wo(this, i, s, l, c, { force: o, omit: a }), r })(r, i, s); if (Mo(s)) { var l = void 0, c = function (r) { if (l) return r; var n = u(e, this, t), c = n.target, f = n.name; return Wo(this, i, s, c, f, { force: o, omit: a }), l = !0, r }; return Go({ get: c, set: c })(r, i, s) } var f = u(e, r, t), d = f.target, h = f.name; return Wo(r, i, s, d, h, { force: o, omit: a }), s } } var qo = jt; var Yo = function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}, r = t.requirement, n = t.customArgs, i = void 0 !== n && n; return function () { for (var t = arguments.length, n = Array(t > 1 ? t - 1 : 0), o = 1; o < t; o++)n[o - 1] = arguments[o]; var a = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, s = a.exclude, u = void 0 === s ? [] : s, l = a.include, c = void 0 === l ? [] : l, f = a.construct, d = void 0 !== f && f, h = a.self, p = void 0 !== h && h; if (!mr(u)) throw new TypeError("options.exclude must be an array"); if (!mr(c)) throw new TypeError("options.include must be an array"); return function (t) { var o = yr(t); if (!p && !o) throw new TypeError("@" + e.name + "Class can only be used on class"); if (p && Ar(t)) throw new TypeError("@" + e.name + "Class must be used on non-primitive type value in 'self' mode"); var a = p ? t : t.prototype; if (vr(a)) throw new Error("The prototype of the " + t.name + " is empty, please check it"); var s = Uo(a); Bo(a).concat(c).forEach(function (t) { var l = s[t]; "constructor" === t && !d || p && o && ["name", "length", "prototype"].indexOf(t) > -1 || u.indexOf(t) > -1 || yr(r) && !1 === r(a, t, l, { self: p }) || qo(a, t, (i ? e.apply(void 0, Yr(n)) : e)(a, t, l)) }) } } }(Qo, { requirement: function (e, t, r) { return function (e) { return !!e && e.hasOwnProperty("value") && kr(e.configurable) && kr(e.enumerable) && kr(e.writable) }(r) && yr(r.value) } }), Xo = void 0; function Qo(e, t, r) { if (1 === arguments.length) return Yo()(e); var n = r || {}, i = n.value, o = n.configurable; if (!yr(i)) throw new TypeError('@autobind can only be used on functions, not "' + i + '" in ' + (void 0 === i ? "undefined" : xt(i)) + ' on property "' + t + '"'); var a, s = e.constructor; return { configurable: o, enumerable: !1, get: function () { var r = this, n = function () { for (var e = arguments.length, t = Array(e), n = 0; n < e; n++)t[n] = arguments[n]; return i.call.apply(i, [r].concat(Yr(t))) }; return this === e ? i : this.constructor !== s && It(this).constructor === s ? i : this.constructor !== s && t in this.constructor.prototype ? function (e, t) { if (void 0 === Lo) throw new Error("Using @autobind on " + t.name + "() requires WeakMap support due to its use of super." + t.name + "()"); Xo || (Xo = new Lo), !1 === Xo.has(e) && Xo.set(e, new Lo); var r = Xo.get(e); return !1 === r.has(t) && r.set(t, to(t, e)), r.get(t) }(this, i) : (jt(this, t, { configurable: !0, writable: !0, enumerable: !1, value: n }), n) }, set: (a = t, function (e) { return jt(this, a, { configurable: !0, writable: !0, enumerable: !0, value: e }), e }) } } var Jo = jt; function Zo(e, t, r) { if (void 0 === r) return { value: void 0, writable: !1, enumerable: !1, configurable: !1 }; if (r.enumerable = !1, r.configurable = !1, Mo(r)) { var n = r.get; if (r.set = void 0, !yr(n)) return; return { get: function () { var e = to(n, this)(); return Jo(this, t, { value: e, writable: !1, configurable: !1, enumerable: !1 }), e }, set: void 0, configurable: !1, enumerable: !1 } } return r.writable = !1, r } var ea = eo, ta = jt; function ra(e, t, r) { return void 0 === r ? { value: void 0, enumerable: !1, configurable: !0, writable: !0 } : (r.enumerable = !1, r) } var na = jt, ia = eo; function oa(e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}, n = r.self, i = void 0 !== n && n, o = r.omit, a = void 0 !== o && o, s = yr(t); if (s || mr(t)) { if (!yr(e)) throw new TypeError("If you want to decorator class, you must pass it a legal class"); if (s) t(e); else for (var u = 0, l = t.length; u < l; u++) { var c = t[u]; if (!yr(c)) throw new TypeError("If you want to decorate an class, you must pass it function or array of function"); c(e) } return e } if (!i && !yr(e)) throw new TypeError("applyDecorators only accept class as first arguments. If you want to modify instance, you should set options.self true."); if (i && Ar(e)) throw new TypeError("We can't apply docorators on a primitive value, even in self mode"); if (!gr(t)) throw new TypeError("applyDecorators only accept object as second arguments"); var f = i ? e : e.prototype; if (vr(f)) throw new Error("The class muse have a prototype, please take a check"); for (var d in t) { var h = t[d], p = mr(h) ? h : [h], v = void 0; try { v = jo.apply(void 0, Yr(p)) } catch (e) { throw new Error("The decorators set on props must be Function or Array of Function") } var m = ia(f, d); if (!m || m.configurable) na(f, d, v(f, d, m)); else if (!a) throw new Error(d + " of " + f + " is unconfigurable") } return e } var aa = ["push", "pop", "unshift", "shift", "splice", "sort", "reverse"]; function sa(e, t, r) { var n, i = r.diff, o = r.operationPrefix, a = {}, s = !1, u = new Proxy(e, { get: function (e, r, n) { var u = e[r]; if (mr(e) && aa.indexOf(r) > -1) return function () { s = !0, to(u, n).apply(void 0, arguments), s = !1, t() }; if (!0 === a[r]) return u; if (gr(u) || mr(u)) { var l = a[r] || sa(u, t, { diff: i, operationPrefix: o }); return a[r] = l, l } return a[r] = !0, u }, set: function (e, r, n) { var u = e[r], l = gr(n) || mr(n) ? sa(n, t, { diff: i, operationPrefix: o }) : n; return e[r] = l, a[r] = !0, !!(s || i && u === l) || (t(), !0) }, deleteProperty: function (e, r) { return delete e[r], delete a[r], !!s || (t(), !0) } }), l = (xo(n = {}, o + "set", [zo(function (e) { return function (e, t) { u[e] = t } }), ra]), xo(n, o + "del", [zo(function (e) { return function (e) { delete u[e] } }), ra]), n); return oa(u, l, { self: !0 }), u } function ua(e, t, r) { var n, i = this, o = r.operationPrefix, a = r.diff, s = {}, u = !1; function l(e) { var r = void 0; return e.reduce(function (e, n) { return e[n] = [Go({ set: function (e) { return r = this[n], e } }), Go({ get: function (e) { return s[n] ? e : ((gr(e) || mr(e)) && ua(e, t, { operationPrefix: o, diff: a }), s[n] = !0, e) }, set: function (e) { return (gr(e) || mr(e)) && ua(e, t, { operationPrefix: o, diff: a }), s[n] = !0, u || a && r === e || t(), e } }, { preSet: !1 })], e }, {}) } var c = l(Bo(e)); if (oa(e, c, { self: !0, omit: !0 }), mr(e)) { var f = aa.reduce(function (r, n) { return r[n] = [zo(function (r) { return r = yr(r) ? r : Array.prototype[n], function () { var n = e.length; if (u = !0, to(r, e).apply(void 0, arguments), u = !1, n < e.length) { var i = l(new Array(e.length - n).fill(1).map(function (e, t) { return (t + n).toString() })); oa(e, i, { self: !0, omit: !0 }) } t() } }), ra], r }, {}); oa(e, f, { self: !0 }) } var d = (xo(n = {}, o + "set", [zo(function (t) { return function (r, n) { var o = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}, a = o.disable, s = o.isNewVal; if (s = s || -1 === Bo(e).indexOf(r), yr(t) && to(t, i)(r, n, { disable: !0, isNewVal: s }), s) { var u = l([r]); oa(e, u, { self: !0, omit: !0 }) } a || (e[r] = n) } }), ra]), xo(n, o + "del", [zo(function (r) { return function (n) { yr(r) ? to(r, i)(n) : delete e[n], t() } }), ra]), n); return oa(e, d, { self: !0 }), e } function la(e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}, r = t.other, n = t.backup; if (!yr(e) && !Sr(e)) throw new TypeError("@runnable only accept Function or String"); return function (t, i, o) { var a = o || {}, s = a.value, u = a.configurable; if (!yr(s)) throw new TypeError("@runnable can only be used on method, but not " + s + ' on property "' + i + '".'); var l = yr(e) ? e : function () { var t = e.split("."); return ro(Ar(r) ? this : r, t) }; return n = yr(n) ? n : function () { }, { value: function () { return !0 === to(l, this).apply(void 0, arguments) ? to(s, this).apply(void 0, arguments) : to(n, this).apply(void 0, arguments) }, enumerable: !1, configurable: u, writable: !1 } } } function ca(e, t, r) { return void 0 === r ? { value: void 0, enumerable: !0, configurable: !0, writable: !0 } : (r.configurable = !0, r) } function fa() { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; var n = Sr(t[0]) ? t.shift() : ""; return t.unshift(function (e) { return Sr(e) ? e : n }), Go({ set: t, get: t }) } function da() { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; var n = !!kr(t[0]) && t.shift(); return t.unshift(function (e) { return kr(e) ? e : n }), Go({ set: t, get: t }) } function ha() { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; var n = br(t[0]) ? t.shift() : 0; return t.unshift(function (e) { return br(e) ? e : n }), Go({ set: t, get: t }) } var pa, va, ma, ya, ga, ba, _a, wa = m.JSON || (m.JSON = { stringify: JSON.stringify }), Ea = function (e) { return wa.stringify.apply(wa, arguments) }, Sa = r(n(function (e) { e.exports = { default: Ea, __esModule: !0 } })), ka = r(n(function (e, t) { t.__esModule = !0; var r = i(Dt), n = i(Zi); function i(e) { return e && e.__esModule ? e : { default: e } } t.default = function e(t, i, o) { null === t && (t = Function.prototype); var a = (0, n.default)(t, i); if (void 0 === a) { var s = (0, r.default)(t); return null === s ? void 0 : e(s, i, o) } if ("value" in a) return a.value; var u = a.get; return void 0 !== u ? u.call(o) : void 0 } })), Ta = ["", "o", "ms", "moz", "webkit", "webkitCurrent"], Aa = [["", ""], ["exit", "cancel"], ["screen", "Screen"]], Ra = { position: "fixed", zIndex: "2147483647", left: 0, top: 0, right: 0, bottom: 0, overflow: "hidden", width: "100%", height: "100%" }, Oa = ["fullscreenchange", "webkitfullscreenchange", "mozfullscreenchange", "MSFullscreenChange"], La = ["fullscreenerror", "webkitfullscreenerror", "mozfullscreenerror", "MSFullscreenError"], xa = "undefined" != typeof document; function Pa(e, t, r) { if (gr(t)) for (var n in t) Pa(e, n, t[n]); else e.style[t] = r } function Ca(e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}; gr(t) && (r = t), Sr(e) && (t = e); var n = r.keyOnly, i = void 0 !== n && n; if (!xa) return i ? "" : void 0; if (Or(e) || (e = document), !Sr(t)) throw new Error("You must pass in a string as name, but not " + (void 0 === t ? "undefined" : xt(t)) + "."); for (var o = 0; o < Aa.length; o++) { t = t.replace(Aa[o][0], Aa[o][1]); for (var a = 0; a < Ta.length; a++) { var s = 0 === a ? t : Ta[a] + t.charAt(0).toUpperCase() + t.substr(1); if (void 0 !== e[s]) return i ? s : e[s] } } return i ? "" : void 0 } function Da(e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}, n = r.bubbles, i = void 0 === n || n, o = r.cancelable, a = void 0 === o || o, s = void 0; if (yr(Event) ? s = new Event(t, { bubbles: i, cancelable: a }) : xa && document.createEvent ? (s = document.createEvent("HTMLEvents")).initEvent(t, !0, !0) : xa && document.createEventObject && ((s = document.createEventObject()).eventType = t, s.eventName = t), !gr(s) && !Er(s)) throw new Error("We can't create an object on this browser, please report to author"); e.dispatchEvent ? e.dispatchEvent(s) : e.fireEvent ? e.fireEvent("on" + s.eventType, s) : e[t] ? e[t]() : e["on" + t] && e["on" + t]() } function Ia(e, t, r, n, i) { var o = {}; return Object.keys(n).forEach(function (e) { o[e] = n[e] }), o.enumerable = !!o.enumerable, o.configurable = !!o.configurable, ("value" in o || o.initializer) && (o.writable = !0), o = r.slice().reverse().reduce(function (r, n) { return n(e, t, r) || r }, o), i && void 0 !== o.initializer && (o.value = o.initializer ? o.initializer.call(i) : void 0, o.initializer = void 0), void 0 === o.initializer && (Object.defineProperty(e, t, o), o = null), o } var Ma = Ca("fullscreenEnabled"), Na = !1, Fa = new (pa = Yo(), va = Ho("requestFullscreen"), ma = Ho("exitFullscreen"), ya = Ho("addEventListener"), ga = Ho("removeEventListener"), pa((Ia((_a = function () { function e() { Mt(this, e), this._fullscreenElement = null, this.isNativelySupport = pr(Ca("fullscreenElement")) && (!pr(Ma) || !0 === Ma), this._openKey = xa ? Ca(document.body || document.documentElement, "requestFullscreen", { keyOnly: !0 }) : "", this._exitKey = Ca("exitFullscreen", { keyOnly: !0 }), this._useStyleFirst = !1, this.hasUsedStyle = !1 } return Gt(e, [{ key: "open", value: function (e) { var t = (arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}).force, r = void 0 !== t && t, n = this.fullscreenElement; if (n && n !== e) { if (!r) return Da(document, "fullscreenerror"), !1; this.exit() } if (!this.useStyleFirst) { if (this.isNativelySupport) return yr(e[this._openKey]) && e[this._openKey](), !0; if (e instanceof HTMLVideoElement && e.webkitSupportsFullscreen && yr(e.webkitEnterFullscreen)) return e.webkitEnterFullscreen(), this._fullscreenElement = e, !0 } return this._savedStyles = Jt(Ra).reduce(function (t, r) { return t[r] = e.style[r], t }, {}), Pa(e, Ra), document.body && (this._bodyOverflow = document.body.style.overflow, document.body.style.overflow = "hidden"), document.documentElement && (this._htmlOverflow = document.documentElement.style.overflow, document.documentElement.style.overflow = "hidden"), this._fullscreenElement = e, this.hasUsedStyle = !0, Da(e, "fullscreenchange"), !0 } }, { key: "exit", value: function () { if (!this.isFullscreen) return !1; if (this.isNativelySupport && !this.useStyleFirst && !this.hasUsedStyle) return document[this._exitKey](), !0; var e = this._fullscreenElement; return Pa(e, this._savedStyles), document.body && (document.body.style.overflow = this._bodyOverflow), document.documentElement && (document.documentElement.style.overflow = this._htmlOverflow), this._fullscreenElement = null, this._savedStyles = {}, Da(e, "fullscreenchange"), !0 } }, { key: "on", value: function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : document; this._handleEvent(r, "addEventListener", e, t) } }, { key: "off", value: function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : document; this._handleEvent(r, "removeEventListener", e, t) } }, { key: "_handleEvent", value: function (e, t, r, n) { ("fullscreenchange" === r ? Oa : "fullscreenerror" === r ? La : [r]).forEach(function (r) { e[t](r, n) }) } }, { key: "useStyleFirst", get: function () { return Na }, set: function (e) { return (e = !!e) === Na ? e : (Na = e, Da(document, "esfullscreenmethodchange"), e) } }, { key: "fullscreenElement", get: function () { return ["fullscreenElement", "webkitFullscreenElement", "mozFullScreenElement", "msFullscreenElement"].reduce(function (e, t) { return e || document[t] }, null) || this._fullscreenElement } }, { key: "isFullscreen", get: function () { return Or(this.fullscreenElement) } }]), e }()).prototype, "open", [va], eo(_a.prototype, "open"), _a.prototype), Ia(_a.prototype, "exit", [ma], eo(_a.prototype, "exit"), _a.prototype), Ia(_a.prototype, "on", [ya], eo(_a.prototype, "on"), _a.prototype), Ia(_a.prototype, "off", [ga], eo(_a.prototype, "off"), _a.prototype), ba = _a)) || ba), Ba = L.f, Ua = Fe.fastKey, ja = E ? "_s" : "size", Ga = function (e, t) { var r, n = Ua(t); if ("F" !== n) return e._i[n]; for (r = e._f; r; r = r.n)if (r.k == t) return r }, $a = { getConstructor: function (e, t, r, n) { var i = e(function (e, o) { an(e, i, t, "_i"), e._t = t, e._i = ce(null), e._f = void 0, e._l = void 0, e[ja] = 0, null != o && sn(o, r, e[n], e) }); return Mn(i.prototype, { clear: function () { for (var e = po(this, t), r = e._i, n = e._f; n; n = n.n)n.r = !0, n.p && (n.p = n.p.n = void 0), delete r[n.i]; e._f = e._l = void 0, e[ja] = 0 }, delete: function (e) { var r = po(this, t), n = Ga(r, e); if (n) { var i = n.n, o = n.p; delete r._i[n.i], n.r = !0, o && (o.n = i), i && (i.p = o), r._f == n && (r._f = i), r._l == n && (r._l = o), r[ja]-- } return !!n }, forEach: function (e) { po(this, t); for (var r, n = g(e, arguments.length > 1 ? arguments[1] : void 0, 3); r = r ? r.n : this._f;)for (n(r.v, r.k, this); r && r.r;)r = r.p }, has: function (e) { return !!Ga(po(this, t), e) } }), E && Ba(i.prototype, "size", { get: function () { return po(this, t)[ja] } }), i }, def: function (e, t, r) { var n, i, o = Ga(e, t); return o ? o.v = r : (e._l = o = { i: i = Ua(t, !0), k: t, v: r, p: n = e._l, n: void 0, r: !1 }, e._f || (e._f = o), n && (n.n = o), e[ja]++, "F" !== i && (e._i[i] = o)), e }, getEntry: Ga, setStrong: function (e, t, r) { Te(e, t, function (e, r) { this._t = po(e, t), this._k = r, this._l = void 0 }, function () { for (var e = this._k, t = this._l; t && t.r;)t = t.p; return this._t && (this._l = t = t ? t.n : this._t._f) ? Re(0, "keys" == e ? t.k : "values" == e ? t.v : [t.k, t.v]) : (this._t = void 0, Re(1)) }, r ? "entries" : "values", !r, !0), Fn(t) } }; To("Map", function (e) { return function () { return e(this, arguments.length > 0 ? arguments[0] : void 0) } }, { get: function (e) { var t = $a.getEntry(po(this, "Map"), e); return t && t.v }, set: function (e, t) { return $a.def(po(this, "Map"), 0 === e ? 0 : e, t) } }, $a, !0); N(N.P + N.R, "Map", { toJSON: function (e) { return function () { if (jr(this) != e) throw TypeError(e + "#toJSON isn't generic"); return sn(this, !1, (r = []).push, r, t), r; var t, r } }("Map") }), Ao("Map"), Ro("Map"); var za, Ka = m.Map, Va = r(n(function (e) { e.exports = { default: Ka, __esModule: !0 } })), Wa = Ge.f, Ha = (za = !0, function (e) { for (var t, r = $(e), n = ne(r), i = n.length, o = 0, a = []; i > o;)Wa.call(r, t = n[o++]) && a.push(za ? [t, r[t]] : r[t]); return a }); N(N.S, "Object", { entries: function (e) { return Ha(e) } }); var qa = m.Object.entries, Ya = r(n(function (e) { e.exports = { default: qa, __esModule: !0 } })), Xa = n(function (e) { !function (t) { var r, n = Object.prototype, i = n.hasOwnProperty, o = "function" == typeof Symbol ? Symbol : {}, a = o.iterator || "@@iterator", s = o.asyncIterator || "@@asyncIterator", u = o.toStringTag || "@@toStringTag", l = t.regeneratorRuntime; if (l) e.exports = l; else { (l = t.regeneratorRuntime = e.exports).wrap = b; var c = "suspendedStart", f = "suspendedYield", d = "executing", h = "completed", p = {}, v = {}; v[a] = function () { return this }; var m = Object.getPrototypeOf, y = m && m(m(x([]))); y && y !== n && i.call(y, a) && (v = y); var g = S.prototype = w.prototype = Object.create(v); E.prototype = g.constructor = S, S.constructor = E, S[u] = E.displayName = "GeneratorFunction", l.isGeneratorFunction = function (e) { var t = "function" == typeof e && e.constructor; return !!t && (t === E || "GeneratorFunction" === (t.displayName || t.name)) }, l.mark = function (e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, S) : (e.__proto__ = S, u in e || (e[u] = "GeneratorFunction")), e.prototype = Object.create(g), e }, l.awrap = function (e) { return { __await: e } }, k(T.prototype), T.prototype[s] = function () { return this }, l.AsyncIterator = T, l.async = function (e, t, r, n) { var i = new T(b(e, t, r, n)); return l.isGeneratorFunction(t) ? i : i.next().then(function (e) { return e.done ? e.value : i.next() }) }, k(g), g[u] = "Generator", g[a] = function () { return this }, g.toString = function () { return "[object Generator]" }, l.keys = function (e) { var t = []; for (var r in e) t.push(r); return t.reverse(), function r() { for (; t.length;) { var n = t.pop(); if (n in e) return r.value = n, r.done = !1, r } return r.done = !0, r } }, l.values = x, L.prototype = { constructor: L, reset: function (e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = r, this.done = !1, this.delegate = null, this.method = "next", this.arg = r, this.tryEntries.forEach(O), !e) for (var t in this) "t" === t.charAt(0) && i.call(this, t) && !isNaN(+t.slice(1)) && (this[t] = r) }, stop: function () { this.done = !0; var e = this.tryEntries[0].completion; if ("throw" === e.type) throw e.arg; return this.rval }, dispatchException: function (e) { if (this.done) throw e; var t = this; function n(n, i) { return s.type = "throw", s.arg = e, t.next = n, i && (t.method = "next", t.arg = r), !!i } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var a = this.tryEntries[o], s = a.completion; if ("root" === a.tryLoc) return n("end"); if (a.tryLoc <= this.prev) { var u = i.call(a, "catchLoc"), l = i.call(a, "finallyLoc"); if (u && l) { if (this.prev < a.catchLoc) return n(a.catchLoc, !0); if (this.prev < a.finallyLoc) return n(a.finallyLoc) } else if (u) { if (this.prev < a.catchLoc) return n(a.catchLoc, !0) } else { if (!l) throw new Error("try statement without catch or finally"); if (this.prev < a.finallyLoc) return n(a.finallyLoc) } } } }, abrupt: function (e, t) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var n = this.tryEntries[r]; if (n.tryLoc <= this.prev && i.call(n, "finallyLoc") && this.prev < n.finallyLoc) { var o = n; break } } o && ("break" === e || "continue" === e) && o.tryLoc <= t && t <= o.finallyLoc && (o = null); var a = o ? o.completion : {}; return a.type = e, a.arg = t, o ? (this.method = "next", this.next = o.finallyLoc, p) : this.complete(a) }, complete: function (e, t) { if ("throw" === e.type) throw e.arg; return "break" === e.type || "continue" === e.type ? this.next = e.arg : "return" === e.type ? (this.rval = this.arg = e.arg, this.method = "return", this.next = "end") : "normal" === e.type && t && (this.next = t), p }, finish: function (e) { for (var t = this.tryEntries.length - 1; t >= 0; --t) { var r = this.tryEntries[t]; if (r.finallyLoc === e) return this.complete(r.completion, r.afterLoc), O(r), p } }, catch: function (e) { for (var t = this.tryEntries.length - 1; t >= 0; --t) { var r = this.tryEntries[t]; if (r.tryLoc === e) { var n = r.completion; if ("throw" === n.type) { var i = n.arg; O(r) } return i } } throw new Error("illegal catch attempt") }, delegateYield: function (e, t, n) { return this.delegate = { iterator: x(e), resultName: t, nextLoc: n }, "next" === this.method && (this.arg = r), p } } } function b(e, t, r, n) { var i = t && t.prototype instanceof w ? t : w, o = Object.create(i.prototype), a = new L(n || []); return o._invoke = function (e, t, r) { var n = c; return function (i, o) { if (n === d) throw new Error("Generator is already running"); if (n === h) { if ("throw" === i) throw o; return P() } for (r.method = i, r.arg = o; ;) { var a = r.delegate; if (a) { var s = A(a, r); if (s) { if (s === p) continue; return s } } if ("next" === r.method) r.sent = r._sent = r.arg; else if ("throw" === r.method) { if (n === c) throw n = h, r.arg; r.dispatchException(r.arg) } else "return" === r.method && r.abrupt("return", r.arg); n = d; var u = _(e, t, r); if ("normal" === u.type) { if (n = r.done ? h : f, u.arg === p) continue; return { value: u.arg, done: r.done } } "throw" === u.type && (n = h, r.method = "throw", r.arg = u.arg) } } }(e, r, a), o } function _(e, t, r) { try { return { type: "normal", arg: e.call(t, r) } } catch (e) { return { type: "throw", arg: e } } } function w() { } function E() { } function S() { } function k(e) { ["next", "throw", "return"].forEach(function (t) { e[t] = function (e) { return this._invoke(t, e) } }) } function T(e) { var t; this._invoke = function (r, n) { function o() { return new Promise(function (t, o) { !function t(r, n, o, a) { var s = _(e[r], e, n); if ("throw" !== s.type) { var u = s.arg, l = u.value; return l && "object" == typeof l && i.call(l, "__await") ? Promise.resolve(l.__await).then(function (e) { t("next", e, o, a) }, function (e) { t("throw", e, o, a) }) : Promise.resolve(l).then(function (e) { u.value = e, o(u) }, a) } a(s.arg) }(r, n, t, o) }) } return t = t ? t.then(o, o) : o() } } function A(e, t) { var n = e.iterator[t.method]; if (n === r) { if (t.delegate = null, "throw" === t.method) { if (e.iterator.return && (t.method = "return", t.arg = r, A(e, t), "throw" === t.method)) return p; t.method = "throw", t.arg = new TypeError("The iterator does not provide a 'throw' method") } return p } var i = _(n, e.iterator, t.arg); if ("throw" === i.type) return t.method = "throw", t.arg = i.arg, t.delegate = null, p; var o = i.arg; return o ? o.done ? (t[e.resultName] = o.value, t.next = e.nextLoc, "return" !== t.method && (t.method = "next", t.arg = r), t.delegate = null, p) : o : (t.method = "throw", t.arg = new TypeError("iterator result is not an object"), t.delegate = null, p) } function R(e) { var t = { tryLoc: e[0] }; 1 in e && (t.catchLoc = e[1]), 2 in e && (t.finallyLoc = e[2], t.afterLoc = e[3]), this.tryEntries.push(t) } function O(e) { var t = e.completion || {}; t.type = "normal", delete t.arg, e.completion = t } function L(e) { this.tryEntries = [{ tryLoc: "root" }], e.forEach(R, this), this.reset(!0) } function x(e) { if (e) { var t = e[a]; if (t) return t.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var n = -1, o = function t() { for (; ++n < e.length;)if (i.call(e, n)) return t.value = e[n], t.done = !1, t; return t.value = r, t.done = !0, t }; return o.next = o } } return { next: P } } function P() { return { value: r, done: !0 } } }(function () { return this }() || Function("return this")()) }), Qa = function () { return this }() || Function("return this")(), Ja = Qa.regeneratorRuntime && Object.getOwnPropertyNames(Qa).indexOf("regeneratorRuntime") >= 0, Za = Ja && Qa.regeneratorRuntime; Qa.regeneratorRuntime = void 0; var es = Xa; if (Ja) Qa.regeneratorRuntime = Za; else try { delete Qa.regeneratorRuntime } catch (e) { Qa.regeneratorRuntime = void 0 } var ts = es, rs = r(n(function (e, t) { t.__esModule = !0; var r, n = (r = ni) && r.__esModule ? r : { default: r }; t.default = function (e) { return function () { var t = e.apply(this, arguments); return new n.default(function (e, r) { return function i(o, a) { try { var s = t[o](a), u = s.value } catch (e) { return void r(e) } if (!s.done) return n.default.resolve(u).then(function (e) { i("next", e) }, function (e) { i("throw", e) }); e(u) }("next") }) } } })), ns = n(function (e) { var t = e.exports = "undefined" != typeof window && window.Math == Math ? window : "undefined" != typeof self && self.Math == Math ? self : Function("return this")(); "number" == typeof __g && (__g = t) }), is = n(function (e) { var t = e.exports = { version: "2.5.7" }; "number" == typeof __e && (__e = t) }), os = (is.version, function (e) { return "object" == typeof e ? null !== e : "function" == typeof e }), as = function (e) { if (!os(e)) throw TypeError(e + " is not an object!"); return e }, ss = function (e) { try { return !!e() } catch (e) { return !0 } }, us = !ss(function () { return 7 != Object.defineProperty({}, "a", { get: function () { return 7 } }).a }), ls = ns.document, cs = os(ls) && os(ls.createElement), fs = !us && !ss(function () { return 7 != Object.defineProperty((e = "div", cs ? ls.createElement(e) : {}), "a", { get: function () { return 7 } }).a; var e }), ds = Object.defineProperty, hs = { f: us ? Object.defineProperty : function (e, t, r) { if (as(e), t = function (e, t) { if (!os(e)) return e; var r, n; if (t && "function" == typeof (r = e.toString) && !os(n = r.call(e))) return n; if ("function" == typeof (r = e.valueOf) && !os(n = r.call(e))) return n; if (!t && "function" == typeof (r = e.toString) && !os(n = r.call(e))) return n; throw TypeError("Can't convert object to primitive value") }(t, !0), as(r), fs) try { return ds(e, t, r) } catch (e) { } if ("get" in r || "set" in r) throw TypeError("Accessors not supported!"); return "value" in r && (e[t] = r.value), e } }, ps = us ? function (e, t, r) { return hs.f(e, t, function (e, t) { return { enumerable: !(1 & e), configurable: !(2 & e), writable: !(4 & e), value: t } }(1, r)) } : function (e, t, r) { return e[t] = r, e }, vs = {}.hasOwnProperty, ms = function (e, t) { return vs.call(e, t) }, ys = 0, gs = Math.random(), bs = n(function (e) { var t, r = "Symbol(".concat(void 0 === (t = "src") ? "" : t, ")_", (++ys + gs).toString(36)), n = Function.toString, i = ("" + n).split("toString"); is.inspectSource = function (e) { return n.call(e) }, (e.exports = function (e, t, n, o) { var a = "function" == typeof n; a && (ms(n, "name") || ps(n, "name", t)), e[t] !== n && (a && (ms(n, r) || ps(n, r, e[t] ? "" + e[t] : i.join(String(t)))), e === ns ? e[t] = n : o ? e[t] ? e[t] = n : ps(e, t, n) : (delete e[t], ps(e, t, n))) })(Function.prototype, "toString", function () { return "function" == typeof this && this[r] || n.call(this) }) }), _s = function (e, t, r) { if (function (e) { if ("function" != typeof e) throw TypeError(e + " is not a function!") }(e), void 0 === t) return e; switch (r) { case 1: return function (r) { return e.call(t, r) }; case 2: return function (r, n) { return e.call(t, r, n) }; case 3: return function (r, n, i) { return e.call(t, r, n, i) } }return function () { return e.apply(t, arguments) } }, ws = function (e, t, r) { var n, i, o, a, s = e & ws.F, u = e & ws.G, l = e & ws.S, c = e & ws.P, f = e & ws.B, d = u ? ns : l ? ns[t] || (ns[t] = {}) : (ns[t] || {}).prototype, h = u ? is : is[t] || (is[t] = {}), p = h.prototype || (h.prototype = {}); for (n in u && (r = t), r) o = ((i = !s && d && void 0 !== d[n]) ? d : r)[n], a = f && i ? _s(o, ns) : c && "function" == typeof o ? _s(Function.call, o) : o, d && bs(d, n, o, e & ws.U), h[n] != o && ps(h, n, a), c && p[n] != o && (p[n] = o) }; ns.core = is, ws.F = 1, ws.G = 2, ws.S = 4, ws.P = 8, ws.B = 16, ws.W = 32, ws.U = 64, ws.R = 128; ws(ws.G, { global: ns }); is.global; var Es = 0, Ss = function (e) { function t(e, r, n) { Mt(this, t); var i = Nt(this, (t.__proto__ || It(t)).call(this)); if (!Or(e)) throw new Error("You must pass in an legal video element but not " + (void 0 === e ? "undefined" : xt(e))); return i.video = e, i.config = r, i.customConfig = n, i } return Xt(t, wi), Gt(t, null, [{ key: "isSupport", value: function () { return !0 } }]), Gt(t, [{ key: "load", value: function (e) { this.video.setAttribute("src", e), this.video.src = e } }, { key: "startLoad", value: function (e) { var t = this.video.currentTime || Es; this.load(e), this.seek(t) } }, { key: "stopLoad", value: function () { Es = this.video.currentTime, this.video.src = "", this.video.removeAttribute("src") } }, { key: "destroy", value: function () { Or(this.video) && this.stopLoad() } }, { key: "play", value: function () { return this.video.play() } }, { key: "pause", value: function () { return this.video.pause() } }, { key: "refresh", value: function () { this.video.src = this.config.src } }, { key: "attachMedia", value: function () { } }, { key: "seek", value: function (e) { this.video.currentTime = e } }]), t }(), ks = { flv: ".flv", hls: ".m3u8", native: ".mp4" }; function Ts(e) { var t = e.src, r = e.box; if (Sr(r) && r) return r; for (var n in t = t.toLowerCase(), ks) { var i = ks[n]; if (t.indexOf(i) > -1) return n } return "native" } var As, Rs, Os, Ls, xs, Ps, Cs, Ds, Is, Ms, Ns = function () { function e(t, r) { if (Mt(this, e), !Or(t)) throw new Error("You must pass in an video element to the chimee-kernel"); this.config = r, this.videoElement = t, this.initVideoKernel() } return Gt(e, [{ key: "destroy", value: function () { this.videoKernel.destroy() } }, { key: "initVideoKernel", value: function () { var e = this.config, t = Ts(e); this.box = t; var r = this.chooseVideoKernel(this.box, e.preset); if (!yr(r)) throw new Error("We can't find video kernel for " + t + ". Please check your config and make sure it's installed or provided"); var n = e.presetConfig[this.box]; n && Jr(e, n), this.videoKernel = new r(this.videoElement, e, n) } }, { key: "chooseVideoKernel", value: function (e, t) { switch (e) { case "native": return Ss; case "mp4": return this.getMp4Kernel(t.mp4); case "flv": case "hls": return t[e]; default: throw new Error("We currently do not support box " + e + ", please contact us through https://github.com/Chimeejs/chimee/issues.") } } }, { key: "getMp4Kernel", value: function (e) { var t = e && yr(e.isSupport); return t && e.isSupport() ? e : (t && Cr.warn("chimee", "mp4 decode is not support in this browser, we will switch to the native video kernel"), this.box = "native", Ss) } }, { key: "attachMedia", value: function () { this.videoKernel.attachMedia() } }, { key: "load", value: function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : this.config.src; this.config.src = e, this.videoKernel.load(e) } }, { key: "startLoad", value: function () { if (!yr(this.videoKernel.startLoad)) throw new Error("This video kernel do not support startLoad, please contact us on https://github.com/Chimeejs/chimee/issues"); this.videoKernel.startLoad(this.config.src) } }, { key: "stopLoad", value: function () { yr(this.videoKernel.stopLoad) && this.videoKernel.stopLoad() } }, { key: "play", value: function () { this.videoKernel.play() } }, { key: "pause", value: function () { this.videoKernel.pause() } }, { key: "seek", value: function (e) { br(e) ? this.videoKernel.seek(e) : Cr.error("chimee", "When you try to seek, you must offer us a number, but not " + (void 0 === e ? "undefined" : xt(e))) } }, { key: "refresh", value: function () { this.videoKernel.refresh() } }, { key: "on", value: function (e, t) { this.videoKernel.on(e, t) } }, { key: "off", value: function (e, t) { this.videoKernel.off(e, t) } }, { key: "currentTime", get: function () { return this.videoElement.currentTime || 0 } }]), e }(), Fs = ["abort", "canplay", "canplaythrough", "durationchange", "emptied", "encrypted", "ended", "error", "interruptbegin", "interruptend", "loadeddata", "loadedmetadata", "loadstart", "mozaudioavailable", "pause", "play", "playing", "progress", "ratechange", "seeked", "seeking", "stalled", "suspend", "timeupdate", "volumechange", "waiting", "enterpictureinpicture", "leavepictureinpicture"], Bs = ["buffered", "currentSrc", "duration", "error", "ended", "networkState", "paused", "readyState", "seekable", "sinkId", "controlsList", "tabIndex", "dataset", "offsetHeight", "offsetLeft", "offsetParent", "offsetTop", "offsetWidth"], Us = ["beforeinput", "blur", "click", "compositionend", "compositionstart", "compositionupdate", "dblclick", "focus", "focusin", "focusout", "input", "keydown", "keypress", "keyup", "mousedown", "mouseenter", "mouseleave", "mousemove", "mouseout", "mouseover", "mouseup", "resize", "scroll", "select", "wheel", "mousewheel", "contextmenu", "touchstart", "touchmove", "touchend", "fullscreen"], js = ["fullscreenchange"], Gs = ["wheel", "mousewheel", "touchstart", "touchmove"], $s = ["silentLoad", "fullscreen"], zs = ["mouseenter", "mouseleave"], Ks = ["play", "pause", "seek", "startLoad", "stopLoad"], Vs = { load: "load", enterpictureinpicture: "requestPictureInPicture", leavepictureinpicture: "exitPictureInPicture" }, Ws = ["mediaInfo", "heartbeat", "error"], Hs = ["focus", "fullscreen", "requestFullscreen", "exitFullscreen"], qs = ["canPlayType", "captureStream", "setSinkId"]; function Ys(e, t) { if (!Sr(e)) throw new TypeError("key parameter must be String"); if (!yr(t)) throw new TypeError("fn parameter must be Function") } function Xs() { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; return t.length > 2 ? ["set"].concat(t) : 2 === t.length ? ["video", "container", "wrapper", "videoElement"].indexOf(t[0]) > -1 ? ["get"].concat(t) : ["set", "container"].concat(t) : ["get", "container"].concat(t) } function Qs(e, t, r, n) { r && jt(e, t, { enumerable: r.enumerable, configurable: r.configurable, writable: r.writable, value: r.initializer ? r.initializer.call(n) : void 0 }) } function Js(e, t, r, n, i) { var o = {}; return Object.keys(n).forEach(function (e) { o[e] = n[e] }), o.enumerable = !!o.enumerable, o.configurable = !!o.configurable, ("value" in o || o.initializer) && (o.writable = !0), o = r.slice().reverse().reduce(function (r, n) { return n(e, t, r) || r }, o), i && void 0 !== o.initializer && (o.value = o.initializer ? o.initializer.call(i) : void 0, o.initializer = void 0), void 0 === o.initializer && (Object.defineProperty(e, t, o), o = null), o } function Zs(e) { return Sr(e) ? e : void 0 } function eu(e) { return Go({ get: function (t) { return this.dispatcher.videoConfigReady && this.inited ? this.dom.videoElement[e] : t }, set: function (t) { return this.dispatcher.videoConfigReady ? (this.dom.videoElement[e] = t, t) : t } }) } function tu(e) { var t = gr(e) ? e : { set: e, get: e, isBoolean: !1 }, r = t.set, n = t.get, i = t.isBoolean; return Go({ get: function (e) { return this.dispatcher.videoConfigReady && this.inited ? this.dom.videoElement[n] : e }, set: function (e) { if (!this.dispatcher.videoConfigReady) return e; var t = i ? e ? "" : void 0 : null === e ? void 0 : e; return this.dom.setAttr("video", r, t), e } }, { preSet: !1 }) } function ru(e, t) { return Go({ get: function (r) { var n = this.dom.getAttr("video", e); return this.dispatcher.videoConfigReady && this.inited ? t ? !!n : n : r }, set: function (r) { if (!this.dispatcher.videoConfigReady) return r; var n = t ? r || void 0 : null === r ? void 0 : r; return this.dom.setAttr("video", e, n), r } }) } function nu(e) { return Go({ get: function (t) { if (!this.dispatcher.videoConfigReady || !this.inited) return t; var r, n = this.dom.getAttr("video", e), i = this.dom.videoElement[e]; return !mr(r = n) && r - hr(r) + 1 >= 0 && br(i) ? i : n || void 0 }, set: function (t) { if (!this.dispatcher.videoConfigReady) return t; var r = void 0; return void 0 === t || br(t) ? r = t : Sr(t) && !ji(parseFloat(t)) && (r = t), this.dom.setAttr("video", e, r), r } }) } var iu, ou, au, su, uu, lu, cu, fu, du, hu, pu, vu, mu, yu, gu, bu, _u, wu, Eu, Su, ku, Tu = { src: [fa(), Go({ set: function (e) { return this.dispatcher.readySync && this.autoload && e !== this.src && (this.needToLoadSrc = !0), e } }), Go({ set: function (e) { return this.needToLoadSrc && (this.needToLoadSrc = !1, this.dispatcher.binder.emit({ name: "load", target: "plugin", id: "dispatcher" }, e)), e } }, { preSet: !1 })], autoload: da(), autoplay: [da(), eu("autoplay")], controls: [da(), eu("controls")], width: [nu("width")], height: [nu("height")], crossOrigin: [Go({ set: Zs }), tu({ set: "crossorigin", get: "crossOrigin" })], loop: [da(), eu("loop")], defaultMuted: [da(), tu({ get: "defaultMuted", set: "muted", isBoolean: !0 })], muted: [da(), eu("muted")], preload: [Go({ set: function (e) { return ["none", "auto", "metadata", ""].indexOf(e) > -1 ? e : "none" } }, { preSet: !0 }), tu("preload")], poster: [fa(), Go({ get: function (e) { return this.dispatcher.videoConfigReady && this.inited ? this.dom.videoElement.poster : e }, set: function (e) { return this.dispatcher.videoConfigReady ? (e.length && this.dom.setAttr("video", "poster", e), e) : e } })], playsInline: [Go({ get: function (e) { var t = this.dom.videoElement.playsInline; return this.dispatcher.videoConfigReady && this.inited ? void 0 === t ? e : t : e }, set: function (e) { if (!this.dispatcher.videoConfigReady) return e; this.dom.videoElement.playsInline = e; var t = e ? "" : void 0; return this.dom.setAttr("video", "playsinline", t), this.dom.setAttr("video", "webkit-playsinline", t), this.dom.setAttr("video", "x5-playsinline", t), e } }), da()], x5VideoPlayerFullscreen: [Go({ set: function (e) { return !!e }, get: function (e) { return !!e } }), ru("x5-video-player-fullscreen", !0)], x5VideoOrientation: [Go({ set: Zs }), ru("x5-video-orientation")], x5VideoPlayerType: [Go({ set: function (e) { if (!this.dispatcher.videoConfigReady) return e; var t = "h5" === e ? "h5" : void 0; return this.dom.setAttr("video", "x5-video-player-type", t), e }, get: function (e) { return this.dispatcher.videoConfigReady && e || (this.dom.getAttr("video", "x5-video-player-type") ? "h5" : void 0) } })], xWebkitAirplay: [Go({ set: function (e) { return !!e }, get: function (e) { return !!e } }), ru("x-webkit-airplay", !0)], playbackRate: [ha(1), eu("playbackRate")], defaultPlaybackRate: [eu("defaultPlaybackRate"), ha(1)], disableRemotePlayback: [da(), eu("disableRemotePlayback")], volume: [ha(1), eu("volume")] }, Au = (As = function () { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; var n = !!kr(t[0]) && t.shift(); return t.unshift(function (e) { return kr(e) ? e : n }), zo.apply(void 0, t) }(), Rs = function () { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; var n = Sr(t[0]) ? t.shift() : ""; return t.unshift(function (e) { return Sr(e) ? e : n }), zo.apply(void 0, t) }(function (e) { return e.toLocaleLowerCase() }), Os = function () { function e(t, r) { Mt(this, e), Qs(this, "needToLoadSrc", Ls, this), Qs(this, "changeWatchable", xs, this), Qs(this, "inited", Ps, this), this.src = "", Qs(this, "isLive", Cs, this), Qs(this, "box", Ds, this), this.preset = {}, this.presetConfig = {}, this.autoload = !0, this.autoplay = !1, this.controls = !1, this.width = "100%", this.height = "100%", this.crossOrigin = void 0, this.loop = !1, this.defaultMuted = !1, this.muted = !1, this.preload = "auto", this.poster = void 0, this.playsInline = !1, this.x5VideoPlayerFullscreen = !1, this.x5VideoOrientation = void 0, this.x5VideoPlayerType = void 0, this.xWebkitAirplay = !1, this.playbackRate = 1, this.defaultPlaybackRate = 1, this.disableRemotePlayback = !1, this.volume = 1, Qs(this, "_kernelProperty", Is, this), Qs(this, "_realDomAttr", Ms, this), oa(this, Tu, { self: !0 }), Object.defineProperty(this, "dispatcher", { value: t, enumerable: !1, writable: !1, configurable: !1 }), Object.defineProperty(this, "dom", { value: t.dom, enumerable: !1, writable: !1, configurable: !1 }), Jr(this, r) } return Gt(e, [{ key: "init", value: function () { var e = this; this._realDomAttr.forEach(function (t) { e[t] = e[t] }), this.inited = !0 } }]), e }(), Ls = Js(Os.prototype, "needToLoadSrc", [ra], { enumerable: !0, initializer: function () { return !1 } }), xs = Js(Os.prototype, "changeWatchable", [ra], { enumerable: !0, initializer: function () { return !0 } }), Ps = Js(Os.prototype, "inited", [ra], { enumerable: !0, initializer: function () { return !1 } }), Cs = Js(Os.prototype, "isLive", [As, ca], { enumerable: !0, initializer: function () { return !1 } }), Ds = Js(Os.prototype, "box", [Rs, ca], { enumerable: !0, initializer: function () { return "" } }), Is = Js(Os.prototype, "_kernelProperty", [Zo], { enumerable: !0, initializer: function () { return ["isLive", "box", "preset", "kernels", "presetConfig"] } }), Ms = Js(Os.prototype, "_realDomAttr", [Zo], { enumerable: !0, initializer: function () { return ["src", "controls", "width", "height", "crossOrigin", "loop", "muted", "preload", "poster", "autoplay", "playsInline", "x5VideoPlayerFullscreen", "x5VideoOrientation", "xWebkitAirplay", "playbackRate", "defaultPlaybackRate", "autoload", "disableRemotePlayback", "defaultMuted", "volume", "x5VideoPlayerType"] } }), Os); function Ru(e, t, r, n, i) { var o = {}; return Object.keys(n).forEach(function (e) { o[e] = n[e] }), o.enumerable = !!o.enumerable, o.configurable = !!o.configurable, ("value" in o || o.initializer) && (o.writable = !0), o = r.slice().reverse().reduce(function (r, n) { return n(e, t, r) || r }, o), i && void 0 !== o.initializer && (o.value = o.initializer ? o.initializer.call(i) : void 0, o.initializer = void 0), void 0 === o.initializer && (Object.defineProperty(e, t, o), o = null), o } var Ou, Lu, xu, Pu, Cu, Du, Iu, Mu, Nu = (iu = Yo(), ou = Ho("silentLoad"), au = Ho("fullScreen"), su = Ho("$fullScreen"), uu = Ho("fullscreen"), lu = Ho("emit"), cu = Ho("emitSync"), fu = Ho("on"), du = Ho("addEventListener"), hu = $o(Ys), pu = Ho("off"), vu = Ho("removeEventListener"), mu = $o(Ys), yu = Ho("once"), gu = $o(Ys), bu = Ho("css"), _u = $o(Xs), wu = Ho("attr"), Eu = $o(Xs), iu((Ru((ku = function () { function e() { Mt(this, e), this.__events = {}, this.__unwatchHandlers = [] } return Gt(e, [{ key: "__wrapAsVideo", value: function (e) { var t = this; Bs.forEach(function (e) { jt(t, e, { get: function () { return this.__dispatcher.dom.videoElement[e] }, set: void 0, configurable: !1, enumerable: !1 }) }), qs.forEach(function (e) { jt(t, e, { get: function () { var t = this.__dispatcher.dom.videoElement; return en(t[e], t) }, set: void 0, configurable: !1, enumerable: !1 }) }), oa(this, e._realDomAttr.concat(e._kernelProperty).reduce(function (t, r) { return t[r] = [Go({ get: function () { return e[r] }, set: function (t) { return e[r] = t, t } }), ra], t }, {}), { self: !0 }), Ks.forEach(function (e) { jt(t, e, { value: function () { for (var t = this, r = arguments.length, n = Array(r), i = 0; i < r; i++)n[i] = arguments[i]; return new ii(function (r) { var i, o = t.__id; t.__dispatcher.binder.once({ id: o, name: "_" + e, fn: r }), (i = t.__dispatcher.binder)[/^(seek)$/.test(e) ? "emitSync" : "emit"].apply(i, [{ target: "video", name: e, id: o }].concat(Yr(n))) }) }, configurable: !0, enumerable: !1, writable: !0 }) }), Hs.forEach(function (e) { "fullscreen" !== e && jt(t, e, { value: function () { var t; return (t = this.__dispatcher.dom)[e].apply(t, arguments) }, configurable: !0, enumerable: !1, writable: !0 }) }) } }, { key: "$watch", value: function (e, t) { var r = this, n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}, i = n.deep, o = n.diff, a = void 0 === o || o, s = n.other, u = n.proxy, l = void 0 !== u && u; if (!Sr(e) && !mr(e)) throw new TypeError("$watch only accept string and Array<string> as key to find the target to spy on, but not " + e + ", whose type is " + (void 0 === e ? "undefined" : xt(e))); var c = !0, f = function e() { c = !1; var t = r.__unwatchHandlers.indexOf(e); t > -1 && r.__unwatchHandlers.splice(t, 1) }, d = Sr(e) ? e.split(".") : e, h = d.pop(), p = this.__dispatcher.videoConfig; return oa(0 === d.length && !s && p._realDomAttr.indexOf(h) > -1 ? p : ["isFullscreen", "fullscreenElement"].indexOf(h) > -1 ? this.__dispatcher.dom : function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}, n = r.throwError, i = void 0 !== n && n, o = r.backup; if (Sr(t) && (t = t.split(".")), !mr(t)) throw new TypeError("keys of getDeepProperty must be string or Array<string>"); for (var a = [], s = e, u = 0, l = t.length; u < l; u++) { var c = t[u]; if (vr(s)) { if (i) throw new Error("obj" + (a.length > 0 ? "." + a.join(".") : " itself") + " is " + s); return o } s = s[c], a.push(c) } return s }(s || this, d, { throwError: !0 }), xo({}, h, function () { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; var n = gr(t[t.length - 1]) ? t[t.length - 1] : {}, i = n.deep, o = n.omit, a = n.other, s = n.operationPrefix, u = void 0 === s ? "__" : s, l = n.diff, c = void 0 === l || l, f = n.proxy; if ("function" != typeof Proxy && (f = !1), !t.length) throw new TypeError("You must pass a function or a string to find the hanlder function."); if (void 0 !== a && Ar(a)) throw new TypeError("If you want us to trigger function on the other instance, you must pass in a legal instance"); if (!Sr(u)) throw new TypeError("operationPrefix must be an string"); return function (e, r, n) { var s = t.reduce(function (r, n, i) { if (!Sr(n) && !yr(n)) { if (!i || i !== t.length - 1) throw new TypeError("You can only pass function or string as handler"); return r } return r.push(Sr(n) ? function (t, r) { var i = ro(a || e, n); if (yr(i)) return to(i, this)(t, r); if (!o) throw new Error("You pass in a function for us to trigger, please ensure the property to be a function or set omit flag true") } : n), r }, []), l = function (e, t) { var r = this; s.forEach(function (n) { return to(n, r)(e, t) }) }, d = !1, h = void 0, p = void 0, v = void 0; return jo(Go({ set: function (e) { var t = this; h = this[r], v = void 0; var n = function () { return to(l, t)(p, h) }; return i && (gr(e) || mr(e)) ? f ? sa(e, n, { diff: c, operationPrefix: u }) : ua(e, n, { operationPrefix: u, diff: c }) : e }, get: function (e) { var t = this; if (v) return v; if (!d) { d = !0; var r = function () { return to(l, t)(p, h) }; if (i && (gr(e) || mr(e))) { if (f) return v = sa(e, r, { diff: c, operationPrefix: u }), h = v, p = v, v; ua(e, r, { operationPrefix: u, diff: c }) } h = e, p = e } return e } }, { preSet: !0 }), Go({ set: function (e) { return p = e, c && h === e || to(l, this)(p, h), h = e, e } }, { preSet: !1 }))(e, r, n) } }(function () { !c || this instanceof Au && !this.dispatcher.changeWatchable || en(t, this).apply(void 0, arguments) }, { deep: i, diff: a, proxy: l })), { self: !0 }), this.__unwatchHandlers.push(f), f } }, { key: "$set", value: function (e, t, r) { if (!gr(e) && !mr(e)) throw new TypeError("$set only support Array or Object, but not " + e + ", whose type is " + (void 0 === e ? "undefined" : xt(e))); yr(e.__set) ? e.__set(t, r) : e[t] = r } }, { key: "$del", value: function (e, t) { if (!gr(e) && !mr(e)) throw new TypeError("$del only support Array or Object, but not " + e + ", whose type is " + (void 0 === e ? "undefined" : xt(e))); yr(e.__del) ? e.__del(t) : delete e[t] } }, { key: "load", value: function () { for (var e = this, t = arguments.length, r = Array(t), n = 0; n < t; n++)r[n] = arguments[n]; return new ii(function (t) { var n; e.__dispatcher.binder.once({ id: e.__id, name: "_load", target: "plugin", fn: t }), (n = e.__dispatcher.binder).emit.apply(n, [{ name: "load", target: "plugin", id: e.__id }].concat(r)) }) } }, { key: "$silentLoad", value: function () { for (var e = this, t = arguments.length, r = Array(t), n = 0; n < t; n++)r[n] = arguments[n]; return this.__dispatcher.binder.emit({ name: "silentLoad", target: "video", id: this.__id }).then(function () { var t; return (t = e.__dispatcher).silentLoad.apply(t, r) }).then(function (t) { e.__dispatcher.binder.trigger({ name: "silentLoad", target: "video", id: e.__id }, t) }) } }, { key: "$fullscreen", value: function () { var e = !(arguments.length > 0 && void 0 !== arguments[0]) || arguments[0], t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "container"; if (!this.__dispatcher.binder.emitSync({ name: "fullscreen", id: this.__id, target: "video-dom" }, e, t)) return !1; var r = this.__dispatcher.dom.fullscreen(e, t); return this.__dispatcher.binder.triggerSync({ name: "fullscreen", id: this.__id, target: "video-dom" }, e, t), r } }, { key: "$emit", value: function (e) { var t, r = void 0; if (gr(e) && Sr(e.name) && Sr(e.target) && (r = e.target, e = e.name), !Sr(e)) throw new TypeError("emit key parameter must be String"); for (var n = arguments.length, i = Array(n > 1 ? n - 1 : 0), o = 1; o < n; o++)i[o - 1] = arguments[o]; return (t = this.__dispatcher.binder).emit.apply(t, [{ name: e, id: this.__id, target: r }].concat(Yr(i))) } }, { key: "$emitSync", value: function (e) { var t, r = void 0; if (gr(e) && Sr(e.name) && Sr(e.target) && (r = e.target, e = e.name), !Sr(e)) throw new TypeError("emitSync key parameter must be String"); for (var n = arguments.length, i = Array(n > 1 ? n - 1 : 0), o = 1; o < n; o++)i[o - 1] = arguments[o]; return (t = this.__dispatcher.binder).emitSync.apply(t, [{ name: e, id: this.__id, target: r }].concat(Yr(i))) } }, { key: "$on", value: function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}, n = mi({}, r, { name: e, id: this.__id, fn: t }); this.__dispatcher.binder.on(n), this.__addEvents(e, t) } }, { key: "$off", value: function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}, n = mi({}, r, { name: e, id: this.__id, fn: t }); this.__dispatcher.binder.off(n), this.__removeEvents(e, t) } }, { key: "$once", value: function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}, n = this, i = function r() { en(t, this).apply(void 0, arguments), n.__removeEvents(e, r) }; n.__addEvents(e, i); var o = mi({}, r, { name: e, id: this.__id, fn: i }); this.__dispatcher.binder.once(o) } }, { key: "$css", value: function (e) { for (var t, r = arguments.length, n = Array(r > 1 ? r - 1 : 0), i = 1; i < r; i++)n[i - 1] = arguments[i]; return (t = this.__dispatcher.dom)[e + "Style"].apply(t, n) } }, { key: "$attr", value: function (e) { for (var t, r = arguments.length, n = Array(r > 1 ? r - 1 : 0), i = 1; i < r; i++)n[i - 1] = arguments[i]; if ("set" === e && /video/.test(n[0])) { if (!this.__dispatcher.videoConfigReady) return n[2]; if (this.__dispatcher.videoConfig._realDomAttr.indexOf(n[1]) > -1) { var o = n[1], a = n[2]; return this.__dispatcher.videoConfig[o] = a, a } } return (t = this.__dispatcher.dom)[e + "Attr"].apply(t, n) } }, { key: "requestPictureInPicture", value: function () { return this.__dispatcher.binder.emit({ target: "video", name: "enterpictureinpicture", id: this.__id }) } }, { key: "exitPictureInPicture", value: function () { return this.__dispatcher.binder.emit({ target: "video", name: "leavepictureinpicture", id: this.__id }) } }, { key: "__addEvents", value: function (e, t) { this.__events[e] = this.__events[e] || [], this.__events[e].push(t) } }, { key: "__removeEvents", value: function (e, t) { if (!wr(this.__events[e])) { var r = this.__events[e].indexOf(t); r < 0 || (this.__events[e].splice(r, 1), wr(this.__events[e]) && delete this.__events[e]) } } }, { key: "__destroy", value: function () { var e = this; this.__unwatchHandlers.forEach(function (e) { return e() }), Jt(this.__events).forEach(function (t) { mr(e.__events[t]) && e.__events[t].forEach(function (r) { return e.$off(t, r) }) }), delete this.__events } }, { key: "currentTime", get: function () { return this.__dispatcher.kernel.currentTime }, set: function (e) { this.__dispatcher.binder.emitSync({ name: "seek", target: "video", id: this.__id }, e) } }, { key: "inPictureInPictureMode", get: function () { return this.__dispatcher.inPictureInPictureMode } }, { key: "pictureInPictureWindow", get: function () { return window.__chimee_picture_in_picture_window } }, { key: "$plugins", get: function () { return this.__dispatcher.plugins } }, { key: "$pluginOrder", get: function () { return this.__dispatcher.order } }, { key: "$wrapper", get: function () { return this.__dispatcher.dom.wrapper } }, { key: "$container", get: function () { return this.__dispatcher.dom.container } }, { key: "$video", get: function () { return this.__dispatcher.dom.videoElement } }, { key: "isFullscreen", get: function () { return this.__dispatcher.dom.isFullscreen } }, { key: "fullscreenElement", get: function () { return this.__dispatcher.dom.fullscreenElement } }, { key: "container", get: function () { return this.__dispatcher.containerConfig }, set: function (e) { if (!gr(e)) throw new Error("The config of container must be Object, but not " + (void 0 === e ? "undefined" : xt(e)) + "."); return Jr(this.__dispatcher.containerConfig, e), this.__dispatcher.container } }, { key: "videoRequireGuardedAttributes", get: function () { return this.__dispatcher.dom.videoRequireGuardedAttributes } }]), e }()).prototype, "$silentLoad", [ou], eo(ku.prototype, "$silentLoad"), ku.prototype), Ru(ku.prototype, "$fullscreen", [au, su, uu], eo(ku.prototype, "$fullscreen"), ku.prototype), Ru(ku.prototype, "$emit", [lu], eo(ku.prototype, "$emit"), ku.prototype), Ru(ku.prototype, "$emitSync", [cu], eo(ku.prototype, "$emitSync"), ku.prototype), Ru(ku.prototype, "$on", [fu, du, hu], eo(ku.prototype, "$on"), ku.prototype), Ru(ku.prototype, "$off", [pu, vu, mu], eo(ku.prototype, "$off"), ku.prototype), Ru(ku.prototype, "$once", [yu, gu], eo(ku.prototype, "$once"), ku.prototype), Ru(ku.prototype, "$css", [bu, _u], eo(ku.prototype, "$css"), ku.prototype), Ru(ku.prototype, "$attr", [wu, Eu], eo(ku.prototype, "$attr"), ku.prototype), Ru(ku.prototype, "inPictureInPictureMode", [ra], eo(ku.prototype, "inPictureInPictureMode"), ku.prototype), Ru(ku.prototype, "pictureInPictureWindow", [ra], eo(ku.prototype, "pictureInPictureWindow"), ku.prototype), Ru(ku.prototype, "$plugins", [ra], eo(ku.prototype, "$plugins"), ku.prototype), Ru(ku.prototype, "$pluginOrder", [ra], eo(ku.prototype, "$pluginOrder"), ku.prototype), Ru(ku.prototype, "$wrapper", [ra], eo(ku.prototype, "$wrapper"), ku.prototype), Ru(ku.prototype, "$container", [ra], eo(ku.prototype, "$container"), ku.prototype), Ru(ku.prototype, "$video", [ra], eo(ku.prototype, "$video"), ku.prototype), Su = ku)) || Su), Fu = Yo()(Ou = function (e) { function t() { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, r = e.id, n = e.name, i = e.level, o = void 0 === i ? 0 : i, a = e.operable, s = void 0 === a || a, u = e.beforeCreate, l = e.create, c = e.init, f = e.inited, d = e.destroy, h = e.events, p = void 0 === h ? {} : h, v = e.data, m = void 0 === v ? {} : v, y = e.computed, g = void 0 === y ? {} : y, b = e.methods, _ = void 0 === b ? {} : b, w = e.el, E = e.penetrate, S = void 0 !== E && E, k = e.inner, T = void 0 === k || k, A = e.autoFocus, R = e.className, O = arguments[1], L = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : { name: n }; Mt(this, t); var x = Nt(this, (t.__proto__ || It(t)).call(this)); if (x.destroyed = !1, x.VERSION = "0.11.0", x.__operable = !0, x.__level = 0, wr(O)) throw new TypeError("lack of dispatcher"); if (!Sr(r)) throw new TypeError("id of PluginConfig must be string"); x.__id = r, x.__dispatcher = O, x.$videoConfig = x.__dispatcher.videoConfig, x.__wrapAsVideo(x.$videoConfig), x.beforeCreate = x.beforeCreate || u; try { yr(x.beforeCreate) && x.beforeCreate({ events: p, data: m, computed: g, methods: _ }, L) } catch (e) { x.$throwError(e) } if (!wr(_) && gr(_) && Jt(_).forEach(function (e) { var t = _[e]; if (!yr(t)) throw new TypeError("plugins methods must be Function"); jt(x, e, { value: en(t, x), writable: !0, enumerable: !1, configurable: !0 }) }), !wr(p) && gr(p) && Jt(p).forEach(function (e) { if (!yr(p[e])) throw new TypeError("plugins events hook must bind with Function"); x.$on(e, p[e]) }), !wr(m) && gr(m) && Jr(x, m), !wr(g) && gr(g)) { var P = Jt(g).reduce(function (e, t) { var r = g[t]; return yr(r) ? (e[t] = Go({ get: r }), e) : gr(r) && (yr(r.get) || yr(r.set)) ? (e[t] = Go(r), e) : e }, {}); oa(x, P, { self: !0 }) } x.create = x.create || l, x.init = x.init || c, x.inited = x.inited || f, x.destroy = x.destroy || d, x.$dom = x.__dispatcher.dom.insertPlugin(x.__id, w, { penetrate: S, inner: T, className: R }), x.$autoFocus = kr(A) ? A : T, x.$inner = T, x.$penetrate = S, oa(x, { $inner: Zo, $penetrate: Zo }, { self: !0 }), x.$operable = kr(L.operable) ? L.operable : s, x.__level = _r(L.level) ? L.level : o, x.$config = L; try { yr(x.create) && x.create() } catch (e) { x.$throwError(e) } return x } return Xt(t, Nu), Gt(t, [{ key: "__init", value: function (e) { try { yr(this.init) && this.init(e) } catch (e) { this.$throwError(e) } } }, { key: "__inited", value: function () { var e = this, t = void 0; try { t = yr(this.inited) && this.inited() } catch (e) { this.$throwError(e) } return this.readySync = !Tr(t), this.ready = this.readySync ? ii.resolve(this) : t.then(function () { return e.readySync = !0, e }).catch(function (t) { return xr(t) ? e.$throwError(t) : ii.reject(t) }), this.readySync ? this : this.ready } }, { key: "$bumpToTop", value: function () { var e = this.__dispatcher._getTopLevel(this.$inner); this.$level = e + 1 } }, { key: "$throwError", value: function (e) { this.__dispatcher.throwError(e) } }, { key: "$destroy", value: function () { this.destroyed || (yr(this.destroy) && this.destroy(), ka(t.prototype.__proto__ || It(t.prototype), "__destroy", this).call(this), this.__dispatcher.dom.removePlugin(this.__id), delete this.__dispatcher, delete this.$dom, this.destroyed = !0) } }, { key: "$operable", set: function (e) { kr(e) && (this.$dom.style.pointerEvents = e ? "auto" : "none", this.__operable = e) }, get: function () { return this.__operable } }, { key: "$level", set: function (e) { _r(e) && (this.__level = e, this.__dispatcher._sortZIndex()) }, get: function () { return this.__level } }, { key: "$autoFocus", get: function () { return this.__autoFocus }, set: function (e) { this.__autoFocus = e, this.__dispatcher.dom._autoFocusToVideo(this.$dom, !e) } }]), t }()) || Ou; function Bu(e, t, r, n, i) { var o = {}; return Object.keys(n).forEach(function (e) { o[e] = n[e] }), o.enumerable = !!o.enumerable, o.configurable = !!o.configurable, ("value" in o || o.initializer) && (o.writable = !0), o = r.slice().reverse().reduce(function (r, n) { return n(e, t, r) || r }, o), i && void 0 !== o.initializer && (o.value = o.initializer ? o.initializer.call(i) : void 0, o.initializer = void 0), void 0 === o.initializer && (Object.defineProperty(e, t, o), o = null), o } function Uu(e) { if ("video" === e && (e = "videoElement"), !Or(this[e])) throw new TypeError('Your target "' + e + '" is not a legal HTMLElement'); for (var t = arguments.length, r = Array(t > 1 ? t - 1 : 0), n = 1; n < t; n++)r[n - 1] = arguments[n]; return [e].concat(r) } function ju(e, t, r) { if (!Sr(t)) throw new TypeError("to handle dom's attribute or style, your attr parameter must be string, but not " + t + " in " + (void 0 === t ? "undefined" : xt(t))); if (!Sr(e)) throw new TypeError("to handle dom's attribute or style, your target parameter must be string, , but not " + e + " in " + (void 0 === e ? "undefined" : xt(e))); return [e, t, r] } var Gu, $u, zu, Ku, Vu, Wu = (Lu = function (e) { var t = (arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}).other; if (!yr(e) && !Tr(e) && !Sr(e)) throw new TypeError("@waitUntil only accept Function, Promise or String"); return function (r, n, i) { var o = i || {}, a = o.value, s = o.configurable; if (!yr(a)) throw new TypeError("@waituntil can only be used on function, but not " + a + ' on property "' + n + '"'); var u = !1, l = [], c = Tr(e) ? function () { return e } : yr(e) ? e : function () { var r = e.split("."), n = r.slice(-1), i = Ar(t) ? this : t; if (!u) { var o = ro(i, r.slice(0, -1)); if (vr(o)) return o; var a = ea(o, n), s = function (e) { if (!0 === e) for (; l.length > 0;)l[0](), l.shift(); return e }, c = Io(a) ? Go({ set: s })(o, n, a) : Go({ set: s })(o, n, { value: void 0, configurable: !0, enumerable: !0, writable: !0 }); ta(o, n, c), u = !0 } return ro(i, r) }; return { value: function () { for (var e = this, t = arguments.length, r = Array(t), n = 0; n < t; n++)r[n] = arguments[n]; var i = to(a, this), o = to(c, this).apply(void 0, r); return Tr(o) ? ii.resolve(o).then(function () { return to(a, e).apply(void 0, r) }) : !0 === o ? to(a, this).apply(void 0, r) : new ii(function (e) { l.push(function () { i.apply(void 0, r), e() }) }) }, enumerable: !1, configurable: s, writable: !1 } } }("__dispatcher.videoConfigReady"), xu = $o(ju, Uu), Pu = $o(ju, Uu), Cu = $o(ju, Uu), Du = $o(ju, Uu), Iu = $o(Uu), Bu((Mu = function () { function e(t, r) { Mt(this, e), this.plugins = {}, this.originHTML = "", this.__mouseInVideo = !1, this.destroyed = !1, this.__videoExtendedNodes = [], this.isFullscreen = !1, this.fullscreenElement = void 0; var n = (t || {}).wrapper; if (this.__dispatcher = r, !Or(n) && !Sr(n)) throw new TypeError("Wrapper can only be string or HTMLElement, but not " + (void 0 === n ? "undefined" : xt(n))); var i = Bi(n); if (0 === i.length) throw new TypeError("Can not get dom node accroding wrapper. Please check your wrapper"); this.wrapper = i[0], this.originHTML = this.wrapper.innerHTML; var o = i.find("video")[0]; o || (o = document.createElement("video")), this.installVideo(o), this._fullscreenMonitor(), Fa.on("fullscreenchange", this._fullscreenMonitor); var a = mr(t.videoRequiredGuardedAttributes) ? t.videoRequiredGuardedAttributes : []; a.indexOf("style") < 0 && a.unshift("style"), this.videoRequireGuardedAttributes = a } return Gt(e, [{ key: "mouseInVideo", get: function () { return this.__mouseInVideo }, set: function (e) { this.__mouseInVideo = !!e } }, { key: "videoExtendedNodes", get: function () { return this.__videoExtendedNodes } }]), Gt(e, [{ key: "installVideo", value: function (e) { if (this.__videoExtendedNodes.push(e), Ai(e, "tabindex", -1), this._autoFocusToVideo(e), Or(this.container)) { var t = this.container; 0 === t.childNodes.length ? t.appendChild(e) : t.insertBefore(e, t.childNodes[0]) } else e.parentElement && Or(e.parentElement) && e.parentElement !== this.wrapper ? this.container = e.parentElement : (this.container = document.createElement("container"), Bi(this.container).append(e)); return this.container.parentElement !== this.wrapper && Bi(this.wrapper).append(this.container), this.videoElement = e, e } }, { key: "removeVideo", value: function () { var e = this.videoElement; return this._autoFocusToVideo(this.videoElement, !1), this.__dispatcher.binder && this.__dispatcher.binder.bindEventOnVideo(e, !0), Bi(e).remove(), delete this.videoElement, e } }, { key: "insertPlugin", value: function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}; if (!Sr(e)) throw new TypeError("insertPlugin id parameter must be string"); if (Or(this.plugins[e]) && this.removePlugin(e), Sr(t)) if (/<[^>]+?>/.test(t)) { var n = document.createElement("div"); n.innerHTML = t, t = n.children[0] } else t = document.createElement(function (e) { return Zr(e).replace(/([A-Z])/g, function (e) { return "-" + e.toLowerCase() }) }(t)); else gr(t) && (r = t); var i = r, o = i.inner, a = i.penetrate, s = r.className, u = t && Or(t) ? t : document.createElement("div"); mr(s) && (s = s.join(" ")), Sr(s) && Ri(u, s), this.plugins[e] = u; var l = o ? this.container : this.wrapper, c = o ? this.videoElement : this.container; return a && (this.__dispatcher.binder.bindEventOnPenetrateNode(u), this.__videoExtendedNodes.push(u)), l.lastChild === c ? (l.appendChild(u), u) : (l.insertBefore(u, c.nextSibling), u) } }, { key: "removePlugin", value: function (e) { if (Sr(e)) { var t = this.plugins[e]; Or(t) && (t.parentNode && t.parentNode.removeChild(t), this._autoFocusToVideo(t, !0)); var r = (Pl.getPluginConfig(e) || {}).penetrate; void 0 !== r && r && this.__dispatcher.binder.bindEventOnPenetrateNode(t, !0), delete this.plugins[e] } } }, { key: "setPluginsZIndex", value: function (e) { var t = this; e.forEach(function (e, r) { return Mi(e.match(/^(videoElement|container)$/) ? t[e] : t.plugins[e], "z-index", ++r) }) } }, { key: "setAttr", value: function (e, t, r) { Ai(this[e], t, r) } }, { key: "getAttr", value: function (e, t) { return Ti(this[e], t) } }, { key: "setStyle", value: function (e, t, r) { Mi(this[e], t, r) } }, { key: "getStyle", value: function (e, t) { return Ii(this[e], t) } }, { key: "requestFullscreen", value: function (e) { return Fa.open(this[e]) } }, { key: "exitFullscreen", value: function () { return Fa.exit() } }, { key: "fullscreen", value: function () { for (var e = !(arguments.length > 0 && void 0 !== arguments[0]) || arguments[0], t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "container", r = arguments.length, n = Array(r > 2 ? r - 2 : 0), i = 2; i < r; i++)n[i - 2] = arguments[i]; return e ? this.requestFullscreen.apply(this, [t].concat(Yr(n))) : this.exitFullscreen.apply(this, Yr(n)) } }, { key: "focus", value: function () { this.videoElement.focus() } }, { key: "isNodeInsideVideo", value: function (e) { return this.__videoExtendedNodes.indexOf(e) > -1 || this.__videoExtendedNodes.reduce(function (t, r) { return t || Lr(r, e) }, !1) } }, { key: "migrateVideoRequiredGuardedAttributes", value: function (e) { var t = this; this.videoRequireGuardedAttributes.map(function (e) { return [e, Ti(t.videoElement, e)] }).forEach(function (t) { var r = lo(t, 2), n = r[0], i = r[1]; return Ai(e, n, i) }) } }, { key: "destroy", value: function () { this.removeVideo(), Fa.off("fullscreenchange", this._fullscreenMonitor), this.wrapper.innerHTML = this.originHTML, delete this.wrapper, delete this.plugins, this.destroyed = !0 } }, { key: "_autoFocusToVideo", value: function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] && arguments[1]; Or(e) && ((t ? Pi : Ci)(e, "mouseup", this._focusToVideo, !1, !0), (t ? Pi : Ci)(e, "touchend", this._focusToVideo, !1, !0)) } }, { key: "_focusToVideo", value: function () { var e = window.scrollX, t = window.scrollY; yr(this.videoElement.focus) && this.videoElement.focus(), window.scrollTo(e, t) } }, { key: "_fullscreenMonitor", value: function (e) { var t = Fa.fullscreenElement, r = this.isFullscreen; !t || !Lr(this.wrapper, t) && t !== this.wrapper ? (this.isFullscreen = !1, this.fullscreenElement = void 0) : (this.isFullscreen = !0, this.fullscreenElement = this.wrapper === t ? "wrapper" : this.container === t ? "container" : this.videoElement === t ? "video" : t), Er(e) && r !== this.isFullscreen && this.__dispatcher.binder.triggerSync({ name: "fullscreenchange", target: "esFullscreen", id: "dispatcher" }, e) } }]), e }()).prototype, "setAttr", [Lu, xu], eo(Mu.prototype, "setAttr"), Mu.prototype), Bu(Mu.prototype, "getAttr", [Pu], eo(Mu.prototype, "getAttr"), Mu.prototype), Bu(Mu.prototype, "setStyle", [Cu], eo(Mu.prototype, "setStyle"), Mu.prototype), Bu(Mu.prototype, "getStyle", [Du], eo(Mu.prototype, "getStyle"), Mu.prototype), Bu(Mu.prototype, "requestFullscreen", [Iu], eo(Mu.prototype, "requestFullscreen"), Mu.prototype), Bu(Mu.prototype, "_focusToVideo", [Qo], eo(Mu.prototype, "_focusToVideo"), Mu.prototype), Bu(Mu.prototype, "_fullscreenMonitor", [Qo], eo(Mu.prototype, "_fullscreenMonitor"), Mu.prototype), Mu), Hu = { width: "100%", height: "100%", position: "relative", display: "block" }, qu = function e(t, r, n) { var i = this; Mt(this, e), this.__dispatcher = t, this.__target = r, ["width", "height", "position", "display"].forEach(function (e) { jt(i, e, { get: function () { return this.__dispatcher.dom.getStyle(this.__target, e) }, set: function (t) { if (br(t) && (t += "px"), !Sr(t)) throw new Error("The value of " + e + " in " + this.__target + "Config must be string, but not " + (void 0 === t ? "undefined" : xt(t)) + "."); this.__dispatcher.dom.setStyle(this.__target, e, t) }, configurable: !0, enumerable: !0 }) }), Jr(this, n) }; function Yu(e, t, r, n, i) { var o = {}; return Object.keys(n).forEach(function (e) { o[e] = n[e] }), o.enumerable = !!o.enumerable, o.configurable = !!o.configurable, ("value" in o || o.initializer) && (o.writable = !0), o = r.slice().reverse().reduce(function (r, n) { return n(e, t, r) || r }, o), i && void 0 !== o.initializer && (o.value = o.initializer ? o.initializer.call(i) : void 0, o.initializer = void 0), void 0 === o.initializer && (Object.defineProperty(e, t, o), o = null), o } var Xu = /^(before|after|_)/; function Qu(e) { return !e.match(Xu) } var Ju, Zu, el, tl, rl, nl, il, ol, al, sl, ul, ll, cl = (Gu = la(Qu), $u = la(Qu, { backup: function () { return !1 } }), zu = la(Qu), Ku = la(Qu, { backup: function () { return !1 } }), Yu((Vu = function () { function e(t, r) { Mt(this, e), this.events = {}, this.onceMap = {}, this.__dispatcher = t, this.__kind = r } return Gt(e, [{ key: "on", value: function (e, t, r, n) { this._addEvent([t, n, e], r) } }, { key: "off", value: function (e, t, r, n) { var i = [t, n, e]; if (!this._removeEvent(i, r)) { var o = this._getHandlerFromOnceMap(i, r); yr(o) && this._removeEvent(i, o) && this._removeFromOnceMap(i, r, o) } } }, { key: "once", value: function (e, t, r, n) { var i = this, o = [t, n, e], a = function e() { en(r, this).apply(void 0, arguments), i._removeEvent(o, e), i._removeFromOnceMap(o, r, e) }; this._addEvent(o, a), this._addToOnceMap(o, r, a) } }, { key: "emit", value: function (e) { for (var t = this, r = arguments.length, n = Array(r > 1 ? r - 1 : 0), i = 1; i < r; i++)n[i - 1] = arguments[i]; var o = this.events[e]; if (wr(o)) return $s.indexOf(e) > -1 ? ii.resolve() : this._eventProcessor.apply(this, [e, { sync: !1 }].concat(Yr(n))); var a = this._getEventQueue(o.before, this.__dispatcher.order); return si.apply(void 0, [a].concat(Yr(n))).then(function () { if (!($s.indexOf(e) > -1)) return t._eventProcessor.apply(t, [e, { sync: !1 }].concat(Yr(n))) }).catch(function (e) { return xr(e) && t.__dispatcher.throwError(e), ii.reject(e) }) } }, { key: "emitSync", value: function (e) { for (var t = this.events[e], r = arguments.length, n = Array(r > 1 ? r - 1 : 0), i = 1; i < r; i++)n[i - 1] = arguments[i]; if (wr(t)) return $s.indexOf(e) > -1 || this._eventProcessor.apply(this, [e, { sync: !0 }].concat(Yr(n))); var o = this._getEventQueue(t.before, this.__dispatcher.order); return ui.apply(void 0, [o].concat(Yr(n))) && ($s.indexOf(e) > -1 || this._eventProcessor.apply(this, [e, { sync: !0 }].concat(Yr(n)))) } }, { key: "trigger", value: function (e) { for (var t = this, r = arguments.length, n = Array(r > 1 ? r - 1 : 0), i = 1; i < r; i++)n[i - 1] = arguments[i]; var o = this.events[e]; if (wr(o)) return ii.resolve(!0); var a = this._getEventQueue(o.main, this.__dispatcher.order); return si.apply(void 0, [a].concat(Yr(n))).then(function () { var e = t._getEventQueue(o.after, t.__dispatcher.order); return si.apply(void 0, [e].concat(Yr(n))) }).then(function () { return t._runSideEffectEvent.apply(t, [e, t.__dispatcher.order].concat(Yr(n))) }).catch(function (r) { return xr(r) && t.__dispatcher.throwError(r), t._runSideEffectEvent.apply(t, [e, t.__dispatcher.order].concat(Yr(n))) }) } }, { key: "triggerSync", value: function (e) { var t = this.events[e]; if (wr(t)) return !0; for (var r = this._getEventQueue(t.main, this.__dispatcher.order), n = this._getEventQueue(t.after, this.__dispatcher.order), i = arguments.length, o = Array(i > 1 ? i - 1 : 0), a = 1; a < i; a++)o[a - 1] = arguments[a]; var s = ui.apply(void 0, [r].concat(Yr(o))) && ui.apply(void 0, [n].concat(Yr(o))); return this._runSideEffectEvent.apply(this, [e, this.__dispatcher.order].concat(Yr(o))), s } }, { key: "destroy", value: function () { delete this.events, delete this.__dispatcher } }, { key: "_addEvent", value: function (e, t) { var r = (e = Qr(e)).pop(), n = e.reduce(function (e, t) { return e[t] = e[t] || {}, e[t] }, this.events); n[r] = n[r] || [], n[r].push(t) } }, { key: "_removeEvent", value: function (e, t) { for (var r = (e = Qr(e)).pop(), n = this.events, i = [], o = 0, a = e.length; o < a; o++) { var s = n[e[o]]; if (wr(s)) return; i.push([n, e[o]]), n = s } var u = n[r] || [], l = u.indexOf(t), c = l > -1; if (c && u.splice(l, 1), u.length < 1) { delete n[r]; for (var f = i.length - 1; f > -1; f--) { var d = lo(i[f], 2), h = d[0], p = d[1]; if (!wr(h[p])) break; delete h[p] } } return c } }, { key: "_addToOnceMap", value: function (e, t, r) { var n = e.join("-"), i = this.onceMap[n] = this.onceMap[n] || new Va; i.has(t) || i.set(t, []), i.get(t).push(r) } }, { key: "_removeFromOnceMap", value: function (e, t, r) { var n = e.join("-"), i = this.onceMap[n], o = i.get(t), a = o.indexOf(r); o.splice(a, 1), wr(o) && i.delete(t) } }, { key: "_getHandlerFromOnceMap", value: function (e, t) { var r = e.join("-"), n = this.onceMap[r]; if (!vr(n) && n.has(t)) return n.get(t)[0] } }, { key: "_getEventStage", value: function (e) { var t = e.match(Xu), r = t && t[0] || "main"; return t && (e = Zr(e.replace(Xu, ""))), { stage: r, key: e } } }, { key: "_getEventQueue", value: function (e, t) { var r = this; return t = mr(t) ? t.concat(["_vm"]) : ["_vm"], wr(e) ? [] : t.reduce(function (t, n) { return wr(e[n]) || !mr(e[n]) || !r.__dispatcher.plugins[n] && "_vm" !== n ? t : t.concat(e[n].map(function (e) { return en(e, r.__dispatcher.plugins[n] || r.__dispatcher.vm) })) }, []) } }, { key: "_eventProcessor", value: function (e, t) { for (var r = t.sync, n = Ks.indexOf(e) > -1, i = Hs.indexOf(e) > -1, o = Boolean(Vs[e]), a = arguments.length, s = Array(a > 2 ? a - 2 : 0), u = 2; u < a; u++)s[u - 2] = arguments[u]; if (n || i || o) { var l, c; if (o) (l = this.__dispatcher)[Vs[e]].apply(l, Yr(s)); else (c = this.__dispatcher[n ? "kernel" : "dom"])[e].apply(c, Yr(s)); if (Fs.indexOf(e) > -1 || Us.indexOf(e) > -1) return !0 } return this[r ? "triggerSync" : "trigger"].apply(this, [e].concat(Yr(s))) } }, { key: "_runSideEffectEvent", value: function (e, t) { for (var r = arguments.length, n = Array(r > 2 ? r - 2 : 0), i = 2; i < r; i++)n[i - 2] = arguments[i]; var o = this.events[e]; return !wr(o) && (this._getEventQueue(o._, t).forEach(function (e) { return e.apply(void 0, Yr(n)) }), !0) } }]), e }()).prototype, "emit", [Gu], eo(Vu.prototype, "emit"), Vu.prototype), Yu(Vu.prototype, "emitSync", [$u], eo(Vu.prototype, "emitSync"), Vu.prototype), Yu(Vu.prototype, "trigger", [zu], eo(Vu.prototype, "trigger"), Vu.prototype), Yu(Vu.prototype, "triggerSync", [Ku], eo(Vu.prototype, "triggerSync"), Vu.prototype), Vu); function fl(e, t, r, n, i) { var o = {}; return Object.keys(n).forEach(function (e) { o[e] = n[e] }), o.enumerable = !!o.enumerable, o.configurable = !!o.configurable, ("value" in o || o.initializer) && (o.writable = !0), o = r.slice().reverse().reduce(function (r, n) { return n(e, t, r) || r }, o), i && void 0 !== o.initializer && (o.value = o.initializer ? o.initializer.call(i) : void 0, o.initializer = void 0), void 0 === o.initializer && (Object.defineProperty(e, t, o), o = null), o } var dl = /^(before|after|_)/; function hl(e) { var t, r, n = e.name, i = e.target, o = e.stage, a = (t = n, r = new RegExp("^(c|w)_"), t.match(r) ? { name: t.replace(r, ""), target: 0 === t.indexOf("c") ? "container" : "wrapper" } : "error" === t && { name: "error", target: "kernel" }); a && (n = a.name, i = a.target); var s = function (e) { var t = e.match(dl), r = t && t[0] || "main"; return t && (e = Zr(e.replace(dl, ""))), { name: e, stage: r } }(n), u = s.stage; return n = s.name, i || (i = function (e) { return Fs.indexOf(e) > -1 ? "video" : Ws.indexOf(e) > -1 ? "kernel" : Us.indexOf(e) > -1 ? "video-dom" : js.indexOf(e) > -1 ? "esFullscreen" : "plugin" }(n)), { name: n, stage: o || u, target: i } } function pl(e) { var t = e.id, r = e.fn, n = hl(e), i = n.name, o = n.target, a = n.stage; if (!yr(r)) throw new Error("You must provide a function to handle with event " + i + ", but not " + (void 0 === r ? "undefined" : xt(r))); return { id: t, fn: r, name: i, target: o, stage: a } } function vl(e) { var t = e.id, r = e.name; return r && Sr(r) && !dl.test(r) ? !(!t || !Sr(t)) || (Cr.error("You must provide the id of emitter"), !1) : (Cr.error("You must provide a legal event name, which is string and could not started with before/after/_"), !1) } function ml(e) { e.target = hl(e).target; for (var t = arguments.length, r = Array(t > 1 ? t - 1 : 0), n = 1; n < t; n++)r[n - 1] = arguments[n]; return [e].concat(Yr(r)) } var yl, gl, bl, _l, wl, El, Sl, kl = (Ju = $o(pl), Zu = $o(pl), el = $o(pl), tl = la(vl), rl = $o(ml), nl = la(vl, { backup: function () { return !1 } }), il = $o(ml), ol = la(vl), al = $o(ml), sl = la(vl, { backup: function () { return !1 } }), ul = $o(ml), fl((ll = function () { function e(t) { Mt(this, e), this.__dispatcher = t, this.kinds = ["kernel", "container", "wrapper", "video", "video-dom", "plugin", "esFullscreen"], this.buses = {}, this.bindedEventNames = {}, this.bindedEventInfo = {}, this.pendingEventsInfo = {}; var r = !0, n = !1, i = void 0; try { for (var o, a = uo(this.kinds); !(r = (o = a.next()).done); r = !0) { var s = o.value; this.bindedEventNames[s] = [], this.bindedEventInfo[s] = [], this.pendingEventsInfo[s] = [], this.buses[s] = new cl(t, s) } } catch (e) { n = !0, i = e } finally { try { !r && a.return && a.return() } finally { if (n) throw i } } } return Gt(e, [{ key: "on", value: function (e) { var t = e.target, r = e.id, n = e.name, i = e.fn, o = e.stage; return this._addEventListenerOnTarget({ name: n, target: t, id: r }), this.buses[t].on(r, n, i, o) } }, { key: "off", value: function (e) { var t = e.target, r = e.id, n = e.name, i = e.fn, o = e.stage, a = this.buses[t].off(r, n, i, o); return this._removeEventListenerOnTargetWhenIsUseless({ name: n, target: t }), a } }, { key: "once", value: function (e) { var t = e.target, r = e.id, n = e.name, i = e.fn, o = e.stage; return this.buses[t].once(r, n, i, o) } }, { key: "emit", value: function (e) { for (var t, r = e.target, n = e.name, i = arguments.length, o = Array(i > 1 ? i - 1 : 0), a = 1; a < i; a++)o[a - 1] = arguments[a]; return (t = this.buses[r]).emit.apply(t, [n].concat(Yr(o))) } }, { key: "emitSync", value: function (e) { for (var t, r = e.target, n = e.name, i = arguments.length, o = Array(i > 1 ? i - 1 : 0), a = 1; a < i; a++)o[a - 1] = arguments[a]; return (t = this.buses[r]).emitSync.apply(t, [n].concat(Yr(o))) } }, { key: "trigger", value: function (e) { for (var t, r = e.target, n = e.name, i = arguments.length, o = Array(i > 1 ? i - 1 : 0), a = 1; a < i; a++)o[a - 1] = arguments[a]; return (t = this.buses[r]).trigger.apply(t, [n].concat(Yr(o))) } }, { key: "triggerSync", value: function (e) { for (var t, r = e.target, n = e.name, i = arguments.length, o = Array(i > 1 ? i - 1 : 0), a = 1; a < i; a++)o[a - 1] = arguments[a]; return (t = this.buses[r]).triggerSync.apply(t, [n].concat(Yr(o))) } }, { key: "bindEventOnPenetrateNode", value: function (e) { var t = this, r = arguments.length > 1 && void 0 !== arguments[1] && arguments[1]; this.bindedEventInfo["video-dom"].forEach(function (n) { var i = lo(n, 2), o = i[0], a = i[1]; r ? Pi(e, o, a) : t._addEventOnDom(e, o, a) }) } }, { key: "bindEventOnVideo", value: function (e) { var t = this, r = arguments.length > 1 && void 0 !== arguments[1] && arguments[1]; this.bindedEventInfo["video-dom"].concat(this.bindedEventInfo.video).forEach(function (n) { var i = lo(n, 2), o = i[0], a = i[1]; r ? Pi(e, o, a) : t._addEventOnDom(e, o, a) }) } }, { key: "listenOnMouseMoveEvent", value: function (e) { var t = this, r = this.__dispatcher.dom, n = "video-dom", i = "_vm"; zs.forEach(function (o) { var a = function () { for (var e = arguments.length, a = Array(e), s = 0; s < e; s++)a[s] = arguments[s]; var u = a[0], l = u.toElement, c = u.currentTarget, f = u.relatedTarget, d = u.type, h = l || f; return r.mouseInVideo && "mouseleave" === d && !r.isNodeInsideVideo(h) ? (r.mouseInVideo = !1, t.triggerSync.apply(t, [{ target: n, name: o, id: i }].concat(a))) : !r.mouseInVideo && "mouseenter" === d && r.isNodeInsideVideo(c) ? (r.mouseInVideo = !0, t.triggerSync.apply(t, [{ target: n, name: o, id: i }].concat(a))) : void 0 }; t._addEventOnDom(e, o, a), t.bindedEventNames[n].indexOf(o) < 0 && (t.bindedEventNames[n].push(o), t.bindedEventInfo[n].push([o, a])) }) } }, { key: "migrateKernelEvent", value: function (e, t) { this.bindedEventInfo.kernel.forEach(function (r) { var n = lo(r, 2), i = n[0], o = n[1]; e.off(i, o), t.on(i, o) }) } }, { key: "destroy", value: function () { var e = this; this.kinds.forEach(function (t) { if ("kernel" === t) e.bindedEventInfo.kernel.forEach(function (t) { var r = lo(t, 2), n = r[0], i = r[1]; e.__dispatcher.kernel.off(n, i) }); else { var r = e._getTargetDom(t); e.bindedEventInfo[t].forEach(function (n) { var i = lo(n, 2), o = i[0], a = i[1]; Pi(r, o, a), "video-dom" === t && e.__dispatcher.dom.videoExtendedNodes.forEach(function (e) { return Pi(e, o, a) }) }) } e.bindedEventInfo.kernel = [], e.bindedEventNames.kernel = [] }) } }, { key: "_addEventOnDom", value: function (e, t, r) { if (Gs.indexOf(t) > -1) return Ci(e, t, r, !1, { passive: !0 }); Ci(e, t, r) } }, { key: "_addEventListenerOnTarget", value: function (e) { var t = this, r = e.name, n = e.target, i = e.id; if (this._isEventNeedToBeHandled(n, r)) { var o = void 0; if (!(this.bindedEventNames[n].indexOf(r) > -1)) { var a = this._getTargetDom(n); if ("kernel" === n) { if (!this.__dispatcher.kernel) return void this.addPendingEvent(n, r, i); o = function () { for (var e = arguments.length, i = Array(e), o = 0; o < e; o++)i[o] = arguments[o]; return t.triggerSync.apply(t, [{ target: n, name: r, id: "kernel" }].concat(i)) }, this.__dispatcher.kernel.on(r, o) } else "container" === n || "wrapper" === n ? (o = function () { for (var e = arguments.length, i = Array(e), o = 0; o < e; o++)i[o] = arguments[o]; return t.triggerSync.apply(t, [{ target: n, name: r, id: n }].concat(i)) }, this._addEventOnDom(a, r, o)) : "video" === n ? (o = function () { for (var e = arguments.length, i = Array(e), o = 0; o < e; o++)i[o] = arguments[o]; return t.trigger.apply(t, [{ target: n, name: r, id: n }].concat(i)) }, this._addEventOnDom(a, r, o)) : "video-dom" === n && (o = function () { for (var e = arguments.length, i = Array(e), o = 0; o < e; o++)i[o] = arguments[o]; return t.triggerSync.apply(t, [{ target: n, name: r, id: n }].concat(i)) }, this.__dispatcher.dom.videoExtendedNodes.forEach(function (e) { return t._addEventOnDom(e, r, o) }), this._addEventOnDom(a, r, o)); this.bindedEventNames[n].push(r), this.bindedEventInfo[n].push([r, o]) } } } }, { key: "_removeEventListenerOnTargetWhenIsUseless", value: function (e) { var t = e.name, r = e.target; if (this._isEventNeedToBeHandled(r, t)) { var n = this.bindedEventNames[r], i = n.indexOf(t); if (!(i < 0) && wr(this.buses[r].events[t])) { var o = this.bindedEventInfo[r], a = void 0, s = void 0; for (s = 0; s < o.length; s++)if (o[s][0] === t) { a = o[s][1]; break } if (yr(a)) { if ("kernel" === r) this.__dispatcher.kernel.off(t, a); else Pi(this._getTargetDom(r), t, a), "video-dom" === r && this.__dispatcher.dom.videoExtendedNodes.forEach(function (e) { Pi(e, t, a) }); o.splice(s, 1), n.splice(i, 1) } } } } }, { key: "_getTargetDom", value: function (e) { var t = void 0; switch (e) { case "container": case "wrapper": t = this.__dispatcher.dom[e]; break; default: t = this.__dispatcher.dom.videoElement }return t } }, { key: "_isEventNeedToBeHandled", value: function (e, t) { return "plugin" !== e && "esFullscreen" !== e && (zs.indexOf(t) < 0 || "video" !== e) } }, { key: "addPendingEvent", value: function (e, t, r) { this.pendingEventsInfo[e].push([t, r]) } }, { key: "applyPendingEvents", value: function (e) { for (var t = this.pendingEventsInfo[e], r = t.splice(0, t.length); r.length;) { var n = r.pop(), i = lo(n, 2), o = i[0], a = i[1]; this._addEventListenerOnTarget({ name: o, target: e, id: a }) } } }]), e }()).prototype, "on", [Ju], eo(ll.prototype, "on"), ll.prototype), fl(ll.prototype, "off", [Zu], eo(ll.prototype, "off"), ll.prototype), fl(ll.prototype, "once", [el], eo(ll.prototype, "once"), ll.prototype), fl(ll.prototype, "emit", [tl, rl], eo(ll.prototype, "emit"), ll.prototype), fl(ll.prototype, "emitSync", [nl, il], eo(ll.prototype, "emitSync"), ll.prototype), fl(ll.prototype, "trigger", [ol, al], eo(ll.prototype, "trigger"), ll.prototype), fl(ll.prototype, "triggerSync", [sl, ul], eo(ll.prototype, "triggerSync"), ll.prototype), ll); function Tl(e, t, r, n, i) { var o = {}; return Object.keys(n).forEach(function (e) { o[e] = n[e] }), o.enumerable = !!o.enumerable, o.configurable = !!o.configurable, ("value" in o || o.initializer) && (o.writable = !0), o = r.slice().reverse().reduce(function (r, n) { return n(e, t, r) || r }, o), i && void 0 !== o.initializer && (o.value = o.initializer ? o.initializer.call(i) : void 0, o.initializer = void 0), void 0 === o.initializer && (Object.defineProperty(e, t, o), o = null), o } var Al = {}, Rl = {}; function Ol(e) { if (!Sr(e)) throw new Error("Plugin's name must be a string, but not \"" + e + '" in ' + (void 0 === e ? "undefined" : xt(e))); return Zr(e) } var Ll, xl, Pl = (yl = $o(Ol), gl = $o(Ol), bl = $o(function (e) { if (yr(e)) { if (!(e.prototype instanceof Fu)) throw new TypeError("Your are trying to install plugin " + e.name + ", but it's not extends from Chimee.plugin.") } else { if (!gr(e) || wr(e)) throw new TypeError("plugin's config must be an Object, but not \"" + e + '" in ' + (void 0 === e ? "undefined" : xt(e))); var t = e.name; if (!Sr(t) || t.length < 1) throw new TypeError('plugin must have a legal namea, but not "' + t + '" in ' + (void 0 === t ? "undefined" : xt(t))) } }), _l = $o(Ol), wl = $o(Ol), El = $o(Ol), Tl((Sl = function () { function e(t, r) { var n = this; if (Mt(this, e), this.plugins = {}, this.order = [], this.readySync = !1, this.zIndexMap = { inner: [], outer: [] }, this.changeWatchable = !0, this.kernelEventHandlerList = [], !gr(t)) throw new TypeError('UserConfig must be an Object, but not "' + t + '" in ' + (void 0 === t ? "undefined" : xt(t))); this.dom = new Wu(t, this), this.vm = r, this.videoConfigReady = !1, this.videoConfig = new Au(this, t), mr(t.plugins) && !mr(t.plugin) && (t.plugin = t.plugins, delete t.plugins), this.binder = new kl(this), this.binder.listenOnMouseMoveEvent(this.dom.videoElement), this._initUserPlugin(t.plugin); var i = Jr({}, Hu, t.container || {}); if (this.order.forEach(function (e) { return n.plugins[e].__init(n.videoConfig, i) }), this.videoConfigReady = !0, this.videoConfig.init(), this.containerConfig = new qu(this, "container", i), this.kernel = this._createKernel(this.dom.videoElement, this.videoConfig), this.binder.applyPendingEvents("kernel"), t.noDefaultContextMenu) { var o = t.noDefaultContextMenu, a = "container" === o || "wrapper" === o ? o : "video-dom"; this.binder.on({ target: a, id: "_vm", name: "contextmenu", fn: function (e) { return e.preventDefault() }, stage: "main" }) } var s = []; this.order.forEach(function (e) { var t = n.plugins[e].__inited(); Tr(t) && s.push(t) }), this.readySync = 0 === s.length, this.ready = this.readySync ? ii.resolve() : ii.all(s).then(function () { n.readySync = !0, n.onReady() }), this.readySync && this.onReady() } return Gt(e, [{ key: "onReady", value: function () { this.binder.trigger({ target: "plugin", name: "ready", id: "dispatcher" }), this._autoloadVideoSrcAtFirst() } }, { key: "use", value: function (t) { if (Sr(t) && (t = { name: t, alias: void 0 }), !gr(t) || gr(t) && !Sr(t.name)) throw new TypeError("pluginConfig do not match requirement"); Sr(t.alias) || (t.alias = void 0); var r = t, n = r.name, i = r.alias; t.name = i || n, delete t.alias; var o = Zr(n), a = Zr(i || n), s = t, u = e.getPluginConfig(o); if (wr(u)) throw new TypeError("You have not installed plugin " + o); gr(u) && (u.id = a); var l = yr(u) ? new u({ id: a }, this, s) : new Fu(u, this, s); return this.plugins[a] = l, jt(this.vm, a, { value: l, configurable: !0, enumerable: !1, writable: !1 }), this.order.push(a), this._sortZIndex(), this.videoConfigReady && l.__inited(), l.ready } }, { key: "unuse", value: function (e) { var t = this.plugins[e]; if (gr(t) && yr(t.$destroy)) { t.$destroy(); var r = this.order.indexOf(e); r > -1 && this.order.splice(r, 1), delete this.plugins[e], delete this.vm[e] } else delete this.plugins[e] } }, { key: "hasUsed", value: function (e) { return gr(this.plugins[e]) } }, { key: "throwError", value: function (e) { this.vm.__throwError(e) } }, { key: "silentLoad", value: function (e) { var t = this, r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}, n = r.duration, i = void 0 === n ? 3 : n, o = r.bias, a = void 0 === o ? 0 : o, s = r.repeatTimes, u = void 0 === s ? 0 : s, l = r.increment, c = void 0 === l ? 0 : l, f = r.isLive, d = void 0 === f ? this.videoConfig.isLive : f, h = r.box, p = void 0 === h ? this.videoConfig.box : h, v = r.kernels, m = void 0 === v ? this.videoConfig.kernels : v, y = r.preset, g = void 0 === y ? this.videoConfig.preset : y, b = r.immediate || d, _ = { isLive: d, box: p, src: e, kernels: m, preset: g }; return si(new Array(u + 1).fill(1).map(function (e, n) { return function () { return new ii(function (e, o) { r.abort && o({ error: !0, message: "user abort the mission" }); var s = document.createElement("video"), l = t.kernel.currentTime + i + c * n; s.muted = !0; var f = !1, h = void 0, p = void 0, v = void 0, m = void 0, y = function r() { var n = t.kernel.currentTime; if (a <= 0 && n >= l || a > 0 && (Math.abs(l - n) <= a && f || n - l > a)) return Pi(t.dom.videoElement, "timeupdate", r), Pi(s, "error", p, !0), f ? o({ error: !1, video: s, kernel: h }) : (Pi(s, "canplay", v, !0), Pi(s, "loadedmetadata", m, !0), h.destroy(), e()) }; v = function () { if (f = !0, b) return Pi(t.dom.videoElement, "timeupdate", y), Pi(s, "error", p, !0), o({ error: !1, video: s, kernel: h }) }, m = function () { d || h.seek(b ? t.kernel.currentTime : l) }, p = function (r) { Pi(s, "canplay", v, !0), Pi(s, "loadedmetadata", m, !0), Pi(t.dom.videoElement, "timeupdate", y), h.off("error", p); var i = void 0; if (!wr(r.data) && r.data.errmsg) { var a = r.data.errmsg; Cr.error("chimee's silentload bump into a kernel error", a), i = new Error(a) } else i = wr(s.error) ? new Error("unknow video error") : new Error(s.error.message), Cr.error("chimee's silentload", i.message); return h.destroy(), t._silentLoadTempKernel = void 0, n === u ? o(i) : e(i) }, Ci(s, "canplay", v, !0), Ci(s, "loadedmetadata", m, !0), Ci(s, "error", p, !0), h = t._createKernel(s, _), t._silentLoadTempKernel = h, h.on("error", p), Ci(t.dom.videoElement, "timeupdate", y), h.load() }) } })).then(function () { var t = "The silentLoad for " + e + " timed out. Please set a longer duration or check your network"; return ii.reject(new Error(t)) }).catch(function (e) { if (xr(e)) return ii.reject(e); if (e.error) return ii.reject(new Error(e.message)); var n = e.video, i = e.kernel; return r.abort ? (i.destroy(), ii.reject(new Error("user abort the mission"))) : t.dom.videoElement.paused ? (t.switchKernel({ video: n, kernel: i, config: _ }), ii.resolve()) : new ii(function (e) { Ci(n, "play", function () { t.switchKernel({ video: n, kernel: i, config: _ }), e() }, !0), n.play() }) }) } }, { key: "load", value: function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}, r = Sr(e) ? e : gr(e) && Sr(e.src) ? e.src : ""; gr(e) && (delete e.src, t = e); var n = this.kernel.box, i = this.videoConfig, o = t, a = o.isLive, s = void 0 === a ? i.isLive : a, u = o.box, l = void 0 === u ? Ts({ src: r, box: i.box }) : u, c = o.preset, f = void 0 === c ? i.preset : c, d = o.kernels, h = void 0 === d ? i.kernels : d; if ("native" !== l || l !== n || !wr(t)) { var p = document.createElement("video"), v = { isLive: s, box: l, preset: f, src: r, kernels: h }, m = this._createKernel(p, v); this.switchKernel({ video: p, kernel: m, config: v, notifyChange: !0 }) } var y = this.videoConfig.autoload; this._changeUnwatchable(this.videoConfig, "autoload", !1), this.videoConfig.src = r || this.videoConfig.src, this.kernel.load(this.videoConfig.src), this._changeUnwatchable(this.videoConfig, "autoload", y) } }, { key: "switchKernel", value: function (e) { var t = this, r = e.video, n = e.kernel, i = e.config, o = e.notifyChange, a = this.kernel, s = Qr(this.videoConfig); this.dom.migrateVideoRequiredGuardedAttributes(r), this.dom.removeVideo(), this.dom.installVideo(r), this.videoConfig.changeWatchable = !1, this.videoConfig.autoload = !1, this.videoConfig.src = i.src, this.videoConfig._realDomAttr.forEach(function (e) { "src" !== e && (t.videoConfig[e] = s[e]) }), this.videoConfig.changeWatchable = !0, this.binder.migrateKernelEvent(a, n), this.kernel = n, this._silentLoadTempKernel = void 0; var u = i.isLive, l = i.box, c = i.preset, f = i.kernels; mi(this.videoConfig, { isLive: u, box: l, preset: c, kernels: f }), a.destroy(), o ? this.binder && this.binder.bindEventOnVideo && this.binder.bindEventOnVideo(r) : setTimeout(function () { t.binder && t.binder.bindEventOnVideo && t.binder.bindEventOnVideo(r) }), this.inPictureInPictureMode && this.exitPictureInPicture() } }, { key: "requestPictureInPicture", value: function () { var t = rs(ts.mark(function t() { var r, n, i; return ts.wrap(function (t) { for (; ;)switch (t.prev = t.next) { case 0: if (!("pictureInPictureEnabled" in document)) { t.next = 8; break } if (!this.inPictureInPictureMode) { t.next = 3; break } return t.abrupt("return", ii.resolve(window.__chimee_picture_in_picture_window)); case 3: return t.next = 5, this.dom.videoElement.requestPictureInPicture(); case 5: return r = t.sent, window.__chimee_picture_in_picture_window = r, t.abrupt("return", r); case 8: return t.next = 10, Promise.resolve().then(function () { return oc }); case 10: return n = t.sent, i = n.default, e.hasInstalled(i.name) || e.install(i), this.hasUsed(i.name) || this.use(i.name), t.abrupt("return", this.plugins.pictureInPicture.requestPictureInPicture()); case 15: case "end": return t.stop() } }, t, this) })); return function () { return t.apply(this, arguments) } }() }, { key: "exitPictureInPicture", value: function () { return "pictureInPictureEnabled" in document && this.inPictureInPictureMode ? (window.__chimee_picture_in_picture_window = void 0, document.exitPictureInPicture()) : this.plugins.pictureInPicture && this.plugins.pictureInPicture.exitPictureInPicture() } }, { key: "destroy", value: function () { for (var e in this.plugins) this.unuse(e); this.binder.destroy(), delete this.binder, this.dom.destroy(), delete this.dom, this.kernel.destroy(), delete this.kernel, delete this.vm, delete this.plugins, delete this.order } }, { key: "_initUserPlugin", value: function () { var e = this, t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : []; return mr(t) || (t = []), t.map(function (t) { return e.use(t) }) } }, { key: "_sortZIndex", value: function () { var e = this, t = this.order.reduce(function (t, r) { var n = e.plugins[r]; if (wr(n)) return t; var i = t[n.$inner ? "inner" : "outer"], o = n.$level; return i[o] = i[o] || [], i[o].push(r), t }, { inner: {}, outer: {} }), r = t.inner, n = t.outer; r[0] = r[0] || [], r[0].unshift("videoElement"), n[0] = n[0] || [], n[0].unshift("container"); var i = ai(r), o = ai(n); this.dom.setPluginsZIndex(i), this.dom.setPluginsZIndex(o), this.zIndexMap.inner = i, this.zIndexMap.outer = o } }, { key: "_getTopLevel", value: function (e) { var t = this.zIndexMap[e ? "inner" : "outer"], r = this.plugins[t[t.length - 1]]; return wr(r) ? 0 : r.$level } }, { key: "_autoloadVideoSrcAtFirst", value: function () { if (this.videoConfig.autoload) { if (!this.videoConfig.src) return void Cr.warn("You have not set the src, so you better set autoload to be false. Accroding to https://github.com/Chimeejs/chimee/blob/master/doc/zh-cn/chimee-api.md#src."); this.binder.emit({ name: "load", target: "plugin", id: "dispatcher" }, { src: this.videoConfig.src }) } } }, { key: "_changeUnwatchable", value: function (e, t, r) { this.changeWatchable = !1, e[t] = r, this.changeWatchable = !0 } }, { key: "_createKernel", value: function (e, t) { var r = t.kernels, n = t.preset, i = {}, o = {}; return mr(r) && (o = r.reduce(function (e, t) { if (Sr(t)) { var r = Rl[t]; return yr(r) ? (e[t] = r, e) : (Cr.warn("You have not installed kernel for " + t + "."), e) } if (gr(t)) { var n = t.name, o = t.handler; if (Sr(o)) { var a = Rl[o]; return yr(a) ? (e[o] = a, i[o] = t, e) : (Cr.warn("You have not installed kernel for " + o + "."), e) } if (yr(o)) { var s = n || o.name; return e[s] = o, i[s] = t, e } return Cr.warn("When you pass in an SingleKernelConfig in Array, you must clarify it's handler, we only support handler in string or function but not " + (void 0 === o ? "undefined" : xt(o))), e } return Cr.warn("If you pass in kernels as array, you must pass in kernels in string or function, but not " + (void 0 === t ? "undefined" : xt(t))), e }, {})), gr(r) && Jt(r).forEach(function (e) { var t = r[e]; if (!yr(t)) { if (gr(t)) { var n = t.handler; if (Sr(n)) { var a = Rl[n]; return yr(a) ? (o[e] = a, void (i[e] = t)) : void Cr.warn("You have not installed kernel for " + n + ".") } return yr(n) ? (o[e] = n, void (i[e] = t)) : void Cr.warn("When you pass in an SingleKernelConfig in Object, you must clarify it's handler, we only support handler in string or function but not " + (void 0 === n ? "undefined" : xt(n))) } return Cr.warn("If you pass in kernels as object, you must pass in kernels in string or function, but not " + (void 0 === t ? "undefined" : xt(t))), r } o[e] = t }), t.preset = mi(o, n), t.presetConfig = i, new Ns(e, t) } }, { key: "inPictureInPictureMode", get: function () { return "pictureInPictureEnabled" in document ? this.dom.videoElement === document.pictureInPictureElement : Boolean(this.plugins.pictureInPicture && this.plugins.pictureInPicture.isShown) } }], [{ key: "install", value: function (e) { var t = Zr(e.name); wr(Al[t]); var r = yr(e) ? e : Jr({ id: t }, e); return Al[t] = r, t } }, { key: "hasInstalled", value: function (e) { return !wr(Al[e]) } }, { key: "uninstall", value: function (e) { delete Al[e] } }, { key: "getPluginConfig", value: function (e) { return Al[e] } }, { key: "installKernel", value: function (e, t) { (gr(e) ? Ya(e) : [[e, t]]).forEach(function (e) { var t = lo(e, 2), r = t[0], n = t[1]; if (!yr(n)) throw new Error("The kernel you install on " + r + " must be a Function, but not " + (void 0 === n ? "undefined" : xt(n))); yr(Rl[r]) && Cr.warn("You have alrady install a kernel on " + r + ", and now we will replace it"), Rl[r] = n }) } }, { key: "uninstallKernel", value: function (e) { delete Rl[e] } }, { key: "hasInstalledKernel", value: function (e) { return yr(Rl[e]) } }]), e }()).prototype, "unuse", [yl], eo(Sl.prototype, "unuse"), Sl.prototype), Tl(Sl.prototype, "hasUsed", [gl], eo(Sl.prototype, "hasUsed"), Sl.prototype), Tl(Sl.prototype, "throwError", [Qo], eo(Sl.prototype, "throwError"), Sl.prototype), Tl(Sl.prototype, "inPictureInPictureMode", [ra], eo(Sl.prototype, "inPictureInPictureMode"), Sl.prototype), Tl(Sl, "install", [bl], eo(Sl, "install"), Sl), Tl(Sl, "hasInstalled", [_l], eo(Sl, "hasInstalled"), Sl), Tl(Sl, "uninstall", [wl], eo(Sl, "uninstall"), Sl), Tl(Sl, "getPluginConfig", [El], eo(Sl, "getPluginConfig"), Sl), Sl); var Cl, Dl, Il, Ml, Nl, Fl, Bl, Ul, jl, Gl, $l, zl, Kl, Vl, Wl, Hl, ql, Yl, Xl, Ql, Jl, Zl, ec = (Ll = function () { function e() { var t, r, n, i; Mt(this, e), this.log = { error: !0, info: !0, warn: !0, debug: !0, verbose: !0 }, t = this, r = "_silent", i = this, (n = xl) && jt(t, r, { enumerable: n.enumerable, configurable: n.configurable, writable: n.writable, value: n.initializer ? n.initializer.call(i) : void 0 }), this.errorHandler = void 0; var o = Jt(this.log).reduce(function (e, t) { return e[t] = Go({ get: function () { return Cr["ENABLE_" + t.toUpperCase()] }, set: function (e) { return Cr["ENABLE_" + t.toUpperCase()] = e, !0 === e && (this.silent = !1), e } }), e }, {}); oa(this.log, o, { self: !0 }) } return Gt(e, [{ key: "silent", get: function () { return this._silent }, set: function (e) { var t = this; e = !!e, this._silent = e, Jt(this.log).forEach(function (r) { t.log[r] = !e }) } }, { key: "useStyleFullscreen", get: function () { return Fa.useStyleFirst }, set: function (e) { Fa.useStyleFirst = !!e } }]), e }(), Cl = Ll.prototype, Dl = "_silent", Il = [ra], Ml = { enumerable: !0, initializer: function () { return !1 } }, Fl = {}, Object.keys(Ml).forEach(function (e) { Fl[e] = Ml[e] }), Fl.enumerable = !!Fl.enumerable, Fl.configurable = !!Fl.configurable, ("value" in Fl || Fl.initializer) && (Fl.writable = !0), Fl = Il.slice().reverse().reduce(function (e, t) { return t(Cl, Dl, e) || e }, Fl), Nl && void 0 !== Fl.initializer && (Fl.value = Fl.initializer ? Fl.initializer.call(Nl) : void 0, Fl.initializer = void 0), void 0 === Fl.initializer && (Object.defineProperty(Cl, Dl, Fl), Fl = null), xl = Fl, Ll); function tc(e, t, r, n) { r && jt(e, t, { enumerable: r.enumerable, configurable: r.configurable, writable: r.writable, value: r.initializer ? r.initializer.call(n) : void 0 }) } function rc(e, t, r, n, i) { var o = {}; return Object.keys(n).forEach(function (e) { o[e] = n[e] }), o.enumerable = !!o.enumerable, o.configurable = !!o.configurable, ("value" in o || o.initializer) && (o.writable = !0), o = r.slice().reverse().reduce(function (r, n) { return n(e, t, r) || r }, o), i && void 0 !== o.initializer && (o.value = o.initializer ? o.initializer.call(i) : void 0, o.initializer = void 0), void 0 === o.initializer && (Object.defineProperty(e, t, o), o = null), o } var nc = Yo()((Zl = Jl = function (e) { function t(e) { Mt(this, t); var r = Nt(this, (t.__proto__ || It(t)).call(this)); if (r.destroyed = !1, tc(r, "__id", jl, r), tc(r, "version", Gl, r), tc(r, "config", $l, r), Sr(e) || Or(e)) e = { wrapper: e, controls: !0 }; else { if (!gr(e)) throw new Error("You must pass in an Object containing wrapper or string or element to new a Chimee"); if (!e.wrapper) throw new Error("You must pass in an legal object") } return r.__dispatcher = new Pl(e, r), r.ready = r.__dispatcher.ready, r.readySync = r.__dispatcher.readySync, r.__wrapAsVideo(r.__dispatcher.videoConfig), r } return Xt(t, Nu), Gt(t, null, [{ key: "registerEvents", value: function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, t = e.name, r = e.target; if (!t || !Sr(t)) throw new Error("The event name must be a string, but not " + (void 0 === t ? "undefined" : xt(t))); if (!r || !Sr(r)) throw new Error("The event target must be a string, but not " + (void 0 === r ? "undefined" : xt(r))); "kernel" === r && Ws.push(t) } }]), Gt(t, [{ key: "destroy", value: function () { this.destroyed || (ka(t.prototype.__proto__ || It(t.prototype), "__destroy", this).call(this), this.__dispatcher.destroy(), Object.defineProperty(this, "__dispatcher", { get: function () { throw new Error("This instance has been destroyed.") }, enumerable: !0, configurable: !0 }), this.destroyed = !0) } }, { key: "use", value: function (e) { return this.__dispatcher.use(e) } }, { key: "unuse", value: function (e) { return this.__dispatcher.unuse(e) } }, { key: "__throwError", value: function (e) { Sr(e) && (e = new Error(e)); var r = this.config.errorHandler || t.config.errorHandler; if (yr(r)) return r(e); if (!t.config.silent) { if (xr(e)) throw e; console.error(e) } } }]), t }(), Jl.plugin = Fu, Jl.config = new ec, Jl.install = Pl.install, Jl.uninstall = Pl.uninstall, Jl.hasInstalled = Pl.hasInstalled, Jl.installKernel = Pl.installKernel, Jl.uninstallKernel = Pl.uninstallKernel, Jl.hasInstalledKernel = Pl.hasInstalledKernel, Jl.getPluginConfig = Pl.getPluginConfig, jl = rc((Ul = Zl).prototype, "__id", [Zo], { enumerable: !0, initializer: function () { return "_vm" } }), Gl = rc(Ul.prototype, "version", [Zo], { enumerable: !0, initializer: function () { return "0.11.0" } }), $l = rc(Ul.prototype, "config", [Zo], { enumerable: !0, initializer: function () { return { errorHandler: void 0 } } }), rc(Ul, "plugin", [Zo], (zl = (zl = eo(Ul, "plugin")) ? zl.value : void 0, { enumerable: !0, configurable: !0, writable: !0, initializer: function () { return zl } }), Ul), rc(Ul, "config", [Zo], (Kl = (Kl = eo(Ul, "config")) ? Kl.value : void 0, { enumerable: !0, configurable: !0, writable: !0, initializer: function () { return Kl } }), Ul), rc(Ul, "install", [Zo], (Vl = (Vl = eo(Ul, "install")) ? Vl.value : void 0, { enumerable: !0, configurable: !0, writable: !0, initializer: function () { return Vl } }), Ul), rc(Ul, "uninstall", [Zo], (Wl = (Wl = eo(Ul, "uninstall")) ? Wl.value : void 0, { enumerable: !0, configurable: !0, writable: !0, initializer: function () { return Wl } }), Ul), rc(Ul, "hasInstalled", [Zo], (Hl = (Hl = eo(Ul, "hasInstalled")) ? Hl.value : void 0, { enumerable: !0, configurable: !0, writable: !0, initializer: function () { return Hl } }), Ul), rc(Ul, "installKernel", [Zo], (ql = (ql = eo(Ul, "installKernel")) ? ql.value : void 0, { enumerable: !0, configurable: !0, writable: !0, initializer: function () { return ql } }), Ul), rc(Ul, "uninstallKernel", [Zo], (Yl = (Yl = eo(Ul, "uninstallKernel")) ? Yl.value : void 0, { enumerable: !0, configurable: !0, writable: !0, initializer: function () { return Yl } }), Ul), rc(Ul, "hasInstalledKernel", [Zo], (Xl = (Xl = eo(Ul, "hasInstalledKernel")) ? Xl.value : void 0, { enumerable: !0, configurable: !0, writable: !0, initializer: function () { return Xl } }), Ul), rc(Ul, "getPluginConfig", [Zo], (Ql = (Ql = eo(Ul, "getPluginConfig")) ? Ql.value : void 0, { enumerable: !0, configurable: !0, writable: !0, initializer: function () { return Ql } }), Ul), Bl = Ul)) || Bl, ic = function (e) { function t(e) { var r; Mt(this, t); for (var n = arguments.length, i = Array(n > 1 ? n - 1 : 0), o = 1; o < n; o++)i[o - 1] = arguments[o]; var a = Nt(this, (r = t.__proto__ || It(t)).call.apply(r, [this, mi(e, { el: document.createElement("canvas"), penetrate: !0, inner: !1 })].concat(Yr(i)))); return a.isShown = !1, a.hasStopRender = !0, a.myStyle = { position: "fixed", top: "", left: "", right: 0, bottom: 0, width: 277, height: 156 }, a } return Xt(t, Fu), Gt(t, [{ key: "create", value: function () { Ri(this.$dom, "chimee-plugin-picture-in-picture"), this.getContext() } }, { key: "inited", value: function () { this.setStyle() } }, { key: "show", value: function () { Mi(this.$dom, "display", "block"), this.isShown = !0 } }, { key: "hide", value: function () { Mi(this.$dom, "display", "none"), this.isShown = !1 } }, { key: "closeCurrentPicture", value: function () { window.__chimee_picture_in_picture && window.__chimee_picture_in_picture.plugin && window.__chimee_picture_in_picture.plugin.exitPictureInPicture() } }, { key: "requestPictureInPicture", value: function () { var e = (arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}).autoplay, t = void 0 !== e && e; this.closeCurrentPicture(), this.show(), this.poller(this.render), t && this.paused ? this.play() : t || this.paused || this.pause(), window.__chimee_picture_in_picture = { plugin: this, window: this.$dom, element: this.$video } } }, { key: "exitPictureInPicture", value: function () { this.hide(), window.__chimee_picture_in_picture = {} } }, { key: "getContext", value: function () { this.ctx = this.$dom.getContext("2d") } }, { key: "poller", value: function (e) { var t = this; requestAnimationFrame(function () { e.call(t), t.isShown ? (t.poller(e), t.hasStopRender = !1) : t.hasStopRender = !0 }) } }, { key: "render", value: function () { this.isShown && this.ctx.drawImage(this.$video, 0, 0, this.myStyle.width, this.myStyle.height) } }, { key: "setStyle", value: function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; for (var t in mi(this.myStyle, e), this.$dom.setAttribute("width", this.myStyle.width.toString()), this.$dom.setAttribute("height", this.myStyle.height.toString()), this.myStyle) if ("width" !== t && "height" !== t) { var r = this.myStyle[t]; Mi(this.$dom, t, r) } } }]), t }(), oc = Object.freeze({ default: ic }); var ac = function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : function (e, t, r) { e[t] = r }; return function r(n, i, o) { if (mr(n) || gr(n)) { for (var a in i = Ar(i) ? gr(n) ? {} : [] : i, n) t(i, a, r(n[a], i[a], a)); return i } return e(n, i, o) } }(function (e) { return e }); function sc() { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; if (t.length < 2) throw new Error("deepAssign accept two and more argument"); for (var n = t.length - 1; n > -1; n--)if (Ar(t[n])) throw new TypeError("deepAssign only accept non primitive type"); var i = t.shift(); return t.forEach(function (e) { return ac(e, i) }), i } function uc(e, t) { return e.bind ? e.bind(t) : e.apply ? function () { for (var r = arguments.length, n = Array(r), i = 0; i < r; i++)n[i] = arguments[i]; return e.apply(t, n) } : function () { for (var r = arguments.length, n = Array(r), i = 0; i < r; i++)n[i] = arguments[i]; return e.call.apply(e, [t].concat(Yr(n))) } } function lc(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } var cc = function (e, t, r) { return t && lc(e.prototype, t), r && lc(e, r), e }; var fc = function (e, t) { for (; !Object.prototype.hasOwnProperty.call(e, t) && null !== (e = s(e));); return e }, dc = n(function (e) { function t(r, n, i) { return "undefined" != typeof Reflect && Reflect.get ? e.exports = t = Reflect.get : e.exports = t = function (e, t, r) { var n = fc(e, t); if (n) { var i = Object.getOwnPropertyDescriptor(n, t); return i.get ? i.get.call(r) : i.value } }, t(r, n, i || r) } e.exports = t }), hc = function () { function t(r) { e(this, t), this.parent = r } return cc(t, [{ key: "create", value: function () { this.createEl(), this.addAllEvent(), this.option.create && this.option.create.apply(this) } }, { key: "destroy", value: function () { this.removeAllEvent(), this.option.destroy && this.option.destroy.apply(this) } }, { key: "createEl", value: function () { this.$dom = document.createElement(this.option.tag), "string" == typeof this.option.html ? this.$dom.innerHTML = this.option.html : this.$dom.appendChild(this.option.html), this.parent.$wrap.appendChild(this.$dom) } }, { key: "addAllEvent", value: function () { var e = this; this.option.defaultEvent && Object.keys(this.option.defaultEvent).forEach(function (t) { var r = e.option.defaultEvent[t]; e[r] = uc(e[r], e), Ci(e.$dom, t, e[r], !1, !1) }), this.option.event && Object.keys(this.option.event).forEach(function (t) { var r = "__" + t; e[r] = uc(e.option.event[t], e), Ci(e.$dom, t, e[r], !1, !1) }) } }, { key: "removeAllEvent", value: function () { var e = this; this.$dom instanceof HTMLElement || (this.$dom = this.$dom[0]), this.option.defaultEvent && Object.keys(this.option.defaultEvent).forEach(function (t) { var r = e.option.defaultEvent[t]; e[r] = uc(e[r], e), Pi(e.$dom, t, e[r], !1, !1) }), this.option.event && Object.keys(this.option.event).forEach(function (t) { var r = "__" + t; e[r] = uc(e.option.event[t], e), Pi(e.$dom, t, e[r], !1, !1) }) } }]), t }(), pc = function (t) { function r(t, n) { var i; return e(this, r), (i = a(this, s(r).call(this, t))).option = n, i.init(), i } return l(r, hc), cc(r, [{ key: "init", value: function () { dc(s(r.prototype), "create", this).call(this), Ri(this.$dom, "chimee-flex-component") } }]), r }(), vc = { tag: "chimee-control-state", html: "\n    <chimee-control-state-play></chimee-control-state-play>\n    <chimee-control-state-pause></chimee-control-state-pause>\n  ", animate: { icon: '\n      <svg viewBox="0 0 200 200" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <g fill="#ffffff" stroke="#ffffff">\n          <path class="left"></path>\n          <path class="right"></path>\n        </g>\n      </svg>\n    ', path: { play: { left: "M0.921875,0.265625L0.921875,197.074852L95.7890625,149L96.2929688,49Z", right: "M90.3142151,45.9315226L90.3142151,151.774115L201.600944,99.9938782L201.600944,98.0237571Z" }, pause: { left: "M0.921875,1.265625L0.921875,198.074852L79.3611677,198.074852L79.3611677,0.258923126Z", right: "M126.921875,1.265625L126.921875,198.074852L205.361168,198.074852L205.361168,0.258923126Z" } } }, defaultEvent: { click: "click" } }, mc = function (t) { function r(t, n) { var i; return e(this, r), (i = a(this, s(r).call(this, t))).option = sc(vc, gr(n) ? n : {}), i.animate = !1, i.init(), i } return l(r, hc), cc(r, [{ key: "init", value: function () { dc(s(r.prototype), "create", this).call(this), this.$dom = Bi(this.$dom), this.$dom.addClass("chimee-flex-component"), this.option.icon && this.option.icon.play && this.option.icon.pause ? (this.$play = this.$dom.find("chimee-control-state-play"), this.$pause = this.$dom.find("chimee-control-state-pause"), this.$play.html(this.option.icon.play), this.$pause.html(this.option.icon.pause)) : this.option.bitmap || (this.animate = !0, this.option.animate.path = this.option.path ? this.option.path : this.option.animate.path, this.$dom.html(this.option.animate.icon), this.$left = this.$dom.find(".left"), this.$right = this.$dom.find(".right")), this.changeState("pause") } }, { key: "changeState", value: function (e) { var t = "play" === e ? "pause" : "play"; this.state = e, Ri(this.parent.$dom, t), Oi(this.parent.$dom, e), this.animate && this.setPath(t) } }, { key: "setPath", value: function (e) { var t = this.option.animate.path; "play" === e ? (this.$left.attr("d", t.play.left), this.$right.attr("d", t.play.right)) : (this.$left.attr("d", t.pause.left), this.$right.attr("d", t.pause.right)) } }, { key: "click", value: function (e) { var t = "play" === this.state ? "pause" : "play"; this.changeState(t), this.parent.$emit(t) } }]), r }(); var yc, gc, bc, _c = function (e, t, r, n, i) { var o = {}; return Object.keys(n).forEach(function (e) { o[e] = n[e] }), o.enumerable = !!o.enumerable, o.configurable = !!o.configurable, ("value" in o || o.initializer) && (o.writable = !0), o = r.slice().reverse().reduce(function (r, n) { return n(e, t, r) || r }, o), i && void 0 !== o.initializer && (o.value = o.initializer ? o.initializer.call(i) : void 0, o.initializer = void 0), void 0 === o.initializer && (Object.defineProperty(e, t, o), o = null), o }, wc = { tag: "chimee-volume", html: "\n    <chimee-volume-state>\n      <chimee-volume-state-mute></chimee-volume-state-mute>\n      <chimee-volume-state-low></chimee-volume-state-low>\n      <chimee-volume-state-high></chimee-volume-state-high>\n    </chimee-volume-state>\n    <chimee-volume-bar>\n      <chimee-volume-bar-wrap>\n        <chimee-volume-bar-bg></chimee-volume-bar-bg>\n        <chimee-volume-bar-all>\n          <chimee-volume-bar-ball></chimee-volume-bar-ball>\n        </chimee-volume-bar-all>\n        <chimee-volume-bar-track></chimee-volume-bar-track>\n      </chimee-volume-bar-wrap>\n    </chimee-volume-bar>\n  ", animate: { icon: '\n      <svg viewBox="0 0 107 101" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <g class="volume">\n          <polygon class="horn" points="0.403399942 30 27.3842118 30 56.8220589 2.84217094e-14 57.9139815 100 27.3842118 70 0.403399942 70"></polygon>\n          <path class="ring1" d="M63,5.00975239 C69.037659,4.78612057 75.9178585,8.40856146 83.6405984,15.877075 C95.2247083,27.0798454 100,34.7975125 100,50.9608558 C100,67.1241991 95.3628694,73.7907482 83.6405984,83.8306724 C75.8257511,90.5239552 68.9455516,94.0320644 63,94.355" fill-opacity="0" stroke-width="10"></path>\n          <path class="ring2" d="M65.2173913,29.4929195 C67.8779343,29.3931169 70.9097496,31.0097416 74.3128371,34.3427934 C79.4174684,39.3423712 81.5217391,42.7866154 81.5217391,50 C81.5217391,57.2133846 79.4783502,60.1885354 74.3128371,64.6691576 C70.8691617,67.656239 67.8373465,69.2218397 65.2173913,69.3659595" fill-opacity="0" stroke-width="10"></path>\n          <path class="line" d="M4.19119202,3.65220497 L102,96" stroke-width="10"></path>\n        </g>\n      </svg>\n    ' }, defaultEvent: { mousedown: "mousedown" } }, Ec = (_c((yc = function (t) { function r(t, n) { var i; return e(this, r), (i = a(this, s(r).call(this, t))).parent.preVolume = 0, i.option = sc(wc, gr(n) ? n : {}), i.init(), i } return l(r, hc), cc(r, [{ key: "init", value: function () { var e = this; dc(s(r.prototype), "create", this).call(this), this.$dom = Bi(this.$dom), this.$state = this.$dom.find("chimee-volume-state"), this.$bar = this.$dom.find("chimee-volume-bar"), this.$all = this.$dom.find("chimee-volume-bar-all"), this.$bg = this.$dom.find("chimee-volume-bar-bg"), this.layout = "vertical" === this.option.layout ? "vertical" : "horizonal", this.option.icon && this.option.icon.mute && this.option.icon.low ? (this.option.icon.high = this.option.icon.high || this.option.icon.low, this.$mute = this.$dom.find("chimee-volume-state-mute"), this.$low = this.$dom.find("chimee-volume-state-low"), this.$high = this.$dom.find("chimee-volume-state-high"), this.$mute.html(this.option.icon.mute), this.$low.html(this.option.icon.low), this.$high.html(this.option.icon.high)) : this.option.bitmap || (this.animate = !0, this.$state.html(this.option.animate.icon)), this.$dom.addClass("chimee-flex-component ".concat(this.layout)), this.changeState(), this.watch_muted = this.parent.$watch("muted", function (t) { e.update() }) } }, { key: "inited", value: function () { this.update() } }, { key: "destroy", value: function () { this.watch_muted(), dc(s(r.prototype), "destroy", this).call(this) } }, { key: "changeState", value: function () { this.parent.muted || 0 === this.parent.volume ? this.state = "mute" : this.parent.volume > 0 && this.parent.volume <= .5 ? this.state = "low" : this.parent.volume > .5 && this.parent.volume <= 1 && (this.state = "high"), this.$dom.removeClass("mute low high"), this.$dom.addClass(this.state) } }, { key: "click", value: function (e) { var t = e.path || function (e) { var t = []; if (null === e) return t; for (t.push(e); null !== e.parentNode;)e = e.parentNode, t.push(e); return t }(e.target); return -1 !== t.indexOf(this.$state[0]) ? (this.stateClick(e), "state") : -1 !== t.indexOf(this.$bar[0]) ? (this.barClick(e), "bar") : "padding" } }, { key: "stateClick", value: function () { if (this.parent.muted) this.parent.muted = !1; else { var e = this.parent.volume; this.parent.volume = 0 === e ? this.parent.preVolume : 0, this.parent.preVolume = e, this.changeState() } } }, { key: "barClick", value: function (e) { var t = "vertical" === this.layout ? 1 - e.offsetY / this.$bg[0].offsetHeight : e.offsetX / this.$bg[0].offsetWidth; this.parent.volume = t < 0 ? 0 : t > 1 ? 1 : t, this.update() } }, { key: "mousedown", value: function (e) { "bar" === this.click(e) && (this.startX = "vertical" === this.layout ? e.clientY : e.clientX, this.startVolume = this.parent.volume, Ci(window, "mousemove", this.draging), Ci(window, "mouseup", this.dragEnd), Ci(window, "contextmenu", this.dragEnd)) } }, { key: "update", value: function () { this.changeState(); var e = this.parent.muted ? 0 : this.parent.volume; "vertical" === this.layout ? this.$all.css("height", "".concat(100 * e, "%")) : this.$all.css("width", "".concat(100 * e, "%")) } }, { key: "draging", value: function (e) { this.endX = "vertical" === this.layout ? e.clientY : e.clientX; var t = "vertical" === this.layout ? (this.startX - this.endX) / this.$bg[0].offsetHeight : (this.endX - this.startX) / this.$bg[0].offsetWidth, r = +(this.startVolume + t).toFixed(2); this.parent.volume = r < 0 ? 0 : r > 1 ? 1 : r, this.parent.muted = !1 } }, { key: "dragEnd", value: function () { this.startX = 0, this.startVolume = 0, Pi(window, "mousemove", this.draging), Pi(window, "mouseup", this.dragEnd), Pi(window, "contextmenu", this.dragEnd) } }]), r }()).prototype, "draging", [Qo], Object.getOwnPropertyDescriptor(yc.prototype, "draging"), yc.prototype), _c(yc.prototype, "dragEnd", [Qo], Object.getOwnPropertyDescriptor(yc.prototype, "dragEnd"), yc.prototype), yc), Sc = { tag: "chimee-progressbar", html: '\n    <chimee-progressbar-wrap>\n      <chimee-progressbar-bg class="chimee-progressbar-line"></chimee-progressbar-bg>\n      <chimee-progressbar-buffer class="chimee-progressbar-line"></chimee-progressbar-buffer>\n      <chimee-progressbar-all class="chimee-progressbar-line">\n        <chimee-progressbar-ball></chimee-progressbar-ball>\n      </chimee-progressbar-all>\n      <chimee-progressbar-tip></chimee-progressbar-tip>\n    </chimee-progressbar-wrap>\n  ' }, kc = (_c((gc = function (t) { function r(t, n) { var i; return e(this, r), (i = a(this, s(r).call(this, t))).option = sc(Sc, gr(n) ? n : {}), i.visiable = !1 !== n, i.init(), i } return l(r, hc), cc(r, [{ key: "init", value: function () { dc(s(r.prototype), "create", this).call(this), this.$dom = Bi(this.$dom), this.$wrap = this.$dom.find("chimee-progressbar-wrap"), this.$buffer = this.$dom.find("chimee-progressbar-buffer"), this.$all = this.$dom.find("chimee-progressbar-all"), this.$tip = this.$dom.find("chimee-progressbar-tip"), this.$track = this.$dom.find("chimee-progressbar-track"), this.$line = this.$dom.find(".chimee-progressbar-line"), this.$ball = this.$dom.find("chimee-progressbar-ball"), this.$dom.addClass("chimee-flex-component"), !this.visiable && this.$dom.css("visibility", "hidden"), "top" === this.option.layout && (this.$dom.addClass("progressbar-layout-top"), this.$wrap.css({ top: -this.$ball[0].offsetHeight + "px" }), Mi(this.parent.$wrap, "paddingTop", this.$ball[0].offsetHeight + "px")), this.addWrapEvent() } }, { key: "destroy", value: function () { this.removeWrapEvent(), this.watch_screen && this.watch_screen(), dc(s(r.prototype), "destroy", this).call(this) } }, { key: "addWrapEvent", value: function () { this.$wrap.on("mousedown", this.mousedown), this.$wrap.on("mousemove", this.tipShow), this.$wrap.on("mouseleave", this.tipEnd) } }, { key: "removeWrapEvent", value: function () { this.$wrap.off("mousedown", this.mousedown), this.$wrap.off("mousemove", this.tipShow), this.$wrap.off("mouseleave", this.tipEnd) } }, { key: "progress", value: function () { var e = 0; try { e = this.parent.buffered.end(0) } catch (e) { } var t = e / this.parent.duration * 100 + "%"; this.$buffer.css("width", t) } }, { key: "update", value: function () { var e = void 0 !== this._currentTime ? this._currentTime : this.parent.currentTime, t = e ? e / this.parent.duration : 0; this.$all.css("width", "calc(".concat(100 * t, "% - ").concat(this.$ball[0].offsetWidth / 2, "px")) } }, { key: "mousedown", value: function (e) { e.target !== this.$tip[0] && (this.parent.duration == this.parent.duration ? (this._currentTime = e.offsetX / this.$wrap[0].offsetWidth * this.parent.duration, this.startX = e.clientX, this.startTime = this._currentTime, Ci(window, "mousemove", this.draging), Ci(window, "mouseup", this.dragEnd), Ci(window, "contextmenu", this.dragEnd)) : console.error("isNaN(duration) === true")) } }, { key: "draging", value: function (e) { this.endX = e.clientX; var t = (this.endX - this.startX) / this.$wrap[0].offsetWidth * this.parent.duration, r = +(this.startTime + t).toFixed(2); this._currentTime = r < 0 ? 0 : r > this.parent.duration ? this.parent.duration : r, this.update() } }, { key: "dragEnd", value: function () { this.update(), this.startX = 0, this.startTime = 0, this.parent.currentTime = this._currentTime, this._currentTime = void 0, Pi(window, "mousemove", this.draging), Pi(window, "mouseup", this.dragEnd), Pi(window, "contextmenu", this.dragEnd) } }, { key: "tipShow", value: function (e) { if (e.target !== this.$tip[0] && e.target !== this.$ball[0]) { var t = e.offsetX / this.$wrap[0].offsetWidth * this.parent.duration, r = ci(t = t < 0 ? 0 : t > this.parent.duration ? this.parent.duration : t), n = e.offsetX - this.$tip[0].offsetWidth / 2, i = this.$wrap[0].offsetWidth - this.$tip[0].offsetWidth; n = n < 0 ? 0 : n > i ? i : n, this.$tip.text(r), this.$tip.css("display", "inline-block"), this.$tip.css("left", "".concat(n, "px")) } else this.$tip.css("display", "none") } }, { key: "tipEnd", value: function () { this.$tip.css("display", "none") } }, { key: "changePointerEvent", value: function (e) { this.$wrap.css("pointerEvents", e) } }]), r }()).prototype, "mousedown", [Qo], Object.getOwnPropertyDescriptor(gc.prototype, "mousedown"), gc.prototype), _c(gc.prototype, "draging", [Qo], Object.getOwnPropertyDescriptor(gc.prototype, "draging"), gc.prototype), _c(gc.prototype, "dragEnd", [Qo], Object.getOwnPropertyDescriptor(gc.prototype, "dragEnd"), gc.prototype), _c(gc.prototype, "tipShow", [Qo], Object.getOwnPropertyDescriptor(gc.prototype, "tipShow"), gc.prototype), _c(gc.prototype, "tipEnd", [Qo], Object.getOwnPropertyDescriptor(gc.prototype, "tipEnd"), gc.prototype), gc), Tc = { tag: "chimee-progresstime", html: "\n    <chimee-progresstime-pass>00:00</chimee-progresstime-pass\n    ><chimee-progresstime-total\n      ><span>/</span\n      ><chimee-progresstime-total-value>00:00</chimee-progresstime-total-value>\n    </chimee-progresstime-total>\n  " }, Ac = function (t) { function r(t, n) { var i; return e(this, r), (i = a(this, s(r).call(this, t))).option = sc(Tc, gr(n) ? n : {}), i.init(), i } return l(r, hc), cc(r, [{ key: "init", value: function () { dc(s(r.prototype), "create", this).call(this), this.$dom = Bi(this.$dom), this.$total = this.$dom.find("chimee-progresstime-total-value"), this.$pass = this.$dom.find("chimee-progresstime-pass"), this.$dom.addClass("chimee-flex-component") } }, { key: "updatePass", value: function () { this.$pass.text(ci(this.parent.currentTime)) } }, { key: "updateTotal", value: function () { this.$total.text(ci(this.parent.duration)) } }]), r }(), Rc = { tag: "chimee-screen", html: '\n    <chimee-screen-full>\n      <svg viewBox="0 0 67 66" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n          \x3c!-- Generator: Sketch 43.1 (39012) - http://www.bohemiancoding.com/sketch --\x3e\n          <desc>Created with Sketch.</desc>\n          <defs></defs>\n          <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n              <g id="screen-small" transform="translate(33.756308, 32.621867) rotate(45.000000) translate(-33.756308, -32.621867) translate(18.756308, -10.378133)" fill="#FFFFFF">\n                  <polygon id="Path" transform="translate(14.967695, 66.389245) rotate(180.000000) translate(-14.967695, -66.389245) " points="11.5190786 46.9431778 11.7210093 70.7913773 0.565180527 70.7913773 15.4674455 85.8353125 29.3702096 70.7913773 18.5573247 70.7702156 18.5573247 46.9431778"></polygon>\n                  <polygon id="Path" points="11.5190786 0.274130278 11.7210093 24.1223298 0.565180527 24.1223298 15.4674455 39.1662649 29.3702096 24.1223298 18.5573247 24.1011681 18.5573247 0.274130278"></polygon>\n              </g>\n          </g>\n      </svg>\n    </chimee-screen-full>\n    <chimee-screen-small>\n      <svg viewBox="0 0 61 62" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        \x3c!-- Generator: Sketch 43.1 (39012) - http://www.bohemiancoding.com/sketch --\x3e\n        <desc>Created with Sketch.</desc>\n        <defs></defs>\n        <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n            <g id="Group" transform="translate(30.756308, 30.621867) rotate(45.000000) translate(-30.756308, -30.621867) translate(15.756308, -12.378133)" fill="#FFFFFF">\n                <polygon id="Path" points="11.5190786 46.9431778 11.7210093 70.7913773 0.565180527 70.7913773 15.4674455 85.8353125 29.3702096 70.7913773 18.5573247 70.7702156 18.5573247 46.9431778"></polygon>\n                <polygon id="Path" transform="translate(14.967695, 19.720198) rotate(180.000000) translate(-14.967695, -19.720198) " points="11.5190786 0.274130278 11.7210093 24.1223298 0.565180527 24.1223298 15.4674455 39.1662649 29.3702096 24.1223298 18.5573247 24.1011681 18.5573247 0.274130278"></polygon>\n            </g>\n        </g>\n      </svg>\n    </chimee-screen-small>\n  ', defaultEvent: { click: "click" } }, Oc = (_c((bc = function (t) { function r(t, n) { var i; return e(this, r), (i = a(this, s(r).call(this, t))).state = "small", i.option = sc(Rc, gr(n) ? n : {}), i.init(), i } return l(r, hc), cc(r, [{ key: "init", value: function () { dc(s(r.prototype), "create", this).call(this), this.$dom = Bi(this.$dom), this.changeState(this.state), this.$dom.addClass("chimee-flex-component"), this.$full = this.$dom.find("chimee-screen-full"), this.$small = this.$dom.find("chimee-screen-small"), this.option.icon && this.option.icon.full && this.option.icon.small ? (this.$full.html(this.option.icon.full), this.$small.html(this.option.icon.small)) : this.option.bitmap && (this.$full.html(""), this.$small.html("")) } }, { key: "changeState", value: function (e) { var t = "small" === e ? "full" : "small"; Ri(this.parent.$dom, e), Oi(this.parent.$dom, t) } }, { key: "click", value: function () { var e = !1; "small" === this.state ? (this.state = "full", e = !0) : (this.state = "small", e = !1), this.changeState(this.state), this.parent.$fullscreen(e, "container"), e ? this.watch_screen = this.parent.$watch("isFullscreen", this.screenChange) : this.watch_screen() } }, { key: "screenChange", value: function () { this.parent.fullscreenElement && (this.state = "small", this.changeState("small"), this.parent.$fullscreen(!1, "container")) } }]), r }()).prototype, "screenChange", [Qo], Object.getOwnPropertyDescriptor(bc.prototype, "screenChange"), bc.prototype), bc), Lc = { tag: "chimee-clarity", width: "2em", html: '\n    <chimee-clarity-text></chimee-clarity-text>\n    <chimee-clarity-list>\n      <ul></ul>\n      <div class="chimee-clarity-list-arrow">\n        <svg viewBox="0 0 115 6"  version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n          <g id="Group-3-Copy" fill="#57B0F6">\n            <polygon id="Path-2" points="0.0205224145 0.0374249581 0.0205224145 2.12677903 53.9230712 2.12677903 57.1127727 5.3468462 60.2283558 2.12677903 113.820935 2.12677903 113.820935 0.0374249581"></polygon>\n          </g>\n        </svg>\n      </div>\n    </chimee-clarity-list>\n  ', defaultEvent: { click: "click" }, duration: 3, bias: 0, increment: 0, repeatTimes: 0, immediate: !1, abort: !1, list: [] }, xc = function (t) { function r(t, n) { var i; return e(this, r), (i = a(this, s(r).call(this, t))).option = sc(Lc, gr(n) ? n : {}), i.init(), i } return l(r, hc), cc(r, [{ key: "init", value: function () { if (dc(s(r.prototype), "create", this).call(this), Ri(this.$dom, "chimee-flex-component"), this.$text = Bi(this.$dom).find("chimee-clarity-text"), this.$list = Bi(this.$dom).find("chimee-clarity-list"), this.$listUl = this.$list.find("ul"), this.option.width && Mi(this.$dom, "width", this.option.width), !this.option.list.length) return Mi(this.$dom, { display: "none" }); this.initTextList(this.option.list) } }, { key: "initTextList", value: function (e) { var t = this; this.$listUl.html(""), e.forEach(function (e) { var r = Bi(document.createElement("li")); r.attr("data-url", e.src), r.text(e.name), e.src === t.parent.$videoConfig.src && (t.$text.text(e.name), r.addClass("active")), t.$listUl.append(r) }) } }, { key: "click", value: function (e) { var t = this, r = e.target; if ("LI" === r.tagName) { var n = r.getAttribute("data-url") || ""; this.switchClarity(n).then(function () { t.loadOption = void 0, Array.from(r.parentElement.children).map(function (e) { Oi(e, "active") }), Ri(e.target, "active"), t.$text.text(e.target.textContent) }).catch(function (e) { console.warn(e) }) } } }, { key: "switchClarity", value: function (e) { this.loadOption && (this.loadOption.abort = !0); var t = this.option, r = t.duration, n = t.bias, i = t.increment, o = t.repeatTimes, a = t.immediate, s = t.abort; return this.loadOption = { duration: r, bias: n, increment: i, repeatTimes: o, immediate: a, abort: s }, this.parent.$silentLoad(e, this.loadOption) } }]), r }(), Pc = { tag: "chimee-playbackrate", width: "4em", html: '\n    <chimee-playbackrate-text></chimee-playbackrate-text>\n    <chimee-playbackrate-list>\n      <ul></ul>\n      <div class="chimee-playbackrate-list-arrow">\n        <svg viewBox="0 0 115 6"  version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n          <g id="Group-3-Copy" fill="#57B0F6">\n            <polygon id="Path-2" points="0.0205224145 0.0374249581 0.0205224145 2.12677903 53.9230712 2.12677903 57.1127727 5.3468462 60.2283558 2.12677903 113.820935 2.12677903 113.820935 0.0374249581"></polygon>\n          </g>\n        </svg>\n      </div>\n    </chimee-playbackrate-list>\n  ', defaultEvent: { click: "click" } }, Cc = function (t) { function r(t, n) { var i; return e(this, r), (i = a(this, s(r).call(this, t))).option = sc(Pc, gr(n) ? n : {}), i.init(), i } return l(r, hc), cc(r, [{ key: "init", value: function () { dc(s(r.prototype), "create", this).call(this), Ri(this.$dom, "chimee-flex-component"), this.$text = Bi(this.$dom).find("chimee-playbackrate-text"), this.$list = Bi(this.$dom).find("chimee-playbackrate-list"), this.$listUl = this.$list.find("ul"), this.option.width && Mi(this.$dom, "width", this.option.width), this.initTextList() } }, { key: "initTextList", value: function () { var e = this, t = this.option.list.length, r = !1; this.option.list.forEach(function (n, i) { var o = Bi(document.createElement("li")); o.attr("data-value", n.value), o.text(n.name), (n.default || !r && i === t - 1) && (r = !0, !n.default && console.warn("播放速率列表需要给每项配置 `default(boolean)` 来标明是否是默认播放速率"), e.$text.text(n.name), o.addClass("active"), e.switchPlaybackrate(n.value)), e.$listUl.append(o) }) } }, { key: "click", value: function (e) { var t = e.target; if ("LI" === t.tagName) { var r = t.getAttribute("data-value") || 1; this.switchPlaybackrate(r), Array.from(t.parentElement.children).map(function (e) { Oi(e, "active") }), Ri(e.target, "active"), this.$text.text(e.target.textContent) } } }, { key: "switchPlaybackrate", value: function (e) { var t = this; setTimeout(function (r) { t.parent.playbackRate = e }, 0) } }]), r }(); var Dc = { hideBarTime: 2e3, barShowByMouse: "move" }, Ic = { name: "chimeeControl", el: "chimee-control", data: { children: {}, show: !1, disabled: !0 }, level: 99, operable: !1, penetrate: !1, create: function () { }, init: function (e) { }, destroy: function () { for (var e in window.clearTimeout(this.timeId), this.children) this.children[e].destroy() }, inited: function () { var e = this.$videoConfig; e.controls && (this.show = !0, e.controls = !1); var t, r, n, i = this; for (var o in oa(e, { controls: Go({ get: function () { return i.show }, set: function (e) { return i.show = Boolean(e), i._display(), !1 } }, { preSet: !0 }) }, { self: !0 }), this.config = gr(this.$config) ? sc(Dc, this.$config) : Dc, this.config.hideBarTime = "move" === this.config.barShowByMouse ? this.config.hideBarTime : 0, this.$dom.innerHTML = "<chimee-control-wrap></chimee-control-wrap>", this.$wrap = this.$dom.querySelector("chimee-control-wrap"), this.children = (r = (t = this).config.children = function (e) { return e.$config.children ? e.$config.children : e.isLive ? { play: !0, progressTime: !1, progressBar: !1, volume: !0, screen: !0 } : { play: !0, progressTime: !0, progressBar: !0, volume: !0, screen: !0 } }(t), n = {}, r ? Object.keys(r).forEach(function (e) { switch (e) { case "play": r.play && (n.play = new mc(t, r.play)); break; case "progressTime": r.progressTime && (n.progressTime = new Ac(t, r.progressTime)); break; case "progressBar": n.progressBar = new kc(t, r.progressBar); break; case "volume": r.volume && (n.volume = new Ec(t, r.volume)); break; case "screen": r.screen && (n.screen = new Oc(t, r.screen)); break; case "clarity": r.clarity && (n.clarity = new xc(t, r.clarity)); break; case "playbackrate": r.playbackrate && Array.isArray(r.playbackrate.list) && r.playbackrate.list.length && (n.playbackrate = new Cc(t, r.playbackrate)); break; default: n[e] = new pc(t, r[e]) } }) : (n.play = new mc(t), n.progressTime = new Ac(t), n.progressBar = new kc(t), n.volume = new Ec(t), n.screen = new Oc(t)), n), this._setStyle(), this.children) this.children[o].inited && this.children[o].inited() }, events: { load: function () { this._showItself(), this._progressUpdate(), this.children.play && this.children.play.changeState("pause"), this.children.progressTime && this.children.progressTime.updateTotal(), this.children.progressBar && this.children.progressBar.changePointerEvent("none") }, loadstart: function () { this._disable(!0) }, canplay: function () { this._disable(!1) }, play: function () { this.children.play && this.children.play.changeState("play"), "move" === this.config.barShowByMouse && this._hideItself() }, pause: function () { this.children.play && this.children.play.changeState("pause"), this._showItself() }, c_mouseenter: function () { "move" !== this.config.barShowByMouse && this._showItself() }, c_mousemove: function () { this._mousemove() }, c_mouseleave: function () { "move" !== this.config.barShowByMouse && this._hideItself() }, durationchange: function () { this.children.progressTime && this.children.progressTime.updateTotal(), this.children.progressBar && this.children.progressBar.changePointerEvent("auto") }, timeupdate: function () { this._progressUpdate() }, progress: function () { this.children.progressBar && this.children.progressBar.progress() }, volumechange: function () { this.children.volume && this.children.volume.update() }, keydown: function (e) { switch (e.stopPropagation(), e.keyCode) { case 32: e.preventDefault(), this.children.play && this.children.play.click(e); break; case 37: e.preventDefault(); var t = this.currentTime - 10; this.currentTime = t < 0 ? 0 : t, this._mousemove(); break; case 39: e.preventDefault(); var r = this.currentTime + 10; this.currentTime = r > this.duration ? this.duration : r, this._mousemove(); break; case 38: e.preventDefault(); var n = this.volume + .1; this.volume = n > 1 ? 1 : n, this._mousemove(); break; case 40: e.preventDefault(); var i = this.volume - .1; this.volume = i < 0 ? 0 : i, this._mousemove() } }, click: function (e) { var t = this, r = new Date, n = this.clickTime; this.clickTime = r, r - n < 300 ? clearTimeout(this.clickTimeId) : this.clickTimeId = setTimeout(function () { !t.disabled && t.children.play && t.children.play.click(e) }, 300) }, dblclick: function (e) { !this.disabled && this.children.screen && this.children.screen.click() } }, methods: { _progressUpdate: function () { this.children.progressBar && this.children.progressBar.update(), this.children.progressTime && this.children.progressTime.updatePass() }, _hideItself: function () { var e = this; window.clearTimeout(this.timeId), this.timeId = setTimeout(function () { var t = e.$wrap.offsetHeight; t = e.children.progressBar ? e.children.progressBar.$wrap[0].offsetTop - t : -t, Mi(e.$wrap, { bottom: t + "px" }), Mi(e.$dom, { visibility: "hidden" }) }, this.config.hideBarTime) }, _showItself: function () { window.clearTimeout(this.timeId), Mi(this.$wrap, { bottom: "0" }), Mi(this.$dom, { visibility: "visible" }) }, _display: function () { var e = this.show ? "block" : "none"; Mi(this.$dom, { display: e }) }, _mousemove: function (e) { this.paused || "enter" === this.config.barShowByMouse || (this._showItself(), this._hideItself()) }, _disable: function (e) { this.show && (this.disabled = e) }, _setStyle: function () { var e = ""; e += this.config.majorColor ? "\n  .chimee-flex-component svg * {\n    fill: majorColor;\n    stroke: majorColor;\n  }\n\n  chimee-progressbar-all {\n    background: majorColor;\n  }\n\n  chimee-volume.chimee-flex-component chimee-volume-bar-all {\n    background: majorColor;\n  }\n\n  chimee-playbackrate-list li:hover,\n  chimee-playbackrate-list li.active,\n  chimee-clarity-list li:hover,\n  chimee-clarity-list li.active {\n    color: majorColor;\n  }\n".replace(/majorColor/g, this.config.majorColor) : "", e += this.config.hoverColor ? "\n  .chimee-flex-component svg:hover *{\n    fill: hoverColor;\n    stroke: hoverColor;\n  }\n".replace(/hoverColor/g, this.config.hoverColor) : ""; var t = document.createElement("style"); t.setAttribute("type", "text/css"), t.innerHTML = e, document.head.appendChild(t) }, updateClarity: function (e) { if (!mr(e)) return console.error("list must be an array."); this.children.clarity.initTextList(e) } } }; var Mc = function (e) { if (Array.isArray(e)) return e }; var Nc = function (e, t) { var r = [], n = !0, i = !1, o = void 0; try { for (var a, s = e[Symbol.iterator](); !(n = (a = s.next()).done) && (r.push(a.value), !t || r.length !== t); n = !0); } catch (e) { i = !0, o = e } finally { try { n || null == s.return || s.return() } finally { if (i) throw o } } return r }; var Fc = function () { throw new TypeError("Invalid attempt to destructure non-iterable instance") }; var Bc = function (e, t) { return Mc(e) || Nc(e, t) || Fc() }; !function (e, t) { if ("undefined" == typeof document) return t; e = e || ""; var r = document.head || document.getElementsByTagName("head")[0], n = document.createElement("style"); n.type = "text/css", r.appendChild(n), n.styleSheet ? n.styleSheet.cssText = e : n.appendChild(document.createTextNode(e)) }("chimee-popup{position:absolute;color:#fff;background-color:rgba(88,88,88,.5);font-size:13px;font-family:sans-serif;border:1px solid hsla(0,0%,100%,.08);padding:3px}chimee-popup cm-pp-close{float:right;color:#fff;text-decoration:none;line-height:14px;text-shadow:0 0 1px #000;font-size:15px;padding:0 3px;cursor:pointer;opacity:.8}chimee-popup cm-pp-close:hover{opacity:1}chimee-popup cm-pp-body,chimee-popup cm-pp-head{display:block;padding:3px 3px 6px}chimee-popup cm-pp-head{font-weight:700;border-bottom:1px solid hsla(0,0%,100%,.18);padding:0 5px 4px;margin-bottom:5px}chimee-popup cm-pp-body{font-size:12px}", void 0); var Uc = function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, t = e.tagName, r = void 0 === t ? "chimee-popup" : t, n = e.className, i = e.name, o = void 0 === i ? "popup" : i, a = e.html, s = e.title, u = void 0 === s ? "这是一个信息框" : s, l = e.body, c = void 0 === l ? "这里是信息内容" : l, f = e.offsetAttr, d = void 0 === f ? "left top" : f, h = e.offset, p = void 0 === h ? "50% 50%" : h, v = e.translate, m = void 0 === v ? "" : v, y = e.width, g = e.height, b = e.level, _ = e.init, w = e.inited, E = e.data, S = e.create, k = e.beforeCreate, T = e.destroy, A = e.events, R = e.computed, O = e.methods, L = void 0 === O ? {} : O, x = e.penetrate, P = void 0 !== x && x, C = e.operable, D = void 0 === C || C, I = e.hide, M = void 0 !== I && I, N = e.opened, F = e.closed, B = e.autoFocus, U = { html: a || "\n      <cm-pp-close>×</cm-pp-close>\n      " + (!1 !== u ? "<cm-pp-head>" + u + "</cm-pp-head>" : "") + "\n      " + (!1 !== c ? "<cm-pp-body>" + c + "</cm-pp-body>" : "") + "\n    ", closeSelector: "._close" }; return { name: o, el: r, className: n, beforeCreate: function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, t = e.events, r = e.methods, n = arguments[1]; gr(n) && (gr(n.events) && Jr(t, n.events), gr(n.methods) && Jr(r, n.methods)), k && k.apply(this, arguments) }, create: function () { var e = gr(this.$config) ? Jr(U, this.$config) : U; (this.$domWrap = Bi(this.$dom).css("display", "none")).html(e.html).delegate("cm-pp-close, " + e.closeSelector, "click", this.close), this.width(y).height(g).offset(p).translate(m), this._hide = M; for (var t = arguments.length, r = Array(t), n = 0; n < t; n++)r[n] = arguments[n]; S && S.apply(this, r), !this._hide && this.open() }, destroy: function () { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; T && T.apply(this, t), this.$domWrap.undelegate(this.$config.closeSelector, "click", this.close).remove() }, level: b, init: _, inited: w, data: E, events: A, computed: R, penetrate: P, operable: D, autoFocus: B, methods: Jr({ open: function () { if (this.destroyed) return this; this.$domWrap.css("display", "block"), this._hide = !1; for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; return this.$emit("popupOpen", t, this), yr(N) && N.apply(this, t), this }, close: function () { if (this.destroyed) return this; this.$domWrap.css("display", "none"), this._hide = !0; for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; return this.$emit("popupClose", t, this), yr(F) && F.apply(this, t), this }, width: function (e) { return e && this.$domWrap.css("width", e), this }, height: function (e) { return e && this.$domWrap.css("height", e), this }, offset: function (e) { var t = ("" + (e || "")).split(" "), r = {}; if (t.length > 2) return ["top", "right", "bottom", "left"].forEach(function (e, n) { t[n] && "auto" !== t[n] && (r[e] = t[n]) }), this.$domWrap.css(r), this; var n = lo(t, 2), i = n[0], o = n[1]; if ("" === i) return this; var a = o || i, s = d.split(" "); r[s[0]] = i, r[s[1]] = a, this.$domWrap.css(r); var u = []; return "50%" === i && u.push("-50%"), "50%" === a && u.push("-50%"), u.length > 0 && this.translate(u.join(" ")), this }, translate: function (e) { var t = ("" + (e || "")).split(" "), r = lo(t, 2), n = r[0], i = r[1]; return n && this.$domWrap.css("transform", "translate(" + n + ", " + (i || n) + ")"), this } }, L) } }({ tagName: "chimee-menu", name: "chimeeContextmenu", html: "<ul></ul>", offset: "0", hide: !0, data: { baseMenus: [{ text: "查看日志", action: "openLogPopup", hide: !0 }, { text: "Chimee {VERSION} &copy; 360", url: "http://chimee.org", disable: !0 }] }, create: function () { var e = this, t = this.$config, r = t.baseMenus, n = t.menus; mr(r) && (this.baseMenus = r), this.updatemenu(n), this.$domWrap.on("click", this.clickHandler), this.$plugins.chimeeLog && this.switchLogMenu(!1), this._doc = new this.$domWrap.constructor(document), this._doc_click = function (t) { return e.close() }, this._doc.on("click", this._doc_click) }, destroy: function () { this._doc.off("click", this._doc_click) }, opened: function () { this.$bumpToTop() }, events: { contextmenu: function (e) { var t = e.offsetX, r = e.offsetY, n = this.$dom.parentElement; if (yr(n.getBoundingClientRect)) { var i = n.getBoundingClientRect(); t = e.pageX - i.left - (document.documentElement.scrollLeft || document.body.scrollLeft || 0), r = e.pageY - i.top - (document.documentElement.scrollTop || document.body.scrollTop || 0) } this.offset(t + "px " + r + "px").open(e), e.preventDefault() }, logPluginDestroy: function () { this.switchLogMenu(!0) }, logPluginCreate: function () { this.switchLogMenu(!1) } }, methods: { switchLogMenu: function (e) { var t = this.baseMenus.find(function (e) { return "openLogPopup" === e.action }); t && (t.hide = e, this.$domWrap.find('[data-action="openLogPopup"]').css("display", e ? "none" : "")) }, updatemenu: function (e) { var t = this, r = []; mr(e) && (r = r.concat(e)); var n = r.concat(this.baseMenus).map(function (e) { var r = e.hide, n = e.disable, i = e.action, o = e.className, a = e.text, s = e.url, u = n ? "disable" : "", l = i ? 'data-action="' + i + '"' : "", c = o ? 'class="' + o + '"' : "", f = r ? 'style="display:none"' : "", d = a.replace(/\{([^)]*)\}/g, function (e, r) { return t[r] }); return s && (d = '<a href="'.concat(s, '" target="_blank">').concat(d, "</a>")), "<li ".concat(u, " ").concat(l, " ").concat(c, " ").concat(f, ">").concat(d, "</li>") }).join(""); this.$domWrap.find("ul").html(n) }, clickHandler: function (e) { var t = e.target; if (!t.disable) { var r = t.dataset.action; r && (this.$emit(r), yr(this[r]) && this[r](e)), this.close() } e.stopPropagation() } } }); !function (e, t) { if ("undefined" == typeof document) return t; e = e || ""; var r = document.head || document.getElementsByTagName("head")[0], n = document.createElement("style"); n.type = "text/css", r.appendChild(n), n.styleSheet ? n.styleSheet.cssText = e : n.appendChild(document.createTextNode(e)) }("chimee-popup{position:absolute;color:#fff;background-color:rgba(88,88,88,.5);font-size:13px;font-family:sans-serif;border:1px solid hsla(0,0%,100%,.08);padding:3px}chimee-popup cm-pp-close{float:right;color:#fff;text-decoration:none;line-height:14px;text-shadow:0 0 1px #000;font-size:15px;padding:0 3px;cursor:pointer;opacity:.8}chimee-popup cm-pp-close:hover{opacity:1}chimee-popup cm-pp-body,chimee-popup cm-pp-head{display:block;padding:3px 3px 6px}chimee-popup cm-pp-head{font-weight:700;border-bottom:1px solid hsla(0,0%,100%,.18);padding:0 5px 4px;margin-bottom:5px}chimee-popup cm-pp-body{font-size:12px}", void 0), function (e, t) { if ("undefined" == typeof document) return t; e = e || ""; var r = document.head || document.getElementsByTagName("head")[0], n = document.createElement("style"); n.type = "text/css", r.appendChild(n), n.styleSheet ? n.styleSheet.cssText = e : n.appendChild(document.createTextNode(e)) }(".chimee-log{padding:2px;box-shadow:0 1px 4px rgba(0,0,0,.6)}.chimee-log label{margin-left:10px;font-weight:100;font-size:12px}.chimee-log label input{vertical-align:middle;display:inline;width:auto;padding:0;margin:0}.chimee-log vs-pp-body{padding:3px}.chimee-log textarea{display:block;width:100%;height:200px;margin:-3px;border:1px solid hsla(0,0%,100%,.5);background-color:hsla(0,0%,100%,.9)}", void 0); var jc = (new Date).getTime().toString(); di("_chimee_t", jc); var Gc, $c = fi("_chimee_t") === jc, zc = function () { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; var n = {}; return t.forEach(function (e) { n[e] = function (t) { for (var r = this, n = arguments.length, i = Array(n > 1 ? n - 1 : 0), o = 1; o < n; o++)i[o - 1] = arguments[o]; this.writeLog(t); var a = this.box, s = this.type, u = this.src, l = this._waiting_num, c = this.currentTime, f = this._is_seek, d = void 0 !== f && f, h = this._is_play, p = void 0 !== h && h, v = this.playingTimestamp, m = this.loadstartTimestamp, y = this.waitingTimestamp; switch (e) { case "loadstart": this.sendLog(e, { box: a, type: s, src: u }), this._ls_timeout = setTimeout(function () { r.sendLog("timeout", { src: u }) }, this.timeoutDelay), this._total_waiting_time = 0; break; case "seeking": this._is_seek = !0; break; case "play": this._is_play = !0; break; case "pause": this.sendLog(e, { src: u, currentTime: c }); break; case "canplay": clearTimeout(this._ls_timeout); var g = this.canplayTimestamp; this.sendLog(e, { src: u, currentTime: c, waitingNum: l, waitingTime: g - (m || y || g) }); break; case "playing": clearTimeout(this._ls_timeout); var b = v - (m || y || v); this._total_waiting_time += b, this.sendLog(e, { src: u, waitingNum: l, currentTime: c, isSeek: d, isPlay: p, waitingTime: b }), this.loadstartTimestamp = 0, this.waitingTimestamp = 0, this._is_seek = !1, this._is_play = !1; break; case "ended": this.sendLog(e, { src: u, waitingNum: l, totalWaitingTime: this._total_waiting_time }); break; case "waiting": this._waiting_num++, this.sendLog(e, { src: u, waitingNum: l, currentTime: c, isSeek: d, isPlay: p }); break; case "error": this.sendLog(e, { src: u, args: i }) } } }), n }("loadstart", "abort", "durationchange", "loadedmetadata", "loadeddata", "progress", "canplay", "canplaythrough", "pause", "play", "playing", "emptied", "ended", "seeking", "seeked", "stalled", "suspend", "timeupdate", "waiting", "error"), Kc = function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, t = e.tagName, r = void 0 === t ? "chimee-popup" : t, n = e.className, i = e.name, o = void 0 === i ? "popup" : i, a = e.html, s = e.title, u = void 0 === s ? "这是一个信息框" : s, l = e.body, c = void 0 === l ? "这里是信息内容" : l, f = e.offsetAttr, d = void 0 === f ? "left top" : f, h = e.offset, p = void 0 === h ? "50% 50%" : h, v = e.translate, m = void 0 === v ? "" : v, y = e.width, g = e.height, b = e.level, _ = e.init, w = e.inited, E = e.data, S = e.create, k = e.beforeCreate, T = e.destroy, A = e.events, R = e.computed, O = e.methods, L = void 0 === O ? {} : O, x = e.penetrate, P = void 0 !== x && x, C = e.operable, D = void 0 === C || C, I = e.hide, M = void 0 !== I && I, N = e.opened, F = e.closed, B = e.autoFocus, U = { html: a || "\n      <cm-pp-close>×</cm-pp-close>\n      " + (!1 !== u ? "<cm-pp-head>" + u + "</cm-pp-head>" : "") + "\n      " + (!1 !== c ? "<cm-pp-body>" + c + "</cm-pp-body>" : "") + "\n    ", closeSelector: "._close" }; return { name: o, el: r, className: n, beforeCreate: function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, t = e.events, r = e.methods, n = arguments[1]; gr(n) && (gr(n.events) && Jr(t, n.events), gr(n.methods) && Jr(r, n.methods)), k && k.apply(this, arguments) }, create: function () { var e = gr(this.$config) ? Jr(U, this.$config) : U; (this.$domWrap = Bi(this.$dom).css("display", "none")).html(e.html).delegate("cm-pp-close, " + e.closeSelector, "click", this.close), this.width(y).height(g).offset(p).translate(m), this._hide = M; for (var t = arguments.length, r = Array(t), n = 0; n < t; n++)r[n] = arguments[n]; S && S.apply(this, r), !this._hide && this.open() }, destroy: function () { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; T && T.apply(this, t), this.$domWrap.undelegate(this.$config.closeSelector, "click", this.close).remove() }, level: b, init: _, inited: w, data: E, events: A, computed: R, penetrate: P, operable: D, autoFocus: B, methods: Jr({ open: function () { if (this.destroyed) return this; this.$domWrap.css("display", "block"), this._hide = !1; for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; return this.$emit("popupOpen", t, this), yr(N) && N.apply(this, t), this }, close: function () { if (this.destroyed) return this; this.$domWrap.css("display", "none"), this._hide = !0; for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; return this.$emit("popupClose", t, this), yr(F) && F.apply(this, t), this }, width: function (e) { return e && this.$domWrap.css("width", e), this }, height: function (e) { return e && this.$domWrap.css("height", e), this }, offset: function (e) { var t = ("" + (e || "")).split(" "), r = {}; if (t.length > 2) return ["top", "right", "bottom", "left"].forEach(function (e, n) { t[n] && "auto" !== t[n] && (r[e] = t[n]) }), this.$domWrap.css(r), this; var n = lo(t, 2), i = n[0], o = n[1]; if ("" === i) return this; var a = o || i, s = d.split(" "); r[s[0]] = i, r[s[1]] = a, this.$domWrap.css(r); var u = []; return "50%" === i && u.push("-50%"), "50%" === a && u.push("-50%"), u.length > 0 && this.translate(u.join(" ")), this }, translate: function (e) { var t = ("" + (e || "")).split(" "), r = lo(t, 2), n = r[0], i = r[1]; return n && this.$domWrap.css("transform", "translate(" + n + ", " + (i || n) + ")"), this } }, L) } }({ name: "chimeeLog", className: "chimee-log", title: "日志信息" + ($c ? '<label><input type="checkbox">下次自动打开</label>' : ""), body: "<textarea>Chimee logs:</textarea>", offset: "0", width: "400px", hide: !0, autoFocus: !1, logPostUrl: void 0, beforeCreate: function (e, t) { var r; Sr(r = t.logPostUrl) && r.match(/^((https?|ftp|rtsp|mms):\/\/)(([0-9a-z_!~*'().&=+$%-]+: )?[0-9a-z_!~*'().&=+$%-]+@)?(([0-9]{1,3}\.){3}[0-9]{1,3}|([0-9a-z_!~*'()-]+\.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z]\.[a-z]{2,6}|localhost)(:[0-9]{1,4})?((\/?)|(\/[0-9a-z_!~*'().;?:@&=+$,%#-]+)+\/?)$/i) && (this.logPostUrl = t.logPostUrl), t.timeoutDelay && (this.timeoutDelay = t.timeoutDelay) }, create: function () { this.logBase.ver = this.VERSION; var e = this.$domWrap; if (this.$txtEl = e.find("textarea"), $c) { var t = "1" === fi("auto_on"); e.find('input[type="checkbox"]').on("change", function (e) { di("auto_on", +this.checked) })[0].checked = t, this._hide = !t } this.writeLog({ type: "ready" }), this.$emitSync("logPluginCreate") }, destroy: function () { clearTimeout(this._ls_timeout), this.$emitSync("logPluginDestroy"), this.sendLog("destroy") }, inited: function () { }, closed: function () { this.$txtEl.text("") }, opened: function () { this.$bumpToTop() }, methods: { writeLog: function (e) { var t = e.type; if (this[t + "Timestamp"] = +new Date, !this._hide) { var r = void 0, n = "write_" + t + "_log"; if (this[n]) { for (var i = arguments.length, o = Array(i > 1 ? i - 1 : 0), a = 1; a < i; a++)o[a - 1] = arguments[a]; r = this[n](t, o) } var s = this.$txtEl.text() + "\n[" + function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : new Date, t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "yyyy-MM-dd hh:mm:ss.i", r = e.getFullYear().toString(), n = { M: e.getMonth() + 1, d: e.getDate(), h: e.getHours(), m: e.getMinutes(), s: e.getSeconds(), i: e.getMilliseconds() }; t = t.replace(/(y+)/gi, function (e, t) { return r.substr(4 - Math.min(4, t.length)) }); var i = function (e) { t = t.replace(new RegExp("(" + e + "+)", "g"), function (t, r) { return (n[e] < 10 && r.length > 1 ? "0" : "") + n[e] }) }; for (var o in n) i(o); return t }(new Date(this[t + "Timestamp"]), "yyyy-MM-dd hh:mm:ss.i") + "] " + t + " " + (void 0 !== r ? Sa(r) : ""), u = this.$txtEl.text(s)[0]; u.scrollTop = u.scrollHeight } }, write_loadstart_log: function (e) { return { box: this.box, type: this.type, src: this.src } }, write_durationchange_log: function () { return { duration: this.duration } }, write_timeupdate_log: function () { return { currentTime: this.currentTime } }, send_inited_log: function () { var e = this.box, t = this.type, r = this.src, n = this.controls, i = this.loop; return { pro: location.protocol, box: e, type: t, src: r, ctrs: n, loop: i } }, sendLog: function (e, t) { var r = this.logPostUrl; if (r) { var n = Jr(t || {}, this.logBase), i = "send_" + e + "_log"; this[i] && Jr(n, this[i](e, n)), Jr(n, { evt: e, _t: +new Date, _r: Math.random() }); var o = []; Jt(n).forEach(function (e) { return o.push(encodeURIComponent(e) + "=" + encodeURIComponent(n[e])) }); var a = new Image; a.onload = a.onerror = function (e) { a = null }, a.src = r + "?" + o.join("&") } } }, events: Jr(zc, { openLogPopup: function () { this.open() } }), data: { timeoutDelay: 3e4, pageLoadedTimestamp: jc, _waiting_num: 0, _total_waiting_time: 0, logBase: { uid: (Gc = fi("_chimee_uid"), Gc || di("_chimee_uid", Gc = tn() + tn() + "-" + tn() + "-" + tn() + "-" + tn() + "-" + tn() + tn() + tn()), Gc), ref: location.href } }, computed: { type: function () { return this.$videoConfig.isLive ? "live" : "vod" } } }); var Vc = function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : function (e, t, r) { e[t] = r }; return function r(n, i, o) { if (mr(n) || gr(n)) { for (var a in i = Ar(i) ? gr(n) ? {} : [] : i, n) t(i, a, r(n[a], i[a], a)); return i } return e(n, i, o) } }(function (e) { return e }); !function (e, t) { if ("undefined" == typeof document) return t; e = e || ""; var r = document.head || document.getElementsByTagName("head")[0], n = document.createElement("style"); n.type = "text/css", r.appendChild(n), n.styleSheet ? n.styleSheet.cssText = e : n.appendChild(document.createTextNode(e)) }("chimee-popup{position:absolute;color:#fff;background-color:rgba(88,88,88,.5);font-size:13px;font-family:sans-serif;border:1px solid hsla(0,0%,100%,.08);padding:3px}chimee-popup cm-pp-close{float:right;color:#fff;text-decoration:none;line-height:14px;text-shadow:0 0 1px #000;font-size:15px;padding:0 3px;cursor:pointer;opacity:.8}chimee-popup cm-pp-close:hover{opacity:1}chimee-popup cm-pp-body,chimee-popup cm-pp-head{display:block;padding:3px 3px 6px}chimee-popup cm-pp-head{font-weight:700;border-bottom:1px solid hsla(0,0%,100%,.18);padding:0 5px 4px;margin-bottom:5px}chimee-popup cm-pp-body{font-size:12px}", void 0); var Wc, Hc = { errorTips: "加载失败，请刷新重试" }, qc = function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, t = e.tagName, r = void 0 === t ? "chimee-popup" : t, n = e.className, i = e.name, o = void 0 === i ? "popup" : i, a = e.html, s = e.title, u = void 0 === s ? "这是一个信息框" : s, l = e.body, c = void 0 === l ? "这里是信息内容" : l, f = e.offsetAttr, d = void 0 === f ? "left top" : f, h = e.offset, p = void 0 === h ? "50% 50%" : h, v = e.translate, m = void 0 === v ? "" : v, y = e.width, g = e.height, b = e.level, _ = e.init, w = e.inited, E = e.data, S = e.create, k = e.beforeCreate, T = e.destroy, A = e.events, R = e.computed, O = e.methods, L = void 0 === O ? {} : O, x = e.penetrate, P = void 0 !== x && x, C = e.operable, D = void 0 === C || C, I = e.hide, M = void 0 !== I && I, N = e.opened, F = e.closed, B = e.autoFocus, U = { html: a || "\n      <cm-pp-close>×</cm-pp-close>\n      " + (!1 !== u ? "<cm-pp-head>" + u + "</cm-pp-head>" : "") + "\n      " + (!1 !== c ? "<cm-pp-body>" + c + "</cm-pp-body>" : "") + "\n    ", closeSelector: "._close" }; return { name: o, el: r, className: n, beforeCreate: function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, t = e.events, r = e.methods, n = arguments[1]; gr(n) && (gr(n.events) && Jr(t, n.events), gr(n.methods) && Jr(r, n.methods)), k && k.apply(this, arguments) }, create: function () { var e = gr(this.$config) ? Jr(U, this.$config) : U; (this.$domWrap = Bi(this.$dom).css("display", "none")).html(e.html).delegate("cm-pp-close, " + e.closeSelector, "click", this.close), this.width(y).height(g).offset(p).translate(m), this._hide = M; for (var t = arguments.length, r = Array(t), n = 0; n < t; n++)r[n] = arguments[n]; S && S.apply(this, r), !this._hide && this.open() }, destroy: function () { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; T && T.apply(this, t), this.$domWrap.undelegate(this.$config.closeSelector, "click", this.close).remove() }, level: b, init: _, inited: w, data: E, events: A, computed: R, penetrate: P, operable: D, autoFocus: B, methods: Jr({ open: function () { if (this.destroyed) return this; this.$domWrap.css("display", "block"), this._hide = !1; for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; return this.$emit("popupOpen", t, this), yr(N) && N.apply(this, t), this }, close: function () { if (this.destroyed) return this; this.$domWrap.css("display", "none"), this._hide = !0; for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; return this.$emit("popupClose", t, this), yr(F) && F.apply(this, t), this }, width: function (e) { return e && this.$domWrap.css("width", e), this }, height: function (e) { return e && this.$domWrap.css("height", e), this }, offset: function (e) { var t = ("" + (e || "")).split(" "), r = {}; if (t.length > 2) return ["top", "right", "bottom", "left"].forEach(function (e, n) { t[n] && (r[e] = t[n]) }), this.$domWrap.css(r), this; var n = lo(t, 2), i = n[0], o = n[1]; if ("" === i) return this; var a = o || i, s = d.split(" "); r[s[0]] = i, r[s[1]] = a, this.$domWrap.css(r); var u = []; return "50%" === i && u.push("-50%"), "50%" === a && u.push("-50%"), u.length > 0 && this.translate(u.join(" ")), this }, translate: function (e) { var t = ("" + (e || "")).split(" "), r = lo(t, 2), n = r[0], i = r[1]; return "" !== n && (this.$domWrap.css("transform", "translate(" + n + ", " + (i || n) + ")"), "transform" in document.createElement("a").style || !window.console || !window.console.warn || console.warn("[chimee-plugin-popup] 当前环境不支持CSS3的transform特性，Dom元素无法正常使用translate。")), this } }, L) } }({ name: "chimeeCenterState", tagName: "chimee-center-state", html: "\n    <chimee-center-state-correct>\n      <chimee-center-state-loading></chimee-center-state-loading>\n      <chimee-center-state-tip>\n        <span></span>\n      </chimee-center-state-tip>\n    </chimee-center-state-correct>\n    <chimee-center-state-error></chimee-center-state-error>\n  ", offset: "50%", hide: !1, create: function () { }, inited: function () { this.config = gr(this.$config) ? function () { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; if (t.length < 2) throw new Error("deepAssign accept two and more argument"); for (var n = t.length - 1; n > -1; n--)if (Ar(t[n])) throw new TypeError("deepAssign only accept non primitive type"); var i = t.shift(); return t.forEach(function (e) { return Vc(e, i) }), i }(Hc, this.$config) : Hc, this.$dom.querySelector("chimee-center-state-error").innerText = this.config.errorTips, this.src && ("auto" === this.preload || "metadata" === this.preload || "" === this.preload || !0 === this.autoplay) && this.showLoading(!0) }, penetrate: !0, operable: !1, destroy: function () { this.clearTimeout() }, events: { pause: function () { this.showTip("pause"), this.showLoading(!1) }, play: function () { this.showTip("play") }, canplay: function () { this.playing() }, playing: function () { this.playing() }, waiting: function () { this.waiting() }, timeupdate: function () { this.showLoading(!1), this.clearTimeout() }, keydown: function (e) { if (this.$videoConfig.plugin.some(function (e) { return "chimeeControl" === (e.name || e) })) switch (e.stopPropagation(), e.keyCode) { case 37: e.preventDefault(), !this.live && this.showTip("back"); break; case 39: e.preventDefault(), !this.live && this.showTip("forward"); break; case 38: e.preventDefault(), this.showTip("volume-high"); break; case 40: e.preventDefault(), this.showTip("volume-low") } } }, methods: { playing: function () { this.clearTimeout(), this.showLoading(!1), this.showError(!1) }, waiting: function () { var e = this; this.clearTimeout(), this._timeout = setTimeout(function () { return e.showError() }, 3e4), !this.paused && this.showLoading(!0) }, clearTimeout: function (e) { function t() { return e.apply(this, arguments) } return t.toString = function () { return e.toString() }, t }(function () { this._timeout && (clearTimeout(this._timeout), this._timeout = null) }), showTip: function (e) { var t = this; this.$domWrap.removeClass("correct tip play pause back forward volume-high volume-low").addClass("correct tip " + e), setTimeout(function () { t.$domWrap.removeClass("tip " + e) }, 500) }, showLoading: function (e) { !1 === e ? this.$domWrap.removeClass("loading") : this.$domWrap.addClass("correct loading") }, showError: function (e) { !1 === e ? this.$domWrap.removeClass("error") : (this.$domWrap[0].className = "", this.$domWrap.addClass("error")) } } }), Yc = r(n(function (e, t) { var r; "undefined" != typeof self && self, r = function () { return function (e) { var t = {}; function r(n) { if (t[n]) return t[n].exports; var i = t[n] = { i: n, l: !1, exports: {} }; return e[n].call(i.exports, i, i.exports, r), i.l = !0, i.exports } return r.m = e, r.c = t, r.d = function (e, t, n) { r.o(e, t) || Object.defineProperty(e, t, { configurable: !1, enumerable: !0, get: n }) }, r.n = function (e) { var t = e && e.__esModule ? function () { return e.default } : function () { return e }; return r.d(t, "a", t), t }, r.o = function (e, t) { return Object.prototype.hasOwnProperty.call(e, t) }, r.p = "/dist/", r(r.s = 9) }([function (e, t, r) { r.d(t, "a", function () { return u }), r.d(t, "b", function () { return l }); var n = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }; function i() { } var o = { trace: i, debug: i, log: i, warn: i, info: i, error: i }, a = o; function s(e) { for (var t = arguments.length, r = Array(t > 1 ? t - 1 : 0), n = 1; n < t; n++)r[n - 1] = arguments[n]; r.forEach(function (t) { a[t] = e[t] ? e[t].bind(e) : function (e) { var t = self.console[e]; return t ? function () { for (var r = arguments.length, n = Array(r), i = 0; i < r; i++)n[i] = arguments[i]; n[0] && (n[0] = function (e, t) { return t = "[" + e + "] > " + t }(e, n[0])), t.apply(self.console, n) } : i }(t) }) } var u = function (e) { if (!0 === e || "object" === (void 0 === e ? "undefined" : n(e))) { s(e, "debug", "log", "info", "warn", "error"); try { a.log() } catch (e) { a = o } } else a = o }, l = o }, function (e, t, r) { t.a = { MEDIA_ATTACHING: "hlsMediaAttaching", MEDIA_ATTACHED: "hlsMediaAttached", MEDIA_DETACHING: "hlsMediaDetaching", MEDIA_DETACHED: "hlsMediaDetached", BUFFER_RESET: "hlsBufferReset", BUFFER_CODECS: "hlsBufferCodecs", BUFFER_CREATED: "hlsBufferCreated", BUFFER_APPENDING: "hlsBufferAppending", BUFFER_APPENDED: "hlsBufferAppended", BUFFER_EOS: "hlsBufferEos", BUFFER_FLUSHING: "hlsBufferFlushing", BUFFER_FLUSHED: "hlsBufferFlushed", MANIFEST_LOADING: "hlsManifestLoading", MANIFEST_LOADED: "hlsManifestLoaded", MANIFEST_PARSED: "hlsManifestParsed", LEVEL_SWITCHING: "hlsLevelSwitching", LEVEL_SWITCHED: "hlsLevelSwitched", LEVEL_LOADING: "hlsLevelLoading", LEVEL_LOADED: "hlsLevelLoaded", LEVEL_UPDATED: "hlsLevelUpdated", LEVEL_PTS_UPDATED: "hlsLevelPtsUpdated", AUDIO_TRACKS_UPDATED: "hlsAudioTracksUpdated", AUDIO_TRACK_SWITCHING: "hlsAudioTrackSwitching", AUDIO_TRACK_SWITCHED: "hlsAudioTrackSwitched", AUDIO_TRACK_LOADING: "hlsAudioTrackLoading", AUDIO_TRACK_LOADED: "hlsAudioTrackLoaded", SUBTITLE_TRACKS_UPDATED: "hlsSubtitleTracksUpdated", SUBTITLE_TRACK_SWITCH: "hlsSubtitleTrackSwitch", SUBTITLE_TRACK_LOADING: "hlsSubtitleTrackLoading", SUBTITLE_TRACK_LOADED: "hlsSubtitleTrackLoaded", SUBTITLE_FRAG_PROCESSED: "hlsSubtitleFragProcessed", INIT_PTS_FOUND: "hlsInitPtsFound", FRAG_LOADING: "hlsFragLoading", FRAG_LOAD_PROGRESS: "hlsFragLoadProgress", FRAG_LOAD_EMERGENCY_ABORTED: "hlsFragLoadEmergencyAborted", FRAG_LOADED: "hlsFragLoaded", FRAG_DECRYPTED: "hlsFragDecrypted", FRAG_PARSING_INIT_SEGMENT: "hlsFragParsingInitSegment", FRAG_PARSING_USERDATA: "hlsFragParsingUserdata", FRAG_PARSING_METADATA: "hlsFragParsingMetadata", FRAG_PARSING_DATA: "hlsFragParsingData", FRAG_PARSED: "hlsFragParsed", FRAG_BUFFERED: "hlsFragBuffered", FRAG_CHANGED: "hlsFragChanged", FPS_DROP: "hlsFpsDrop", FPS_DROP_LEVEL_CAPPING: "hlsFpsDropLevelCapping", ERROR: "hlsError", DESTROYING: "hlsDestroying", KEY_LOADING: "hlsKeyLoading", KEY_LOADED: "hlsKeyLoaded", STREAM_STATE_TRANSITION: "hlsStreamStateTransition" } }, function (e, t, r) { r.d(t, "b", function () { return n }), r.d(t, "a", function () { return i }); var n = { NETWORK_ERROR: "networkError", MEDIA_ERROR: "mediaError", KEY_SYSTEM_ERROR: "keySystemError", MUX_ERROR: "muxError", OTHER_ERROR: "otherError" }, i = { KEY_SYSTEM_NO_KEYS: "keySystemNoKeys", KEY_SYSTEM_NO_ACCESS: "keySystemNoAccess", KEY_SYSTEM_NO_SESSION: "keySystemNoSession", KEY_SYSTEM_LICENSE_REQUEST_FAILED: "keySystemLicenseRequestFailed", MANIFEST_LOAD_ERROR: "manifestLoadError", MANIFEST_LOAD_TIMEOUT: "manifestLoadTimeOut", MANIFEST_PARSING_ERROR: "manifestParsingError", MANIFEST_INCOMPATIBLE_CODECS_ERROR: "manifestIncompatibleCodecsError", LEVEL_LOAD_ERROR: "levelLoadError", LEVEL_LOAD_TIMEOUT: "levelLoadTimeOut", LEVEL_SWITCH_ERROR: "levelSwitchError", AUDIO_TRACK_LOAD_ERROR: "audioTrackLoadError", AUDIO_TRACK_LOAD_TIMEOUT: "audioTrackLoadTimeOut", FRAG_LOAD_ERROR: "fragLoadError", FRAG_LOAD_TIMEOUT: "fragLoadTimeOut", FRAG_DECRYPT_ERROR: "fragDecryptError", FRAG_PARSING_ERROR: "fragParsingError", REMUX_ALLOC_ERROR: "remuxAllocError", KEY_LOAD_ERROR: "keyLoadError", KEY_LOAD_TIMEOUT: "keyLoadTimeOut", BUFFER_ADD_CODEC_ERROR: "bufferAddCodecError", BUFFER_APPEND_ERROR: "bufferAppendError", BUFFER_APPENDING_ERROR: "bufferAppendingError", BUFFER_STALLED_ERROR: "bufferStalledError", BUFFER_FULL_ERROR: "bufferFullError", BUFFER_SEEK_OVER_HOLE: "bufferSeekOverHole", BUFFER_NUDGE_ON_STALL: "bufferNudgeOnStall", INTERNAL_EXCEPTION: "internalException" } }, function (e, t, r) { var n, i, o, a, s; n = /^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/, i = /^([^\/;?#]*)(.*)$/, o = /(?:\/|^)\.(?=\/)/g, a = /(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g, s = { buildAbsoluteURL: function (e, t, r) { if (r = r || {}, e = e.trim(), !(t = t.trim())) { if (!r.alwaysNormalize) return e; var n = s.parseURL(e); if (!n) throw new Error("Error trying to parse base URL."); return n.path = s.normalizePath(n.path), s.buildURLFromParts(n) } var o = s.parseURL(t); if (!o) throw new Error("Error trying to parse relative URL."); if (o.scheme) return r.alwaysNormalize ? (o.path = s.normalizePath(o.path), s.buildURLFromParts(o)) : t; var a = s.parseURL(e); if (!a) throw new Error("Error trying to parse base URL."); if (!a.netLoc && a.path && "/" !== a.path[0]) { var u = i.exec(a.path); a.netLoc = u[1], a.path = u[2] } a.netLoc && !a.path && (a.path = "/"); var l = { scheme: a.scheme, netLoc: o.netLoc, path: null, params: o.params, query: o.query, fragment: o.fragment }; if (!o.netLoc && (l.netLoc = a.netLoc, "/" !== o.path[0])) if (o.path) { var c = a.path, f = c.substring(0, c.lastIndexOf("/") + 1) + o.path; l.path = s.normalizePath(f) } else l.path = a.path, o.params || (l.params = a.params, o.query || (l.query = a.query)); return null === l.path && (l.path = r.alwaysNormalize ? s.normalizePath(o.path) : o.path), s.buildURLFromParts(l) }, parseURL: function (e) { var t = n.exec(e); return t ? { scheme: t[1] || "", netLoc: t[2] || "", path: t[3] || "", params: t[4] || "", query: t[5] || "", fragment: t[6] || "" } : null }, normalizePath: function (e) { for (e = e.split("").reverse().join("").replace(o, ""); e.length !== (e = e.replace(a, "")).length;); return e.split("").reverse().join("") }, buildURLFromParts: function (e) { return e.scheme + e.netLoc + e.path + e.params + e.query + e.fragment } }, e.exports = s }, function (e, t, r) { r.d(t, "b", function () { return i }); var n = function () { function e() { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e) } return e.isHeader = function (e, t) { return t + 10 <= e.length && 73 === e[t] && 68 === e[t + 1] && 51 === e[t + 2] && e[t + 3] < 255 && e[t + 4] < 255 && e[t + 6] < 128 && e[t + 7] < 128 && e[t + 8] < 128 && e[t + 9] < 128 }, e.isFooter = function (e, t) { return t + 10 <= e.length && 51 === e[t] && 68 === e[t + 1] && 73 === e[t + 2] && e[t + 3] < 255 && e[t + 4] < 255 && e[t + 6] < 128 && e[t + 7] < 128 && e[t + 8] < 128 && e[t + 9] < 128 }, e.getID3Data = function (t, r) { for (var n = r, i = 0; e.isHeader(t, r);) { i += 10, i += e._readSize(t, r + 6), e.isFooter(t, r + 10) && (i += 10), r += i } if (i > 0) return t.subarray(n, n + i) }, e._readSize = function (e, t) { var r = 0; return r = (127 & e[t]) << 21, r |= (127 & e[t + 1]) << 14, r |= (127 & e[t + 2]) << 7, r |= 127 & e[t + 3] }, e.getTimeStamp = function (t) { for (var r = e.getID3Frames(t), n = 0; n < r.length; n++) { var i = r[n]; if (e.isTimeStampFrame(i)) return e._readTimeStamp(i) } }, e.isTimeStampFrame = function (e) { return e && "PRIV" === e.key && "com.apple.streaming.transportStreamTimestamp" === e.info }, e._getFrameData = function (t) { var r = String.fromCharCode(t[0], t[1], t[2], t[3]), n = e._readSize(t, 4); return { type: r, size: n, data: t.subarray(10, 10 + n) } }, e.getID3Frames = function (t) { for (var r = 0, n = []; e.isHeader(t, r);) { for (var i = e._readSize(t, r + 6), o = (r += 10) + i; r + 8 < o;) { var a = e._getFrameData(t.subarray(r)), s = e._decodeFrame(a); s && n.push(s), r += a.size + 10 } e.isFooter(t, r) && (r += 10) } return n }, e._decodeFrame = function (t) { return "PRIV" === t.type ? e._decodePrivFrame(t) : "T" === t.type[0] ? e._decodeTextFrame(t) : "W" === t.type[0] ? e._decodeURLFrame(t) : void 0 }, e._readTimeStamp = function (e) { if (8 === e.data.byteLength) { var t = new Uint8Array(e.data), r = 1 & t[3], n = (t[4] << 23) + (t[5] << 15) + (t[6] << 7) + t[7]; return n /= 45, r && (n += 47721858.84), Math.round(n) } }, e._decodePrivFrame = function (t) { if (!(t.size < 2)) { var r = e._utf8ArrayToStr(t.data, !0), n = new Uint8Array(t.data.subarray(r.length + 1)); return { key: t.type, info: r, data: n.buffer } } }, e._decodeTextFrame = function (t) { if (!(t.size < 2)) { if ("TXXX" === t.type) { var r = 1, n = e._utf8ArrayToStr(t.data.subarray(r)); r += n.length + 1; var i = e._utf8ArrayToStr(t.data.subarray(r)); return { key: t.type, info: n, data: i } } var o = e._utf8ArrayToStr(t.data.subarray(1)); return { key: t.type, data: o } } }, e._decodeURLFrame = function (t) { if ("WXXX" === t.type) { if (t.size < 2) return; var r = 1, n = e._utf8ArrayToStr(t.data.subarray(r)); r += n.length + 1; var i = e._utf8ArrayToStr(t.data.subarray(r)); return { key: t.type, info: n, data: i } } var o = e._utf8ArrayToStr(t.data); return { key: t.type, data: o } }, e._utf8ArrayToStr = function (e) { for (var t = arguments.length > 1 && void 0 !== arguments[1] && arguments[1], r = e.length, n = void 0, i = void 0, o = void 0, a = "", s = 0; s < r;) { if (0 === (n = e[s++]) && t) return a; if (0 !== n && 3 !== n) switch (n >> 4) { case 0: case 1: case 2: case 3: case 4: case 5: case 6: case 7: a += String.fromCharCode(n); break; case 12: case 13: i = e[s++], a += String.fromCharCode((31 & n) << 6 | 63 & i); break; case 14: i = e[s++], o = e[s++], a += String.fromCharCode((15 & n) << 12 | (63 & i) << 6 | (63 & o) << 0) } } return a }, e }(), i = n._utf8ArrayToStr; t.a = n }, function (e, t, r) { var n = function () { function e(t, r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this.subtle = t, this.aesIV = r } return e.prototype.decrypt = function (e, t) { return this.subtle.decrypt({ name: "AES-CBC", iv: this.aesIV }, t, e) }, e }(); var i = function () { function e(t, r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this.subtle = t, this.key = r } return e.prototype.expandKey = function () { return this.subtle.importKey("raw", this.key, { name: "AES-CBC" }, !1, ["encrypt", "decrypt"]) }, e }(); var o = function () { function e() { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this.rcon = [0, 1, 2, 4, 8, 16, 32, 64, 128, 27, 54], this.subMix = [new Uint32Array(256), new Uint32Array(256), new Uint32Array(256), new Uint32Array(256)], this.invSubMix = [new Uint32Array(256), new Uint32Array(256), new Uint32Array(256), new Uint32Array(256)], this.sBox = new Uint32Array(256), this.invSBox = new Uint32Array(256), this.key = new Uint32Array(0), this.initTable() } return e.prototype.uint8ArrayToUint32Array_ = function (e) { for (var t = new DataView(e), r = new Uint32Array(4), n = 0; n < 4; n++)r[n] = t.getUint32(4 * n); return r }, e.prototype.initTable = function () { var e = this.sBox, t = this.invSBox, r = this.subMix, n = r[0], i = r[1], o = r[2], a = r[3], s = this.invSubMix, u = s[0], l = s[1], c = s[2], f = s[3], d = new Uint32Array(256), h = 0, p = 0, v = 0; for (v = 0; v < 256; v++)d[v] = v < 128 ? v << 1 : v << 1 ^ 283; for (v = 0; v < 256; v++) { var m = p ^ p << 1 ^ p << 2 ^ p << 3 ^ p << 4; m = m >>> 8 ^ 255 & m ^ 99, e[h] = m, t[m] = h; var y = d[h], g = d[y], b = d[g], _ = 257 * d[m] ^ 16843008 * m; n[h] = _ << 24 | _ >>> 8, i[h] = _ << 16 | _ >>> 16, o[h] = _ << 8 | _ >>> 24, a[h] = _, _ = 16843009 * b ^ 65537 * g ^ 257 * y ^ 16843008 * h, u[m] = _ << 24 | _ >>> 8, l[m] = _ << 16 | _ >>> 16, c[m] = _ << 8 | _ >>> 24, f[m] = _, h ? (h = y ^ d[d[d[b ^ y]]], p ^= d[d[p]]) : h = p = 1 } }, e.prototype.expandKey = function (e) { for (var t = this.uint8ArrayToUint32Array_(e), r = !0, n = 0; n < t.length && r;)r = t[n] === this.key[n], n++; if (!r) { this.key = t; var i = this.keySize = t.length; if (4 !== i && 6 !== i && 8 !== i) throw new Error("Invalid aes key size=" + i); var o = this.ksRows = 4 * (i + 6 + 1), a = void 0, s = void 0, u = this.keySchedule = new Uint32Array(o), l = this.invKeySchedule = new Uint32Array(o), c = this.sBox, f = this.rcon, d = this.invSubMix, h = d[0], p = d[1], v = d[2], m = d[3], y = void 0, g = void 0; for (a = 0; a < o; a++)a < i ? y = u[a] = t[a] : (g = y, a % i == 0 ? (g = c[(g = g << 8 | g >>> 24) >>> 24] << 24 | c[g >>> 16 & 255] << 16 | c[g >>> 8 & 255] << 8 | c[255 & g], g ^= f[a / i | 0] << 24) : i > 6 && a % i == 4 && (g = c[g >>> 24] << 24 | c[g >>> 16 & 255] << 16 | c[g >>> 8 & 255] << 8 | c[255 & g]), u[a] = y = (u[a - i] ^ g) >>> 0); for (s = 0; s < o; s++)a = o - s, g = 3 & s ? u[a] : u[a - 4], l[s] = s < 4 || a <= 4 ? g : h[c[g >>> 24]] ^ p[c[g >>> 16 & 255]] ^ v[c[g >>> 8 & 255]] ^ m[c[255 & g]], l[s] = l[s] >>> 0 } }, e.prototype.networkToHostOrderSwap = function (e) { return e << 24 | (65280 & e) << 8 | (16711680 & e) >> 8 | e >>> 24 }, e.prototype.decrypt = function (e, t, r, n) { for (var i, o, a, s = this.keySize + 6, u = this.invKeySchedule, l = this.invSBox, c = this.invSubMix, f = c[0], d = c[1], h = c[2], p = c[3], v = this.uint8ArrayToUint32Array_(r), m = v[0], y = v[1], g = v[2], b = v[3], _ = new Int32Array(e), w = new Int32Array(_.length), E = void 0, S = void 0, k = void 0, T = void 0, A = void 0, R = void 0, O = void 0, L = void 0, x = void 0, P = void 0, C = void 0, D = void 0, I = void 0, M = void 0, N = this.networkToHostOrderSwap; t < _.length;) { for (x = N(_[t]), P = N(_[t + 1]), C = N(_[t + 2]), D = N(_[t + 3]), A = x ^ u[0], R = D ^ u[1], O = C ^ u[2], L = P ^ u[3], I = 4, M = 1; M < s; M++)E = f[A >>> 24] ^ d[R >> 16 & 255] ^ h[O >> 8 & 255] ^ p[255 & L] ^ u[I], S = f[R >>> 24] ^ d[O >> 16 & 255] ^ h[L >> 8 & 255] ^ p[255 & A] ^ u[I + 1], k = f[O >>> 24] ^ d[L >> 16 & 255] ^ h[A >> 8 & 255] ^ p[255 & R] ^ u[I + 2], T = f[L >>> 24] ^ d[A >> 16 & 255] ^ h[R >> 8 & 255] ^ p[255 & O] ^ u[I + 3], A = E, R = S, O = k, L = T, I += 4; E = l[A >>> 24] << 24 ^ l[R >> 16 & 255] << 16 ^ l[O >> 8 & 255] << 8 ^ l[255 & L] ^ u[I], S = l[R >>> 24] << 24 ^ l[O >> 16 & 255] << 16 ^ l[L >> 8 & 255] << 8 ^ l[255 & A] ^ u[I + 1], k = l[O >>> 24] << 24 ^ l[L >> 16 & 255] << 16 ^ l[A >> 8 & 255] << 8 ^ l[255 & R] ^ u[I + 2], T = l[L >>> 24] << 24 ^ l[A >> 16 & 255] << 16 ^ l[R >> 8 & 255] << 8 ^ l[255 & O] ^ u[I + 3], I += 3, w[t] = N(E ^ m), w[t + 1] = N(T ^ y), w[t + 2] = N(k ^ g), w[t + 3] = N(S ^ b), m = x, y = P, g = C, b = D, t += 4 } return n ? (i = w.buffer, o = i.byteLength, (a = o && new DataView(i).getUint8(o - 1)) ? i.slice(0, o - a) : i) : w.buffer }, e.prototype.destroy = function () { this.key = void 0, this.keySize = void 0, this.ksRows = void 0, this.sBox = void 0, this.invSBox = void 0, this.subMix = void 0, this.invSubMix = void 0, this.keySchedule = void 0, this.invKeySchedule = void 0, this.rcon = void 0 }, e }(), a = r(2), s = r(0); var u = function () { function e(t, r) { var n = (arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}).removePKCS7Padding, i = void 0 === n || n; if (function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this.logEnabled = !0, this.observer = t, this.config = r, this.removePKCS7Padding = i, i) try { var o = crypto || self.crypto; this.subtle = o.subtle || o.webkitSubtle } catch (e) { } this.disableWebCrypto = !this.subtle } return e.prototype.isSync = function () { return this.disableWebCrypto && this.config.enableSoftwareAES }, e.prototype.decrypt = function (e, t, r, a) { var u = this; if (this.disableWebCrypto && this.config.enableSoftwareAES) { this.logEnabled && (s.b.log("JS AES decrypt"), this.logEnabled = !1); var l = this.decryptor; l || (this.decryptor = l = new o), l.expandKey(t), a(l.decrypt(e, 0, r, this.removePKCS7Padding)) } else { this.logEnabled && (s.b.log("WebCrypto AES decrypt"), this.logEnabled = !1); var c = this.subtle; this.key !== t && (this.key = t, this.fastAesKey = new i(c, t)), this.fastAesKey.expandKey().then(function (i) { new n(c, r).decrypt(e, i).catch(function (n) { u.onWebCryptoError(n, e, t, r, a) }).then(function (e) { a(e) }) }).catch(function (n) { u.onWebCryptoError(n, e, t, r, a) }) } }, e.prototype.onWebCryptoError = function (e, t, r, n, i) { this.config.enableSoftwareAES ? (s.b.log("WebCrypto Error, disable WebCrypto API"), this.disableWebCrypto = !0, this.logEnabled = !0, this.decrypt(t, r, n, i)) : (s.b.error("decrypting error : " + e.message), this.observer.trigger(Event.ERROR, { type: a.b.MEDIA_ERROR, details: a.a.FRAG_DECRYPT_ERROR, fatal: !0, reason: e.message })) }, e.prototype.destroy = function () { var e = this.decryptor; e && (e.destroy(), this.decryptor = void 0) }, e }(); t.a = u }, function (e, t) { function r() { this._events = this._events || {}, this._maxListeners = this._maxListeners || void 0 } function n(e) { return "function" == typeof e } function i(e) { return "object" == typeof e && null !== e } function o(e) { return void 0 === e } e.exports = r, r.EventEmitter = r, r.prototype._events = void 0, r.prototype._maxListeners = void 0, r.defaultMaxListeners = 10, r.prototype.setMaxListeners = function (e) { if ("number" != typeof e || e < 0 || isNaN(e)) throw TypeError("n must be a positive number"); return this._maxListeners = e, this }, r.prototype.emit = function (e) { var t, r, a, s, u, l; if (this._events || (this._events = {}), "error" === e && (!this._events.error || i(this._events.error) && !this._events.error.length)) { if ((t = arguments[1]) instanceof Error) throw t; var c = new Error('Uncaught, unspecified "error" event. (' + t + ")"); throw c.context = t, c } if (o(r = this._events[e])) return !1; if (n(r)) switch (arguments.length) { case 1: r.call(this); break; case 2: r.call(this, arguments[1]); break; case 3: r.call(this, arguments[1], arguments[2]); break; default: s = Array.prototype.slice.call(arguments, 1), r.apply(this, s) } else if (i(r)) for (s = Array.prototype.slice.call(arguments, 1), a = (l = r.slice()).length, u = 0; u < a; u++)l[u].apply(this, s); return !0 }, r.prototype.addListener = function (e, t) { var a; if (!n(t)) throw TypeError("listener must be a function"); return this._events || (this._events = {}), this._events.newListener && this.emit("newListener", e, n(t.listener) ? t.listener : t), this._events[e] ? i(this._events[e]) ? this._events[e].push(t) : this._events[e] = [this._events[e], t] : this._events[e] = t, i(this._events[e]) && !this._events[e].warned && (a = o(this._maxListeners) ? r.defaultMaxListeners : this._maxListeners) && a > 0 && this._events[e].length > a && (this._events[e].warned = !0, console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.", this._events[e].length), "function" == typeof console.trace && console.trace()), this }, r.prototype.on = r.prototype.addListener, r.prototype.once = function (e, t) { if (!n(t)) throw TypeError("listener must be a function"); var r = !1; function i() { this.removeListener(e, i), r || (r = !0, t.apply(this, arguments)) } return i.listener = t, this.on(e, i), this }, r.prototype.removeListener = function (e, t) { var r, o, a, s; if (!n(t)) throw TypeError("listener must be a function"); if (!this._events || !this._events[e]) return this; if (a = (r = this._events[e]).length, o = -1, r === t || n(r.listener) && r.listener === t) delete this._events[e], this._events.removeListener && this.emit("removeListener", e, t); else if (i(r)) { for (s = a; s-- > 0;)if (r[s] === t || r[s].listener && r[s].listener === t) { o = s; break } if (o < 0) return this; 1 === r.length ? (r.length = 0, delete this._events[e]) : r.splice(o, 1), this._events.removeListener && this.emit("removeListener", e, t) } return this }, r.prototype.removeAllListeners = function (e) { var t, r; if (!this._events) return this; if (!this._events.removeListener) return 0 === arguments.length ? this._events = {} : this._events[e] && delete this._events[e], this; if (0 === arguments.length) { for (t in this._events) "removeListener" !== t && this.removeAllListeners(t); return this.removeAllListeners("removeListener"), this._events = {}, this } if (n(r = this._events[e])) this.removeListener(e, r); else if (r) for (; r.length;)this.removeListener(e, r[r.length - 1]); return delete this._events[e], this }, r.prototype.listeners = function (e) { return this._events && this._events[e] ? n(this._events[e]) ? [this._events[e]] : this._events[e].slice() : [] }, r.prototype.listenerCount = function (e) { if (this._events) { var t = this._events[e]; if (n(t)) return 1; if (t) return t.length } return 0 }, r.listenerCount = function (e, t) { return e.listenerCount(t) } }, function (e, t, r) { var n = r(0), i = r(1); var o = Math.pow(2, 32) - 1, a = function () { function e(t, r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this.observer = t, this.remuxer = r } return e.prototype.resetTimeStamp = function (e) { this.initPTS = e }, e.prototype.resetInitSegment = function (t, r, n, o) { if (t && t.byteLength) { var a = this.initData = e.parseInitSegment(t); null == r && (r = "mp4a.40.5"), null == n && (n = "avc1.42e01e"); var s = {}; a.audio && a.video ? s.audiovideo = { container: "video/mp4", codec: r + "," + n, initSegment: o ? t : null } : (a.audio && (s.audio = { container: "audio/mp4", codec: r, initSegment: o ? t : null }), a.video && (s.video = { container: "video/mp4", codec: n, initSegment: o ? t : null })), this.observer.trigger(i.a.FRAG_PARSING_INIT_SEGMENT, { tracks: s }) } else r && (this.audioCodec = r), n && (this.videoCodec = n) }, e.probe = function (t) { return e.findBox({ data: t, start: 0, end: Math.min(t.length, 16384) }, ["moof"]).length > 0 }, e.bin2str = function (e) { return String.fromCharCode.apply(null, e) }, e.readUint16 = function (e, t) { e.data && (t += e.start, e = e.data); var r = e[t] << 8 | e[t + 1]; return r < 0 ? 65536 + r : r }, e.readUint32 = function (e, t) { e.data && (t += e.start, e = e.data); var r = e[t] << 24 | e[t + 1] << 16 | e[t + 2] << 8 | e[t + 3]; return r < 0 ? 4294967296 + r : r }, e.writeUint32 = function (e, t, r) { e.data && (t += e.start, e = e.data), e[t] = r >> 24, e[t + 1] = r >> 16 & 255, e[t + 2] = r >> 8 & 255, e[t + 3] = 255 & r }, e.findBox = function (t, r) { var n = [], i = void 0, o = void 0, a = void 0, s = void 0, u = void 0, l = void 0; if (t.data ? (u = t.start, a = t.end, t = t.data) : (u = 0, a = t.byteLength), !r.length) return null; for (i = u; i < a;)l = (o = e.readUint32(t, i)) > 1 ? i + o : a, e.bin2str(t.subarray(i + 4, i + 8)) === r[0] && (1 === r.length ? n.push({ data: t, start: i + 8, end: l }) : (s = e.findBox({ data: t, start: i + 8, end: l }, r.slice(1))).length && (n = n.concat(s))), i = l; return n }, e.parseSegmentIndex = function (t) { var r = e.findBox(t, ["moov"])[0], n = r ? r.end : null, i = 0, o = e.findBox(t, ["sidx"]), a = void 0; if (!o || !o[0]) return null; a = []; var s = (o = o[0]).data[0]; i = 0 === s ? 8 : 16; var u = e.readUint32(o, i); i += 4; i += 0 === s ? 8 : 16, i += 2; var l = o.end + 0, c = e.readUint16(o, i); i += 2; for (var f = 0; f < c; f++) { var d = i, h = e.readUint32(o, d); d += 4; var p = 2147483647 & h; if (1 === (2147483648 & h) >>> 31) return void console.warn("SIDX has hierarchical references (not supported)"); var v = e.readUint32(o, d); d += 4, a.push({ referenceSize: p, subsegmentDuration: v, info: { duration: v / u, start: l, end: l + p - 1 } }), l += p, i = d += 4 } return { earliestPresentationTime: 0, timescale: u, version: s, referencesCount: c, references: a, moovEndOffset: n } }, e.parseInitSegment = function (t) { var r = []; return e.findBox(t, ["moov", "trak"]).forEach(function (t) { var i = e.findBox(t, ["tkhd"])[0]; if (i) { var o = i.data[i.start], a = 0 === o ? 12 : 20, s = e.readUint32(i, a), u = e.findBox(t, ["mdia", "mdhd"])[0]; if (u) { a = 0 === (o = u.data[u.start]) ? 12 : 20; var l = e.readUint32(u, a), c = e.findBox(t, ["mdia", "hdlr"])[0]; if (c) { var f = { soun: "audio", vide: "video" }[e.bin2str(c.data.subarray(c.start + 8, c.start + 12))]; if (f) { var d = e.findBox(t, ["mdia", "minf", "stbl", "stsd"]); if (d.length) { d = d[0]; var h = e.bin2str(d.data.subarray(d.start + 12, d.start + 16)); n.b.log("MP4Demuxer:" + f + ":" + h + " found") } r[s] = { timescale: l, type: f }, r[f] = { timescale: l, id: s } } } } } }), r }, e.getStartDTS = function (t, r) { var n, i, o = void 0; return o = e.findBox(r, ["moof", "traf"]), n = [].concat.apply([], o.map(function (r) { return e.findBox(r, ["tfhd"]).map(function (n) { var i, o; return i = e.readUint32(n, 4), o = t[i].timescale || 9e4, e.findBox(r, ["tfdt"]).map(function (t) { var r, n = void 0; return r = t.data[t.start], n = e.readUint32(t, 4), 1 === r && (n *= Math.pow(2, 32), n += e.readUint32(t, 8)), n })[0] / o }) })), i = Math.min.apply(null, n), isFinite(i) ? i : 0 }, e.offsetStartDTS = function (t, r, n) { e.findBox(r, ["moof", "traf"]).map(function (r) { return e.findBox(r, ["tfhd"]).map(function (i) { var a = e.readUint32(i, 4), s = t[a].timescale || 9e4; e.findBox(r, ["tfdt"]).map(function (t) { var r = t.data[t.start], i = e.readUint32(t, 4); if (0 === r) e.writeUint32(t, 4, i - n * s); else { i *= Math.pow(2, 32), i += e.readUint32(t, 8), i -= n * s, i = Math.max(i, 0); var a = Math.floor(i / (o + 1)), u = Math.floor(i % (o + 1)); e.writeUint32(t, 4, a), e.writeUint32(t, 8, u) } }) }) }) }, e.prototype.append = function (t, r, n, o) { var a = this.initData; a || (this.resetInitSegment(t, this.audioCodec, this.videoCodec, !1), a = this.initData); var s, u = this.initPTS; if (void 0 === u) { var l = e.getStartDTS(a, t); this.initPTS = u = l - r, this.observer.trigger(i.a.INIT_PTS_FOUND, { initPTS: u }) } e.offsetStartDTS(a, t, u), s = e.getStartDTS(a, t), this.remuxer.remux(a.audio, a.video, null, null, s, n, o, t) }, e.prototype.destroy = function () { }, e }(); t.a = a }, function (e, t, r) { var n = r(1), i = r(2), o = r(5), a = r(0); function s(e, t) { return 255 === e[t] && 240 == (246 & e[t + 1]) } function u(e, t) { return 1 & e[t + 1] ? 7 : 9 } function l(e, t) { return (3 & e[t + 3]) << 11 | e[t + 4] << 3 | (224 & e[t + 5]) >>> 5 } function c(e, t) { return !!(t + 1 < e.length && s(e, t)) } function f(e, t) { if (t + 1 < e.length && s(e, t)) { var r = u(e, t); t + 5 < e.length && (r = l(e, t)); var n = t + r; if (n === e.length || n + 1 < e.length && s(e, n)) return !0 } return !1 } function d(e, t, r, n, o) { if (!e.samplerate) { var s = function (e, t, r, n) { var o, s = void 0, u = void 0, l = void 0, c = void 0, f = navigator.userAgent.toLowerCase(), d = n, h = [96e3, 88200, 64e3, 48e3, 44100, 32e3, 24e3, 22050, 16e3, 12e3, 11025, 8e3, 7350]; if (s = 1 + ((192 & t[r + 2]) >>> 6), !((o = (60 & t[r + 2]) >>> 2) > h.length - 1)) return l = (1 & t[r + 2]) << 2, l |= (192 & t[r + 3]) >>> 6, a.b.log("manifest codec:" + n + ",ADTS data:type:" + s + ",sampleingIndex:" + o + "[" + h[o] + "Hz],channelConfig:" + l), /firefox/i.test(f) ? o >= 6 ? (s = 5, c = new Array(4), u = o - 3) : (s = 2, c = new Array(2), u = o) : -1 !== f.indexOf("android") ? (s = 2, c = new Array(2), u = o) : (s = 5, c = new Array(4), n && (-1 !== n.indexOf("mp4a.40.29") || -1 !== n.indexOf("mp4a.40.5")) || !n && o >= 6 ? u = o - 3 : ((n && -1 !== n.indexOf("mp4a.40.2") && (o >= 6 && 1 === l || /vivaldi/i.test(f)) || !n && 1 === l) && (s = 2, c = new Array(2)), u = o)), c[0] = s << 3, c[0] |= (14 & o) >> 1, c[1] |= (1 & o) << 7, c[1] |= l << 3, 5 === s && (c[1] |= (14 & u) >> 1, c[2] = (1 & u) << 7, c[2] |= 8, c[3] = 0), { config: c, samplerate: h[o], channelCount: l, codec: "mp4a.40." + s, manifestCodec: d }; e.trigger(Event.ERROR, { type: i.b.MEDIA_ERROR, details: i.a.FRAG_PARSING_ERROR, fatal: !0, reason: "invalid ADTS sampling index:" + o }) }(t, r, n, o); e.config = s.config, e.samplerate = s.samplerate, e.channelCount = s.channelCount, e.codec = s.codec, e.manifestCodec = s.manifestCodec, a.b.log("parsed codec:" + e.codec + ",rate:" + s.samplerate + ",nb channel:" + s.channelCount) } } function h(e) { return 9216e4 / e } function p(e, t, r, n, i) { var o = function (e, t, r, n, i) { var o, a = void 0, s = e.length; if (o = u(e, t), a = l(e, t), (a -= o) > 0 && t + o + a <= s) return { headerLength: o, frameLength: a, stamp: r + n * i } }(t, r, n, i, h(e.samplerate)); if (o) { var a = o.stamp, s = o.headerLength, c = o.frameLength, f = { unit: t.subarray(r + s, r + s + c), pts: a, dts: a }; return e.samples.push(f), e.len += c, { sample: f, length: c + s } } } var v = r(4); var m = function () { function e(t, r, n) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this.observer = t, this.config = n, this.remuxer = r } return e.prototype.resetInitSegment = function (e, t, r, n) { this._audioTrack = { container: "audio/adts", type: "audio", id: 0, sequenceNumber: 0, isAAC: !0, samples: [], len: 0, manifestCodec: t, duration: n, inputTimeScale: 9e4 } }, e.prototype.resetTimeStamp = function () { }, e.probe = function (e) { if (!e) return !1; for (var t = (v.a.getID3Data(e, 0) || []).length, r = e.length; t < r; t++)if (f(e, t)) return a.b.log("ADTS sync word found !"), !0; return !1 }, e.prototype.append = function (e, t, r, n) { for (var i = this._audioTrack, o = v.a.getID3Data(e, 0) || [], s = v.a.getTimeStamp(o), u = s ? 90 * s : 9e4 * t, l = 0, f = u, h = e.length, m = o.length, y = [{ pts: f, dts: f, data: o }]; m < h - 1;)if (c(e, m) && m + 5 < h) { d(i, this.observer, e, m, i.manifestCodec); var g = p(i, e, m, u, l); if (!g) { a.b.log("Unable to parse AAC frame"); break } m += g.length, f = g.sample.pts, l++ } else v.a.isHeader(e, m) ? (o = v.a.getID3Data(e, m), y.push({ pts: f, dts: f, data: o }), m += o.length) : m++; this.remuxer.remux(i, { samples: [] }, { samples: y, inputTimeScale: 9e4 }, { samples: [] }, t, r, n) }, e.prototype.destroy = function () { }, e }(), y = r(7), g = { BitratesMap: [32, 64, 96, 128, 160, 192, 224, 256, 288, 320, 352, 384, 416, 448, 32, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 384, 32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 32, 48, 56, 64, 80, 96, 112, 128, 144, 160, 176, 192, 224, 256, 8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160], SamplingRateMap: [44100, 48e3, 32e3, 22050, 24e3, 16e3, 11025, 12e3, 8e3], SamplesCoefficients: [[0, 72, 144, 12], [0, 0, 0, 0], [0, 72, 144, 12], [0, 144, 144, 12]], BytesInSlot: [0, 1, 1, 4], appendFrame: function (e, t, r, n, i) { if (!(r + 24 > t.length)) { var o = this.parseHeader(t, r); if (o && r + o.frameLength <= t.length) { var a = n + i * (9e4 * o.samplesPerFrame / o.sampleRate), s = { unit: t.subarray(r, r + o.frameLength), pts: a, dts: a }; return e.config = [], e.channelCount = o.channelCount, e.samplerate = o.sampleRate, e.samples.push(s), e.len += o.frameLength, { sample: s, length: o.frameLength } } } }, parseHeader: function (e, t) { var r = e[t + 1] >> 3 & 3, n = e[t + 1] >> 1 & 3, i = e[t + 2] >> 4 & 15, o = e[t + 2] >> 2 & 3, a = e[t + 2] >> 1 & 1; if (1 !== r && 0 !== i && 15 !== i && 3 !== o) { var s = 3 === r ? 3 - n : 3 === n ? 3 : 4, u = 1e3 * g.BitratesMap[14 * s + i - 1], l = 3 === r ? 0 : 2 === r ? 1 : 2, c = g.SamplingRateMap[3 * l + o], f = e[t + 3] >> 6 == 3 ? 1 : 2, d = g.SamplesCoefficients[r][n], h = g.BytesInSlot[n], p = 8 * d * h; return { sampleRate: c, channelCount: f, frameLength: parseInt(d * u / c + a, 10) * h, samplesPerFrame: p } } }, isHeaderPattern: function (e, t) { return 255 === e[t] && 224 == (224 & e[t + 1]) && 0 != (6 & e[t + 1]) }, isHeader: function (e, t) { return !!(t + 1 < e.length && this.isHeaderPattern(e, t)) }, probe: function (e, t) { if (t + 1 < e.length && this.isHeaderPattern(e, t)) { var r = this.parseHeader(e, t), n = 4; r && r.frameLength && (n = r.frameLength); var i = t + n; if (i === e.length || i + 1 < e.length && this.isHeaderPattern(e, i)) return !0 } return !1 } }, b = g; var _ = function () { function e(t) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this.data = t, this.bytesAvailable = t.byteLength, this.word = 0, this.bitsAvailable = 0 } return e.prototype.loadWord = function () { var e = this.data, t = this.bytesAvailable, r = e.byteLength - t, n = new Uint8Array(4), i = Math.min(4, t); if (0 === i) throw new Error("no bytes available"); n.set(e.subarray(r, r + i)), this.word = new DataView(n.buffer).getUint32(0), this.bitsAvailable = 8 * i, this.bytesAvailable -= i }, e.prototype.skipBits = function (e) { var t = void 0; this.bitsAvailable > e ? (this.word <<= e, this.bitsAvailable -= e) : (e -= this.bitsAvailable, e -= (t = e >> 3) >> 3, this.bytesAvailable -= t, this.loadWord(), this.word <<= e, this.bitsAvailable -= e) }, e.prototype.readBits = function (e) { var t = Math.min(this.bitsAvailable, e), r = this.word >>> 32 - t; return e > 32 && a.b.error("Cannot read more than 32 bits at a time"), this.bitsAvailable -= t, this.bitsAvailable > 0 ? this.word <<= t : this.bytesAvailable > 0 && this.loadWord(), (t = e - t) > 0 && this.bitsAvailable ? r << t | this.readBits(t) : r }, e.prototype.skipLZ = function () { var e = void 0; for (e = 0; e < this.bitsAvailable; ++e)if (0 != (this.word & 2147483648 >>> e)) return this.word <<= e, this.bitsAvailable -= e, e; return this.loadWord(), e + this.skipLZ() }, e.prototype.skipUEG = function () { this.skipBits(1 + this.skipLZ()) }, e.prototype.skipEG = function () { this.skipBits(1 + this.skipLZ()) }, e.prototype.readUEG = function () { var e = this.skipLZ(); return this.readBits(e + 1) - 1 }, e.prototype.readEG = function () { var e = this.readUEG(); return 1 & e ? 1 + e >>> 1 : -1 * (e >>> 1) }, e.prototype.readBoolean = function () { return 1 === this.readBits(1) }, e.prototype.readUByte = function () { return this.readBits(8) }, e.prototype.readUShort = function () { return this.readBits(16) }, e.prototype.readUInt = function () { return this.readBits(32) }, e.prototype.skipScalingList = function (e) { var t = 8, r = 8, n = void 0; for (n = 0; n < e; n++)0 !== r && (r = (t + this.readEG() + 256) % 256), t = 0 === r ? t : r }, e.prototype.readSPS = function () { var e, t, r, n, i = 0, o = 0, a = 0, s = 0, u = void 0, l = void 0, c = void 0, f = this.readUByte.bind(this), d = this.readBits.bind(this), h = this.readUEG.bind(this), p = this.readBoolean.bind(this), v = this.skipBits.bind(this), m = this.skipEG.bind(this), y = this.skipUEG.bind(this), g = this.skipScalingList.bind(this); if (f(), e = f(), d(5), v(3), f(), y(), 100 === e || 110 === e || 122 === e || 244 === e || 44 === e || 83 === e || 86 === e || 118 === e || 128 === e) { var b = h(); if (3 === b && v(1), y(), y(), v(1), p()) for (l = 3 !== b ? 8 : 12, c = 0; c < l; c++)p() && g(c < 6 ? 16 : 64) } y(); var _ = h(); if (0 === _) h(); else if (1 === _) for (v(1), m(), m(), u = h(), c = 0; c < u; c++)m(); y(), v(1), t = h(), r = h(), 0 === (n = d(1)) && v(1), v(1), p() && (i = h(), o = h(), a = h(), s = h()); var w = [1, 1]; if (p() && p()) switch (f()) { case 1: w = [1, 1]; break; case 2: w = [12, 11]; break; case 3: w = [10, 11]; break; case 4: w = [16, 11]; break; case 5: w = [40, 33]; break; case 6: w = [24, 11]; break; case 7: w = [20, 11]; break; case 8: w = [32, 11]; break; case 9: w = [80, 33]; break; case 10: w = [18, 11]; break; case 11: w = [15, 11]; break; case 12: w = [64, 33]; break; case 13: w = [160, 99]; break; case 14: w = [4, 3]; break; case 15: w = [3, 2]; break; case 16: w = [2, 1]; break; case 255: w = [f() << 8 | f(), f() << 8 | f()] }return { width: Math.ceil(16 * (t + 1) - 2 * i - 2 * o), height: (2 - n) * (r + 1) * 16 - (n ? 2 : 4) * (a + s), pixelRatio: w } }, e.prototype.readSliceType = function () { return this.readUByte(), this.readUEG(), this.readUEG() }, e }(); var w = function () { function e(t, r, n, i) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this.decryptdata = n, this.discardEPB = i, this.decrypter = new o.a(t, r, { removePKCS7Padding: !1 }) } return e.prototype.decryptBuffer = function (e, t) { this.decrypter.decrypt(e, this.decryptdata.key.buffer, this.decryptdata.iv.buffer, t) }, e.prototype.decryptAacSample = function (e, t, r, n) { var i = e[t].unit, o = i.subarray(16, i.length - i.length % 16), a = o.buffer.slice(o.byteOffset, o.byteOffset + o.length), s = this; this.decryptBuffer(a, function (o) { o = new Uint8Array(o), i.set(o, 16), n || s.decryptAacSamples(e, t + 1, r) }) }, e.prototype.decryptAacSamples = function (e, t, r) { for (; ; t++) { if (t >= e.length) return void r(); if (!(e[t].unit.length < 32)) { var n = this.decrypter.isSync(); if (this.decryptAacSample(e, t, r, n), !n) return } } }, e.prototype.getAvcEncryptedData = function (e) { for (var t = 16 * Math.floor((e.length - 48) / 160) + 16, r = new Int8Array(t), n = 0, i = 32; i <= e.length - 16; i += 160, n += 16)r.set(e.subarray(i, i + 16), n); return r }, e.prototype.getAvcDecryptedUnit = function (e, t) { t = new Uint8Array(t); for (var r = 0, n = 32; n <= e.length - 16; n += 160, r += 16)e.set(t.subarray(r, r + 16), n); return e }, e.prototype.decryptAvcSample = function (e, t, r, n, i, o) { var a = this.discardEPB(i.data), s = this.getAvcEncryptedData(a), u = this; this.decryptBuffer(s.buffer, function (s) { i.data = u.getAvcDecryptedUnit(a, s), o || u.decryptAvcSamples(e, t, r + 1, n) }) }, e.prototype.decryptAvcSamples = function (e, t, r, n) { for (; ; t++, r = 0) { if (t >= e.length) return void n(); for (var i = e[t].units; !(r >= i.length); r++) { var o = i[r]; if (!(o.length <= 48 || 1 !== o.type && 5 !== o.type)) { var a = this.decrypter.isSync(); if (this.decryptAvcSample(e, t, r, n, o, a), !a) return } } } }, e }(); var E = { video: 0, audio: 1, id3: 2, text: 3 }, S = function () { function e(t, r, n, i) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this.observer = t, this.config = n, this.typeSupported = i, this.remuxer = r, this.sampleAes = null } return e.prototype.setDecryptData = function (e) { null != e && null != e.key && "SAMPLE-AES" === e.method ? this.sampleAes = new w(this.observer, this.config, e, this.discardEPB) : this.sampleAes = null }, e.probe = function (t) { var r = e._syncOffset(t); return !(r < 0) && (r && a.b.warn("MPEG2-TS detected but first sync word found @ offset " + r + ", junk ahead ?"), !0) }, e._syncOffset = function (e) { for (var t = Math.min(1e3, e.length - 564), r = 0; r < t;) { if (71 === e[r] && 71 === e[r + 188] && 71 === e[r + 376]) return r; r++ } return -1 }, e.createTrack = function (e, t) { return { container: "video" === e || "audio" === e ? "video/mp2t" : void 0, type: e, id: E[e], pid: -1, inputTimeScale: 9e4, sequenceNumber: 0, samples: [], len: 0, dropped: "video" === e ? 0 : void 0, isAAC: "audio" === e || void 0, duration: "audio" === e ? t : void 0 } }, e.prototype.resetInitSegment = function (t, r, n, i) { this.pmtParsed = !1, this._pmtId = -1, this._avcTrack = e.createTrack("video", i), this._audioTrack = e.createTrack("audio", i), this._id3Track = e.createTrack("id3", i), this._txtTrack = e.createTrack("text", i), this.aacOverFlow = null, this.aacLastPTS = null, this.avcSample = null, this.audioCodec = r, this.videoCodec = n, this._duration = i }, e.prototype.resetTimeStamp = function () { }, e.prototype.append = function (t, r, o, s) { var u = void 0, l = t.length, c = void 0, f = void 0, d = void 0, h = void 0, p = !1; this.contiguous = o; var v = this.pmtParsed, m = this._avcTrack, y = this._audioTrack, g = this._id3Track, b = m.pid, _ = y.pid, w = g.pid, E = this._pmtId, S = m.pesData, k = y.pesData, T = g.pesData, A = this._parsePAT, R = this._parsePMT, O = this._parsePES, L = this._parseAVCPES.bind(this), x = this._parseAACPES.bind(this), P = this._parseMPEGPES.bind(this), C = this._parseID3PES.bind(this), D = e._syncOffset(t); for (l -= (l + D) % 188, u = D; u < l; u += 188)if (71 === t[u]) { if (c = !!(64 & t[u + 1]), f = ((31 & t[u + 1]) << 8) + t[u + 2], (48 & t[u + 3]) >> 4 > 1) { if ((d = u + 5 + t[u + 4]) === u + 188) continue } else d = u + 4; switch (f) { case b: c && (S && (h = O(S)) && void 0 !== h.pts && L(h, !1), S = { data: [], size: 0 }), S && (S.data.push(t.subarray(d, u + 188)), S.size += u + 188 - d); break; case _: c && (k && (h = O(k)) && void 0 !== h.pts && (y.isAAC ? x(h) : P(h)), k = { data: [], size: 0 }), k && (k.data.push(t.subarray(d, u + 188)), k.size += u + 188 - d); break; case w: c && (T && (h = O(T)) && void 0 !== h.pts && C(h), T = { data: [], size: 0 }), T && (T.data.push(t.subarray(d, u + 188)), T.size += u + 188 - d); break; case 0: c && (d += t[d] + 1), E = this._pmtId = A(t, d); break; case E: c && (d += t[d] + 1); var I = R(t, d, !0 === this.typeSupported.mpeg || !0 === this.typeSupported.mp3, null != this.sampleAes); (b = I.avc) > 0 && (m.pid = b), (_ = I.audio) > 0 && (y.pid = _, y.isAAC = I.isAAC), (w = I.id3) > 0 && (g.pid = w), p && !v && (a.b.log("reparse from beginning"), p = !1, u = D - 188), v = this.pmtParsed = !0; break; case 17: case 8191: break; default: p = !0 } } else this.observer.trigger(n.a.ERROR, { type: i.b.MEDIA_ERROR, details: i.a.FRAG_PARSING_ERROR, fatal: !1, reason: "TS packet did not start with 0x47" }); S && (h = O(S)) && void 0 !== h.pts ? (L(h, !0), m.pesData = null) : m.pesData = S, k && (h = O(k)) && void 0 !== h.pts ? (y.isAAC ? x(h) : P(h), y.pesData = null) : (k && k.size && a.b.log("last AAC PES packet truncated,might overlap between fragments"), y.pesData = k), T && (h = O(T)) && void 0 !== h.pts ? (C(h), g.pesData = null) : g.pesData = T, null == this.sampleAes ? this.remuxer.remux(y, m, g, this._txtTrack, r, o, s) : this.decryptAndRemux(y, m, g, this._txtTrack, r, o, s) }, e.prototype.decryptAndRemux = function (e, t, r, n, i, o, a) { if (e.samples && e.isAAC) { var s = this; this.sampleAes.decryptAacSamples(e.samples, 0, function () { s.decryptAndRemuxAvc(e, t, r, n, i, o, a) }) } else this.decryptAndRemuxAvc(e, t, r, n, i, o, a) }, e.prototype.decryptAndRemuxAvc = function (e, t, r, n, i, o, a) { if (t.samples) { var s = this; this.sampleAes.decryptAvcSamples(t.samples, 0, 0, function () { s.remuxer.remux(e, t, r, n, i, o, a) }) } else this.remuxer.remux(e, t, r, n, i, o, a) }, e.prototype.destroy = function () { this._initPTS = this._initDTS = void 0, this._duration = 0 }, e.prototype._parsePAT = function (e, t) { return (31 & e[t + 10]) << 8 | e[t + 11] }, e.prototype._parsePMT = function (e, t, r, n) { var i, o = void 0, s = { audio: -1, avc: -1, id3: -1, isAAC: !0 }; for (i = t + 3 + ((15 & e[t + 1]) << 8 | e[t + 2]) - 4, t += 12 + ((15 & e[t + 10]) << 8 | e[t + 11]); t < i;) { switch (o = (31 & e[t + 1]) << 8 | e[t + 2], e[t]) { case 207: if (!n) { a.b.log("unkown stream type:" + e[t]); break } case 15: -1 === s.audio && (s.audio = o); break; case 21: -1 === s.id3 && (s.id3 = o); break; case 219: if (!n) { a.b.log("unkown stream type:" + e[t]); break } case 27: -1 === s.avc && (s.avc = o); break; case 3: case 4: r ? -1 === s.audio && (s.audio = o, s.isAAC = !1) : a.b.log("MPEG audio found, not supported in this browser for now"); break; case 36: a.b.warn("HEVC stream type found, not supported for now"); break; default: a.b.log("unkown stream type:" + e[t]) }t += 5 + ((15 & e[t + 3]) << 8 | e[t + 4]) } return s }, e.prototype._parsePES = function (e) { var t = 0, r = void 0, n = void 0, i = void 0, o = void 0, s = void 0, u = void 0, l = void 0, c = void 0, f = e.data; if (!e || 0 === e.size) return null; for (; f[0].length < 19 && f.length > 1;) { var d = new Uint8Array(f[0].length + f[1].length); d.set(f[0]), d.set(f[1], f[0].length), f[0] = d, f.splice(1, 1) } if (1 === ((r = f[0])[0] << 16) + (r[1] << 8) + r[2]) { if ((i = (r[4] << 8) + r[5]) && i > e.size - 6) return null; 192 & (n = r[7]) && ((u = 536870912 * (14 & r[9]) + 4194304 * (255 & r[10]) + 16384 * (254 & r[11]) + 128 * (255 & r[12]) + (254 & r[13]) / 2) > 4294967295 && (u -= 8589934592), 64 & n ? ((l = 536870912 * (14 & r[14]) + 4194304 * (255 & r[15]) + 16384 * (254 & r[16]) + 128 * (255 & r[17]) + (254 & r[18]) / 2) > 4294967295 && (l -= 8589934592), u - l > 54e5 && (a.b.warn(Math.round((u - l) / 9e4) + "s delta between PTS and DTS, align them"), u = l)) : l = u), c = (o = r[8]) + 9, e.size -= c, s = new Uint8Array(e.size); for (var h = 0, p = f.length; h < p; h++) { var v = (r = f[h]).byteLength; if (c) { if (c > v) { c -= v; continue } r = r.subarray(c), v -= c, c = 0 } s.set(r, t), t += v } return i && (i -= o + 3), { data: s, pts: u, dts: l, len: i } } return null }, e.prototype.pushAccesUnit = function (e, t) { if (e.units.length && e.frame) { var r = t.samples, n = r.length; !this.config.forceKeyFrameOnDiscontinuity || !0 === e.key || t.sps && (n || this.contiguous) ? (e.id = n, r.push(e)) : t.dropped++ } e.debug.length && a.b.log(e.pts + "/" + e.dts + ":" + e.debug) }, e.prototype._parseAVCPES = function (e, t) { var r = this, n = this._avcTrack, i = this._parseAVCNALu(e.data), o = void 0, a = this.avcSample, s = void 0, u = !1, l = void 0, c = this.pushAccesUnit.bind(this), f = function (e, t, r, n) { return { key: e, pts: t, dts: r, units: [], debug: n } }; e.data = null, a && i.length && !n.audFound && (c(a, n), a = this.avcSample = f(!1, e.pts, e.dts, "")), i.forEach(function (t) { switch (t.type) { case 1: s = !0, a || (a = r.avcSample = f(!0, e.pts, e.dts, "")), a.frame = !0; var i = t.data; if (u && i.length > 4) { var d = new _(i).readSliceType(); 2 !== d && 4 !== d && 7 !== d && 9 !== d || (a.key = !0) } break; case 5: s = !0, a || (a = r.avcSample = f(!0, e.pts, e.dts, "")), a.key = !0, a.frame = !0; break; case 6: s = !0, (o = new _(r.discardEPB(t.data))).readUByte(); for (var h = 0, p = 0, v = !1, m = 0; !v && o.bytesAvailable > 1;) { h = 0; do { h += m = o.readUByte() } while (255 === m); p = 0; do { p += m = o.readUByte() } while (255 === m); if (4 === h && 0 !== o.bytesAvailable) { if (v = !0, 181 === o.readUByte()) if (49 === o.readUShort()) if (1195456820 === o.readUInt()) if (3 === o.readUByte()) { var y = o.readUByte(), g = 31 & y, b = [y, o.readUByte()]; for (l = 0; l < g; l++)b.push(o.readUByte()), b.push(o.readUByte()), b.push(o.readUByte()); r._insertSampleInOrder(r._txtTrack.samples, { type: 3, pts: e.pts, bytes: b }) } } else if (p < o.bytesAvailable) for (l = 0; l < p; l++)o.readUByte() } break; case 7: if (s = !0, u = !0, !n.sps) { var w = (o = new _(t.data)).readSPS(); n.width = w.width, n.height = w.height, n.pixelRatio = w.pixelRatio, n.sps = [t.data], n.duration = r._duration; var E = t.data.subarray(1, 4), S = "avc1."; for (l = 0; l < 3; l++) { var k = E[l].toString(16); k.length < 2 && (k = "0" + k), S += k } n.codec = S } break; case 8: s = !0, n.pps || (n.pps = [t.data]); break; case 9: s = !1, n.audFound = !0, a && c(a, n), a = r.avcSample = f(!1, e.pts, e.dts, ""); break; case 12: s = !1; break; default: s = !1, a && (a.debug += "unknown NAL " + t.type + " ") }a && s && a.units.push(t) }), t && a && (c(a, n), this.avcSample = null) }, e.prototype._insertSampleInOrder = function (e, t) { var r = e.length; if (r > 0) { if (t.pts >= e[r - 1].pts) e.push(t); else for (var n = r - 1; n >= 0; n--)if (t.pts < e[n].pts) { e.splice(n, 0, t); break } } else e.push(t) }, e.prototype._getLastNalUnit = function () { var e = this.avcSample, t = void 0; if (!e || 0 === e.units.length) { var r = this._avcTrack.samples; e = r[r.length - 1] } if (e) { var n = e.units; t = n[n.length - 1] } return t }, e.prototype._parseAVCNALu = function (e) { var t = 0, r = e.byteLength, n = void 0, i = void 0, o = this._avcTrack, a = o.naluState || 0, s = a, u = [], l = void 0, c = -1, f = void 0; for (-1 === a && (c = 0, f = 31 & e[0], a = 0, t = 1); t < r;)if (n = e[t++], a) if (1 !== a) if (n) if (1 === n) { if (c >= 0) l = { data: e.subarray(c, t - a - 1), type: f }, u.push(l); else { var d = this._getLastNalUnit(); if (d && (s && t <= 4 - s && d.state && (d.data = d.data.subarray(0, d.data.byteLength - s)), (i = t - a - 1) > 0)) { var h = new Uint8Array(d.data.byteLength + i); h.set(d.data, 0), h.set(e.subarray(0, i), d.data.byteLength), d.data = h } } t < r ? (c = t, f = 31 & e[t], a = 0) : a = -1 } else a = 0; else a = 3; else a = n ? 0 : 2; else a = n ? 0 : 1; if (c >= 0 && a >= 0 && (l = { data: e.subarray(c, r), type: f, state: a }, u.push(l)), 0 === u.length) { var p = this._getLastNalUnit(); if (p) { var v = new Uint8Array(p.data.byteLength + e.byteLength); v.set(p.data, 0), v.set(e, p.data.byteLength), p.data = v } } return o.naluState = a, u }, e.prototype.discardEPB = function (e) { for (var t, r = e.byteLength, n = [], i = 1, o = void 0; i < r - 2;)0 === e[i] && 0 === e[i + 1] && 3 === e[i + 2] ? (n.push(i + 2), i += 2) : i++; if (0 === n.length) return e; t = r - n.length, o = new Uint8Array(t); var a = 0; for (i = 0; i < t; a++, i++)a === n[0] && (a++, n.shift()), o[i] = e[a]; return o }, e.prototype._parseAACPES = function (e) { var t, r, o = this._audioTrack, s = e.data, u = e.pts, l = this.aacOverFlow, f = this.aacLastPTS, v = void 0, m = void 0, y = void 0; if (l) { var g = new Uint8Array(l.byteLength + s.byteLength); g.set(l, 0), g.set(s, l.byteLength), s = g } for (m = 0, r = s.length; m < r - 1 && !c(s, m); m++); if (m) { var b = void 0, _ = void 0; if (m < r - 1 ? (b = "AAC PES did not start with ADTS header,offset:" + m, _ = !1) : (b = "no ADTS header found in AAC PES", _ = !0), a.b.warn("parsing error:" + b), this.observer.trigger(n.a.ERROR, { type: i.b.MEDIA_ERROR, details: i.a.FRAG_PARSING_ERROR, fatal: _, reason: b }), _) return } if (d(o, this.observer, s, m, this.audioCodec), v = 0, t = h(o.samplerate), l && f) { var w = f + t; Math.abs(w - u) > 1 && (a.b.log("AAC: align PTS for overlapping frames by " + Math.round((w - u) / 90)), u = w) } for (; m < r;)if (c(s, m) && m + 5 < r) { var E = p(o, s, m, u, v); if (!E) break; m += E.length, y = E.sample.pts, v++ } else m++; l = m < r ? s.subarray(m, r) : null, this.aacOverFlow = l, this.aacLastPTS = y }, e.prototype._parseMPEGPES = function (e) { for (var t = e.data, r = t.length, n = 0, i = 0, o = e.pts; i < r;)if (b.isHeader(t, i)) { var a = b.appendFrame(this._audioTrack, t, i, o, n); if (!a) break; i += a.length, n++ } else i++ }, e.prototype._parseID3PES = function (e) { this._id3Track.samples.push(e) }, e }(); var k = function () { function e(t, r, n) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this.observer = t, this.config = n, this.remuxer = r } return e.prototype.resetInitSegment = function (e, t, r, n) { this._audioTrack = { container: "audio/mpeg", type: "audio", id: -1, sequenceNumber: 0, isAAC: !1, samples: [], len: 0, manifestCodec: t, duration: n, inputTimeScale: 9e4 } }, e.prototype.resetTimeStamp = function () { }, e.probe = function (e) { var t = void 0, r = void 0, n = v.a.getID3Data(e, 0); if (n && void 0 !== v.a.getTimeStamp(n)) for (t = n.length, r = Math.min(e.length - 1, t + 100); t < r; t++)if (b.probe(e, t)) return a.b.log("MPEG Audio sync word found !"), !0; return !1 }, e.prototype.append = function (e, t, r, n) { for (var i = v.a.getID3Data(e, 0), o = v.a.getTimeStamp(i), a = o ? 90 * o : 9e4 * t, s = i.length, u = e.length, l = 0, c = 0, f = this._audioTrack, d = [{ pts: a, dts: a, data: i }]; s < u;)if (b.isHeader(e, s)) { var h = b.appendFrame(f, e, s, a, l); if (!h) break; s += h.length, c = h.sample.pts, l++ } else v.a.isHeader(e, s) ? (i = v.a.getID3Data(e, s), d.push({ pts: c, dts: c, data: i }), s += i.length) : s++; this.remuxer.remux(f, { samples: [] }, { samples: d, inputTimeScale: 9e4 }, { samples: [] }, t, r, n) }, e.prototype.destroy = function () { }, e }(); var T = function () { function e() { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e) } return e.getSilentFrame = function (e, t) { switch (e) { case "mp4a.40.2": if (1 === t) return new Uint8Array([0, 200, 0, 128, 35, 128]); if (2 === t) return new Uint8Array([33, 0, 73, 144, 2, 25, 0, 35, 128]); if (3 === t) return new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 142]); if (4 === t) return new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 128, 44, 128, 8, 2, 56]); if (5 === t) return new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 130, 48, 4, 153, 0, 33, 144, 2, 56]); if (6 === t) return new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 130, 48, 4, 153, 0, 33, 144, 2, 0, 178, 0, 32, 8, 224]); break; default: if (1 === t) return new Uint8Array([1, 64, 34, 128, 163, 78, 230, 128, 186, 8, 0, 0, 0, 28, 6, 241, 193, 10, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 94]); if (2 === t) return new Uint8Array([1, 64, 34, 128, 163, 94, 230, 128, 186, 8, 0, 0, 0, 0, 149, 0, 6, 241, 161, 10, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 94]); if (3 === t) return new Uint8Array([1, 64, 34, 128, 163, 94, 230, 128, 186, 8, 0, 0, 0, 0, 149, 0, 6, 241, 161, 10, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 94]) }return null }, e }(); var A = Math.pow(2, 32) - 1, R = function () { function e() { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e) } return e.init = function () { e.types = { avc1: [], avcC: [], btrt: [], dinf: [], dref: [], esds: [], ftyp: [], hdlr: [], mdat: [], mdhd: [], mdia: [], mfhd: [], minf: [], moof: [], moov: [], mp4a: [], ".mp3": [], mvex: [], mvhd: [], pasp: [], sdtp: [], stbl: [], stco: [], stsc: [], stsd: [], stsz: [], stts: [], tfdt: [], tfhd: [], traf: [], trak: [], trun: [], trex: [], tkhd: [], vmhd: [], smhd: [] }; var t = void 0; for (t in e.types) e.types.hasOwnProperty(t) && (e.types[t] = [t.charCodeAt(0), t.charCodeAt(1), t.charCodeAt(2), t.charCodeAt(3)]); var r = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 118, 105, 100, 101, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86, 105, 100, 101, 111, 72, 97, 110, 100, 108, 101, 114, 0]), n = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 115, 111, 117, 110, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 83, 111, 117, 110, 100, 72, 97, 110, 100, 108, 101, 114, 0]); e.HDLR_TYPES = { video: r, audio: n }; var i = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 12, 117, 114, 108, 32, 0, 0, 0, 1]), o = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]); e.STTS = e.STSC = e.STCO = o, e.STSZ = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]), e.VMHD = new Uint8Array([0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0]), e.SMHD = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]), e.STSD = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1]); var a = new Uint8Array([105, 115, 111, 109]), s = new Uint8Array([97, 118, 99, 49]), u = new Uint8Array([0, 0, 0, 1]); e.FTYP = e.box(e.types.ftyp, a, u, a, s), e.DINF = e.box(e.types.dinf, e.box(e.types.dref, i)) }, e.box = function (e) { for (var t = Array.prototype.slice.call(arguments, 1), r = 8, n = t.length, i = n, o = void 0; n--;)r += t[n].byteLength; for ((o = new Uint8Array(r))[0] = r >> 24 & 255, o[1] = r >> 16 & 255, o[2] = r >> 8 & 255, o[3] = 255 & r, o.set(e, 4), n = 0, r = 8; n < i; n++)o.set(t[n], r), r += t[n].byteLength; return o }, e.hdlr = function (t) { return e.box(e.types.hdlr, e.HDLR_TYPES[t]) }, e.mdat = function (t) { return e.box(e.types.mdat, t) }, e.mdhd = function (t, r) { r *= t; var n = Math.floor(r / (A + 1)), i = Math.floor(r % (A + 1)); return e.box(e.types.mdhd, new Uint8Array([1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 3, t >> 24 & 255, t >> 16 & 255, t >> 8 & 255, 255 & t, n >> 24, n >> 16 & 255, n >> 8 & 255, 255 & n, i >> 24, i >> 16 & 255, i >> 8 & 255, 255 & i, 85, 196, 0, 0])) }, e.mdia = function (t) { return e.box(e.types.mdia, e.mdhd(t.timescale, t.duration), e.hdlr(t.type), e.minf(t)) }, e.mfhd = function (t) { return e.box(e.types.mfhd, new Uint8Array([0, 0, 0, 0, t >> 24, t >> 16 & 255, t >> 8 & 255, 255 & t])) }, e.minf = function (t) { return "audio" === t.type ? e.box(e.types.minf, e.box(e.types.smhd, e.SMHD), e.DINF, e.stbl(t)) : e.box(e.types.minf, e.box(e.types.vmhd, e.VMHD), e.DINF, e.stbl(t)) }, e.moof = function (t, r, n) { return e.box(e.types.moof, e.mfhd(t), e.traf(n, r)) }, e.moov = function (t) { for (var r = t.length, n = []; r--;)n[r] = e.trak(t[r]); return e.box.apply(null, [e.types.moov, e.mvhd(t[0].timescale, t[0].duration)].concat(n).concat(e.mvex(t))) }, e.mvex = function (t) { for (var r = t.length, n = []; r--;)n[r] = e.trex(t[r]); return e.box.apply(null, [e.types.mvex].concat(n)) }, e.mvhd = function (t, r) { r *= t; var n = Math.floor(r / (A + 1)), i = Math.floor(r % (A + 1)), o = new Uint8Array([1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 3, t >> 24 & 255, t >> 16 & 255, t >> 8 & 255, 255 & t, n >> 24, n >> 16 & 255, n >> 8 & 255, 255 & n, i >> 24, i >> 16 & 255, i >> 8 & 255, 255 & i, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255]); return e.box(e.types.mvhd, o) }, e.sdtp = function (t) { var r = t.samples || [], n = new Uint8Array(4 + r.length), i = void 0, o = void 0; for (o = 0; o < r.length; o++)i = r[o].flags, n[o + 4] = i.dependsOn << 4 | i.isDependedOn << 2 | i.hasRedundancy; return e.box(e.types.sdtp, n) }, e.stbl = function (t) { return e.box(e.types.stbl, e.stsd(t), e.box(e.types.stts, e.STTS), e.box(e.types.stsc, e.STSC), e.box(e.types.stsz, e.STSZ), e.box(e.types.stco, e.STCO)) }, e.avc1 = function (t) { var r = [], n = [], i = void 0, o = void 0, a = void 0; for (i = 0; i < t.sps.length; i++)a = (o = t.sps[i]).byteLength, r.push(a >>> 8 & 255), r.push(255 & a), r = r.concat(Array.prototype.slice.call(o)); for (i = 0; i < t.pps.length; i++)a = (o = t.pps[i]).byteLength, n.push(a >>> 8 & 255), n.push(255 & a), n = n.concat(Array.prototype.slice.call(o)); var s = e.box(e.types.avcC, new Uint8Array([1, r[3], r[4], r[5], 255, 224 | t.sps.length].concat(r).concat([t.pps.length]).concat(n))), u = t.width, l = t.height, c = t.pixelRatio[0], f = t.pixelRatio[1]; return e.box(e.types.avc1, new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, u >> 8 & 255, 255 & u, l >> 8 & 255, 255 & l, 0, 72, 0, 0, 0, 72, 0, 0, 0, 0, 0, 0, 0, 1, 18, 100, 97, 105, 108, 121, 109, 111, 116, 105, 111, 110, 47, 104, 108, 115, 46, 106, 115, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 17, 17]), s, e.box(e.types.btrt, new Uint8Array([0, 28, 156, 128, 0, 45, 198, 192, 0, 45, 198, 192])), e.box(e.types.pasp, new Uint8Array([c >> 24, c >> 16 & 255, c >> 8 & 255, 255 & c, f >> 24, f >> 16 & 255, f >> 8 & 255, 255 & f]))) }, e.esds = function (e) { var t = e.config.length; return new Uint8Array([0, 0, 0, 0, 3, 23 + t, 0, 1, 0, 4, 15 + t, 64, 21, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5].concat([t]).concat(e.config).concat([6, 1, 2])) }, e.mp4a = function (t) { var r = t.samplerate; return e.box(e.types.mp4a, new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, t.channelCount, 0, 16, 0, 0, 0, 0, r >> 8 & 255, 255 & r, 0, 0]), e.box(e.types.esds, e.esds(t))) }, e.mp3 = function (t) { var r = t.samplerate; return e.box(e.types[".mp3"], new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, t.channelCount, 0, 16, 0, 0, 0, 0, r >> 8 & 255, 255 & r, 0, 0])) }, e.stsd = function (t) { return "audio" === t.type ? t.isAAC || "mp3" !== t.codec ? e.box(e.types.stsd, e.STSD, e.mp4a(t)) : e.box(e.types.stsd, e.STSD, e.mp3(t)) : e.box(e.types.stsd, e.STSD, e.avc1(t)) }, e.tkhd = function (t) { var r = t.id, n = t.duration * t.timescale, i = t.width, o = t.height, a = Math.floor(n / (A + 1)), s = Math.floor(n % (A + 1)); return e.box(e.types.tkhd, new Uint8Array([1, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 3, r >> 24 & 255, r >> 16 & 255, r >> 8 & 255, 255 & r, 0, 0, 0, 0, a >> 24, a >> 16 & 255, a >> 8 & 255, 255 & a, s >> 24, s >> 16 & 255, s >> 8 & 255, 255 & s, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 0, 0, i >> 8 & 255, 255 & i, 0, 0, o >> 8 & 255, 255 & o, 0, 0])) }, e.traf = function (t, r) { var n = e.sdtp(t), i = t.id, o = Math.floor(r / (A + 1)), a = Math.floor(r % (A + 1)); return e.box(e.types.traf, e.box(e.types.tfhd, new Uint8Array([0, 0, 0, 0, i >> 24, i >> 16 & 255, i >> 8 & 255, 255 & i])), e.box(e.types.tfdt, new Uint8Array([1, 0, 0, 0, o >> 24, o >> 16 & 255, o >> 8 & 255, 255 & o, a >> 24, a >> 16 & 255, a >> 8 & 255, 255 & a])), e.trun(t, n.length + 16 + 20 + 8 + 16 + 8 + 8), n) }, e.trak = function (t) { return t.duration = t.duration || 4294967295, e.box(e.types.trak, e.tkhd(t), e.mdia(t)) }, e.trex = function (t) { var r = t.id; return e.box(e.types.trex, new Uint8Array([0, 0, 0, 0, r >> 24, r >> 16 & 255, r >> 8 & 255, 255 & r, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1])) }, e.trun = function (t, r) { var n = t.samples || [], i = n.length, o = 12 + 16 * i, a = new Uint8Array(o), s = void 0, u = void 0, l = void 0, c = void 0, f = void 0, d = void 0; for (r += 8 + o, a.set([0, 0, 15, 1, i >>> 24 & 255, i >>> 16 & 255, i >>> 8 & 255, 255 & i, r >>> 24 & 255, r >>> 16 & 255, r >>> 8 & 255, 255 & r], 0), s = 0; s < i; s++)l = (u = n[s]).duration, c = u.size, f = u.flags, d = u.cts, a.set([l >>> 24 & 255, l >>> 16 & 255, l >>> 8 & 255, 255 & l, c >>> 24 & 255, c >>> 16 & 255, c >>> 8 & 255, 255 & c, f.isLeading << 2 | f.dependsOn, f.isDependedOn << 6 | f.hasRedundancy << 4 | f.paddingValue << 1 | f.isNonSync, 61440 & f.degradPrio, 15 & f.degradPrio, d >>> 24 & 255, d >>> 16 & 255, d >>> 8 & 255, 255 & d], 12 + 16 * s); return e.box(e.types.trun, a) }, e.initSegment = function (t) { e.types || e.init(); var r = e.moov(t), n = void 0; return (n = new Uint8Array(e.FTYP.byteLength + r.byteLength)).set(e.FTYP), n.set(r, e.FTYP.byteLength), n }, e }(); var O = function () { function e(t, r, n, i) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this.observer = t, this.config = r, this.typeSupported = n; var o = navigator.userAgent; this.isSafari = i && i.indexOf("Apple") > -1 && o && !o.match("CriOS"), this.ISGenerated = !1 } return e.prototype.destroy = function () { }, e.prototype.resetTimeStamp = function (e) { this._initPTS = this._initDTS = e }, e.prototype.resetInitSegment = function () { this.ISGenerated = !1 }, e.prototype.remux = function (e, t, r, i, o, s, u) { if (this.ISGenerated || this.generateIS(e, t, o), this.ISGenerated) { var l = e.samples.length, c = t.samples.length, f = o, d = o; if (l && c) { var h = (e.samples[0].dts - t.samples[0].dts) / t.inputTimeScale; f += Math.max(0, h), d += Math.max(0, -h) } if (l) { e.timescale || (a.b.warn("regenerate InitSegment as audio detected"), this.generateIS(e, t, o)); var p = this.remuxAudio(e, f, s, u); if (c) { var v = void 0; p && (v = p.endPTS - p.startPTS), t.timescale || (a.b.warn("regenerate InitSegment as video detected"), this.generateIS(e, t, o)), this.remuxVideo(t, d, s, v, u) } } else if (c) { var m = this.remuxVideo(t, d, s, 0, u); m && e.codec && this.remuxEmptyAudio(e, f, s, m) } } r.samples.length && this.remuxID3(r, o), i.samples.length && this.remuxText(i, o), this.observer.trigger(n.a.FRAG_PARSED) }, e.prototype.generateIS = function (e, t, r) { var o = this.observer, s = e.samples, u = t.samples, l = this.typeSupported, c = "audio/mp4", f = {}, d = { tracks: f }, h = void 0 === this._initPTS, p = void 0, v = void 0; if (h && (p = v = 1 / 0), e.config && s.length && (e.timescale = e.samplerate, a.b.log("audio sampling rate : " + e.samplerate), e.isAAC || (l.mpeg ? (c = "audio/mpeg", e.codec = "") : l.mp3 && (e.codec = "mp3")), f.audio = { container: c, codec: e.codec, initSegment: !e.isAAC && l.mpeg ? new Uint8Array : R.initSegment([e]), metadata: { channelCount: e.channelCount } }, h && (p = v = s[0].pts - e.inputTimeScale * r)), t.sps && t.pps && u.length) { var m = t.inputTimeScale; t.timescale = m, f.video = { container: "video/mp4", codec: t.codec, initSegment: R.initSegment([t]), metadata: { width: t.width, height: t.height } }, h && (p = Math.min(p, u[0].pts - m * r), v = Math.min(v, u[0].dts - m * r), this.observer.trigger(n.a.INIT_PTS_FOUND, { initPTS: p })) } Object.keys(f).length ? (o.trigger(n.a.FRAG_PARSING_INIT_SEGMENT, d), this.ISGenerated = !0, h && (this._initPTS = p, this._initDTS = v)) : o.trigger(n.a.ERROR, { type: i.b.MEDIA_ERROR, details: i.a.FRAG_PARSING_ERROR, fatal: !1, reason: "no audio/video samples found" }) }, e.prototype.remuxVideo = function (e, t, r, o, s) { var u, l, c, f = 8, d = e.timescale, h = void 0, p = void 0, v = void 0, m = void 0, y = e.samples, g = [], b = y.length, _ = this._PTSNormalize, w = this._initDTS, E = this.nextAvcDts, S = this.isSafari; if (0 !== b) { S && (r |= y.length && E && (s && Math.abs(t - E / d) < .1 || Math.abs(y[0].pts - E - w) < d / 5)), r || (E = t * d), y.forEach(function (e) { e.pts = _(e.pts - w, E), e.dts = _(e.dts - w, E) }), y.sort(function (e, t) { var r = e.dts - t.dts, n = e.pts - t.pts; return r || n || e.id - t.id }); var k = y.reduce(function (e, t) { return Math.max(Math.min(e, t.pts - t.dts), -18e3) }, 0); if (k < 0) { a.b.warn("PTS < DTS detected in video samples, shifting DTS by " + Math.round(k / 90) + " ms to overcome this issue"); for (var T = 0; T < y.length; T++)y[T].dts += k } var A = y[0]; m = Math.max(A.dts, 0), v = Math.max(A.pts, 0); var O = Math.round((m - E) / 90); r && O && (O > 1 ? a.b.log("AVC:" + O + " ms hole between fragments detected,filling it") : O < -1 && a.b.log("AVC:" + -O + " ms overlapping between fragments detected"), m = E, y[0].dts = m, v = Math.max(v - O, E), y[0].pts = v, a.b.log("Video/PTS/DTS adjusted: " + Math.round(v / 90) + "/" + Math.round(m / 90) + ",delta:" + O + " ms")), A = y[y.length - 1], c = Math.max(A.dts, 0), l = Math.max(A.pts, 0, c), S && (h = Math.round((c - m) / (y.length - 1))); for (var L = 0, x = 0, P = 0; P < b; P++) { for (var C = y[P], D = C.units, I = D.length, M = 0, N = 0; N < I; N++)M += D[N].data.length; x += M, L += I, C.length = M, C.dts = S ? m + P * h : Math.max(C.dts, m), C.pts = Math.max(C.pts, C.dts) } var F = x + 4 * L + 8; try { p = new Uint8Array(F) } catch (e) { return void this.observer.trigger(n.a.ERROR, { type: i.b.MUX_ERROR, details: i.a.REMUX_ALLOC_ERROR, fatal: !1, bytes: F, reason: "fail allocating video mdat " + F }) } var B = new DataView(p.buffer); B.setUint32(0, F), p.set(R.types.mdat, 4); for (var U = 0; U < b; U++) { for (var j = y[U], G = j.units, $ = 0, z = void 0, K = 0, V = G.length; K < V; K++) { var W = G[K], H = W.data, q = W.data.byteLength; B.setUint32(f, q), f += 4, p.set(H, f), f += q, $ += 4 + q } if (S) z = Math.max(0, h * Math.round((j.pts - j.dts) / h)); else { if (U < b - 1) h = y[U + 1].dts - j.dts; else { var Y = this.config, X = j.dts - y[U > 0 ? U - 1 : U].dts; if (Y.stretchShortVideoTrack) { var Q = Y.maxBufferHole, J = Math.floor(Q * d), Z = (o ? v + o * d : this.nextAudioPts) - j.pts; Z > J ? ((h = Z - X) < 0 && (h = X), a.b.log("It is approximately " + Z / 90 + " ms to the next segment; using duration " + h / 90 + " ms for the last video frame.")) : h = X } else h = X } z = Math.round(j.pts - j.dts) } g.push({ size: $, duration: h, cts: z, flags: { isLeading: 0, isDependedOn: 0, hasRedundancy: 0, degradPrio: 0, dependsOn: j.key ? 2 : 1, isNonSync: j.key ? 0 : 1 } }) } this.nextAvcDts = c + h; var ee = e.dropped; if (e.len = 0, e.nbNalu = 0, e.dropped = 0, g.length && navigator.userAgent.toLowerCase().indexOf("chrome") > -1) { var te = g[0].flags; te.dependsOn = 2, te.isNonSync = 0 } e.samples = g, u = R.moof(e.sequenceNumber++, m, e), e.samples = []; var re = { data1: u, data2: p, startPTS: v / d, endPTS: (l + h) / d, startDTS: m / d, endDTS: this.nextAvcDts / d, type: "video", hasAudio: !1, hasVideo: !0, nb: g.length, dropped: ee }; return this.observer.trigger(n.a.FRAG_PARSING_DATA, re), re } }, e.prototype.remuxAudio = function (e, t, r, o) { var s = e.inputTimeScale, u = e.timescale, l = s / u, c = (e.isAAC ? 1024 : 1152) * l, f = this._PTSNormalize, d = this._initDTS, h = !e.isAAC && this.typeSupported.mpeg, p = void 0, v = void 0, m = void 0, y = void 0, g = void 0, b = void 0, _ = void 0, w = e.samples, E = [], S = this.nextAudioPts; if (r |= w.length && S && (o && Math.abs(t - S / s) < .1 || Math.abs(w[0].pts - S - d) < 20 * c), w.forEach(function (e) { e.pts = e.dts = f(e.pts - d, t * s) }), 0 !== (w = w.filter(function (e) { return e.pts >= 0 })).length) { if (r || (S = o ? t * s : w[0].pts), e.isAAC) for (var k = this.config.maxAudioFramesDrift, A = 0, O = S; A < w.length;) { var L, x = w[A]; L = x.pts - O; var P = Math.abs(1e3 * L / s); if (L <= -k * c) a.b.warn("Dropping 1 audio frame @ " + (O / s).toFixed(3) + "s due to " + Math.round(P) + " ms overlap."), w.splice(A, 1), e.len -= x.unit.length; else if (L >= k * c && P < 1e4 && O) { var C = Math.round(L / c); a.b.warn("Injecting " + C + " audio frame @ " + (O / s).toFixed(3) + "s due to " + Math.round(1e3 * L / s) + " ms gap."); for (var D = 0; D < C; D++) { var I = Math.max(O, 0); (m = T.getSilentFrame(e.manifestCodec || e.codec, e.channelCount)) || (a.b.log("Unable to get silent frame for given audio codec; duplicating last frame instead."), m = x.unit.subarray()), w.splice(A, 0, { unit: m, pts: I, dts: I }), e.len += m.length, O += c, A++ } x.pts = x.dts = O, O += c, A++ } else x.pts = x.dts = O, O += c, A++ } for (var M = 0, N = w.length; M < N; M++) { var F = w[M], B = F.unit, U = F.pts; if (void 0 !== _) v.duration = Math.round((U - _) / l); else { var j = Math.round(1e3 * (U - S) / s), G = 0; if (r && e.isAAC && j) { if (j > 0 && j < 1e4) G = Math.round((U - S) / c), a.b.log(j + " ms hole between AAC samples detected,filling it"), G > 0 && ((m = T.getSilentFrame(e.manifestCodec || e.codec, e.channelCount)) || (m = B.subarray()), e.len += G * m.length); else if (j < -12) { a.b.log("drop overlapping AAC sample, expected/parsed/delta:" + (S / s).toFixed(3) + "s/" + (U / s).toFixed(3) + "s/" + -j + "ms"), e.len -= B.byteLength; continue } U = S } if (b = U, !(e.len > 0)) return; var $ = h ? e.len : e.len + 8; p = h ? 0 : 8; try { y = new Uint8Array($) } catch (e) { return void this.observer.trigger(n.a.ERROR, { type: i.b.MUX_ERROR, details: i.a.REMUX_ALLOC_ERROR, fatal: !1, bytes: $, reason: "fail allocating audio mdat " + $ }) } h || (new DataView(y.buffer).setUint32(0, $), y.set(R.types.mdat, 4)); for (var z = 0; z < G; z++)(m = T.getSilentFrame(e.manifestCodec || e.codec, e.channelCount)) || (a.b.log("Unable to get silent frame for given audio codec; duplicating this frame instead."), m = B.subarray()), y.set(m, p), p += m.byteLength, v = { size: m.byteLength, cts: 0, duration: 1024, flags: { isLeading: 0, isDependedOn: 0, hasRedundancy: 0, degradPrio: 0, dependsOn: 1 } }, E.push(v) } y.set(B, p); var K = B.byteLength; p += K, v = { size: K, cts: 0, duration: 0, flags: { isLeading: 0, isDependedOn: 0, hasRedundancy: 0, degradPrio: 0, dependsOn: 1 } }, E.push(v), _ = U } var V = 0, W = E.length; if (W >= 2 && (V = E[W - 2].duration, v.duration = V), W) { this.nextAudioPts = S = _ + l * V, e.len = 0, e.samples = E, g = h ? new Uint8Array : R.moof(e.sequenceNumber++, b / l, e), e.samples = []; var H = b / s, q = S / s, Y = { data1: g, data2: y, startPTS: H, endPTS: q, startDTS: H, endDTS: q, type: "audio", hasAudio: !0, hasVideo: !1, nb: W }; return this.observer.trigger(n.a.FRAG_PARSING_DATA, Y), Y } return null } }, e.prototype.remuxEmptyAudio = function (e, t, r, n) { var i = e.inputTimeScale, o = i / (e.samplerate ? e.samplerate : i), s = this.nextAudioPts, u = (void 0 !== s ? s : n.startDTS * i) + this._initDTS, l = n.endDTS * i + this._initDTS, c = 1024 * o, f = Math.ceil((l - u) / c), d = T.getSilentFrame(e.manifestCodec || e.codec, e.channelCount); if (a.b.warn("remux empty Audio"), d) { for (var h = [], p = 0; p < f; p++) { var v = u + p * c; h.push({ unit: d, pts: v, dts: v }), e.len += d.length } e.samples = h, this.remuxAudio(e, t, r) } else a.b.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!") }, e.prototype.remuxID3 = function (e, t) { var r = e.samples.length, i = void 0, o = e.inputTimeScale, a = this._initPTS, s = this._initDTS; if (r) { for (var u = 0; u < r; u++)(i = e.samples[u]).pts = (i.pts - a) / o, i.dts = (i.dts - s) / o; this.observer.trigger(n.a.FRAG_PARSING_METADATA, { samples: e.samples }) } e.samples = [], t = t }, e.prototype.remuxText = function (e, t) { e.samples.sort(function (e, t) { return e.pts - t.pts }); var r = e.samples.length, i = void 0, o = e.inputTimeScale, a = this._initPTS; if (r) { for (var s = 0; s < r; s++)(i = e.samples[s]).pts = (i.pts - a) / o; this.observer.trigger(n.a.FRAG_PARSING_USERDATA, { samples: e.samples }) } e.samples = [], t = t }, e.prototype._PTSNormalize = function (e, t) { var r = void 0; if (void 0 === t) return e; for (r = t < e ? -8589934592 : 8589934592; Math.abs(e - t) > 4294967296;)e += r; return e }, e }(); var L = function () { function e(t) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this.observer = t } return e.prototype.destroy = function () { }, e.prototype.resetTimeStamp = function () { }, e.prototype.resetInitSegment = function () { }, e.prototype.remux = function (e, t, r, i, o, a, s, u) { var l = this.observer, c = ""; e && (c += "audio"), t && (c += "video"), l.trigger(n.a.FRAG_PARSING_DATA, { data1: u, startPTS: o, startDTS: o, type: c, hasAudio: !!e, hasVideo: !!t, nb: 1, dropped: 0 }), l.trigger(n.a.FRAG_PARSED) }, e }(); var x = function () { function e(t, r, n, i) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this.observer = t, this.typeSupported = r, this.config = n, this.vendor = i } return e.prototype.destroy = function () { var e = this.demuxer; e && e.destroy() }, e.prototype.push = function (e, t, r, i, a, s, u, l, c, f, d, h) { if (e.byteLength > 0 && null != t && null != t.key && "AES-128" === t.method) { var p = this.decrypter; null == p && (p = this.decrypter = new o.a(this.observer, this.config)); var v = this, m = void 0; try { m = performance.now() } catch (e) { m = Date.now() } p.decrypt(e, t.key.buffer, t.iv.buffer, function (e) { var o = void 0; try { o = performance.now() } catch (e) { o = Date.now() } v.observer.trigger(n.a.FRAG_DECRYPTED, { stats: { tstart: m, tdecrypt: o } }), v.pushDecrypted(new Uint8Array(e), t, new Uint8Array(r), i, a, s, u, l, c, f, d, h) }) } else this.pushDecrypted(new Uint8Array(e), t, new Uint8Array(r), i, a, s, u, l, c, f, d, h) }, e.prototype.pushDecrypted = function (e, t, r, o, a, s, u, l, c, f, d, h) { var p = this.demuxer; if (!p || (u || l) && !this.probe(e)) { for (var v = this.observer, g = this.typeSupported, b = this.config, _ = [{ demux: S, remux: O }, { demux: y.a, remux: L }, { demux: m, remux: O }, { demux: k, remux: O }], w = 0, E = _.length; w < E; w++) { var T = _[w], A = T.demux.probe; if (A(e)) { var R = this.remuxer = new T.remux(v, b, g, this.vendor); p = new T.demux(v, R, b, g), this.probe = A; break } } if (!p) return void v.trigger(n.a.ERROR, { type: i.b.MEDIA_ERROR, details: i.a.FRAG_PARSING_ERROR, fatal: !0, reason: "no demux matching with content found" }); this.demuxer = p } var x = this.remuxer; (u || l) && (p.resetInitSegment(r, o, a, f), x.resetInitSegment()), u && (p.resetTimeStamp(h), x.resetTimeStamp(h)), "function" == typeof p.setDecryptData && p.setDecryptData(t), p.append(e, s, c, d) }, e }(); t.a = x }, function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = {}; r.d(n, "newCue", function () { return Me }); var i = r(3), o = r.n(i), a = r(2), s = r(1), u = r(0), l = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }; var c = new Set(["hlsEventGeneric", "hlsHandlerDestroying", "hlsHandlerDestroyed"]), f = function () { function e(t) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this.hls = t, this.onEvent = this.onEvent.bind(this); for (var r = arguments.length, n = Array(r > 1 ? r - 1 : 0), i = 1; i < r; i++)n[i - 1] = arguments[i]; this.handledEvents = n, this.useGenericHandler = !0, this.registerListeners() } return e.prototype.destroy = function () { this.onHandlerDestroying(), this.unregisterListeners(), this.onHandlerDestroyed() }, e.prototype.onHandlerDestroying = function () { }, e.prototype.onHandlerDestroyed = function () { }, e.prototype.isEventHandler = function () { return "object" === l(this.handledEvents) && this.handledEvents.length && "function" == typeof this.onEvent }, e.prototype.registerListeners = function () { this.isEventHandler() && this.handledEvents.forEach(function (e) { if (c.has(e)) throw new Error("Forbidden event-name: " + e); this.hls.on(e, this.onEvent) }, this) }, e.prototype.unregisterListeners = function () { this.isEventHandler() && this.handledEvents.forEach(function (e) { this.hls.off(e, this.onEvent) }, this) }, e.prototype.onEvent = function (e, t) { this.onEventGeneric(e, t) }, e.prototype.onEventGeneric = function (e, t) { try { (function (e, t) { var r = "on" + e.replace("hls", ""); if ("function" != typeof this[r]) throw new Error("Event " + e + " has no generic handler in this " + this.constructor.name + " class (tried " + r + ")"); return this[r].bind(this, t) }).call(this, e, t).call() } catch (t) { u.b.error("An internal error happened while handling event " + e + '. Error message: "' + t.message + '". Here is a stacktrace:', t), this.hls.trigger(s.a.ERROR, { type: a.b.OTHER_ERROR, details: a.a.INTERNAL_EXCEPTION, fatal: !1, event: e, err: t }) } }, e }(), d = r(7), h = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }(); var p = function () { function e() { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this.method = null, this.key = null, this.iv = null, this._uri = null } return h(e, [{ key: "uri", get: function () { return !this._uri && this.reluri && (this._uri = o.a.buildAbsoluteURL(this.baseuri, this.reluri, { alwaysNormalize: !0 })), this._uri } }]), e }(), v = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }(); var m = function () { function e() { var t; !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this._url = null, this._byteRange = null, this._decryptdata = null, this.tagList = [], this._elementaryStreams = ((t = {})[e.ElementaryStreamTypes.AUDIO] = !1, t[e.ElementaryStreamTypes.VIDEO] = !1, t) } return e.prototype.addElementaryStream = function (e) { this._elementaryStreams[e] = !0 }, e.prototype.hasElementaryStream = function (e) { return !0 === this._elementaryStreams[e] }, e.prototype.createInitializationVector = function (e) { for (var t = new Uint8Array(16), r = 12; r < 16; r++)t[r] = e >> 8 * (15 - r) & 255; return t }, e.prototype.fragmentDecryptdataFromLevelkey = function (e, t) { var r = e; return e && e.method && e.uri && !e.iv && ((r = new p).method = e.method, r.baseuri = e.baseuri, r.reluri = e.reluri, r.iv = this.createInitializationVector(t)), r }, v(e, [{ key: "url", get: function () { return !this._url && this.relurl && (this._url = o.a.buildAbsoluteURL(this.baseurl, this.relurl, { alwaysNormalize: !0 })), this._url }, set: function (e) { this._url = e } }, { key: "programDateTime", get: function () { return !this._programDateTime && this.rawProgramDateTime && (this._programDateTime = new Date(Date.parse(this.rawProgramDateTime))), this._programDateTime } }, { key: "byteRange", get: function () { if (!this._byteRange && !this.rawByteRange) return []; if (this._byteRange) return this._byteRange; var e = []; if (this.rawByteRange) { var t = this.rawByteRange.split("@", 2); if (1 === t.length) { var r = this.lastByteRangeEndOffset; e[0] = r || 0 } else e[0] = parseInt(t[1]); e[1] = parseInt(t[0]) + e[0], this._byteRange = e } return e } }, { key: "byteRangeStartOffset", get: function () { return this.byteRange[0] } }, { key: "byteRangeEndOffset", get: function () { return this.byteRange[1] } }, { key: "decryptdata", get: function () { return this._decryptdata || (this._decryptdata = this.fragmentDecryptdataFromLevelkey(this.levelkey, this.sn)), this._decryptdata } }], [{ key: "ElementaryStreamTypes", get: function () { return { AUDIO: "audio", VIDEO: "video" } } }]), e }(); var y = /^(\d+)x(\d+)$/, g = /\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g, b = function () { function e(t) { for (var r in function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), "string" == typeof t && (t = e.parseAttrList(t)), t) t.hasOwnProperty(r) && (this[r] = t[r]) } return e.prototype.decimalInteger = function (e) { var t = parseInt(this[e], 10); return t > Number.MAX_SAFE_INTEGER ? 1 / 0 : t }, e.prototype.hexadecimalInteger = function (e) { if (this[e]) { var t = (this[e] || "0x").slice(2); t = (1 & t.length ? "0" : "") + t; for (var r = new Uint8Array(t.length / 2), n = 0; n < t.length / 2; n++)r[n] = parseInt(t.slice(2 * n, 2 * n + 2), 16); return r } return null }, e.prototype.hexadecimalIntegerAsNumber = function (e) { var t = parseInt(this[e], 16); return t > Number.MAX_SAFE_INTEGER ? 1 / 0 : t }, e.prototype.decimalFloatingPoint = function (e) { return parseFloat(this[e]) }, e.prototype.enumeratedString = function (e) { return this[e] }, e.prototype.decimalResolution = function (e) { var t = y.exec(this[e]); if (null !== t) return { width: parseInt(t[1], 10), height: parseInt(t[2], 10) } }, e.parseAttrList = function (e) { var t = void 0, r = {}; for (g.lastIndex = 0; null !== (t = g.exec(e));) { var n = t[2]; 0 === n.indexOf('"') && n.lastIndexOf('"') === n.length - 1 && (n = n.slice(1, -1)), r[t[1]] = n } return r }, e }(), _ = { audio: { a3ds: !0, "ac-3": !0, "ac-4": !0, alac: !0, alaw: !0, dra1: !0, "dts+": !0, "dts-": !0, dtsc: !0, dtse: !0, dtsh: !0, "ec-3": !0, enca: !0, g719: !0, g726: !0, m4ae: !0, mha1: !0, mha2: !0, mhm1: !0, mhm2: !0, mlpa: !0, mp4a: !0, "raw ": !0, Opus: !0, samr: !0, sawb: !0, sawp: !0, sevc: !0, sqcp: !0, ssmv: !0, twos: !0, ulaw: !0 }, video: { avc1: !0, avc2: !0, avc3: !0, avc4: !0, avcp: !0, drac: !0, dvav: !0, dvhe: !0, encv: !0, hev1: !0, hvc1: !0, mjp2: !0, mp4v: !0, mvc1: !0, mvc2: !0, mvc3: !0, mvc4: !0, resv: !0, rv60: !0, s263: !0, svc1: !0, svc2: !0, "vc-1": !0, vp08: !0, vp09: !0 } }; function w(e, t) { return MediaSource.isTypeSupported((t || "video") + '/mp4;codecs="' + e + '"') } var E = /#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g, S = /#EXT-X-MEDIA:(.*)/g, k = new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source, /|(?!#)(\S+)/.source, /|#EXT-X-BYTERANGE:*(.+)/.source, /|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source, /|#.*/.source].join(""), "g"), T = /(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/, A = function () { function e() { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e) } return e.findGroup = function (e, t) { if (!e) return null; for (var r = null, n = 0; n < e.length; n++) { var i = e[n]; i.id === t && (r = i) } return r }, e.convertAVC1ToAVCOTI = function (e) { var t = void 0, r = e.split("."); return r.length > 2 ? (t = r.shift() + ".", t += parseInt(r.shift()).toString(16), t += ("000" + parseInt(r.shift()).toString(16)).substr(-4)) : t = e, t }, e.resolve = function (e, t) { return o.a.buildAbsoluteURL(t, e, { alwaysNormalize: !0 }) }, e.parseMasterPlaylist = function (t, r) { var n = [], i = void 0; function o(e, t) { ["video", "audio"].forEach(function (r) { var n = e.filter(function (e) { return function (e, t) { var r = _[t]; return !!r && !0 === r[e.slice(0, 4)] }(e, r) }); if (n.length) { var i = n.filter(function (e) { return 0 === e.lastIndexOf("avc1", 0) || 0 === e.lastIndexOf("mp4a", 0) }); t[r + "Codec"] = i.length > 0 ? i[0] : n[0], e = e.filter(function (e) { return -1 === n.indexOf(e) }) } }), t.unknownCodecs = e } for (E.lastIndex = 0; null != (i = E.exec(t));) { var a = {}, s = a.attrs = new b(i[1]); a.url = e.resolve(i[2], r); var u = s.decimalResolution("RESOLUTION"); u && (a.width = u.width, a.height = u.height), a.bitrate = s.decimalInteger("AVERAGE-BANDWIDTH") || s.decimalInteger("BANDWIDTH"), a.name = s.NAME, o([].concat((s.CODECS || "").split(/[ ,]+/)), a), a.videoCodec && -1 !== a.videoCodec.indexOf("avc1") && (a.videoCodec = e.convertAVC1ToAVCOTI(a.videoCodec)), n.push(a) } return n }, e.parseMasterPlaylistMedia = function (t, r, n) { var i = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : [], o = void 0, a = [], s = 0; for (S.lastIndex = 0; null !== (o = S.exec(t));) { var u = {}, l = new b(o[1]); if (l.TYPE === n) { if (u.groupId = l["GROUP-ID"], u.name = l.NAME, u.type = n, u.default = "YES" === l.DEFAULT, u.autoselect = "YES" === l.AUTOSELECT, u.forced = "YES" === l.FORCED, l.URI && (u.url = e.resolve(l.URI, r)), u.lang = l.LANGUAGE, u.name || (u.name = u.lang), i.length) { var c = e.findGroup(i, u.groupId); u.audioCodec = c ? c.codec : i[0].codec } u.id = s++, a.push(u) } } return a }, e.parseLevelPlaylist = function (e, t, r, n) { var i = 0, o = 0, a = { type: null, version: null, url: t, fragments: [], live: !0, startSN: 0 }, s = new p, l = 0, c = null, f = new m, d = void 0, h = void 0; for (k.lastIndex = 0; null !== (d = k.exec(e));) { var v = d[1]; if (v) { f.duration = parseFloat(v); var y = (" " + d[2]).slice(1); f.title = y || null, f.tagList.push(y ? ["INF", v, y] : ["INF", v]) } else if (d[3]) { if (!isNaN(f.duration)) { var g = i++; f.type = n, f.start = o, f.levelkey = s, f.sn = g, f.level = r, f.cc = l, f.baseurl = t, f.relurl = (" " + d[3]).slice(1), a.programDateTime && (c ? f.rawProgramDateTime ? f.pdt = Date.parse(f.rawProgramDateTime) : f.pdt = c.pdt + 1e3 * c.duration : f.pdt = Date.parse(a.programDateTime), f.endPdt = f.pdt + 1e3 * f.duration), a.fragments.push(f), c = f, o += f.duration, f = new m } } else if (d[4]) { if (f.rawByteRange = (" " + d[4]).slice(1), c) { var _ = c.byteRangeEndOffset; _ && (f.lastByteRangeEndOffset = _) } } else if (d[5]) f.rawProgramDateTime = (" " + d[5]).slice(1), f.tagList.push(["PROGRAM-DATE-TIME", f.rawProgramDateTime]), void 0 === a.programDateTime && (a.programDateTime = new Date(new Date(Date.parse(d[5])) - 1e3 * o)); else { for (d = d[0].match(T), h = 1; h < d.length && void 0 === d[h]; h++); var w = (" " + d[h + 1]).slice(1), E = (" " + d[h + 2]).slice(1); switch (d[h]) { case "#": f.tagList.push(E ? [w, E] : [w]); break; case "PLAYLIST-TYPE": a.type = w.toUpperCase(); break; case "MEDIA-SEQUENCE": i = a.startSN = parseInt(w); break; case "TARGETDURATION": a.targetduration = parseFloat(w); break; case "VERSION": a.version = parseInt(w); break; case "EXTM3U": break; case "ENDLIST": a.live = !1; break; case "DIS": l++, f.tagList.push(["DIS"]); break; case "DISCONTINUITY-SEQ": l = parseInt(w); break; case "KEY": var S = new b(w), A = S.enumeratedString("METHOD"), R = S.URI, O = S.hexadecimalInteger("IV"); A && (s = new p, R && ["AES-128", "SAMPLE-AES", "SAMPLE-AES-CENC"].indexOf(A) >= 0 && (s.method = A, s.baseuri = t, s.reluri = R, s.key = null, s.iv = O)); break; case "START": var L = new b(w).decimalFloatingPoint("TIME-OFFSET"); isNaN(L) || (a.startTimeOffset = L); break; case "MAP": var x = new b(w); f.relurl = x.URI, f.rawByteRange = x.BYTERANGE, f.baseurl = t, f.level = r, f.type = n, f.sn = "initSegment", a.initSegment = f, f = new m; break; default: u.b.warn("line parsed but not handled: " + d) } } } return (f = c) && !f.relurl && (a.fragments.pop(), o -= f.duration), a.totalduration = o, a.averagetargetduration = o / a.fragments.length, a.endSN = i - 1, a.startCC = a.fragments[0] ? a.fragments[0].cc : 0, a.endCC = l, !a.initSegment && a.fragments.length && a.fragments.every(function (e) { return e.relurl.endsWith(".mp4") }) && (u.b.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"), (f = new m).relurl = a.fragments[0].relurl, f.baseurl = t, f.level = r, f.type = n, f.sn = "initSegment", a.initSegment = f, a.needSidxRanges = !0), a }, e }(), R = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }(); var O = { MANIFEST: "manifest", LEVEL: "level", AUDIO_TRACK: "audioTrack", SUBTITLE_TRACK: "subtitleTrack" }, L = { MAIN: "main", AUDIO: "audio", SUBTITLE: "subtitle" }, x = function (e) { function t(r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); var n = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, e.call(this, r, s.a.MANIFEST_LOADING, s.a.LEVEL_LOADING, s.a.AUDIO_TRACK_LOADING, s.a.SUBTITLE_TRACK_LOADING)); return n.loaders = {}, n } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, e), t.canHaveQualityLevels = function (e) { return e !== O.AUDIO_TRACK && e !== O.SUBTITLE_TRACK }, t.mapContextToLevelType = function (e) { switch (e.type) { case O.AUDIO_TRACK: return L.AUDIO; case O.SUBTITLE_TRACK: return L.SUBTITLE; default: return L.MAIN } }, t.getResponseUrl = function (e, t) { var r = e.url; return void 0 !== r && 0 !== r.indexOf("data:") || (r = t.url), r }, t.prototype.createInternalLoader = function (e) { var t = this.hls.config, r = t.pLoader, n = t.loader, i = new (r || n)(t); return e.loader = i, this.loaders[e.type] = i, i }, t.prototype.getInternalLoader = function (e) { return this.loaders[e.type] }, t.prototype.resetInternalLoader = function (e) { this.loaders[e] && delete this.loaders[e] }, t.prototype.destroyInternalLoaders = function () { for (var e in this.loaders) { var t = this.loaders[e]; t && t.destroy(), this.resetInternalLoader(e) } }, t.prototype.destroy = function () { this.destroyInternalLoaders(), e.prototype.destroy.call(this) }, t.prototype.onManifestLoading = function (e) { this.load(e.url, { type: O.MANIFEST }) }, t.prototype.onLevelLoading = function (e) { this.load(e.url, { type: O.LEVEL, level: e.level, id: e.id }) }, t.prototype.onAudioTrackLoading = function (e) { this.load(e.url, { type: O.AUDIO_TRACK, id: e.id }) }, t.prototype.onSubtitleTrackLoading = function (e) { this.load(e.url, { type: O.SUBTITLE_TRACK, id: e.id }) }, t.prototype.load = function (e, t) { var r = this.hls.config, n = this.getInternalLoader(t); if (n) { var i = n.context; if (i && i.url === e) return u.b.trace("playlist request ongoing"), !1; u.b.warn("aborting previous loader for type: " + t.type), n.abort() } var o = void 0, a = void 0, s = void 0, l = void 0; switch (t.type) { case O.MANIFEST: o = r.manifestLoadingMaxRetry, a = r.manifestLoadingTimeOut, s = r.manifestLoadingRetryDelay, l = r.manifestLoadingMaxRetryTimeout; break; case O.LEVEL: o = 0, a = r.levelLoadingTimeOut; break; default: o = r.levelLoadingMaxRetry, a = r.levelLoadingTimeOut, s = r.levelLoadingRetryDelay, l = r.levelLoadingMaxRetryTimeout, u.b.log("Playlist loader for " + t.type + " " + (t.level || t.id)) }n = this.createInternalLoader(t), t.url = e, t.responseType = t.responseType || ""; var c, f; return c = { timeout: a, maxRetry: o, retryDelay: s, maxRetryDelay: l }, f = { onSuccess: this.loadsuccess.bind(this), onError: this.loaderror.bind(this), onTimeout: this.loadtimeout.bind(this) }, n.load(t, c, f), !0 }, t.prototype.loadsuccess = function (e, t, r) { var n = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : null; if (r.isSidxRequest) return this._handleSidxRequest(e, r), void this._handlePlaylistLoaded(e, t, r, n); this.resetInternalLoader(r.type); var i = e.data; t.tload = performance.now(), 0 === i.indexOf("#EXTM3U") ? i.indexOf("#EXTINF:") > 0 || i.indexOf("#EXT-X-TARGETDURATION:") > 0 ? this._handleTrackOrLevelPlaylist(e, t, r, n) : this._handleMasterPlaylist(e, t, r, n) : this._handleManifestParsingError(e, r, "no EXTM3U delimiter", n) }, t.prototype.loaderror = function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null; this._handleNetworkError(t, r) }, t.prototype.loadtimeout = function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null; this._handleNetworkError(t, r, !0) }, t.prototype._handleMasterPlaylist = function (e, r, n, i) { var o = this.hls, a = e.data, l = t.getResponseUrl(e, n), c = A.parseMasterPlaylist(a, l); if (c.length) { var f = c.map(function (e) { return { id: e.attrs.AUDIO, codec: e.audioCodec } }), d = A.parseMasterPlaylistMedia(a, l, "AUDIO", f), h = A.parseMasterPlaylistMedia(a, l, "SUBTITLES"); if (d.length) { var p = !1; d.forEach(function (e) { e.url || (p = !0) }), !1 === p && c[0].audioCodec && !c[0].attrs.AUDIO && (u.b.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"), d.unshift({ type: "main", name: "main" })) } o.trigger(s.a.MANIFEST_LOADED, { levels: c, audioTracks: d, subtitles: h, url: l, stats: r, networkDetails: i }) } else this._handleManifestParsingError(e, n, "no level found in manifest", i) }, t.prototype._handleTrackOrLevelPlaylist = function (e, r, n, i) { var o = this.hls, a = n.id, u = n.level, l = n.type, c = t.getResponseUrl(e, n), f = isNaN(u) ? isNaN(a) ? 0 : a : u, d = t.mapContextToLevelType(n), h = A.parseLevelPlaylist(e.data, c, f, d); if (h.tload = r.tload, l === O.MANIFEST) { var p = { url: c, details: h }; o.trigger(s.a.MANIFEST_LOADED, { levels: [p], audioTracks: [], url: c, stats: r, networkDetails: i }) } if (r.tparsed = performance.now(), h.needSidxRanges) { var v = h.initSegment.url; this.load(v, { isSidxRequest: !0, type: l, level: u, levelDetails: h, id: a, rangeStart: 0, rangeEnd: 2048, responseType: "arraybuffer" }) } else n.levelDetails = h, this._handlePlaylistLoaded(e, r, n, i) }, t.prototype._handleSidxRequest = function (e, t) { var r = d.a.parseSegmentIndex(new Uint8Array(e.data)); r.references.forEach(function (e, r) { var n = e.info, i = t.levelDetails.fragments[r]; 0 === i.byteRange.length && (i.rawByteRange = String(1 + n.end - n.start) + "@" + String(n.start)) }), t.levelDetails.initSegment.rawByteRange = String(r.moovEndOffset) + "@0" }, t.prototype._handleManifestParsingError = function (e, t, r, n) { this.hls.trigger(s.a.ERROR, { type: a.b.NETWORK_ERROR, details: a.a.MANIFEST_PARSING_ERROR, fatal: !0, url: e.url, reason: r, networkDetails: n }) }, t.prototype._handleNetworkError = function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] && arguments[2], n = void 0, i = void 0, o = this.getInternalLoader(e); switch (e.type) { case O.MANIFEST: n = r ? a.a.MANIFEST_LOAD_TIMEOUT : a.a.MANIFEST_LOAD_ERROR, i = !0; break; case O.LEVEL: n = r ? a.a.LEVEL_LOAD_TIMEOUT : a.a.LEVEL_LOAD_ERROR, i = !1; break; case O.AUDIO_TRACK: n = r ? a.a.AUDIO_TRACK_LOAD_TIMEOUT : a.a.AUDIO_TRACK_LOAD_ERROR, i = !1; break; default: i = !1 }o && (o.abort(), this.resetInternalLoader(e.type)), this.hls.trigger(s.a.ERROR, { type: a.b.NETWORK_ERROR, details: n, fatal: i, url: o.url, loader: o, context: e, networkDetails: t }) }, t.prototype._handlePlaylistLoaded = function (e, r, n, i) { var o = n.type, a = n.level, u = n.id, l = n.levelDetails; if (l.targetduration) if (t.canHaveQualityLevels(n.type)) this.hls.trigger(s.a.LEVEL_LOADED, { details: l, level: a || 0, id: u || 0, stats: r, networkDetails: i }); else switch (o) { case O.AUDIO_TRACK: this.hls.trigger(s.a.AUDIO_TRACK_LOADED, { details: l, id: u, stats: r, networkDetails: i }); break; case O.SUBTITLE_TRACK: this.hls.trigger(s.a.SUBTITLE_TRACK_LOADED, { details: l, id: u, stats: r, networkDetails: i }) } else this._handleManifestParsingError(e, n, "invalid target duration", i) }, R(t, null, [{ key: "ContextType", get: function () { return O } }, { key: "LevelType", get: function () { return L } }]), t }(f); var P = function (e) { function t(r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); var n = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, e.call(this, r, s.a.FRAG_LOADING)); return n.loaders = {}, n } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, e), t.prototype.destroy = function () { var t = this.loaders; for (var r in t) { var n = t[r]; n && n.destroy() } this.loaders = {}, e.prototype.destroy.call(this) }, t.prototype.onFragLoading = function (e) { var t = e.frag, r = t.type, n = this.loaders, i = this.hls.config, o = i.fLoader, a = i.loader; t.loaded = 0; var s = n[r]; s && (u.b.warn("abort previous fragment loader for type: " + r), s.abort()), s = n[r] = t.loader = i.fLoader ? new o(i) : new a(i); var l, c, f = void 0; f = { url: t.url, frag: t, responseType: "arraybuffer", progressData: !1 }; var d = t.byteRangeStartOffset, h = t.byteRangeEndOffset; isNaN(d) || isNaN(h) || (f.rangeStart = d, f.rangeEnd = h), l = { timeout: i.fragLoadingTimeOut, maxRetry: 0, retryDelay: 0, maxRetryDelay: i.fragLoadingMaxRetryTimeout }, c = { onSuccess: this.loadsuccess.bind(this), onError: this.loaderror.bind(this), onTimeout: this.loadtimeout.bind(this), onProgress: this.loadprogress.bind(this) }, s.load(f, l, c) }, t.prototype.loadsuccess = function (e, t, r) { var n = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : null, i = e.data, o = r.frag; o.loader = void 0, this.loaders[o.type] = void 0, this.hls.trigger(s.a.FRAG_LOADED, { payload: i, frag: o, stats: t, networkDetails: n }) }, t.prototype.loaderror = function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null, n = t.loader; n && n.abort(), this.loaders[t.type] = void 0, this.hls.trigger(s.a.ERROR, { type: a.b.NETWORK_ERROR, details: a.a.FRAG_LOAD_ERROR, fatal: !1, frag: t.frag, response: e, networkDetails: r }) }, t.prototype.loadtimeout = function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null, n = t.loader; n && n.abort(), this.loaders[t.type] = void 0, this.hls.trigger(s.a.ERROR, { type: a.b.NETWORK_ERROR, details: a.a.FRAG_LOAD_TIMEOUT, fatal: !1, frag: t.frag, networkDetails: r }) }, t.prototype.loadprogress = function (e, t, r) { var n = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : null, i = t.frag; i.loaded = e.loaded, this.hls.trigger(s.a.FRAG_LOAD_PROGRESS, { frag: i, stats: e, networkDetails: n }) }, t }(f); var C = function (e) { function t(r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); var n = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, e.call(this, r, s.a.KEY_LOADING)); return n.loaders = {}, n.decryptkey = null, n.decrypturl = null, n } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, e), t.prototype.destroy = function () { for (var e in this.loaders) { var t = this.loaders[e]; t && t.destroy() } this.loaders = {}, f.prototype.destroy.call(this) }, t.prototype.onKeyLoading = function (e) { var t = e.frag, r = t.type, n = this.loaders[r], i = t.decryptdata, o = i.uri; if (o !== this.decrypturl || null === this.decryptkey) { var a = this.hls.config; n && (u.b.warn("abort previous key loader for type:" + r), n.abort()), t.loader = this.loaders[r] = new a.loader(a), this.decrypturl = o, this.decryptkey = null; var l, c, f; l = { url: o, frag: t, responseType: "arraybuffer" }, c = { timeout: a.fragLoadingTimeOut, maxRetry: a.fragLoadingMaxRetry, retryDelay: a.fragLoadingRetryDelay, maxRetryDelay: a.fragLoadingMaxRetryTimeout }, f = { onSuccess: this.loadsuccess.bind(this), onError: this.loaderror.bind(this), onTimeout: this.loadtimeout.bind(this) }, t.loader.load(l, c, f) } else this.decryptkey && (i.key = this.decryptkey, this.hls.trigger(s.a.KEY_LOADED, { frag: t })) }, t.prototype.loadsuccess = function (e, t, r) { var n = r.frag; this.decryptkey = n.decryptdata.key = new Uint8Array(e.data), n.loader = void 0, this.loaders[n.type] = void 0, this.hls.trigger(s.a.KEY_LOADED, { frag: n }) }, t.prototype.loaderror = function (e, t) { var r = t.frag, n = r.loader; n && n.abort(), this.loaders[t.type] = void 0, this.hls.trigger(s.a.ERROR, { type: a.b.NETWORK_ERROR, details: a.a.KEY_LOAD_ERROR, fatal: !1, frag: r, response: e }) }, t.prototype.loadtimeout = function (e, t) { var r = t.frag, n = r.loader; n && n.abort(), this.loaders[t.type] = void 0, this.hls.trigger(s.a.ERROR, { type: a.b.NETWORK_ERROR, details: a.a.KEY_LOAD_TIMEOUT, fatal: !1, frag: r }) }, t }(f), D = { search: function (e, t) { for (var r = 0, n = e.length - 1, i = null, o = null; r <= n;) { var a = t(o = e[i = (r + n) / 2 | 0]); if (a > 0) r = i + 1; else { if (!(a < 0)) return o; n = i - 1 } } return null } }, I = { isBuffered: function (e, t) { try { if (e) for (var r = e.buffered, n = 0; n < r.length; n++)if (t >= r.start(n) && t <= r.end(n)) return !0 } catch (e) { } return !1 }, bufferInfo: function (e, t, r) { try { if (e) { var n = e.buffered, i = [], o = void 0; for (o = 0; o < n.length; o++)i.push({ start: n.start(o), end: n.end(o) }); return this.bufferedInfo(i, t, r) } } catch (e) { } return { len: 0, start: t, end: t, nextStart: void 0 } }, bufferedInfo: function (e, t, r) { var n = [], i = void 0, o = void 0, a = void 0, s = void 0, u = void 0; for (e.sort(function (e, t) { var r = e.start - t.start; return r || t.end - e.end }), u = 0; u < e.length; u++) { var l = n.length; if (l) { var c = n[l - 1].end; e[u].start - c < r ? e[u].end > c && (n[l - 1].end = e[u].end) : n.push(e[u]) } else n.push(e[u]) } for (u = 0, i = 0, o = a = t; u < n.length; u++) { var f = n[u].start, d = n[u].end; if (t + r >= f && t < d) o = f, i = (a = d) - t; else if (t + r < f) { s = f; break } } return { len: i, start: o, end: a, nextStart: s } } }, M = r(8), N = r(6), F = r.n(N), B = r(10), U = r.n(B); function j() { if ("undefined" != typeof window) return window.MediaSource || window.WebKitMediaSource } var G = j(), $ = function () { function e(t, r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this.hls = t, this.id = r; var n = this.observer = new F.a, i = t.config; n.trigger = function (e) { for (var t = arguments.length, r = Array(t > 1 ? t - 1 : 0), i = 1; i < t; i++)r[i - 1] = arguments[i]; n.emit.apply(n, [e, e].concat(r)) }, n.off = function (e) { for (var t = arguments.length, r = Array(t > 1 ? t - 1 : 0), i = 1; i < t; i++)r[i - 1] = arguments[i]; n.removeListener.apply(n, [e].concat(r)) }; var o = function (e, r) { (r = r || {}).frag = this.frag, r.id = this.id, t.trigger(e, r) }.bind(this); n.on(s.a.FRAG_DECRYPTED, o), n.on(s.a.FRAG_PARSING_INIT_SEGMENT, o), n.on(s.a.FRAG_PARSING_DATA, o), n.on(s.a.FRAG_PARSED, o), n.on(s.a.ERROR, o), n.on(s.a.FRAG_PARSING_METADATA, o), n.on(s.a.FRAG_PARSING_USERDATA, o), n.on(s.a.INIT_PTS_FOUND, o); var l = { mp4: G.isTypeSupported("video/mp4"), mpeg: G.isTypeSupported("audio/mpeg"), mp3: G.isTypeSupported('audio/mp4; codecs="mp3"') }, c = navigator.vendor; if (i.enableWorker && "undefined" != typeof Worker) { u.b.log("demuxing in webworker"); var f = void 0; try { f = this.w = U()(11), this.onwmsg = this.onWorkerMessage.bind(this), f.addEventListener("message", this.onwmsg), f.onerror = function (e) { t.trigger(s.a.ERROR, { type: a.b.OTHER_ERROR, details: a.a.INTERNAL_EXCEPTION, fatal: !0, event: "demuxerWorker", err: { message: e.message + " (" + e.filename + ":" + e.lineno + ")" } }) }, f.postMessage({ cmd: "init", typeSupported: l, vendor: c, id: r, config: JSON.stringify(i) }) } catch (e) { u.b.error("error while initializing DemuxerWorker, fallback on DemuxerInline"), f && URL.revokeObjectURL(f.objectURL), this.demuxer = new M.a(n, l, i, c), this.w = void 0 } } else this.demuxer = new M.a(n, l, i, c) } return e.prototype.destroy = function () { var e = this.w; if (e) e.removeEventListener("message", this.onwmsg), e.terminate(), this.w = null; else { var t = this.demuxer; t && (t.destroy(), this.demuxer = null) } var r = this.observer; r && (r.removeAllListeners(), this.observer = null) }, e.prototype.push = function (e, t, r, n, i, o, a, s) { var l = this.w, c = isNaN(i.startDTS) ? i.start : i.startDTS, f = i.decryptdata, d = this.frag, h = !(d && i.cc === d.cc), p = !(d && i.level === d.level), v = d && i.sn === d.sn + 1, m = !p && v; if (h && u.b.log(this.id + ":discontinuity detected"), p && u.b.log(this.id + ":switch detected"), this.frag = i, l) l.postMessage({ cmd: "demux", data: e, decryptdata: f, initSegment: t, audioCodec: r, videoCodec: n, timeOffset: c, discontinuity: h, trackSwitch: p, contiguous: m, duration: o, accurateTimeOffset: a, defaultInitPTS: s }, e instanceof ArrayBuffer ? [e] : []); else { var y = this.demuxer; y && y.push(e, f, t, r, n, c, h, p, m, o, a, s) } }, e.prototype.onWorkerMessage = function (e) { var t = e.data, r = this.hls; switch (t.event) { case "init": URL.revokeObjectURL(this.w.objectURL); break; case s.a.FRAG_PARSING_DATA: t.data.data1 = new Uint8Array(t.data1), t.data2 && (t.data.data2 = new Uint8Array(t.data2)); default: t.data = t.data || {}, t.data.frag = this.frag, t.data.id = this.id, r.trigger(t.event, t.data) } }, e }(); var z = "NOT_LOADED", K = "APPENDING", V = "PARTIAL", W = "OK", H = function (e) { function t(r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); var n = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, e.call(this, r, s.a.BUFFER_APPENDED, s.a.FRAG_BUFFERED, s.a.FRAG_LOADED)); return n.bufferPadding = .2, n.fragments = Object.create(null), n.timeRanges = Object.create(null), n.config = r.config, n } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, e), t.prototype.destroy = function () { this.fragments = null, this.timeRanges = null, this.config = null, f.prototype.destroy.call(this), e.prototype.destroy.call(this) }, t.prototype.getBufferedFrag = function (e, t) { var r = this.fragments, n = Object.keys(r).filter(function (n) { var i = r[n]; if (i.body.type !== t) return !1; if (!i.buffered) return !1; var o = i.body; return o.startPTS <= e && e <= o.endPTS }); if (0 === n.length) return null; var i = n.pop(); return r[i].body }, t.prototype.detectEvictedFragments = function (e, t) { var r = this, n = void 0, i = void 0; Object.keys(this.fragments).forEach(function (o) { var a = r.fragments[o]; if (!0 === a.buffered) { var s = a.range[e]; if (s) { n = s.time; for (var u = 0; u < n.length; u++)if (i = n[u], !1 === r.isTimeBuffered(i.startPTS, i.endPTS, t)) { r.removeFragment(a.body); break } } } }) }, t.prototype.detectPartialFragments = function (e) { var t = this, r = this.getFragmentKey(e), n = this.fragments[r]; n && (n.buffered = !0, Object.keys(this.timeRanges).forEach(function (r) { if (!0 === e.hasElementaryStream(r)) { var i = t.timeRanges[r]; n.range[r] = t.getBufferedTimes(e.startPTS, e.endPTS, i) } })) }, t.prototype.getBufferedTimes = function (e, t, r) { for (var n = [], i = void 0, o = void 0, a = !1, s = 0; s < r.length; s++) { if (i = r.start(s) - this.bufferPadding, o = r.end(s) + this.bufferPadding, e >= i && t <= o) { n.push({ startPTS: Math.max(e, r.start(s)), endPTS: Math.min(t, r.end(s)) }); break } if (e < o && t > i) n.push({ startPTS: Math.max(e, r.start(s)), endPTS: Math.min(t, r.end(s)) }), a = !0; else if (t <= i) break } return { time: n, partial: a } }, t.prototype.getFragmentKey = function (e) { return e.type + "_" + e.level + "_" + e.sn }, t.prototype.getPartialFragment = function (e) { var t = this, r = void 0, n = void 0, i = void 0, o = null, a = 0; return Object.keys(this.fragments).forEach(function (s) { var u = t.fragments[s]; t.isPartial(u) && (n = u.body.startPTS - t.bufferPadding, i = u.body.endPTS + t.bufferPadding, e >= n && e <= i && (r = Math.min(e - n, i - e), a <= r && (o = u.body, a = r))) }), o }, t.prototype.getState = function (e) { var t = this.getFragmentKey(e), r = this.fragments[t], n = z; return void 0 !== r && (n = r.buffered ? !0 === this.isPartial(r) ? V : W : K), n }, t.prototype.isPartial = function (e) { return !0 === e.buffered && (void 0 !== e.range.video && !0 === e.range.video.partial || void 0 !== e.range.audio && !0 === e.range.audio.partial) }, t.prototype.isTimeBuffered = function (e, t, r) { for (var n = void 0, i = void 0, o = 0; o < r.length; o++) { if (n = r.start(o) - this.bufferPadding, i = r.end(o) + this.bufferPadding, e >= n && t <= i) return !0; if (t <= n) return !1 } return !1 }, t.prototype.onFragLoaded = function (e) { var t = e.frag; if (!isNaN(t.sn)) { var r = this.getFragmentKey(t), n = { body: t, range: Object.create(null), buffered: !1 }; this.fragments[r] = n } }, t.prototype.onBufferAppended = function (e) { var t = this; this.timeRanges = e.timeRanges, Object.keys(this.timeRanges).forEach(function (e) { var r = t.timeRanges[e]; t.detectEvictedFragments(e, r) }) }, t.prototype.onFragBuffered = function (e) { this.detectPartialFragments(e.frag) }, t.prototype.hasFragment = function (e) { var t = this.getFragmentKey(e); return void 0 !== this.fragments[t] }, t.prototype.removeFragment = function (e) { var t = this.getFragmentKey(e); delete this.fragments[t] }, t.prototype.removeAllFragments = function () { this.fragments = Object.create(null) }, t }(f); function q(e, t, r) { var n = e[t], i = e[r], o = i.startPTS; isNaN(o) ? i.start = r > t ? n.start + n.duration : Math.max(n.start - i.duration, 0) : r > t ? (n.duration = o - n.start, n.duration < 0 && u.b.warn("negative duration computed for frag " + n.sn + ",level " + n.level + ", there should be some duration drift between playlist and fragment!")) : (i.duration = n.start - o, i.duration < 0 && u.b.warn("negative duration computed for frag " + i.sn + ",level " + i.level + ", there should be some duration drift between playlist and fragment!")) } function Y(e, t, r, n, i, o) { var a = r; if (!isNaN(t.startPTS)) { var s = Math.abs(t.startPTS - r); isNaN(t.deltaPTS) ? t.deltaPTS = s : t.deltaPTS = Math.max(s, t.deltaPTS), a = Math.max(r, t.startPTS), r = Math.min(r, t.startPTS), n = Math.max(n, t.endPTS), i = Math.min(i, t.startDTS), o = Math.max(o, t.endDTS) } var u = r - t.start; t.start = t.startPTS = r, t.maxStartPTS = a, t.endPTS = n, t.startDTS = i, t.endDTS = o, t.duration = n - r; var l = t.sn; if (!e || l < e.startSN || l > e.endSN) return 0; var c, f = void 0, d = void 0; for (c = l - e.startSN, (f = e.fragments)[c] = t, d = c; d > 0; d--)q(f, d, d - 1); for (d = c; d < f.length - 1; d++)q(f, d, d + 1); return e.PTSKnown = !0, u } function X(e, t) { var r = Math.max(e.startSN, t.startSN) - t.startSN, n = Math.min(e.endSN, t.endSN) - t.startSN, i = t.startSN - e.startSN, o = e.fragments, a = t.fragments, s = 0, l = void 0; if (t.initSegment && e.initSegment && (t.initSegment = e.initSegment), n < r) t.PTSKnown = !1; else { for (var c = r; c <= n; c++) { var f = o[i + c], d = a[c]; d && f && (s = f.cc - d.cc, isNaN(f.startPTS) || (d.start = d.startPTS = f.startPTS, d.endPTS = f.endPTS, d.duration = f.duration, d.backtracked = f.backtracked, d.dropped = f.dropped, l = d)) } if (s) for (u.b.log("discontinuity sliding from playlist, take drift into account"), c = 0; c < a.length; c++)a[c].cc += s; if (l) Y(t, l, l.startPTS, l.endPTS, l.startDTS, l.endDTS); else if (i >= 0 && i < o.length) { var h = o[i].start; for (c = 0; c < a.length; c++)a[c].start += h } t.PTSKnown = e.PTSKnown } } var Q = { toString: function (e) { for (var t = "", r = e.length, n = 0; n < r; n++)t += "[" + e.start(n).toFixed(3) + "," + e.end(n).toFixed(3) + "]"; return t } }; function J(e, t) { t.fragments.forEach(function (t) { if (t) { var r = t.start + e; t.start = t.startPTS = r, t.endPTS = r + t.duration } }), t.PTSKnown = !0 } function Z(e, t, r) { if (function (e, t, r) { var n = !1; return t && t.details && r && (r.endCC > r.startCC || e && e.cc < r.startCC) && (n = !0), n }(e, t, r)) { var n = function (e, t) { var r = e.fragments, n = t.fragments; if (n.length && r.length) { var i = function (e, t) { for (var r = null, n = 0; n < e.length; n += 1) { var i = e[n]; if (i && i.cc === t) { r = i; break } } return r }(r, n[0].cc); if (i && (!i || i.startPTS)) return i; u.b.log("No frag in previous level to align on") } else u.b.log("No fragments to align") }(t.details, r); n && (u.b.log("Adjusting PTS using last level due to CC increase within current level"), J(n.start, r)) } if (!1 === r.PTSKnown && t && t.details && t.details.fragments && t.details.fragments.length) { var i = t.details.programDateTime, o = (r.programDateTime - i) / 1e3 + t.details.fragments[0].start; isNaN(o) || (u.b.log("adjusting PTS using programDateTime delta, sliding:" + o.toFixed(3)), J(o, r)) } } var ee = function (e) { function t(r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); for (var n = arguments.length, i = Array(n > 1 ? n - 1 : 0), o = 1; o < n; o++)i[o - 1] = arguments[o]; var a = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, e.call.apply(e, [this, r].concat(i))); return a._tickInterval = null, a._tickCallCount = 0, a } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, e), t.prototype.destroy = function () { this.clearInterval(), e.prototype.destroy.call(this) }, t.prototype.hasInterval = function () { return null !== this._tickInterval }, t.prototype.setInterval = function (e) { function t(t) { return e.apply(this, arguments) } return t.toString = function () { return e.toString() }, t }(function (e) { return !this._tickInterval && (this._tickInterval = setInterval(this.tick.bind(this, !1), e), !0) }), t.prototype.clearInterval = function (e) { function t() { return e.apply(this, arguments) } return t.toString = function () { return e.toString() }, t }(function () { return !!this._tickInterval && (clearInterval(this._tickInterval), this._tickInterval = null, !0) }), t.prototype.tick = function () { this._tickCallCount++, 1 === this._tickCallCount && (this.doTick(), this._tickCallCount > 1 && setTimeout(this.tick.bind(this), 0), this._tickCallCount = 0) }, t.prototype.doTick = function () { throw new Error("TaskLoop is abstract and `doLoop` must be implemented") }, t }(f), te = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }(); var re = { STOPPED: "STOPPED", IDLE: "IDLE", KEY_LOADING: "KEY_LOADING", FRAG_LOADING: "FRAG_LOADING", FRAG_LOADING_WAITING_RETRY: "FRAG_LOADING_WAITING_RETRY", WAITING_LEVEL: "WAITING_LEVEL", PARSING: "PARSING", PARSED: "PARSED", BUFFER_FLUSHING: "BUFFER_FLUSHING", ENDED: "ENDED", ERROR: "ERROR" }, ne = function (e) { function t(r, n) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); var i = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, e.call(this, r, s.a.MEDIA_ATTACHED, s.a.MEDIA_DETACHING, s.a.MANIFEST_LOADING, s.a.MANIFEST_PARSED, s.a.LEVEL_LOADED, s.a.KEY_LOADED, s.a.FRAG_LOADED, s.a.FRAG_LOAD_EMERGENCY_ABORTED, s.a.FRAG_PARSING_INIT_SEGMENT, s.a.FRAG_PARSING_DATA, s.a.FRAG_PARSED, s.a.ERROR, s.a.AUDIO_TRACK_SWITCHING, s.a.AUDIO_TRACK_SWITCHED, s.a.BUFFER_CREATED, s.a.BUFFER_APPENDED, s.a.BUFFER_FLUSHED)); return i.fragmentTracker = n, i.config = r.config, i.audioCodecSwap = !1, i._state = re.STOPPED, i } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, e), t.prototype.onHandlerDestroying = function () { this.stopLoad() }, t.prototype.onHandlerDestroyed = function () { this.state = re.STOPPED, this.fragmentTracker = null }, t.prototype.startLoad = function (e) { if (this.levels) { var t = this.lastCurrentTime, r = this.hls; if (this.stopLoad(), this.setInterval(100), this.level = -1, this.fragLoadError = 0, !this.startFragRequested) { var n = r.startLevel; -1 === n && (n = 0, this.bitrateTest = !0), this.level = r.nextLoadLevel = n, this.loadedmetadata = !1 } t > 0 && -1 === e && (u.b.log("override startPosition with lastCurrentTime @" + t.toFixed(3)), e = t), this.state = re.IDLE, this.nextLoadPosition = this.startPosition = this.lastCurrentTime = e, this.tick() } else this.forceStartLoad = !0, this.state = re.STOPPED }, t.prototype.stopLoad = function () { var e = this.fragCurrent; e && (e.loader && e.loader.abort(), this.fragmentTracker.removeFragment(e), this.fragCurrent = null), this.fragPrevious = null, this.demuxer && (this.demuxer.destroy(), this.demuxer = null), this.clearInterval(), this.state = re.STOPPED, this.forceStartLoad = !1 }, t.prototype.doTick = function () { switch (this.state) { case re.BUFFER_FLUSHING: this.fragLoadError = 0; break; case re.IDLE: this._doTickIdle(); break; case re.WAITING_LEVEL: var e = this.levels[this.level]; e && e.details && (this.state = re.IDLE); break; case re.FRAG_LOADING_WAITING_RETRY: var t = performance.now(), r = this.retryDate; (!r || t >= r || this.media && this.media.seeking) && (u.b.log("mediaController: retryDate reached, switch back to IDLE state"), this.state = re.IDLE); break; case re.ERROR: case re.STOPPED: case re.FRAG_LOADING: case re.PARSING: case re.PARSED: case re.ENDED: }this._checkBuffer(), this._checkFragmentChanged() }, t.prototype._doTickIdle = function () { var e = this.hls, t = e.config, r = this.media; if (void 0 !== this.levelLastLoaded && (r || !this.startFragRequested && t.startFragPrefetch)) { var n = void 0; n = this.loadedmetadata ? r.currentTime : this.nextLoadPosition; var i = e.nextLoadLevel, o = this.levels[i]; if (o) { var a = o.bitrate, l = void 0; l = a ? Math.max(8 * t.maxBufferSize / a, t.maxBufferLength) : t.maxBufferLength, l = Math.min(l, t.maxMaxBufferLength); var c = I.bufferInfo(this.mediaBuffer ? this.mediaBuffer : r, n, t.maxBufferHole), f = c.len; if (!(f >= l)) { u.b.trace("buffer length of " + f.toFixed(3) + " is below max of " + l.toFixed(3) + ". checking for more payload ..."), this.level = e.nextLoadLevel = i; var d = o.details; if (void 0 === d || !0 === d.live && this.levelLastLoaded !== i) this.state = re.WAITING_LEVEL; else { var h = this.fragPrevious; if (!d.live && h && !h.backtracked && h.sn === d.endSN && !c.nextStart) if (Math.min(r.duration, h.start + h.duration) - Math.max(c.end, h.start) <= Math.max(.2, h.duration)) { var p = {}; return this.altAudio && (p.type = "video"), this.hls.trigger(s.a.BUFFER_EOS, p), void (this.state = re.ENDED) } this._fetchPayloadOrEos(n, c, d) } } } } }, t.prototype._fetchPayloadOrEos = function (e, t, r) { var n = this.fragPrevious, i = this.level, o = r.fragments, a = o.length; if (0 !== a) { var s = o[0].start, l = o[a - 1].start + o[a - 1].duration, c = t.end, f = void 0; if (r.initSegment && !r.initSegment.data) f = r.initSegment; else if (r.live) { var d = this.config.initialLiveManifestSize; if (a < d) return void u.b.warn("Can not start playback of a level, reason: not enough fragments " + a + " < " + d); if (null === (f = this._ensureFragmentAtLivePoint(r, c, s, l, n, o, a))) return } else c < s && (f = o[0]); f || (f = this._findFragment(s, n, a, o, c, l, r)), f && this._loadFragmentOrKey(f, i, r, e, c) } }, t.prototype._ensureFragmentAtLivePoint = function (e, t, r, n, i, o, a) { var s = this.hls.config, l = this.media, c = void 0, f = void 0 !== s.liveMaxLatencyDuration ? s.liveMaxLatencyDuration : s.liveMaxLatencyDurationCount * e.targetduration; if (t < Math.max(r - s.maxFragLookUpTolerance, n - f)) { var d = this.liveSyncPosition = this.computeLivePosition(r, e); u.b.log("buffer end: " + t.toFixed(3) + " is located too far from the end of live sliding playlist, reset currentTime to : " + d.toFixed(3)), t = d, l && l.readyState && l.duration > d && (l.currentTime = d), this.nextLoadPosition = d } if (e.PTSKnown && t > n && l && l.readyState) return null; if (this.startFragRequested && !e.PTSKnown) { if (i) if (e.programDateTime) c = this._findFragmentByPDT(o, i.endPdt + 1); else { var h = i.sn + 1; if (h >= e.startSN && h <= e.endSN) { var p = o[h - e.startSN]; i.cc === p.cc && (c = p, u.b.log("live playlist, switching playlist, load frag with next SN: " + c.sn)) } c || (c = D.search(o, function (e) { return i.cc - e.cc })) && u.b.log("live playlist, switching playlist, load frag with same CC: " + c.sn) } c || (c = o[Math.min(a - 1, Math.round(a / 2))], u.b.log("live playlist, switching playlist, unknown, load middle frag : " + c.sn)) } return c }, t.prototype._findFragmentByPDT = function (e, t) { if (!e || void 0 === t) return null; if (t < e[0].pdt) return null; if (t >= e[e.length - 1].endPdt) return null; for (var r = 0; r < e.length; ++r) { var n = e[r]; if (t < n.endPdt) return n } return null }, t.prototype._findFragmentBySN = function (e, t, r, n) { var i = void 0, o = this.hls.config.maxFragLookUpTolerance, a = e ? t[e.sn - t[0].sn + 1] : void 0, s = function (e) { var t = Math.min(o, e.duration + (e.deltaPTS ? e.deltaPTS : 0)); return e.start + e.duration - t <= r ? 1 : e.start - t > r && e.start ? -1 : 0 }; return r < n && (r > n - o && (o = 0), i = a && !s(a) ? a : D.search(t, s)), i }, t.prototype._findFragment = function (e, t, r, n, i, o, a) { var s = this.hls.config, l = void 0, c = void 0; if (c = i < o ? a.programDateTime ? this._findFragmentByPDT(n, 1e3 * i + (a.programDateTime ? Date.parse(a.programDateTime) : 0) - 1e3 * e) : this._findFragmentBySN(t, n, i, o) : n[r - 1]) { var f = (l = c).sn - a.startSN, d = t && l.level === t.level, h = n[f - 1], p = n[f + 1]; if (t && l.sn === t.sn) if (d && !l.backtracked) if (l.sn < a.endSN) { var v = t.deltaPTS; v && v > s.maxBufferHole && t.dropped && f ? (l = h, u.b.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")) : (l = p, u.b.log("SN just loaded, load next one: " + l.sn)) } else l = null; else l.backtracked && (p && p.backtracked ? (u.b.warn("Already backtracked from fragment " + p.sn + ", will not backtrack to fragment " + l.sn + ". Loading fragment " + p.sn), l = p) : (u.b.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"), l.dropped = 0, h ? (l = h).backtracked = !0 : f && (l = null))) } return l }, t.prototype._loadFragmentOrKey = function (e, t, r, n, i) { if (e.decryptdata && null != e.decryptdata.uri && null == e.decryptdata.key) u.b.log("Loading key for " + e.sn + " of [" + r.startSN + " ," + r.endSN + "],level " + t), this.state = re.KEY_LOADING, this.hls.trigger(s.a.KEY_LOADING, { frag: e }); else { u.b.log("Loading " + e.sn + " of [" + r.startSN + " ," + r.endSN + "],level " + t + ", currentTime:" + n.toFixed(3) + ",bufferEnd:" + i.toFixed(3)); var o = this.fragmentTracker.getState(e); this.fragCurrent = e, this.startFragRequested = !0, isNaN(e.sn) || e.bitrateTest || (this.nextLoadPosition = e.start + e.duration), e.backtracked || o === z ? (e.autoLevel = this.hls.autoLevelEnabled, e.bitrateTest = this.bitrateTest, this.hls.trigger(s.a.FRAG_LOADING, { frag: e }), this.demuxer || (this.demuxer = new $(this.hls, "main")), this.state = re.FRAG_LOADING) : o === K && this._reduceMaxBufferLength(e.duration) && this.fragmentTracker.removeFragment(e) } }, t.prototype.getBufferedFrag = function (e) { return this.fragmentTracker.getBufferedFrag(e, x.LevelType.MAIN) }, t.prototype.followingBufferedFrag = function (e) { return e ? this.getBufferedFrag(e.endPTS + .5) : null }, t.prototype._checkFragmentChanged = function () { var e = void 0, t = void 0, r = this.media; if (r && r.readyState && !1 === r.seeking && ((t = r.currentTime) > r.playbackRate * this.lastCurrentTime && (this.lastCurrentTime = t), I.isBuffered(r, t) ? e = this.getBufferedFrag(t) : I.isBuffered(r, t + .1) && (e = this.getBufferedFrag(t + .1)), e)) { var n = e; if (n !== this.fragPlaying) { this.hls.trigger(s.a.FRAG_CHANGED, { frag: n }); var i = n.level; this.fragPlaying && this.fragPlaying.level === i || this.hls.trigger(s.a.LEVEL_SWITCHED, { level: i }), this.fragPlaying = n } } }, t.prototype.immediateLevelSwitch = function () { if (u.b.log("immediateLevelSwitch"), !this.immediateSwitch) { this.immediateSwitch = !0; var e = this.media, t = void 0; e ? (t = e.paused, e.pause()) : t = !0, this.previouslyPaused = t } var r = this.fragCurrent; r && r.loader && r.loader.abort(), this.fragCurrent = null, this.flushMainBuffer(0, Number.POSITIVE_INFINITY) }, t.prototype.immediateLevelSwitchEnd = function () { var e = this.media; e && e.buffered.length && (this.immediateSwitch = !1, I.isBuffered(e, e.currentTime) && (e.currentTime -= 1e-4), this.previouslyPaused || e.play()) }, t.prototype.nextLevelSwitch = function () { var e = this.media; if (e && e.readyState) { var t, r = void 0, n = void 0; if ((t = this.getBufferedFrag(e.currentTime)) && t.startPTS > 1 && this.flushMainBuffer(0, t.startPTS - 1), e.paused) r = 0; else { var i = this.hls.nextLoadLevel, o = this.levels[i], a = this.fragLastKbps; r = a && this.fragCurrent ? this.fragCurrent.duration * o.bitrate / (1e3 * a) + 1 : 0 } if ((n = this.getBufferedFrag(e.currentTime + r)) && (n = this.followingBufferedFrag(n))) { var s = this.fragCurrent; s && s.loader && s.loader.abort(), this.fragCurrent = null, this.flushMainBuffer(n.maxStartPTS, Number.POSITIVE_INFINITY) } } }, t.prototype.flushMainBuffer = function (e, t) { this.state = re.BUFFER_FLUSHING; var r = { startOffset: e, endOffset: t }; this.altAudio && (r.type = "video"), this.hls.trigger(s.a.BUFFER_FLUSHING, r) }, t.prototype.onMediaAttached = function (e) { var t = this.media = this.mediaBuffer = e.media; this.onvseeking = this.onMediaSeeking.bind(this), this.onvseeked = this.onMediaSeeked.bind(this), this.onvended = this.onMediaEnded.bind(this), t.addEventListener("seeking", this.onvseeking), t.addEventListener("seeked", this.onvseeked), t.addEventListener("ended", this.onvended); var r = this.config; this.levels && r.autoStartLoad && this.hls.startLoad(r.startPosition) }, t.prototype.onMediaDetaching = function () { var e = this.media; e && e.ended && (u.b.log("MSE detaching and video ended, reset startPosition"), this.startPosition = this.lastCurrentTime = 0); var t = this.levels; t && t.forEach(function (e) { e.details && e.details.fragments.forEach(function (e) { e.backtracked = void 0 }) }), e && (e.removeEventListener("seeking", this.onvseeking), e.removeEventListener("seeked", this.onvseeked), e.removeEventListener("ended", this.onvended), this.onvseeking = this.onvseeked = this.onvended = null), this.media = this.mediaBuffer = null, this.loadedmetadata = !1, this.stopLoad() }, t.prototype.onMediaSeeking = function () { var e = this.media, t = e ? e.currentTime : void 0, r = this.config; isNaN(t) || u.b.log("media seeking to " + t.toFixed(3)); var n = this.mediaBuffer ? this.mediaBuffer : e, i = I.bufferInfo(n, t, this.config.maxBufferHole); if (this.state === re.FRAG_LOADING) { var o = this.fragCurrent; if (0 === i.len && o) { var a = r.maxFragLookUpTolerance, s = o.start - a, l = o.start + o.duration + a; t < s || t > l ? (o.loader && (u.b.log("seeking outside of buffer while fragment load in progress, cancel fragment load"), o.loader.abort()), this.fragCurrent = null, this.fragPrevious = null, this.state = re.IDLE) : u.b.log("seeking outside of buffer but within currently loaded fragment range") } } else this.state === re.ENDED && (0 === i.len && (this.fragPrevious = 0), this.state = re.IDLE); e && (this.lastCurrentTime = t), this.loadedmetadata || (this.nextLoadPosition = this.startPosition = t), this.tick() }, t.prototype.onMediaSeeked = function () { var e = this.media, t = e ? e.currentTime : void 0; isNaN(t) || u.b.log("media seeked to " + t.toFixed(3)), this.tick() }, t.prototype.onMediaEnded = function () { u.b.log("media ended"), this.startPosition = this.lastCurrentTime = 0 }, t.prototype.onManifestLoading = function () { u.b.log("trigger BUFFER_RESET"), this.hls.trigger(s.a.BUFFER_RESET), this.fragmentTracker.removeAllFragments(), this.stalled = !1, this.startPosition = this.lastCurrentTime = 0 }, t.prototype.onManifestParsed = function (e) { var t = !1, r = !1, n = void 0; e.levels.forEach(function (e) { (n = e.audioCodec) && (-1 !== n.indexOf("mp4a.40.2") && (t = !0), -1 !== n.indexOf("mp4a.40.5") && (r = !0)) }), this.audioCodecSwitch = t && r, this.audioCodecSwitch && u.b.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"), this.levels = e.levels, this.startFragRequested = !1; var i = this.config; (i.autoStartLoad || this.forceStartLoad) && this.hls.startLoad(i.startPosition) }, t.prototype.onLevelLoaded = function (e) { var t = e.details, r = e.level, n = this.levels[this.levelLastLoaded], i = this.levels[r], o = t.totalduration, a = 0; if (u.b.log("level " + r + " loaded [" + t.startSN + "," + t.endSN + "],duration:" + o), t.live) { var l = i.details; l && t.fragments.length > 0 ? (X(l, t), a = t.fragments[0].start, this.liveSyncPosition = this.computeLivePosition(a, l), t.PTSKnown && !isNaN(a) ? u.b.log("live playlist sliding:" + a.toFixed(3)) : (u.b.log("live playlist - outdated PTS, unknown sliding"), Z(this.fragPrevious, n, t))) : (u.b.log("live playlist - first load, unknown sliding"), t.PTSKnown = !1, Z(this.fragPrevious, n, t)) } else t.PTSKnown = !1; if (i.details = t, this.levelLastLoaded = r, this.hls.trigger(s.a.LEVEL_UPDATED, { details: t, level: r }), !1 === this.startFragRequested) { if (-1 === this.startPosition || -1 === this.lastCurrentTime) { var c = t.startTimeOffset; isNaN(c) ? t.live ? (this.startPosition = this.computeLivePosition(a, t), u.b.log("configure startPosition to " + this.startPosition)) : this.startPosition = 0 : (c < 0 && (u.b.log("negative start time offset " + c + ", count from end of last fragment"), c = a + o + c), u.b.log("start time offset found in playlist, adjust startPosition to " + c), this.startPosition = c), this.lastCurrentTime = this.startPosition } this.nextLoadPosition = this.startPosition } this.state === re.WAITING_LEVEL && (this.state = re.IDLE), this.tick() }, t.prototype.onKeyLoaded = function () { this.state === re.KEY_LOADING && (this.state = re.IDLE, this.tick()) }, t.prototype.onFragLoaded = function (e) { var t = this.fragCurrent, r = e.frag; if (this.state === re.FRAG_LOADING && t && "main" === r.type && r.level === t.level && r.sn === t.sn) { var n = e.stats, i = this.levels[t.level], o = i.details; if (u.b.log("Loaded  " + t.sn + " of [" + o.startSN + " ," + o.endSN + "],level " + t.level), this.bitrateTest = !1, this.stats = n, !0 === r.bitrateTest && this.hls.nextLoadLevel) this.state = re.IDLE, this.startFragRequested = !1, n.tparsed = n.tbuffered = performance.now(), this.hls.trigger(s.a.FRAG_BUFFERED, { stats: n, frag: t, id: "main" }), this.tick(); else if ("initSegment" === r.sn) this.state = re.IDLE, n.tparsed = n.tbuffered = performance.now(), o.initSegment.data = e.payload, this.hls.trigger(s.a.FRAG_BUFFERED, { stats: n, frag: t, id: "main" }), this.tick(); else { this.state = re.PARSING; var a = o.totalduration, l = t.level, c = t.sn, f = this.config.defaultAudioCodec || i.audioCodec; this.audioCodecSwap && (u.b.log("swapping playlist audio codec"), void 0 === f && (f = this.lastAudioCodec), f && (f = -1 !== f.indexOf("mp4a.40.5") ? "mp4a.40.2" : "mp4a.40.5")), this.pendingBuffering = !0, this.appended = !1, u.b.log("Parsing " + c + " of [" + o.startSN + " ," + o.endSN + "],level " + l + ", cc " + t.cc); var d = this.demuxer; d || (d = this.demuxer = new $(this.hls, "main")); var h = this.media, p = !(h && h.seeking) && (o.PTSKnown || !o.live), v = o.initSegment ? o.initSegment.data : []; d.push(e.payload, v, f, i.videoCodec, t, a, p, void 0) } } this.fragLoadError = 0 }, t.prototype.onFragParsingInitSegment = function (e) { var t = this.fragCurrent, r = e.frag; if (t && "main" === e.id && r.sn === t.sn && r.level === t.level && this.state === re.PARSING) { var n = e.tracks, i = void 0, o = void 0; if (n.audio && this.altAudio && delete n.audio, o = n.audio) { var a = this.levels[this.level].audioCodec, l = navigator.userAgent.toLowerCase(); a && this.audioCodecSwap && (u.b.log("swapping playlist audio codec"), a = -1 !== a.indexOf("mp4a.40.5") ? "mp4a.40.2" : "mp4a.40.5"), this.audioCodecSwitch && 1 !== o.metadata.channelCount && -1 === l.indexOf("firefox") && (a = "mp4a.40.5"), -1 !== l.indexOf("android") && "audio/mpeg" !== o.container && (a = "mp4a.40.2", u.b.log("Android: force audio codec to " + a)), o.levelCodec = a, o.id = e.id } for (i in (o = n.video) && (o.levelCodec = this.levels[this.level].videoCodec, o.id = e.id), this.hls.trigger(s.a.BUFFER_CODECS, n), n) { o = n[i], u.b.log("main track:" + i + ",container:" + o.container + ",codecs[level/parsed]=[" + o.levelCodec + "/" + o.codec + "]"); var c = o.initSegment; c && (this.appended = !0, this.pendingBuffering = !0, this.hls.trigger(s.a.BUFFER_APPENDING, { type: i, data: c, parent: "main", content: "initSegment" })) } this.tick() } }, t.prototype.onFragParsingData = function (e) { var t = this, r = this.fragCurrent, n = e.frag; if (r && "main" === e.id && n.sn === r.sn && n.level === r.level && ("audio" !== e.type || !this.altAudio) && this.state === re.PARSING) { var i = this.levels[this.level], o = r; if (isNaN(e.endPTS) && (e.endPTS = e.startPTS + r.duration, e.endDTS = e.startDTS + r.duration), !0 === e.hasAudio && o.addElementaryStream(m.ElementaryStreamTypes.AUDIO), !0 === e.hasVideo && o.addElementaryStream(m.ElementaryStreamTypes.VIDEO), u.b.log("Parsed " + e.type + ",PTS:[" + e.startPTS.toFixed(3) + "," + e.endPTS.toFixed(3) + "],DTS:[" + e.startDTS.toFixed(3) + "/" + e.endDTS.toFixed(3) + "],nb:" + e.nb + ",dropped:" + (e.dropped || 0)), "video" === e.type) if (o.dropped = e.dropped, o.dropped) if (o.backtracked) u.b.warn("Already backtracked on this fragment, appending with the gap"); else { var a = i.details; if (!a || o.sn !== a.startSN) return u.b.warn("missing video frame(s), backtracking fragment"), this.fragmentTracker.removeFragment(o), o.backtracked = !0, this.nextLoadPosition = e.startPTS, this.state = re.IDLE, this.fragPrevious = o, void this.tick(); u.b.warn("missing video frame(s) on first frag, appending with gap") } else o.backtracked = !1; var l = Y(i.details, o, e.startPTS, e.endPTS, e.startDTS, e.endDTS), c = this.hls; c.trigger(s.a.LEVEL_PTS_UPDATED, { details: i.details, level: this.level, drift: l, type: e.type, start: e.startPTS, end: e.endPTS }), [e.data1, e.data2].forEach(function (r) { r && r.length && t.state === re.PARSING && (t.appended = !0, t.pendingBuffering = !0, c.trigger(s.a.BUFFER_APPENDING, { type: e.type, data: r, parent: "main", content: "data" })) }), this.tick() } }, t.prototype.onFragParsed = function (e) { var t = this.fragCurrent, r = e.frag; t && "main" === e.id && r.sn === t.sn && r.level === t.level && this.state === re.PARSING && (this.stats.tparsed = performance.now(), this.state = re.PARSED, this._checkAppendedParsed()) }, t.prototype.onAudioTrackSwitching = function (e) { var t = !!e.url, r = e.id; if (!t) { if (this.mediaBuffer !== this.media) { u.b.log("switching on main audio, use media.buffered to schedule main fragment loading"), this.mediaBuffer = this.media; var n = this.fragCurrent; n.loader && (u.b.log("switching to main audio track, cancel main fragment load"), n.loader.abort()), this.fragCurrent = null, this.fragPrevious = null, this.demuxer && (this.demuxer.destroy(), this.demuxer = null), this.state = re.IDLE } var i = this.hls; i.trigger(s.a.BUFFER_FLUSHING, { startOffset: 0, endOffset: Number.POSITIVE_INFINITY, type: "audio" }), i.trigger(s.a.AUDIO_TRACK_SWITCHED, { id: r }), this.altAudio = !1 } }, t.prototype.onAudioTrackSwitched = function (e) { var t = e.id, r = !!this.hls.audioTracks[t].url; if (r) { var n = this.videoBuffer; n && this.mediaBuffer !== n && (u.b.log("switching on alternate audio, use video.buffered to schedule main fragment loading"), this.mediaBuffer = n) } this.altAudio = r, this.tick() }, t.prototype.onBufferCreated = function (e) { var t = e.tracks, r = void 0, n = void 0, i = !1; for (var o in t) { var a = t[o]; "main" === a.id ? (n = o, r = a, "video" === o && (this.videoBuffer = t[o].buffer)) : i = !0 } i && r ? (u.b.log("alternate track found, use " + n + ".buffered to schedule main fragment loading"), this.mediaBuffer = r.buffer) : this.mediaBuffer = this.media }, t.prototype.onBufferAppended = function (e) { if ("main" === e.parent) { var t = this.state; t !== re.PARSING && t !== re.PARSED || (this.pendingBuffering = e.pending > 0, this._checkAppendedParsed()) } }, t.prototype._checkAppendedParsed = function () { if (!(this.state !== re.PARSED || this.appended && this.pendingBuffering)) { var e = this.fragCurrent; if (e) { var t = this.mediaBuffer ? this.mediaBuffer : this.media; u.b.log("main buffered : " + Q.toString(t.buffered)), this.fragPrevious = e; var r = this.stats; r.tbuffered = performance.now(), this.fragLastKbps = Math.round(8 * r.total / (r.tbuffered - r.tfirst)), this.hls.trigger(s.a.FRAG_BUFFERED, { stats: r, frag: e, id: "main" }), this.state = re.IDLE } this.tick() } }, t.prototype.onError = function (e) { var t = e.frag || this.fragCurrent; if (!t || "main" === t.type) { var r = !!this.media && I.isBuffered(this.media, this.media.currentTime) && I.isBuffered(this.media, this.media.currentTime + .5); switch (e.details) { case a.a.FRAG_LOAD_ERROR: case a.a.FRAG_LOAD_TIMEOUT: case a.a.KEY_LOAD_ERROR: case a.a.KEY_LOAD_TIMEOUT: if (!e.fatal) if (this.fragLoadError + 1 <= this.config.fragLoadingMaxRetry) { var n = Math.min(Math.pow(2, this.fragLoadError) * this.config.fragLoadingRetryDelay, this.config.fragLoadingMaxRetryTimeout); u.b.warn("mediaController: frag loading failed, retry in " + n + " ms"), this.retryDate = performance.now() + n, this.loadedmetadata || (this.startFragRequested = !1, this.nextLoadPosition = this.startPosition), this.fragLoadError++, this.state = re.FRAG_LOADING_WAITING_RETRY } else u.b.error("mediaController: " + e.details + " reaches max retry, redispatch as fatal ..."), e.fatal = !0, this.state = re.ERROR; break; case a.a.LEVEL_LOAD_ERROR: case a.a.LEVEL_LOAD_TIMEOUT: this.state !== re.ERROR && (e.fatal ? (this.state = re.ERROR, u.b.warn("streamController: " + e.details + ",switch to " + this.state + " state ...")) : e.levelRetry || this.state !== re.WAITING_LEVEL || (this.state = re.IDLE)); break; case a.a.BUFFER_FULL_ERROR: "main" !== e.parent || this.state !== re.PARSING && this.state !== re.PARSED || (r ? (this._reduceMaxBufferLength(this.config.maxBufferLength), this.state = re.IDLE) : (u.b.warn("buffer full error also media.currentTime is not buffered, flush everything"), this.fragCurrent = null, this.flushMainBuffer(0, Number.POSITIVE_INFINITY))) } } }, t.prototype._reduceMaxBufferLength = function (e) { var t = this.config; return t.maxMaxBufferLength >= e && (t.maxMaxBufferLength /= 2, u.b.warn("main:reduce max buffer length to " + t.maxMaxBufferLength + "s"), !0) }, t.prototype._checkBuffer = function () { var e = this.media, t = this.config; if (e && e.readyState) { var r = e.currentTime, n = (this.mediaBuffer ? this.mediaBuffer : e).buffered; if (!this.loadedmetadata && n.length) { this.loadedmetadata = !0; var i = e.seeking ? r : this.startPosition; r !== i && (u.b.log("target start position not buffered, seek to buffered.start(0) " + i + " from current time" + r + " "), e.currentTime = i) } else if (this.immediateSwitch) this.immediateLevelSwitchEnd(); else { var o = I.bufferInfo(e, r, t.maxBufferHole), l = !(e.paused && e.readyState > 1 || e.ended || 0 === e.buffered.length); if (r !== this.lastCurrentTime) this.stallReported && (u.b.warn("playback not stuck anymore @" + r + ", after " + Math.round(performance.now() - this.stalled) + "ms"), this.stallReported = !1), this.stalled = void 0, this.nudgeRetry = 0; else if (l) { var c = performance.now(), f = this.hls; if (this.stalled) { var d = c - this.stalled, h = o.len, p = this.nudgeRetry || 0, v = this.fragmentTracker.getPartialFragment(r); if (null !== v) for (var m = 0, y = 0; y < e.buffered.length; y++) { var g = e.buffered.start(y); if (r >= m && r < g) return e.currentTime = Math.max(g, e.currentTime + .1), u.b.warn("skipping hole, adjusting currentTime from " + r + " to " + e.currentTime), this.stalled = void 0, void f.trigger(s.a.ERROR, { type: a.b.MEDIA_ERROR, details: a.a.BUFFER_SEEK_OVER_HOLE, fatal: !1, reason: "fragment loaded with buffer holes, seeking from " + r + " to " + e.currentTime, frag: v }); m = e.buffered.end(y) } if (h > .5 && d > 1e3 * t.highBufferWatchdogPeriod) if (this.stallReported || (this.stallReported = !0, u.b.warn("playback stalling in high buffer @" + r), f.trigger(s.a.ERROR, { type: a.b.MEDIA_ERROR, details: a.a.BUFFER_STALLED_ERROR, fatal: !1, buffer: h })), this.stalled = void 0, this.nudgeRetry = ++p, p < t.nudgeMaxRetry) { var b = e.currentTime, _ = b + p * t.nudgeOffset; u.b.log("adjust currentTime from " + b + " to " + _), e.currentTime = _, f.trigger(s.a.ERROR, { type: a.b.MEDIA_ERROR, details: a.a.BUFFER_NUDGE_ON_STALL, fatal: !1 }) } else u.b.error("still stuck in high buffer @" + r + " after " + t.nudgeMaxRetry + ", raise fatal error"), f.trigger(s.a.ERROR, { type: a.b.MEDIA_ERROR, details: a.a.BUFFER_STALLED_ERROR, fatal: !0 }) } else this.stalled = c, this.stallReported = !1 } } } }, t.prototype.onFragLoadEmergencyAborted = function () { this.state = re.IDLE, this.loadedmetadata || (this.startFragRequested = !1, this.nextLoadPosition = this.startPosition), this.tick() }, t.prototype.onBufferFlushed = function () { var e = this.mediaBuffer ? this.mediaBuffer : this.media; this.fragmentTracker.detectEvictedFragments(m.ElementaryStreamTypes.VIDEO, e.buffered), this.state = re.IDLE, this.fragPrevious = null }, t.prototype.swapAudioCodec = function () { this.audioCodecSwap = !this.audioCodecSwap }, t.prototype.computeLivePosition = function (e, t) { var r = void 0 !== this.config.liveSyncDuration ? this.config.liveSyncDuration : this.config.liveSyncDurationCount * t.targetduration; return e + Math.max(0, t.totalduration - r) }, te(t, [{ key: "state", set: function (e) { if (this.state !== e) { var t = this.state; this._state = e, u.b.log("main stream:" + t + "->" + e), this.hls.trigger(s.a.STREAM_STATE_TRANSITION, { previousState: t, nextState: e }) } }, get: function () { return this._state } }, { key: "currentLevel", get: function () { var e = this.media; if (e) { var t = this.getBufferedFrag(e.currentTime); if (t) return t.level } return -1 } }, { key: "nextBufferedFrag", get: function () { var e = this.media; return e ? this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)) : null } }, { key: "nextLevel", get: function () { var e = this.nextBufferedFrag; return e ? e.level : -1 } }, { key: "liveSyncPosition", get: function () { return this._liveSyncPosition }, set: function (e) { this._liveSyncPosition = e } }]), t }(ee), ie = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }(); var oe = function (e) { function t(r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); var n = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, e.call(this, r, s.a.MANIFEST_LOADED, s.a.LEVEL_LOADED, s.a.FRAG_LOADED, s.a.ERROR)); return n.canload = !1, n.currentLevelIndex = null, n.manualLevelIndex = -1, n.timer = null, n } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, e), t.prototype.onHandlerDestroying = function () { this.cleanTimer(), this.manualLevelIndex = -1 }, t.prototype.cleanTimer = function () { null !== this.timer && (clearTimeout(this.timer), this.timer = null) }, t.prototype.startLoad = function () { var e = this._levels; this.canload = !0, this.levelRetryCount = 0, e && e.forEach(function (e) { e.loadError = 0; var t = e.details; t && t.live && (e.details = void 0) }), null !== this.timer && this.loadLevel() }, t.prototype.stopLoad = function () { this.canload = !1 }, t.prototype.onManifestLoaded = function (e) { var t = [], r = void 0, n = {}, i = null, o = !1, l = !1, c = /chrome|firefox/.test(navigator.userAgent.toLowerCase()), f = []; if (e.levels.forEach(function (e) { e.loadError = 0, e.fragmentError = !1, o = o || !!e.videoCodec, l = l || !!e.audioCodec || !(!e.attrs || !e.attrs.AUDIO), !0 === c && e.audioCodec && -1 !== e.audioCodec.indexOf("mp4a.40.34") && (e.audioCodec = void 0), void 0 === (i = n[e.bitrate]) ? (e.url = [e.url], e.urlId = 0, n[e.bitrate] = e, t.push(e)) : i.url.push(e.url) }), !0 === o && !0 === l && (t = t.filter(function (e) { return !!e.videoCodec })), t = t.filter(function (e) { var t = e.audioCodec, r = e.videoCodec; return (!t || w(t)) && (!r || w(r)) }), e.audioTracks && (f = e.audioTracks.filter(function (e) { return !e.audioCodec || w(e.audioCodec, "audio") })), t.length > 0) { r = t[0].bitrate, t.sort(function (e, t) { return e.bitrate - t.bitrate }), this._levels = t; for (var d = 0; d < t.length; d++)if (t[d].bitrate === r) { this._firstLevel = d, u.b.log("manifest loaded," + t.length + " level(s) found, first bitrate:" + r); break } this.hls.trigger(s.a.MANIFEST_PARSED, { levels: t, audioTracks: f, firstLevel: this._firstLevel, stats: e.stats, audio: l, video: o, altAudio: f.length > 0 }) } else this.hls.trigger(s.a.ERROR, { type: a.b.MEDIA_ERROR, details: a.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR, fatal: !0, url: this.hls.url, reason: "no level with compatible codecs found in manifest" }) }, t.prototype.setLevelInternal = function (e) { var t = this._levels, r = this.hls; if (e >= 0 && e < t.length) { if (this.cleanTimer(), this.currentLevelIndex !== e) { u.b.log("switching to level " + e), this.currentLevelIndex = e; var n = t[e]; n.level = e, r.trigger(s.a.LEVEL_SWITCHING, n) } var i = t[e], o = i.details; if (!o || !0 === o.live) { var l = i.urlId; r.trigger(s.a.LEVEL_LOADING, { url: i.url[l], level: e, id: l }) } } else r.trigger(s.a.ERROR, { type: a.b.OTHER_ERROR, details: a.a.LEVEL_SWITCH_ERROR, level: e, fatal: !1, reason: "invalid level idx" }) }, t.prototype.onError = function (e) { if (!0 !== e.fatal) { var t = !1, r = !1, n = void 0; switch (e.details) { case a.a.FRAG_LOAD_ERROR: case a.a.FRAG_LOAD_TIMEOUT: case a.a.KEY_LOAD_ERROR: case a.a.KEY_LOAD_TIMEOUT: n = e.frag.level, r = !0; break; case a.a.LEVEL_LOAD_ERROR: case a.a.LEVEL_LOAD_TIMEOUT: n = e.context.level, t = !0; break; case a.a.REMUX_ALLOC_ERROR: n = e.level, t = !0 }void 0 !== n && this.recoverLevel(e, n, t, r) } else e.type === a.b.NETWORK_ERROR && this.cleanTimer() }, t.prototype.recoverLevel = function (e, t, r, n) { var i = this, o = this.hls.config, a = e.details, s = this._levels[t], l = void 0, c = void 0, f = void 0; if (s.loadError++, s.fragmentError = n, !0 === r) { if (!(this.levelRetryCount + 1 <= o.levelLoadingMaxRetry)) return u.b.error("level controller, cannot recover from " + a + " error"), this.currentLevelIndex = null, this.cleanTimer(), void (e.fatal = !0); c = Math.min(Math.pow(2, this.levelRetryCount) * o.levelLoadingRetryDelay, o.levelLoadingMaxRetryTimeout), this.timer = setTimeout(function () { return i.loadLevel() }, c), e.levelRetry = !0, this.levelRetryCount++, u.b.warn("level controller, " + a + ", retry in " + c + " ms, current retry count is " + this.levelRetryCount) } !0 !== r && !0 !== n || ((l = s.url.length) > 1 && s.loadError < l ? (u.b.warn("level controller, " + a + " for level " + t + ": switching to redundant stream id " + s.urlId), s.urlId = (s.urlId + 1) % l, s.details = void 0) : -1 === this.manualLevelIndex ? (f = 0 === t ? this._levels.length - 1 : t - 1, u.b.warn("level controller, " + a + ": switch to " + f), this.hls.nextAutoLevel = this.currentLevelIndex = f) : !0 === n && (u.b.warn("level controller, " + a + ": reload a fragment"), this.currentLevelIndex = null)) }, t.prototype.onFragLoaded = function (e) { var t = e.frag; if (void 0 !== t && "main" === t.type) { var r = this._levels[t.level]; void 0 !== r && (r.fragmentError = !1, r.loadError = 0, this.levelRetryCount = 0) } }, t.prototype.onLevelLoaded = function (e) { var t = this, r = e.level; if (r === this.currentLevelIndex) { var n = this._levels[r]; !1 === n.fragmentError && (n.loadError = 0, this.levelRetryCount = 0); var i = e.details; if (i.live) { var o = 1e3 * (i.averagetargetduration ? i.averagetargetduration : i.targetduration), a = o, s = n.details; s && i.endSN === s.endSN && (a /= 2, u.b.log("same live playlist, reload twice faster")), a -= performance.now() - e.stats.trequest, a = Math.max(o / 2, Math.round(a)), u.b.log("live playlist, reload in " + Math.round(a) + " ms"), this.timer = setTimeout(function () { return t.loadLevel() }, a) } else this.cleanTimer() } }, t.prototype.loadLevel = function () { var e = void 0, t = void 0; null !== this.currentLevelIndex && !0 === this.canload && void 0 !== (e = this._levels[this.currentLevelIndex]) && e.url.length > 0 && (t = e.urlId, this.hls.trigger(s.a.LEVEL_LOADING, { url: e.url[t], level: this.currentLevelIndex, id: t })) }, ie(t, [{ key: "levels", get: function () { return this._levels } }, { key: "level", get: function () { return this.currentLevelIndex }, set: function (e) { var t = this._levels; t && (e = Math.min(e, t.length - 1), this.currentLevelIndex === e && void 0 !== t[e].details || this.setLevelInternal(e)) } }, { key: "manualLevel", get: function () { return this.manualLevelIndex }, set: function (e) { this.manualLevelIndex = e, void 0 === this._startLevel && (this._startLevel = e), -1 !== e && (this.level = e) } }, { key: "firstLevel", get: function () { return this._firstLevel }, set: function (e) { this._firstLevel = e } }, { key: "startLevel", get: function () { if (void 0 === this._startLevel) { var e = this.hls.config.startLevel; return void 0 !== e ? e : this._firstLevel } return this._startLevel }, set: function (e) { this._startLevel = e } }, { key: "nextLoadLevel", get: function () { return -1 !== this.manualLevelIndex ? this.manualLevelIndex : this.hls.nextAutoLevel }, set: function (e) { this.level = e, -1 === this.manualLevelIndex && (this.hls.nextAutoLevel = e) } }]), t }(f), ae = r(4); function se(e, t) { var r = null; try { r = new window.Event("addtrack") } catch (e) { (r = document.createEvent("Event")).initEvent("addtrack", !1, !1) } r.track = e, t.dispatchEvent(r) } function ue(e) { if (e && e.cues) for (; e.cues.length > 0;)e.removeCue(e.cues[0]) } var le = function (e) { function t(r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); var n = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, e.call(this, r, s.a.MEDIA_ATTACHED, s.a.MEDIA_DETACHING, s.a.FRAG_PARSING_METADATA)); return n.id3Track = void 0, n.media = void 0, n } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, e), t.prototype.destroy = function () { f.prototype.destroy.call(this) }, t.prototype.onMediaAttached = function (e) { this.media = e.media, this.media }, t.prototype.onMediaDetaching = function () { ue(this.id3Track), this.id3Track = void 0, this.media = void 0 }, t.prototype.getID3Track = function (e) { for (var t = 0; t < e.length; t++) { var r = e[t]; if ("metadata" === r.kind && "id3" === r.label) return se(r, this.media), r } return this.media.addTextTrack("metadata", "id3") }, t.prototype.onFragParsingMetadata = function (e) { var t = e.frag, r = e.samples; this.id3Track || (this.id3Track = this.getID3Track(this.media.textTracks), this.id3Track.mode = "hidden"); for (var n = window.WebKitDataCue || window.VTTCue || window.TextTrackCue, i = 0; i < r.length; i++) { var o = ae.a.getID3Frames(r[i].data); if (o) { var a = r[i].pts, s = i < r.length - 1 ? r[i + 1].pts : t.endPTS; a === s && (s += 1e-4); for (var u = 0; u < o.length; u++) { var l = o[u]; if (!ae.a.isTimeStampFrame(l)) { var c = new n(a, s, ""); c.value = l, this.id3Track.addCue(c) } } } } }, t }(f); var ce = function () { function e(t) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this.alpha_ = t ? Math.exp(Math.log(.5) / t) : 0, this.estimate_ = 0, this.totalWeight_ = 0 } return e.prototype.sample = function (e, t) { var r = Math.pow(this.alpha_, e); this.estimate_ = t * (1 - r) + r * this.estimate_, this.totalWeight_ += e }, e.prototype.getTotalWeight = function () { return this.totalWeight_ }, e.prototype.getEstimate = function () { if (this.alpha_) { var e = 1 - Math.pow(this.alpha_, this.totalWeight_); return this.estimate_ / e } return this.estimate_ }, e }(); var fe = function () { function e(t, r, n, i) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this.hls = t, this.defaultEstimate_ = i, this.minWeight_ = .001, this.minDelayMs_ = 50, this.slow_ = new ce(r), this.fast_ = new ce(n) } return e.prototype.sample = function (e, t) { var r = 8e3 * t / (e = Math.max(e, this.minDelayMs_)), n = e / 1e3; this.fast_.sample(n, r), this.slow_.sample(n, r) }, e.prototype.canEstimate = function () { var e = this.fast_; return e && e.getTotalWeight() >= this.minWeight_ }, e.prototype.getEstimate = function () { return this.canEstimate() ? Math.min(this.fast_.getEstimate(), this.slow_.getEstimate()) : this.defaultEstimate_ }, e.prototype.destroy = function () { }, e }(), de = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }(); var he = function (e) { function t(r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); var n = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, e.call(this, r, s.a.FRAG_LOADING, s.a.FRAG_LOADED, s.a.FRAG_BUFFERED, s.a.ERROR)); return n.lastLoadedFragLevel = 0, n._nextAutoLevel = -1, n.hls = r, n.timer = null, n._bwEstimator = null, n.onCheck = n._abandonRulesCheck.bind(n), n } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, e), t.prototype.destroy = function () { this.clearTimer(), f.prototype.destroy.call(this) }, t.prototype.onFragLoading = function (e) { var t = e.frag; if ("main" === t.type) { if (this.timer || (this.timer = setInterval(this.onCheck, 100)), !this._bwEstimator) { var r = this.hls, n = e.frag.level, i = r.levels[n].details.live, o = r.config, a = void 0, s = void 0; i ? (a = o.abrEwmaFastLive, s = o.abrEwmaSlowLive) : (a = o.abrEwmaFastVoD, s = o.abrEwmaSlowVoD), this._bwEstimator = new fe(r, s, a, o.abrEwmaDefaultEstimate) } this.fragCurrent = t } }, t.prototype._abandonRulesCheck = function () { var e = this.hls, t = e.media, r = this.fragCurrent, n = r.loader, i = e.minAutoLevel; if (!n || n.stats && n.stats.aborted) return u.b.warn("frag loader destroy or aborted, disarm abandonRules"), this.clearTimer(), void (this._nextAutoLevel = -1); var o = n.stats; if (t && o && (!t.paused && 0 !== t.playbackRate || !t.readyState) && r.autoLevel && r.level) { var a = performance.now() - o.trequest, l = Math.abs(t.playbackRate); if (a > 500 * r.duration / l) { var c = e.levels, f = Math.max(1, o.bw ? o.bw / 8 : 1e3 * o.loaded / a), d = c[r.level], h = d.realBitrate ? Math.max(d.realBitrate, d.bitrate) : d.bitrate, p = o.total ? o.total : Math.max(o.loaded, Math.round(r.duration * h / 8)), v = t.currentTime, m = (p - o.loaded) / f, y = (I.bufferInfo(t, v, e.config.maxBufferHole).end - v) / l; if (y < 2 * r.duration / l && m > y) { var g = void 0, b = void 0; for (b = r.level - 1; b > i; b--) { var _ = c[b].realBitrate ? Math.max(c[b].realBitrate, c[b].bitrate) : c[b].bitrate; if ((g = r.duration * _ / (6.4 * f)) < y) break } g < m && (u.b.warn("loading too slow, abort fragment loading and switch to level " + b + ":fragLoadedDelay[" + b + "]<fragLoadedDelay[" + (r.level - 1) + "];bufferStarvationDelay:" + g.toFixed(1) + "<" + m.toFixed(1) + ":" + y.toFixed(1)), e.nextLoadLevel = b, this._bwEstimator.sample(a, o.loaded), n.abort(), this.clearTimer(), e.trigger(s.a.FRAG_LOAD_EMERGENCY_ABORTED, { frag: r, stats: o })) } } } }, t.prototype.onFragLoaded = function (e) { var t = e.frag; if ("main" === t.type && !isNaN(t.sn)) { if (this.clearTimer(), this.lastLoadedFragLevel = t.level, this._nextAutoLevel = -1, this.hls.config.abrMaxWithRealBitrate) { var r = this.hls.levels[t.level], n = (r.loaded ? r.loaded.bytes : 0) + e.stats.loaded, i = (r.loaded ? r.loaded.duration : 0) + e.frag.duration; r.loaded = { bytes: n, duration: i }, r.realBitrate = Math.round(8 * n / i) } if (e.frag.bitrateTest) { var o = e.stats; o.tparsed = o.tbuffered = o.tload, this.onFragBuffered(e) } } }, t.prototype.onFragBuffered = function (e) { var t = e.stats, r = e.frag; if (!(!0 === t.aborted || "main" !== r.type || isNaN(r.sn) || r.bitrateTest && t.tload !== t.tbuffered)) { var n = t.tparsed - t.trequest; u.b.log("latency/loading/parsing/append/kbps:" + Math.round(t.tfirst - t.trequest) + "/" + Math.round(t.tload - t.tfirst) + "/" + Math.round(t.tparsed - t.tload) + "/" + Math.round(t.tbuffered - t.tparsed) + "/" + Math.round(8 * t.loaded / (t.tbuffered - t.trequest))), this._bwEstimator.sample(n, t.loaded), t.bwEstimate = this._bwEstimator.getEstimate(), r.bitrateTest ? this.bitrateTestDelay = n / 1e3 : this.bitrateTestDelay = 0 } }, t.prototype.onError = function (e) { switch (e.details) { case a.a.FRAG_LOAD_ERROR: case a.a.FRAG_LOAD_TIMEOUT: this.clearTimer() } }, t.prototype.clearTimer = function () { clearInterval(this.timer), this.timer = null }, t.prototype._findBestLevel = function (e, t, r, n, i, o, a, s, l) { for (var c = i; c >= n; c--) { var f = l[c].details, d = f ? f.totalduration / f.fragments.length : t, h = !!f && f.live, p = void 0; p = c <= e ? a * r : s * r; var v = l[c].realBitrate ? Math.max(l[c].realBitrate, l[c].bitrate) : l[c].bitrate, m = v * d / p; if (u.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: " + c + "/" + Math.round(p) + "/" + v + "/" + d + "/" + o + "/" + m), p > v && (!m || h && !this.bitrateTestDelay || m < o)) return c } return -1 }, de(t, [{ key: "nextAutoLevel", get: function () { var e = this._nextAutoLevel, t = this._bwEstimator; if (!(-1 === e || t && t.canEstimate())) return e; var r = this._nextABRAutoLevel; return -1 !== e && (r = Math.min(e, r)), r }, set: function (e) { this._nextAutoLevel = e } }, { key: "_nextABRAutoLevel", get: function () { var e = this.hls, t = e.maxAutoLevel, r = e.levels, n = e.config, i = e.minAutoLevel, o = e.media, a = this.lastLoadedFragLevel, s = this.fragCurrent ? this.fragCurrent.duration : 0, l = o ? o.currentTime : 0, c = o && 0 !== o.playbackRate ? Math.abs(o.playbackRate) : 1, f = this._bwEstimator ? this._bwEstimator.getEstimate() : n.abrEwmaDefaultEstimate, d = (I.bufferInfo(o, l, n.maxBufferHole).end - l) / c, h = this._findBestLevel(a, s, f, i, t, d, n.abrBandWidthFactor, n.abrBandWidthUpFactor, r); if (h >= 0) return h; u.b.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering"); var p = s ? Math.min(s, n.maxStarvationDelay) : n.maxStarvationDelay, v = n.abrBandWidthFactor, m = n.abrBandWidthUpFactor; if (0 === d) { var y = this.bitrateTestDelay; if (y) p = (s ? Math.min(s, n.maxLoadingDelay) : n.maxLoadingDelay) - y, u.b.trace("bitrate test took " + Math.round(1e3 * y) + "ms, set first fragment max fetchDuration to " + Math.round(1e3 * p) + " ms"), v = m = 1 } return h = this._findBestLevel(a, s, f, i, t, d + p, v, m, r), Math.max(h, 0) } }]), t }(f); var pe = j(), ve = function (e) { function t(r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); var n = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, e.call(this, r, s.a.MEDIA_ATTACHING, s.a.MEDIA_DETACHING, s.a.MANIFEST_PARSED, s.a.BUFFER_RESET, s.a.BUFFER_APPENDING, s.a.BUFFER_CODECS, s.a.BUFFER_EOS, s.a.BUFFER_FLUSHING, s.a.LEVEL_PTS_UPDATED, s.a.LEVEL_UPDATED)); return n._msDuration = null, n._levelDuration = null, n._live = null, n._objectUrl = null, n.onsbue = n.onSBUpdateEnd.bind(n), n.onsbe = n.onSBUpdateError.bind(n), n.pendingTracks = {}, n.tracks = {}, n } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, e), t.prototype.destroy = function () { f.prototype.destroy.call(this) }, t.prototype.onLevelPtsUpdated = function (e) { var t = e.type, r = this.tracks.audio; if ("audio" === t && r && "audio/mpeg" === r.container) { var n = this.sourceBuffer.audio; if (Math.abs(n.timestampOffset - e.start) > .1) { var i = n.updating; try { n.abort() } catch (e) { i = !0, u.b.warn("can not abort audio buffer: " + e) } i ? this.audioTimestampOffset = e.start : (u.b.warn("change mpeg audio timestamp offset from " + n.timestampOffset + " to " + e.start), n.timestampOffset = e.start) } } }, t.prototype.onManifestParsed = function (e) { var t = e.audio, r = e.video || e.levels.length && e.audio, n = 0; e.altAudio && (t || r) && (n = (t ? 1 : 0) + (r ? 1 : 0), u.b.log(n + " sourceBuffer(s) expected")), this.sourceBufferNb = n }, t.prototype.onMediaAttaching = function (e) { var t = this.media = e.media; if (t) { var r = this.mediaSource = new pe; this.onmso = this.onMediaSourceOpen.bind(this), this.onmse = this.onMediaSourceEnded.bind(this), this.onmsc = this.onMediaSourceClose.bind(this), r.addEventListener("sourceopen", this.onmso), r.addEventListener("sourceended", this.onmse), r.addEventListener("sourceclose", this.onmsc), t.src = URL.createObjectURL(r), this._objectUrl = t.src } }, t.prototype.onMediaDetaching = function () { u.b.log("media source detaching"); var e = this.mediaSource; if (e) { if ("open" === e.readyState) try { e.endOfStream() } catch (e) { u.b.warn("onMediaDetaching:" + e.message + " while calling endOfStream") } e.removeEventListener("sourceopen", this.onmso), e.removeEventListener("sourceended", this.onmse), e.removeEventListener("sourceclose", this.onmsc), this.media && (URL.revokeObjectURL(this._objectUrl), this.media.src === this._objectUrl ? (this.media.removeAttribute("src"), this.media.load()) : u.b.warn("media.src was changed by a third party - skip cleanup")), this.mediaSource = null, this.media = null, this._objectUrl = null, this.pendingTracks = {}, this.tracks = {}, this.sourceBuffer = {}, this.flushRange = [], this.segments = [], this.appended = 0 } this.onmso = this.onmse = this.onmsc = null, this.hls.trigger(s.a.MEDIA_DETACHED) }, t.prototype.onMediaSourceOpen = function () { u.b.log("media source opened"), this.hls.trigger(s.a.MEDIA_ATTACHED, { media: this.media }); var e = this.mediaSource; e && e.removeEventListener("sourceopen", this.onmso), this.checkPendingTracks() }, t.prototype.checkPendingTracks = function () { var e = this.pendingTracks, t = Object.keys(e).length; t && (this.sourceBufferNb <= t || 0 === this.sourceBufferNb) && (this.createSourceBuffers(e), this.pendingTracks = {}, this.doAppending()) }, t.prototype.onMediaSourceClose = function () { u.b.log("media source closed") }, t.prototype.onMediaSourceEnded = function () { u.b.log("media source ended") }, t.prototype.onSBUpdateEnd = function () { if (this.audioTimestampOffset) { var e = this.sourceBuffer.audio; u.b.warn("change mpeg audio timestamp offset from " + e.timestampOffset + " to " + this.audioTimestampOffset), e.timestampOffset = this.audioTimestampOffset, delete this.audioTimestampOffset } this._needsFlush && this.doFlush(), this._needsEos && this.checkEos(), this.appending = !1; var t = this.parent, r = this.segments.reduce(function (e, r) { return r.parent === t ? e + 1 : e }, 0), n = {}, i = this.sourceBuffer; for (var o in i) n[o] = i[o].buffered; this.hls.trigger(s.a.BUFFER_APPENDED, { parent: t, pending: r, timeRanges: n }), this._needsFlush || this.doAppending(), this.updateMediaElementDuration() }, t.prototype.onSBUpdateError = function (e) { u.b.error("sourceBuffer error:", e), this.hls.trigger(s.a.ERROR, { type: a.b.MEDIA_ERROR, details: a.a.BUFFER_APPENDING_ERROR, fatal: !1 }) }, t.prototype.onBufferReset = function () { var e = this.sourceBuffer; for (var t in e) { var r = e[t]; try { this.mediaSource.removeSourceBuffer(r), r.removeEventListener("updateend", this.onsbue), r.removeEventListener("error", this.onsbe) } catch (e) { } } this.sourceBuffer = {}, this.flushRange = [], this.segments = [], this.appended = 0 }, t.prototype.onBufferCodecs = function (e) { if (0 === Object.keys(this.sourceBuffer).length) { for (var t in e) this.pendingTracks[t] = e[t]; var r = this.mediaSource; r && "open" === r.readyState && this.checkPendingTracks() } }, t.prototype.createSourceBuffers = function (e) { var t = this.sourceBuffer, r = this.mediaSource; for (var n in e) if (!t[n]) { var i = e[n], o = i.levelCodec || i.codec, l = i.container + ";codecs=" + o; u.b.log("creating sourceBuffer(" + l + ")"); try { var c = t[n] = r.addSourceBuffer(l); c.addEventListener("updateend", this.onsbue), c.addEventListener("error", this.onsbe), this.tracks[n] = { codec: o, container: i.container }, i.buffer = c } catch (e) { u.b.error("error while trying to add sourceBuffer:" + e.message), this.hls.trigger(s.a.ERROR, { type: a.b.MEDIA_ERROR, details: a.a.BUFFER_ADD_CODEC_ERROR, fatal: !1, err: e, mimeType: l }) } } this.hls.trigger(s.a.BUFFER_CREATED, { tracks: e }) }, t.prototype.onBufferAppending = function (e) { this._needsFlush || (this.segments ? this.segments.push(e) : this.segments = [e], this.doAppending()) }, t.prototype.onBufferAppendFail = function (e) { u.b.error("sourceBuffer error:", e.event), this.hls.trigger(s.a.ERROR, { type: a.b.MEDIA_ERROR, details: a.a.BUFFER_APPENDING_ERROR, fatal: !1 }) }, t.prototype.onBufferEos = function (e) { var t = this.sourceBuffer, r = e.type; for (var n in t) r && n !== r || t[n].ended || (t[n].ended = !0, u.b.log(n + " sourceBuffer now EOS")); this.checkEos() }, t.prototype.checkEos = function () { var e = this.sourceBuffer, t = this.mediaSource; if (t && "open" === t.readyState) { for (var r in e) { var n = e[r]; if (!n.ended) return; if (n.updating) return void (this._needsEos = !0) } u.b.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment"); try { t.endOfStream() } catch (e) { u.b.warn("exception while calling mediaSource.endOfStream()") } this._needsEos = !1 } else this._needsEos = !1 }, t.prototype.onBufferFlushing = function (e) { this.flushRange.push({ start: e.startOffset, end: e.endOffset, type: e.type }), this.flushBufferCounter = 0, this.doFlush() }, t.prototype.onLevelUpdated = function (e) { var t = e.details; t.fragments.length > 0 && (this._levelDuration = t.totalduration + t.fragments[0].start, this._live = t.live, this.updateMediaElementDuration()) }, t.prototype.updateMediaElementDuration = function () { var e, t = this.hls.config; if (null !== this._levelDuration && this.media && this.mediaSource && this.sourceBuffer && 0 !== this.media.readyState && "open" === this.mediaSource.readyState) { for (var r in this.sourceBuffer) if (!0 === this.sourceBuffer[r].updating) return; e = this.media.duration, null === this._msDuration && (this._msDuration = this.mediaSource.duration), !0 === this._live && !0 === t.liveDurationInfinity ? (u.b.log("Media Source duration is set to Infinity"), this._msDuration = this.mediaSource.duration = 1 / 0) : (this._levelDuration > this._msDuration && this._levelDuration > e || e === 1 / 0 || isNaN(e)) && (u.b.log("Updating Media Source duration to " + this._levelDuration.toFixed(3)), this._msDuration = this.mediaSource.duration = this._levelDuration) } }, t.prototype.doFlush = function () { for (; this.flushRange.length;) { var e = this.flushRange[0]; if (!this.flushBuffer(e.start, e.end, e.type)) return void (this._needsFlush = !0); this.flushRange.shift(), this.flushBufferCounter = 0 } if (0 === this.flushRange.length) { this._needsFlush = !1; var t = 0, r = this.sourceBuffer; try { for (var n in r) t += r[n].buffered.length } catch (e) { u.b.error("error while accessing sourceBuffer.buffered") } this.appended = t, this.hls.trigger(s.a.BUFFER_FLUSHED) } }, t.prototype.doAppending = function () { var e = this.hls, t = this.sourceBuffer, r = this.segments; if (Object.keys(t).length) { if (this.media.error) return this.segments = [], void u.b.error("trying to append although a media error occured, flush segment and abort"); if (this.appending) return; if (r && r.length) { var n = r.shift(); try { var i = t[n.type]; i ? i.updating ? r.unshift(n) : (i.ended = !1, this.parent = n.parent, i.appendBuffer(n.data), this.appendError = 0, this.appended++, this.appending = !0) : this.onSBUpdateEnd() } catch (t) { u.b.error("error while trying to append buffer:" + t.message), r.unshift(n); var o = { type: a.b.MEDIA_ERROR, parent: n.parent }; 22 !== t.code ? (this.appendError ? this.appendError++ : this.appendError = 1, o.details = a.a.BUFFER_APPEND_ERROR, this.appendError > e.config.appendErrorMaxRetry ? (u.b.log("fail " + e.config.appendErrorMaxRetry + " times to append segment in sourceBuffer"), r = [], o.fatal = !0, e.trigger(s.a.ERROR, o)) : (o.fatal = !1, e.trigger(s.a.ERROR, o))) : (this.segments = [], o.details = a.a.BUFFER_FULL_ERROR, o.fatal = !1, e.trigger(s.a.ERROR, o)) } } } }, t.prototype.flushBuffer = function (e, t, r) { var n = void 0, i = void 0, o = void 0, a = void 0, s = void 0, l = void 0, c = this.sourceBuffer; if (Object.keys(c).length) { if (u.b.log("flushBuffer,pos/start/end: " + this.media.currentTime.toFixed(3) + "/" + e + "/" + t), this.flushBufferCounter < this.appended) { for (var f in c) if (!r || f === r) { if ((n = c[f]).ended = !1, n.updating) return u.b.warn("cannot flush, sb updating in progress"), !1; try { for (i = 0; i < n.buffered.length; i++)if (o = n.buffered.start(i), a = n.buffered.end(i), -1 !== navigator.userAgent.toLowerCase().indexOf("firefox") && t === Number.POSITIVE_INFINITY ? (s = e, l = t) : (s = Math.max(o, e), l = Math.min(a, t)), Math.min(l, a) - s > .5) return this.flushBufferCounter++, u.b.log("flush " + f + " [" + s + "," + l + "], of [" + o + "," + a + "], pos:" + this.media.currentTime), n.remove(s, l), !1 } catch (e) { u.b.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource") } } } else u.b.warn("abort flushing too many retries"); u.b.log("buffer flushed") } return !0 }, t }(f), me = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }(); var ye = function (e) { function t(r) { return function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t), function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, e.call(this, r, s.a.FPS_DROP_LEVEL_CAPPING, s.a.MEDIA_ATTACHING, s.a.MANIFEST_PARSED)) } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, e), t.prototype.destroy = function () { this.hls.config.capLevelToPlayerSize && (this.media = this.restrictedLevels = null, this.autoLevelCapping = Number.POSITIVE_INFINITY, this.timer && (this.timer = clearInterval(this.timer))) }, t.prototype.onFpsDropLevelCapping = function (e) { t.isLevelAllowed(e.droppedLevel, this.restrictedLevels) && this.restrictedLevels.push(e.droppedLevel) }, t.prototype.onMediaAttaching = function (e) { this.media = e.media instanceof HTMLVideoElement ? e.media : null }, t.prototype.onManifestParsed = function (e) { var t = this.hls; this.restrictedLevels = [], t.config.capLevelToPlayerSize && (this.autoLevelCapping = Number.POSITIVE_INFINITY, this.levels = e.levels, t.firstLevel = this.getMaxLevel(e.firstLevel), clearInterval(this.timer), this.timer = setInterval(this.detectPlayerSize.bind(this), 1e3), this.detectPlayerSize()) }, t.prototype.detectPlayerSize = function () { if (this.media) { var e = this.levels ? this.levels.length : 0; if (e) { var t = this.hls; t.autoLevelCapping = this.getMaxLevel(e - 1), t.autoLevelCapping > this.autoLevelCapping && t.streamController.nextLevelSwitch(), this.autoLevelCapping = t.autoLevelCapping } } }, t.prototype.getMaxLevel = function (e) { var r = this; if (!this.levels) return -1; var n = this.levels.filter(function (n, i) { return t.isLevelAllowed(i, r.restrictedLevels) && i <= e }); return t.getMaxLevelByMediaSize(n, this.mediaWidth, this.mediaHeight) }, t.isLevelAllowed = function (e) { return -1 === (arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : []).indexOf(e) }, t.getMaxLevelByMediaSize = function (e, t, r) { if (!e || e && !e.length) return -1; for (var n, i, o = e.length - 1, a = 0; a < e.length; a += 1) { var s = e[a]; if ((s.width >= t || s.height >= r) && (n = s, !(i = e[a + 1]) || n.width !== i.width || n.height !== i.height)) { o = a; break } } return o }, me(t, [{ key: "mediaWidth", get: function () { var e = void 0, r = this.media; return r && (e = r.width || r.clientWidth || r.offsetWidth, e *= t.contentScaleFactor), e } }, { key: "mediaHeight", get: function () { var e = void 0, r = this.media; return r && (e = r.height || r.clientHeight || r.offsetHeight, e *= t.contentScaleFactor), e } }], [{ key: "contentScaleFactor", get: function () { var e = 1; try { e = window.devicePixelRatio } catch (e) { } return e } }]), t }(f); var ge = function (e) { function t(r) { return function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t), function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, e.call(this, r, s.a.MEDIA_ATTACHING)) } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, e), t.prototype.destroy = function () { this.timer && clearInterval(this.timer), this.isVideoPlaybackQualityAvailable = !1 }, t.prototype.onMediaAttaching = function (e) { var t = this.hls.config; t.capLevelOnFPSDrop && ("function" == typeof (this.video = e.media instanceof HTMLVideoElement ? e.media : null).getVideoPlaybackQuality && (this.isVideoPlaybackQualityAvailable = !0), clearInterval(this.timer), this.timer = setInterval(this.checkFPSInterval.bind(this), t.fpsDroppedMonitoringPeriod)) }, t.prototype.checkFPS = function (e, t, r) { var n = performance.now(); if (t) { if (this.lastTime) { var i = n - this.lastTime, o = r - this.lastDroppedFrames, a = t - this.lastDecodedFrames, l = 1e3 * o / i, c = this.hls; if (c.trigger(s.a.FPS_DROP, { currentDropped: o, currentDecoded: a, totalDroppedFrames: r }), l > 0 && o > c.config.fpsDroppedMonitoringThreshold * a) { var f = c.currentLevel; u.b.warn("drop FPS ratio greater than max allowed value for currentLevel: " + f), f > 0 && (-1 === c.autoLevelCapping || c.autoLevelCapping >= f) && (f -= 1, c.trigger(s.a.FPS_DROP_LEVEL_CAPPING, { level: f, droppedLevel: c.currentLevel }), c.autoLevelCapping = f, c.streamController.nextLevelSwitch()) } } this.lastTime = n, this.lastDroppedFrames = r, this.lastDecodedFrames = t } }, t.prototype.checkFPSInterval = function () { var e = this.video; if (e) if (this.isVideoPlaybackQualityAvailable) { var t = e.getVideoPlaybackQuality(); this.checkFPS(e, t.totalVideoFrames, t.droppedVideoFrames) } else this.checkFPS(e, e.webkitDecodedFrameCount, e.webkitDroppedFrameCount) }, t }(f); var be = function () { function e(t) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), t && t.xhrSetup && (this.xhrSetup = t.xhrSetup) } return e.prototype.destroy = function () { this.abort(), this.loader = null }, e.prototype.abort = function () { var e = this.loader; e && 4 !== e.readyState && (this.stats.aborted = !0, e.abort()), window.clearTimeout(this.requestTimeout), this.requestTimeout = null, window.clearTimeout(this.retryTimeout), this.retryTimeout = null }, e.prototype.load = function (e, t, r) { this.context = e, this.config = t, this.callbacks = r, this.stats = { trequest: performance.now(), retry: 0 }, this.retryDelay = t.retryDelay, this.loadInternal() }, e.prototype.loadInternal = function () { var e = void 0, t = this.context; e = this.loader = new XMLHttpRequest; var r = this.stats; r.tfirst = 0, r.loaded = 0; var n = this.xhrSetup; try { if (n) try { n(e, t.url) } catch (r) { e.open("GET", t.url, !0), n(e, t.url) } e.readyState || e.open("GET", t.url, !0) } catch (r) { return void this.callbacks.onError({ code: e.status, text: r.message }, t, e) } t.rangeEnd && e.setRequestHeader("Range", "bytes=" + t.rangeStart + "-" + (t.rangeEnd - 1)), e.onreadystatechange = this.readystatechange.bind(this), e.onprogress = this.loadprogress.bind(this), e.responseType = t.responseType, this.requestTimeout = window.setTimeout(this.loadtimeout.bind(this), this.config.timeout), e.send() }, e.prototype.readystatechange = function (e) { var t = e.currentTarget, r = t.readyState, n = this.stats, i = this.context, o = this.config; if (!n.aborted && r >= 2) if (window.clearTimeout(this.requestTimeout), 0 === n.tfirst && (n.tfirst = Math.max(performance.now(), n.trequest)), 4 === r) { var a = t.status; if (a >= 200 && a < 300) { n.tload = Math.max(n.tfirst, performance.now()); var s = void 0, l = void 0; l = "arraybuffer" === i.responseType ? (s = t.response).byteLength : (s = t.responseText).length, n.loaded = n.total = l; var c = { url: t.responseURL, data: s }; this.callbacks.onSuccess(c, n, i, t) } else n.retry >= o.maxRetry || a >= 400 && a < 499 ? (u.b.error(a + " while loading " + i.url), this.callbacks.onError({ code: a, text: t.statusText }, i, t)) : (u.b.warn(a + " while loading " + i.url + ", retrying in " + this.retryDelay + "..."), this.destroy(), this.retryTimeout = window.setTimeout(this.loadInternal.bind(this), this.retryDelay), this.retryDelay = Math.min(2 * this.retryDelay, o.maxRetryDelay), n.retry++) } else this.requestTimeout = window.setTimeout(this.loadtimeout.bind(this), o.timeout) }, e.prototype.loadtimeout = function () { u.b.warn("timeout while loading " + this.context.url), this.callbacks.onTimeout(this.stats, this.context, null) }, e.prototype.loadprogress = function (e) { var t = e.currentTarget, r = this.stats; r.loaded = e.loaded, e.lengthComputable && (r.total = e.total); var n = this.callbacks.onProgress; n && n(r, this.context, null, t) }, e }(), _e = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }(); var we = function (e) { function t(r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); var n = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, e.call(this, r, s.a.MANIFEST_LOADING, s.a.MANIFEST_PARSED, s.a.AUDIO_TRACK_LOADED, s.a.ERROR)); return n.ticks = 0, n.ontick = n.tick.bind(n), n } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, e), t.prototype.destroy = function () { this.cleanTimer(), f.prototype.destroy.call(this) }, t.prototype.cleanTimer = function () { this.timer && (clearTimeout(this.timer), this.timer = null) }, t.prototype.tick = function () { this.ticks++, 1 === this.ticks && (this.doTick(), this.ticks > 1 && setTimeout(this.tick, 1), this.ticks = 0) }, t.prototype.doTick = function () { this.updateTrack(this.trackId) }, t.prototype.onError = function (e) { e.fatal && e.type === a.b.NETWORK_ERROR && this.cleanTimer() }, t.prototype.onManifestLoading = function () { this.tracks = [], this.trackId = -1 }, t.prototype.onManifestParsed = function (e) { var t = this, r = e.audioTracks || [], n = !1; this.tracks = r, this.hls.trigger(s.a.AUDIO_TRACKS_UPDATED, { audioTracks: r }); var i = 0; r.forEach(function (e) { if (e.default && !n) return t.audioTrack = i, void (n = !0); i++ }), !1 === n && r.length && (u.b.log("no default audio track defined, use first audio track as default"), this.audioTrack = 0) }, t.prototype.onAudioTrackLoaded = function (e) { e.id < this.tracks.length && (u.b.log("audioTrack " + e.id + " loaded"), this.tracks[e.id].details = e.details, e.details.live && !this.timer && (this.timer = setInterval(this.ontick, 1e3 * e.details.targetduration)), !e.details.live && this.timer && this.cleanTimer()) }, t.prototype.setAudioTrackInternal = function (e) { if (e >= 0 && e < this.tracks.length) { this.cleanTimer(), this.trackId = e, u.b.log("switching to audioTrack " + e); var t = this.tracks[e], r = this.hls, n = t.type, i = t.url, o = { id: e, type: n, url: i }; r.trigger(s.a.AUDIO_TRACK_SWITCHING, o); var a = t.details; !i || void 0 !== a && !0 !== a.live || (u.b.log("(re)loading playlist for audioTrack " + e), r.trigger(s.a.AUDIO_TRACK_LOADING, { url: i, id: e })) } }, t.prototype.updateTrack = function (e) { if (e >= 0 && e < this.tracks.length) { this.cleanTimer(), this.trackId = e, u.b.log("updating audioTrack " + e); var t = this.tracks[e], r = t.url, n = t.details; !r || void 0 !== n && !0 !== n.live || (u.b.log("(re)loading playlist for audioTrack " + e), this.hls.trigger(s.a.AUDIO_TRACK_LOADING, { url: r, id: e })) } }, _e(t, [{ key: "audioTracks", get: function () { return this.tracks } }, { key: "audioTrack", get: function () { return this.trackId }, set: function (e) { this.trackId === e && void 0 !== this.tracks[e].details || this.setAudioTrackInternal(e) } }]), t }(f), Ee = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }(); var Se = { STOPPED: "STOPPED", STARTING: "STARTING", IDLE: "IDLE", PAUSED: "PAUSED", KEY_LOADING: "KEY_LOADING", FRAG_LOADING: "FRAG_LOADING", FRAG_LOADING_WAITING_RETRY: "FRAG_LOADING_WAITING_RETRY", WAITING_TRACK: "WAITING_TRACK", PARSING: "PARSING", PARSED: "PARSED", BUFFER_FLUSHING: "BUFFER_FLUSHING", ENDED: "ENDED", ERROR: "ERROR", WAITING_INIT_PTS: "WAITING_INIT_PTS" }, ke = function (e) { function t(r, n) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); var i = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, e.call(this, r, s.a.MEDIA_ATTACHED, s.a.MEDIA_DETACHING, s.a.AUDIO_TRACKS_UPDATED, s.a.AUDIO_TRACK_SWITCHING, s.a.AUDIO_TRACK_LOADED, s.a.KEY_LOADED, s.a.FRAG_LOADED, s.a.FRAG_PARSING_INIT_SEGMENT, s.a.FRAG_PARSING_DATA, s.a.FRAG_PARSED, s.a.ERROR, s.a.BUFFER_RESET, s.a.BUFFER_CREATED, s.a.BUFFER_APPENDED, s.a.BUFFER_FLUSHED, s.a.INIT_PTS_FOUND)); return i.fragmentTracker = n, i.config = r.config, i.audioCodecSwap = !1, i._state = Se.STOPPED, i.initPTS = [], i.waitingFragment = null, i.videoTrackCC = null, i } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, e), t.prototype.onHandlerDestroying = function () { this.stopLoad() }, t.prototype.onHandlerDestroyed = function () { this.state = Se.STOPPED, this.fragmentTracker = null }, t.prototype.onInitPtsFound = function (e) { var t = e.id, r = e.frag.cc, n = e.initPTS; "main" === t && (this.initPTS[r] = n, this.videoTrackCC = r, u.b.log("InitPTS for cc: " + r + " found from video track: " + n), this.state === Se.WAITING_INIT_PTS && this.tick()) }, t.prototype.startLoad = function (e) { if (this.tracks) { var t = this.lastCurrentTime; this.stopLoad(), this.setInterval(100), this.fragLoadError = 0, t > 0 && -1 === e ? (u.b.log("audio:override startPosition with lastCurrentTime @" + t.toFixed(3)), this.state = Se.IDLE) : (this.lastCurrentTime = this.startPosition ? this.startPosition : e, this.state = Se.STARTING), this.nextLoadPosition = this.startPosition = this.lastCurrentTime, this.tick() } else this.startPosition = e, this.state = Se.STOPPED }, t.prototype.stopLoad = function () { var e = this.fragCurrent; e && (e.loader && e.loader.abort(), this.fragmentTracker.removeFragment(e), this.fragCurrent = null), this.fragPrevious = null, this.demuxer && (this.demuxer.destroy(), this.demuxer = null), this.state = Se.STOPPED }, t.prototype.doTick = function () { var e = void 0, t = void 0, r = void 0, n = this.hls, i = n.config; switch (this.state) { case Se.ERROR: case Se.PAUSED: case Se.BUFFER_FLUSHING: break; case Se.STARTING: this.state = Se.WAITING_TRACK, this.loadedmetadata = !1; break; case Se.IDLE: var o = this.tracks; if (!o) break; if (!this.media && (this.startFragRequested || !i.startFragPrefetch)) break; if (this.loadedmetadata) e = this.media.currentTime; else if (void 0 === (e = this.nextLoadPosition)) break; var a = this.mediaBuffer ? this.mediaBuffer : this.media, l = this.videoBuffer ? this.videoBuffer : this.media, c = I.bufferInfo(a, e, i.maxBufferHole), f = I.bufferInfo(l, e, i.maxBufferHole), d = c.len, h = c.end, p = this.fragPrevious, v = Math.min(i.maxBufferLength, i.maxMaxBufferLength), m = Math.max(v, f.len), y = this.audioSwitch, g = this.trackId; if ((d < m || y) && g < o.length) { if (void 0 === (r = o[g].details)) { this.state = Se.WAITING_TRACK; break } if (!y && !r.live && p && p.sn === r.endSN && !c.nextStart && (!this.media.seeking || this.media.duration - h < p.duration / 2)) { this.hls.trigger(s.a.BUFFER_EOS, { type: "audio" }), this.state = Se.ENDED; break } var b = r.fragments, _ = b.length, w = b[0].start, E = b[_ - 1].start + b[_ - 1].duration, S = void 0; if (y) if (r.live && !r.PTSKnown) u.b.log("switching audiotrack, live stream, unknown PTS,load first fragment"), h = 0; else if (h = e, r.PTSKnown && e < w) { if (!(c.end > w || c.nextStart)) return; u.b.log("alt audio track ahead of main track, seek to start of alt audio track"), this.media.currentTime = w + .05 } if (r.initSegment && !r.initSegment.data) S = r.initSegment; else if (h <= w) { if (S = b[0], null !== this.videoTrackCC && S.cc !== this.videoTrackCC && (S = function (e, t) { return D.search(e, function (e) { return e.cc < t ? 1 : e.cc > t ? -1 : 0 }) }(b, this.videoTrackCC)), r.live && S.loadIdx && S.loadIdx === this.fragLoadIdx) { var k = c.nextStart ? c.nextStart : w; return u.b.log("no alt audio available @currentTime:" + this.media.currentTime + ", seeking @" + (k + .05)), void (this.media.currentTime = k + .05) } } else { var T = void 0, A = i.maxFragLookUpTolerance, R = p ? b[p.sn - b[0].sn + 1] : void 0, O = function (e) { var t = Math.min(A, e.duration); return e.start + e.duration - t <= h ? 1 : e.start - t > h && e.start ? -1 : 0 }; h < E ? (h > E - A && (A = 0), T = R && !O(R) ? R : D.search(b, O)) : T = b[_ - 1], T && (S = T, w = T.start, p && S.level === p.level && S.sn === p.sn && (S.sn < r.endSN ? (S = b[S.sn + 1 - r.startSN], u.b.log("SN just loaded, load next one: " + S.sn)) : S = null)) } S && (S.decryptdata && null != S.decryptdata.uri && null == S.decryptdata.key ? (u.b.log("Loading key for " + S.sn + " of [" + r.startSN + " ," + r.endSN + "],track " + g), this.state = Se.KEY_LOADING, n.trigger(s.a.KEY_LOADING, { frag: S })) : (u.b.log("Loading " + S.sn + ", cc: " + S.cc + " of [" + r.startSN + " ," + r.endSN + "],track " + g + ", currentTime:" + e + ",bufferEnd:" + h.toFixed(3)), this.fragmentTracker.getState(S) === z && (this.fragCurrent = S, this.startFragRequested = !0, isNaN(S.sn) || (this.nextLoadPosition = S.start + S.duration), n.trigger(s.a.FRAG_LOADING, { frag: S }), this.state = Se.FRAG_LOADING))) } break; case Se.WAITING_TRACK: (t = this.tracks[this.trackId]) && t.details && (this.state = Se.IDLE); break; case Se.FRAG_LOADING_WAITING_RETRY: var L = performance.now(), x = this.retryDate, P = (a = this.media) && a.seeking; (!x || L >= x || P) && (u.b.log("audioStreamController: retryDate reached, switch back to IDLE state"), this.state = Se.IDLE); break; case Se.WAITING_INIT_PTS: var C = this.videoTrackCC; if (void 0 === this.initPTS[C]) break; var M = this.waitingFragment; if (M) { var N = M.frag.cc; C !== N ? (t = this.tracks[this.trackId]).details && t.details.live && (u.b.warn("Waiting fragment CC (" + N + ") does not match video track CC (" + C + ")"), this.waitingFragment = null, this.state = Se.IDLE) : (this.state = Se.FRAG_LOADING, this.onFragLoaded(this.waitingFragment), this.waitingFragment = null) } else this.state = Se.IDLE; break; case Se.STOPPED: case Se.FRAG_LOADING: case Se.PARSING: case Se.PARSED: case Se.ENDED: } }, t.prototype.onMediaAttached = function (e) { var t = this.media = this.mediaBuffer = e.media; this.onvseeking = this.onMediaSeeking.bind(this), this.onvended = this.onMediaEnded.bind(this), t.addEventListener("seeking", this.onvseeking), t.addEventListener("ended", this.onvended); var r = this.config; this.tracks && r.autoStartLoad && this.startLoad(r.startPosition) }, t.prototype.onMediaDetaching = function () { var e = this.media; e && e.ended && (u.b.log("MSE detaching and video ended, reset startPosition"), this.startPosition = this.lastCurrentTime = 0), e && (e.removeEventListener("seeking", this.onvseeking), e.removeEventListener("ended", this.onvended), this.onvseeking = this.onvseeked = this.onvended = null), this.media = this.mediaBuffer = this.videoBuffer = null, this.loadedmetadata = !1, this.stopLoad() }, t.prototype.onMediaSeeking = function () { this.state === Se.ENDED && (this.state = Se.IDLE), this.media && (this.lastCurrentTime = this.media.currentTime), this.tick() }, t.prototype.onMediaEnded = function () { this.startPosition = this.lastCurrentTime = 0 }, t.prototype.onAudioTracksUpdated = function (e) { u.b.log("audio tracks updated"), this.tracks = e.audioTracks }, t.prototype.onAudioTrackSwitching = function (e) { var t = !!e.url; this.trackId = e.id, this.fragCurrent = null, this.state = Se.PAUSED, this.waitingFragment = null, t ? this.setInterval(100) : this.demuxer && (this.demuxer.destroy(), this.demuxer = null), t && (this.audioSwitch = !0, this.state = Se.IDLE), this.tick() }, t.prototype.onAudioTrackLoaded = function (e) { var t = e.details, r = e.id, n = this.tracks[r], i = t.totalduration, o = 0; if (u.b.log("track " + r + " loaded [" + t.startSN + "," + t.endSN + "],duration:" + i), t.live) { var a = n.details; a && t.fragments.length > 0 ? (X(a, t), o = t.fragments[0].start, t.PTSKnown ? u.b.log("live audio playlist sliding:" + o.toFixed(3)) : u.b.log("live audio playlist - outdated PTS, unknown sliding")) : (t.PTSKnown = !1, u.b.log("live audio playlist - first load, unknown sliding")) } else t.PTSKnown = !1; if (n.details = t, !this.startFragRequested) { if (-1 === this.startPosition) { var s = t.startTimeOffset; isNaN(s) ? this.startPosition = 0 : (u.b.log("start time offset found in playlist, adjust startPosition to " + s), this.startPosition = s) } this.nextLoadPosition = this.startPosition } this.state === Se.WAITING_TRACK && (this.state = Se.IDLE), this.tick() }, t.prototype.onKeyLoaded = function () { this.state === Se.KEY_LOADING && (this.state = Se.IDLE, this.tick()) }, t.prototype.onFragLoaded = function (e) { var t = this.fragCurrent, r = e.frag; if (this.state === Se.FRAG_LOADING && t && "audio" === r.type && r.level === t.level && r.sn === t.sn) { var n = this.tracks[this.trackId], i = n.details, o = i.totalduration, a = t.level, l = t.sn, c = t.cc, f = this.config.defaultAudioCodec || n.audioCodec || "mp4a.40.2", d = this.stats = e.stats; if ("initSegment" === l) this.state = Se.IDLE, d.tparsed = d.tbuffered = performance.now(), i.initSegment.data = e.payload, this.hls.trigger(s.a.FRAG_BUFFERED, { stats: d, frag: t, id: "audio" }), this.tick(); else { this.state = Se.PARSING, this.appended = !1, this.demuxer || (this.demuxer = new $(this.hls, "audio")); var h = this.initPTS[c], p = i.initSegment ? i.initSegment.data : []; if (i.initSegment || void 0 !== h) { this.pendingBuffering = !0, u.b.log("Demuxing " + l + " of [" + i.startSN + " ," + i.endSN + "],track " + a); this.demuxer.push(e.payload, p, f, null, t, o, !1, h) } else u.b.log("unknown video PTS for continuity counter " + c + ", waiting for video PTS before demuxing audio frag " + l + " of [" + i.startSN + " ," + i.endSN + "],track " + a), this.waitingFragment = e, this.state = Se.WAITING_INIT_PTS } } this.fragLoadError = 0 }, t.prototype.onFragParsingInitSegment = function (e) { var t = this.fragCurrent, r = e.frag; if (t && "audio" === e.id && r.sn === t.sn && r.level === t.level && this.state === Se.PARSING) { var n = e.tracks, i = void 0; if (n.video && delete n.video, i = n.audio) { i.levelCodec = i.codec, i.id = e.id, this.hls.trigger(s.a.BUFFER_CODECS, n), u.b.log("audio track:audio,container:" + i.container + ",codecs[level/parsed]=[" + i.levelCodec + "/" + i.codec + "]"); var o = i.initSegment; if (o) { var a = { type: "audio", data: o, parent: "audio", content: "initSegment" }; this.audioSwitch ? this.pendingData = [a] : (this.appended = !0, this.pendingBuffering = !0, this.hls.trigger(s.a.BUFFER_APPENDING, a)) } this.tick() } } }, t.prototype.onFragParsingData = function (e) { var t = this, r = this.fragCurrent, n = e.frag; if (r && "audio" === e.id && "audio" === e.type && n.sn === r.sn && n.level === r.level && this.state === Se.PARSING) { var i = this.trackId, o = this.tracks[i], l = this.hls; isNaN(e.endPTS) && (e.endPTS = e.startPTS + r.duration, e.endDTS = e.startDTS + r.duration), r.addElementaryStream(m.ElementaryStreamTypes.AUDIO), u.b.log("parsed " + e.type + ",PTS:[" + e.startPTS.toFixed(3) + "," + e.endPTS.toFixed(3) + "],DTS:[" + e.startDTS.toFixed(3) + "/" + e.endDTS.toFixed(3) + "],nb:" + e.nb), Y(o.details, r, e.startPTS, e.endPTS); var c = this.audioSwitch, f = this.media, d = !1; if (c && f) if (f.readyState) { var h = f.currentTime; u.b.log("switching audio track : currentTime:" + h), h >= e.startPTS && (u.b.log("switching audio track : flushing all audio"), this.state = Se.BUFFER_FLUSHING, l.trigger(s.a.BUFFER_FLUSHING, { startOffset: 0, endOffset: Number.POSITIVE_INFINITY, type: "audio" }), d = !0, this.audioSwitch = !1, l.trigger(s.a.AUDIO_TRACK_SWITCHED, { id: i })) } else this.audioSwitch = !1, l.trigger(s.a.AUDIO_TRACK_SWITCHED, { id: i }); var p = this.pendingData; if (!p) return console.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"), void l.trigger(s.a.ERROR, { type: a.b.MEDIA_ERROR, details: null, fatal: !0 }); this.audioSwitch || ([e.data1, e.data2].forEach(function (t) { t && t.length && p.push({ type: e.type, data: t, parent: "audio", content: "data" }) }), !d && p.length && (p.forEach(function (e) { t.state === Se.PARSING && (t.pendingBuffering = !0, t.hls.trigger(s.a.BUFFER_APPENDING, e)) }), this.pendingData = [], this.appended = !0)), this.tick() } }, t.prototype.onFragParsed = function (e) { var t = this.fragCurrent, r = e.frag; t && "audio" === e.id && r.sn === t.sn && r.level === t.level && this.state === Se.PARSING && (this.stats.tparsed = performance.now(), this.state = Se.PARSED, this._checkAppendedParsed()) }, t.prototype.onBufferReset = function () { this.mediaBuffer = this.videoBuffer = null, this.loadedmetadata = !1 }, t.prototype.onBufferCreated = function (e) { var t = e.tracks.audio; t && (this.mediaBuffer = t.buffer, this.loadedmetadata = !0), e.tracks.video && (this.videoBuffer = e.tracks.video.buffer) }, t.prototype.onBufferAppended = function (e) { if ("audio" === e.parent) { var t = this.state; t !== Se.PARSING && t !== Se.PARSED || (this.pendingBuffering = e.pending > 0, this._checkAppendedParsed()) } }, t.prototype._checkAppendedParsed = function () { if (!(this.state !== Se.PARSED || this.appended && this.pendingBuffering)) { var e = this.fragCurrent, t = this.stats, r = this.hls; if (e) { this.fragPrevious = e, t.tbuffered = performance.now(), r.trigger(s.a.FRAG_BUFFERED, { stats: t, frag: e, id: "audio" }); var n = this.mediaBuffer ? this.mediaBuffer : this.media; u.b.log("audio buffered : " + Q.toString(n.buffered)), this.audioSwitch && this.appended && (this.audioSwitch = !1, r.trigger(s.a.AUDIO_TRACK_SWITCHED, { id: this.trackId })), this.state = Se.IDLE } this.tick() } }, t.prototype.onError = function (e) { var t = e.frag; if (!t || "audio" === t.type) switch (e.details) { case a.a.FRAG_LOAD_ERROR: case a.a.FRAG_LOAD_TIMEOUT: if (!e.fatal) { var r = this.fragLoadError; r ? r++ : r = 1; var n = this.config; if (r <= n.fragLoadingMaxRetry) { this.fragLoadError = r; var i = Math.min(Math.pow(2, r - 1) * n.fragLoadingRetryDelay, n.fragLoadingMaxRetryTimeout); u.b.warn("audioStreamController: frag loading failed, retry in " + i + " ms"), this.retryDate = performance.now() + i, this.state = Se.FRAG_LOADING_WAITING_RETRY } else u.b.error("audioStreamController: " + e.details + " reaches max retry, redispatch as fatal ..."), e.fatal = !0, this.state = Se.ERROR } break; case a.a.AUDIO_TRACK_LOAD_ERROR: case a.a.AUDIO_TRACK_LOAD_TIMEOUT: case a.a.KEY_LOAD_ERROR: case a.a.KEY_LOAD_TIMEOUT: this.state !== Se.ERROR && (this.state = e.fatal ? Se.ERROR : Se.IDLE, u.b.warn("audioStreamController: " + e.details + " while loading frag,switch to " + this.state + " state ...")); break; case a.a.BUFFER_FULL_ERROR: if ("audio" === e.parent && (this.state === Se.PARSING || this.state === Se.PARSED)) { var o = this.mediaBuffer, l = this.media.currentTime; if (o && I.isBuffered(o, l) && I.isBuffered(o, l + .5)) { var c = this.config; c.maxMaxBufferLength >= c.maxBufferLength && (c.maxMaxBufferLength /= 2, u.b.warn("audio:reduce max buffer length to " + c.maxMaxBufferLength + "s")), this.state = Se.IDLE } else u.b.warn("buffer full error also media.currentTime is not buffered, flush audio buffer"), this.fragCurrent = null, this.state = Se.BUFFER_FLUSHING, this.hls.trigger(s.a.BUFFER_FLUSHING, { startOffset: 0, endOffset: Number.POSITIVE_INFINITY, type: "audio" }) } } }, t.prototype.onBufferFlushed = function () { var e = this, t = this.pendingData; t && t.length ? (u.b.log("appending pending audio data on Buffer Flushed"), t.forEach(function (t) { e.hls.trigger(s.a.BUFFER_APPENDING, t) }), this.appended = !0, this.pendingData = [], this.state = Se.PARSED) : (this.state = Se.IDLE, this.fragPrevious = null, this.tick()) }, Ee(t, [{ key: "state", set: function (e) { if (this.state !== e) { var t = this.state; this._state = e, u.b.log("audio stream:" + t + "->" + e) } }, get: function () { return this._state } }]), t }(ee), Te = function () { if ("undefined" != typeof window && window.VTTCue) return window.VTTCue; var e = "auto", t = { "": !0, lr: !0, rl: !0 }, r = { start: !0, middle: !0, end: !0, left: !0, right: !0 }; function n(e) { return "string" == typeof e && (!!r[e.toLowerCase()] && e.toLowerCase()) } function i(e) { for (var t = 1; t < arguments.length; t++) { var r = arguments[t]; for (var n in r) e[n] = r[n] } return e } function o(r, o, a) { var s = this, u = function () { if ("undefined" != typeof navigator) return /MSIE\s8\.0/.test(navigator.userAgent) }(), l = {}; u ? s = document.createElement("custom") : l.enumerable = !0, s.hasBeenReset = !1; var c = "", f = !1, d = r, h = o, p = a, v = null, m = "", y = !0, g = "auto", b = "start", _ = 50, w = "middle", E = 50, S = "middle"; if (Object.defineProperty(s, "id", i({}, l, { get: function () { return c }, set: function (e) { c = "" + e } })), Object.defineProperty(s, "pauseOnExit", i({}, l, { get: function () { return f }, set: function (e) { f = !!e } })), Object.defineProperty(s, "startTime", i({}, l, { get: function () { return d }, set: function (e) { if ("number" != typeof e) throw new TypeError("Start time must be set to a number."); d = e, this.hasBeenReset = !0 } })), Object.defineProperty(s, "endTime", i({}, l, { get: function () { return h }, set: function (e) { if ("number" != typeof e) throw new TypeError("End time must be set to a number."); h = e, this.hasBeenReset = !0 } })), Object.defineProperty(s, "text", i({}, l, { get: function () { return p }, set: function (e) { p = "" + e, this.hasBeenReset = !0 } })), Object.defineProperty(s, "region", i({}, l, { get: function () { return v }, set: function (e) { v = e, this.hasBeenReset = !0 } })), Object.defineProperty(s, "vertical", i({}, l, { get: function () { return m }, set: function (e) { var r = function (e) { return "string" == typeof e && !!t[e.toLowerCase()] && e.toLowerCase() }(e); if (!1 === r) throw new SyntaxError("An invalid or illegal string was specified."); m = r, this.hasBeenReset = !0 } })), Object.defineProperty(s, "snapToLines", i({}, l, { get: function () { return y }, set: function (e) { y = !!e, this.hasBeenReset = !0 } })), Object.defineProperty(s, "line", i({}, l, { get: function () { return g }, set: function (t) { if ("number" != typeof t && t !== e) throw new SyntaxError("An invalid number or illegal string was specified."); g = t, this.hasBeenReset = !0 } })), Object.defineProperty(s, "lineAlign", i({}, l, { get: function () { return b }, set: function (e) { var t = n(e); if (!t) throw new SyntaxError("An invalid or illegal string was specified."); b = t, this.hasBeenReset = !0 } })), Object.defineProperty(s, "position", i({}, l, { get: function () { return _ }, set: function (e) { if (e < 0 || e > 100) throw new Error("Position must be between 0 and 100."); _ = e, this.hasBeenReset = !0 } })), Object.defineProperty(s, "positionAlign", i({}, l, { get: function () { return w }, set: function (e) { var t = n(e); if (!t) throw new SyntaxError("An invalid or illegal string was specified."); w = t, this.hasBeenReset = !0 } })), Object.defineProperty(s, "size", i({}, l, { get: function () { return E }, set: function (e) { if (e < 0 || e > 100) throw new Error("Size must be between 0 and 100."); E = e, this.hasBeenReset = !0 } })), Object.defineProperty(s, "align", i({}, l, { get: function () { return S }, set: function (e) { var t = n(e); if (!t) throw new SyntaxError("An invalid or illegal string was specified."); S = t, this.hasBeenReset = !0 } })), s.displayState = void 0, u) return s } return o.prototype.getCueAsHTML = function () { return window.WebVTT.convertCueToDOMTree(window, this.text) }, o }(), Ae = function () { return { decode: function (e) { if (!e) return ""; if ("string" != typeof e) throw new Error("Error - expected string data."); return decodeURIComponent(encodeURIComponent(e)) } } }; function Re() { this.window = window, this.state = "INITIAL", this.buffer = "", this.decoder = new Ae, this.regionList = [] } function Oe() { this.values = Object.create(null) } function Le(e, t, r, n) { var i = n ? e.split(n) : [e]; for (var o in i) if ("string" == typeof i[o]) { var a = i[o].split(r); if (2 === a.length) t(a[0], a[1]) } } Oe.prototype = { set: function (e, t) { this.get(e) || "" === t || (this.values[e] = t) }, get: function (e, t, r) { return r ? this.has(e) ? this.values[e] : t[r] : this.has(e) ? this.values[e] : t }, has: function (e) { return e in this.values }, alt: function (e, t, r) { for (var n = 0; n < r.length; ++n)if (t === r[n]) { this.set(e, t); break } }, integer: function (e, t) { /^-?\d+$/.test(t) && this.set(e, parseInt(t, 10)) }, percent: function (e, t) { return !!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/) && (t = parseFloat(t)) >= 0 && t <= 100) && (this.set(e, t), !0) } }; var xe = new Te(0, 0, 0), Pe = "middle" === xe.align ? "middle" : "center"; function Ce(e, t, r) { var n = e; function i() { var t = function (e) { function t(e, t, r, n) { return 3600 * (0 | e) + 60 * (0 | t) + (0 | r) + (0 | n) / 1e3 } var r = e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/); return r ? r[3] ? t(r[1], r[2], r[3].replace(":", ""), r[4]) : r[1] > 59 ? t(r[1], r[2], 0, r[4]) : t(0, r[1], r[2], r[4]) : null }(e); if (null === t) throw new Error("Malformed timestamp: " + n); return e = e.replace(/^[^\sa-zA-Z-]+/, ""), t } function o() { e = e.replace(/^\s+/, "") } if (o(), t.startTime = i(), o(), "--\x3e" !== e.substr(0, 3)) throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): " + n); e = e.substr(3), o(), t.endTime = i(), o(), function (e, t) { var n = new Oe; Le(e, function (e, t) { switch (e) { case "region": for (var i = r.length - 1; i >= 0; i--)if (r[i].id === t) { n.set(e, r[i].region); break } break; case "vertical": n.alt(e, t, ["rl", "lr"]); break; case "line": var o = t.split(","), a = o[0]; n.integer(e, a), n.percent(e, a) && n.set("snapToLines", !1), n.alt(e, a, ["auto"]), 2 === o.length && n.alt("lineAlign", o[1], ["start", Pe, "end"]); break; case "position": o = t.split(","), n.percent(e, o[0]), 2 === o.length && n.alt("positionAlign", o[1], ["start", Pe, "end", "line-left", "line-right", "auto"]); break; case "size": n.percent(e, t); break; case "align": n.alt(e, t, ["start", Pe, "end", "left", "right"]) } }, /:/, /\s/), t.region = n.get("region", null), t.vertical = n.get("vertical", ""); var i = n.get("line", "auto"); "auto" === i && -1 === xe.line && (i = -1), t.line = i, t.lineAlign = n.get("lineAlign", "start"), t.snapToLines = n.get("snapToLines", !0), t.size = n.get("size", 100), t.align = n.get("align", Pe); var o = n.get("position", "auto"); "auto" === o && 50 === xe.position && (o = "start" === t.align || "left" === t.align ? 0 : "end" === t.align || "right" === t.align ? 100 : 50), t.position = o }(e, t) } function De(e) { return e.replace(/<br(?: \/)?>/gi, "\n") } Re.prototype = { parse: function (e) { var t = this; function r() { var e = t.buffer, r = 0; for (e = De(e); r < e.length && "\r" !== e[r] && "\n" !== e[r];)++r; var n = e.substr(0, r); return "\r" === e[r] && ++r, "\n" === e[r] && ++r, t.buffer = e.substr(r), n } e && (t.buffer += t.decoder.decode(e, { stream: !0 })); try { var n = void 0; if ("INITIAL" === t.state) { if (!/\r\n|\n/.test(t.buffer)) return this; var i = (n = r()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/); if (!i || !i[0]) throw new Error("Malformed WebVTT signature."); t.state = "HEADER" } for (var o = !1; t.buffer;) { if (!/\r\n|\n/.test(t.buffer)) return this; switch (o ? o = !1 : n = r(), t.state) { case "HEADER": /:/.test(n) ? Le(n, function (e, t) { switch (e) { case "Region": console.log("parse region", t) } }, /:/) : n || (t.state = "ID"); continue; case "NOTE": n || (t.state = "ID"); continue; case "ID": if (/^NOTE($|[ \t])/.test(n)) { t.state = "NOTE"; break } if (!n) continue; if (t.cue = new Te(0, 0, ""), t.state = "CUE", -1 === n.indexOf("--\x3e")) { t.cue.id = n; continue } case "CUE": try { Ce(n, t.cue, t.regionList) } catch (e) { t.cue = null, t.state = "BADCUE"; continue } t.state = "CUETEXT"; continue; case "CUETEXT": var a = -1 !== n.indexOf("--\x3e"); if (!n || a && (o = !0)) { t.oncue && t.oncue(t.cue), t.cue = null, t.state = "ID"; continue } t.cue.text && (t.cue.text += "\n"), t.cue.text += n; continue; case "BADCUE": n || (t.state = "ID"); continue } } } catch (e) { "CUETEXT" === t.state && t.cue && t.oncue && t.oncue(t.cue), t.cue = null, t.state = "INITIAL" === t.state ? "BADWEBVTT" : "BADCUE" } return this }, flush: function () { try { if (this.buffer += this.decoder.decode(), (this.cue || "HEADER" === this.state) && (this.buffer += "\n\n", this.parse()), "INITIAL" === this.state) throw new Error("Malformed WebVTT signature.") } catch (e) { throw e } return this.onflush && this.onflush(), this } }; var Ie = Re; function Me(e, t, r, n) { for (var i = void 0, o = void 0, a = void 0, s = void 0, u = void 0, l = window.VTTCue || window.TextTrackCue, c = 0; c < n.rows.length; c++)if (a = !0, s = 0, u = "", !(i = n.rows[c]).isEmpty()) { for (var f = 0; f < i.chars.length; f++)i.chars[f].uchar.match(/\s/) && a ? s++ : (u += i.chars[f].uchar, a = !1); i.cueStartTime = t, t === r && (r += 1e-4), o = new l(t, r, De(u.trim())), s >= 16 ? s-- : s++, navigator.userAgent.match(/Firefox\//) ? o.line = c + 1 : o.line = c > 7 ? c - 2 : c + 1, o.align = "left", o.position = Math.max(0, Math.min(100, s / 32 * 100 + (navigator.userAgent.match(/Firefox\//) ? 50 : 0))), e.addCue(o) } } function Ne(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } var Fe = { 42: 225, 92: 233, 94: 237, 95: 243, 96: 250, 123: 231, 124: 247, 125: 209, 126: 241, 127: 9608, 128: 174, 129: 176, 130: 189, 131: 191, 132: 8482, 133: 162, 134: 163, 135: 9834, 136: 224, 137: 32, 138: 232, 139: 226, 140: 234, 141: 238, 142: 244, 143: 251, 144: 193, 145: 201, 146: 211, 147: 218, 148: 220, 149: 252, 150: 8216, 151: 161, 152: 42, 153: 8217, 154: 9473, 155: 169, 156: 8480, 157: 8226, 158: 8220, 159: 8221, 160: 192, 161: 194, 162: 199, 163: 200, 164: 202, 165: 203, 166: 235, 167: 206, 168: 207, 169: 239, 170: 212, 171: 217, 172: 249, 173: 219, 174: 171, 175: 187, 176: 195, 177: 227, 178: 205, 179: 204, 180: 236, 181: 210, 182: 242, 183: 213, 184: 245, 185: 123, 186: 125, 187: 92, 188: 94, 189: 95, 190: 124, 191: 8764, 192: 196, 193: 228, 194: 214, 195: 246, 196: 223, 197: 165, 198: 164, 199: 9475, 200: 197, 201: 229, 202: 216, 203: 248, 204: 9487, 205: 9491, 206: 9495, 207: 9499 }, Be = function (e) { var t = e; return Fe.hasOwnProperty(e) && (t = Fe[e]), String.fromCharCode(t) }, Ue = 15, je = 100, Ge = { 17: 1, 18: 3, 21: 5, 22: 7, 23: 9, 16: 11, 19: 12, 20: 14 }, $e = { 17: 2, 18: 4, 21: 6, 22: 8, 23: 10, 19: 13, 20: 15 }, ze = { 25: 1, 26: 3, 29: 5, 30: 7, 31: 9, 24: 11, 27: 12, 28: 14 }, Ke = { 25: 2, 26: 4, 29: 6, 30: 8, 31: 10, 27: 13, 28: 15 }, Ve = ["white", "green", "blue", "cyan", "red", "yellow", "magenta", "black", "transparent"], We = { verboseFilter: { DATA: 3, DEBUG: 3, INFO: 2, WARNING: 2, TEXT: 1, ERROR: 0 }, time: null, verboseLevel: 0, setTime: function (e) { this.time = e }, log: function (e, t) { var r = this.verboseFilter[e]; this.verboseLevel >= r && console.log(this.time + " [" + e + "] " + t) } }, He = function (e) { for (var t = [], r = 0; r < e.length; r++)t.push(e[r].toString(16)); return t }, qe = function () { function e(t, r, n, i, o) { Ne(this, e), this.foreground = t || "white", this.underline = r || !1, this.italics = n || !1, this.background = i || "black", this.flash = o || !1 } return e.prototype.reset = function () { this.foreground = "white", this.underline = !1, this.italics = !1, this.background = "black", this.flash = !1 }, e.prototype.setStyles = function (e) { for (var t = ["foreground", "underline", "italics", "background", "flash"], r = 0; r < t.length; r++) { var n = t[r]; e.hasOwnProperty(n) && (this[n] = e[n]) } }, e.prototype.isDefault = function () { return "white" === this.foreground && !this.underline && !this.italics && "black" === this.background && !this.flash }, e.prototype.equals = function (e) { return this.foreground === e.foreground && this.underline === e.underline && this.italics === e.italics && this.background === e.background && this.flash === e.flash }, e.prototype.copy = function (e) { this.foreground = e.foreground, this.underline = e.underline, this.italics = e.italics, this.background = e.background, this.flash = e.flash }, e.prototype.toString = function () { return "color=" + this.foreground + ", underline=" + this.underline + ", italics=" + this.italics + ", background=" + this.background + ", flash=" + this.flash }, e }(), Ye = function () { function e(t, r, n, i, o, a) { Ne(this, e), this.uchar = t || " ", this.penState = new qe(r, n, i, o, a) } return e.prototype.reset = function () { this.uchar = " ", this.penState.reset() }, e.prototype.setChar = function (e, t) { this.uchar = e, this.penState.copy(t) }, e.prototype.setPenState = function (e) { this.penState.copy(e) }, e.prototype.equals = function (e) { return this.uchar === e.uchar && this.penState.equals(e.penState) }, e.prototype.copy = function (e) { this.uchar = e.uchar, this.penState.copy(e.penState) }, e.prototype.isEmpty = function () { return " " === this.uchar && this.penState.isDefault() }, e }(), Xe = function () { function e() { Ne(this, e), this.chars = []; for (var t = 0; t < je; t++)this.chars.push(new Ye); this.pos = 0, this.currPenState = new qe } return e.prototype.equals = function (e) { for (var t = !0, r = 0; r < je; r++)if (!this.chars[r].equals(e.chars[r])) { t = !1; break } return t }, e.prototype.copy = function (e) { for (var t = 0; t < je; t++)this.chars[t].copy(e.chars[t]) }, e.prototype.isEmpty = function () { for (var e = !0, t = 0; t < je; t++)if (!this.chars[t].isEmpty()) { e = !1; break } return e }, e.prototype.setCursor = function (e) { this.pos !== e && (this.pos = e), this.pos < 0 ? (We.log("ERROR", "Negative cursor position " + this.pos), this.pos = 0) : this.pos > je && (We.log("ERROR", "Too large cursor position " + this.pos), this.pos = je) }, e.prototype.moveCursor = function (e) { var t = this.pos + e; if (e > 1) for (var r = this.pos + 1; r < t + 1; r++)this.chars[r].setPenState(this.currPenState); this.setCursor(t) }, e.prototype.backSpace = function () { this.moveCursor(-1), this.chars[this.pos].setChar(" ", this.currPenState) }, e.prototype.insertChar = function (e) { e >= 144 && this.backSpace(); var t = Be(e); this.pos >= je ? We.log("ERROR", "Cannot insert " + e.toString(16) + " (" + t + ") at position " + this.pos + ". Skipping it!") : (this.chars[this.pos].setChar(t, this.currPenState), this.moveCursor(1)) }, e.prototype.clearFromPos = function (e) { var t = void 0; for (t = e; t < je; t++)this.chars[t].reset() }, e.prototype.clear = function () { this.clearFromPos(0), this.pos = 0, this.currPenState.reset() }, e.prototype.clearToEndOfRow = function () { this.clearFromPos(this.pos) }, e.prototype.getTextString = function () { for (var e = [], t = !0, r = 0; r < je; r++) { var n = this.chars[r].uchar; " " !== n && (t = !1), e.push(n) } return t ? "" : e.join("") }, e.prototype.setPenStyles = function (e) { this.currPenState.setStyles(e), this.chars[this.pos].setPenState(this.currPenState) }, e }(), Qe = function () { function e() { Ne(this, e), this.rows = []; for (var t = 0; t < Ue; t++)this.rows.push(new Xe); this.currRow = Ue - 1, this.nrRollUpRows = null, this.reset() } return e.prototype.reset = function () { for (var e = 0; e < Ue; e++)this.rows[e].clear(); this.currRow = Ue - 1 }, e.prototype.equals = function (e) { for (var t = !0, r = 0; r < Ue; r++)if (!this.rows[r].equals(e.rows[r])) { t = !1; break } return t }, e.prototype.copy = function (e) { for (var t = 0; t < Ue; t++)this.rows[t].copy(e.rows[t]) }, e.prototype.isEmpty = function () { for (var e = !0, t = 0; t < Ue; t++)if (!this.rows[t].isEmpty()) { e = !1; break } return e }, e.prototype.backSpace = function () { this.rows[this.currRow].backSpace() }, e.prototype.clearToEndOfRow = function () { this.rows[this.currRow].clearToEndOfRow() }, e.prototype.insertChar = function (e) { this.rows[this.currRow].insertChar(e) }, e.prototype.setPen = function (e) { this.rows[this.currRow].setPenStyles(e) }, e.prototype.moveCursor = function (e) { this.rows[this.currRow].moveCursor(e) }, e.prototype.setCursor = function (e) { We.log("INFO", "setCursor: " + e), this.rows[this.currRow].setCursor(e) }, e.prototype.setPAC = function (e) { We.log("INFO", "pacData = " + JSON.stringify(e)); var t = e.row - 1; if (this.nrRollUpRows && t < this.nrRollUpRows - 1 && (t = this.nrRollUpRows - 1), this.nrRollUpRows && this.currRow !== t) { for (var r = 0; r < Ue; r++)this.rows[r].clear(); var n = this.currRow + 1 - this.nrRollUpRows, i = this.lastOutputScreen; if (i) { var o = i.rows[n].cueStartTime; if (o && o < We.time) for (var a = 0; a < this.nrRollUpRows; a++)this.rows[t - this.nrRollUpRows + a + 1].copy(i.rows[n + a]) } } this.currRow = t; var s = this.rows[this.currRow]; if (null !== e.indent) { var u = e.indent, l = Math.max(u - 1, 0); s.setCursor(e.indent), e.color = s.chars[l].penState.foreground } var c = { foreground: e.color, underline: e.underline, italics: e.italics, background: "black", flash: !1 }; this.setPen(c) }, e.prototype.setBkgData = function (e) { We.log("INFO", "bkgData = " + JSON.stringify(e)), this.backSpace(), this.setPen(e), this.insertChar(32) }, e.prototype.setRollUpRows = function (e) { this.nrRollUpRows = e }, e.prototype.rollUp = function () { if (null !== this.nrRollUpRows) { We.log("TEXT", this.getDisplayText()); var e = this.currRow + 1 - this.nrRollUpRows, t = this.rows.splice(e, 1)[0]; t.clear(), this.rows.splice(this.currRow, 0, t), We.log("INFO", "Rolling up") } else We.log("DEBUG", "roll_up but nrRollUpRows not set yet") }, e.prototype.getDisplayText = function (e) { e = e || !1; for (var t = [], r = "", n = -1, i = 0; i < Ue; i++) { var o = this.rows[i].getTextString(); o && (n = i + 1, e ? t.push("Row " + n + ": '" + o + "'") : t.push(o.trim())) } return t.length > 0 && (r = e ? "[" + t.join(" | ") + "]" : t.join("\n")), r }, e.prototype.getTextAndFormat = function () { return this.rows }, e }(), Je = function () { function e(t, r) { Ne(this, e), this.chNr = t, this.outputFilter = r, this.mode = null, this.verbose = 0, this.displayedMemory = new Qe, this.nonDisplayedMemory = new Qe, this.lastOutputScreen = new Qe, this.currRollUpRow = this.displayedMemory.rows[Ue - 1], this.writeScreen = this.displayedMemory, this.mode = null, this.cueStartTime = null } return e.prototype.reset = function () { this.mode = null, this.displayedMemory.reset(), this.nonDisplayedMemory.reset(), this.lastOutputScreen.reset(), this.currRollUpRow = this.displayedMemory.rows[Ue - 1], this.writeScreen = this.displayedMemory, this.mode = null, this.cueStartTime = null, this.lastCueEndTime = null }, e.prototype.getHandler = function () { return this.outputFilter }, e.prototype.setHandler = function (e) { this.outputFilter = e }, e.prototype.setPAC = function (e) { this.writeScreen.setPAC(e) }, e.prototype.setBkgData = function (e) { this.writeScreen.setBkgData(e) }, e.prototype.setMode = function (e) { e !== this.mode && (this.mode = e, We.log("INFO", "MODE=" + e), "MODE_POP-ON" === this.mode ? this.writeScreen = this.nonDisplayedMemory : (this.writeScreen = this.displayedMemory, this.writeScreen.reset()), "MODE_ROLL-UP" !== this.mode && (this.displayedMemory.nrRollUpRows = null, this.nonDisplayedMemory.nrRollUpRows = null), this.mode = e) }, e.prototype.insertChars = function (e) { for (var t = 0; t < e.length; t++)this.writeScreen.insertChar(e[t]); var r = this.writeScreen === this.displayedMemory ? "DISP" : "NON_DISP"; We.log("INFO", r + ": " + this.writeScreen.getDisplayText(!0)), "MODE_PAINT-ON" !== this.mode && "MODE_ROLL-UP" !== this.mode || (We.log("TEXT", "DISPLAYED: " + this.displayedMemory.getDisplayText(!0)), this.outputDataUpdate()) }, e.prototype.ccRCL = function () { We.log("INFO", "RCL - Resume Caption Loading"), this.setMode("MODE_POP-ON") }, e.prototype.ccBS = function () { We.log("INFO", "BS - BackSpace"), "MODE_TEXT" !== this.mode && (this.writeScreen.backSpace(), this.writeScreen === this.displayedMemory && this.outputDataUpdate()) }, e.prototype.ccAOF = function () { }, e.prototype.ccAON = function () { }, e.prototype.ccDER = function () { We.log("INFO", "DER- Delete to End of Row"), this.writeScreen.clearToEndOfRow(), this.outputDataUpdate() }, e.prototype.ccRU = function (e) { We.log("INFO", "RU(" + e + ") - Roll Up"), this.writeScreen = this.displayedMemory, this.setMode("MODE_ROLL-UP"), this.writeScreen.setRollUpRows(e) }, e.prototype.ccFON = function () { We.log("INFO", "FON - Flash On"), this.writeScreen.setPen({ flash: !0 }) }, e.prototype.ccRDC = function () { We.log("INFO", "RDC - Resume Direct Captioning"), this.setMode("MODE_PAINT-ON") }, e.prototype.ccTR = function () { We.log("INFO", "TR"), this.setMode("MODE_TEXT") }, e.prototype.ccRTD = function () { We.log("INFO", "RTD"), this.setMode("MODE_TEXT") }, e.prototype.ccEDM = function () { We.log("INFO", "EDM - Erase Displayed Memory"), this.displayedMemory.reset(), this.outputDataUpdate(!0) }, e.prototype.ccCR = function () { We.log("CR - Carriage Return"), this.writeScreen.rollUp(), this.outputDataUpdate(!0) }, e.prototype.ccENM = function () { We.log("INFO", "ENM - Erase Non-displayed Memory"), this.nonDisplayedMemory.reset() }, e.prototype.ccEOC = function () { if (We.log("INFO", "EOC - End Of Caption"), "MODE_POP-ON" === this.mode) { var e = this.displayedMemory; this.displayedMemory = this.nonDisplayedMemory, this.nonDisplayedMemory = e, this.writeScreen = this.nonDisplayedMemory, We.log("TEXT", "DISP: " + this.displayedMemory.getDisplayText()) } this.outputDataUpdate(!0) }, e.prototype.ccTO = function (e) { We.log("INFO", "TO(" + e + ") - Tab Offset"), this.writeScreen.moveCursor(e) }, e.prototype.ccMIDROW = function (e) { var t = { flash: !1 }; if (t.underline = e % 2 == 1, t.italics = e >= 46, t.italics) t.foreground = "white"; else { var r = Math.floor(e / 2) - 16; t.foreground = ["white", "green", "blue", "cyan", "red", "yellow", "magenta"][r] } We.log("INFO", "MIDROW: " + JSON.stringify(t)), this.writeScreen.setPen(t) }, e.prototype.outputDataUpdate = function () { arguments.length > 0 && void 0 !== arguments[0] && arguments[0], We.time }, e.prototype.cueSplitAtTime = function (e) { this.outputFilter && (this.displayedMemory.isEmpty() || (this.outputFilter.newCue && this.outputFilter.newCue(this.cueStartTime, e, this.displayedMemory), this.cueStartTime = e)) }, e }(), Ze = function () { function e(t, r, n) { Ne(this, e), this.field = t || 1, this.outputs = [r, n], this.channels = [new Je(1, r), new Je(2, n)], this.currChNr = -1, this.lastCmdA = null, this.lastCmdB = null, this.bufferedData = [], this.startTime = null, this.lastTime = null, this.dataCounters = { padding: 0, char: 0, cmd: 0, other: 0 } } return e.prototype.getHandler = function (e) { return this.channels[e].getHandler() }, e.prototype.setHandler = function (e, t) { this.channels[e].setHandler(t) }, e.prototype.addData = function (e, t) { var r = void 0, n = void 0, i = void 0, o = !1; this.lastTime = e, We.setTime(e); for (var a = 0; a < t.length; a += 2)if (n = 127 & t[a], i = 127 & t[a + 1], 0 !== n || 0 !== i) { if (We.log("DATA", "[" + He([t[a], t[a + 1]]) + "] -> (" + He([n, i]) + ")"), (r = this.parseCmd(n, i)) || (r = this.parseMidrow(n, i)), r || (r = this.parsePAC(n, i)), r || (r = this.parseBackgroundAttributes(n, i)), !r) if (o = this.parseChars(n, i)) if (this.currChNr && this.currChNr >= 0) this.channels[this.currChNr - 1].insertChars(o); else We.log("WARNING", "No channel found yet. TEXT-MODE?"); r ? this.dataCounters.cmd += 2 : o ? this.dataCounters.char += 2 : (this.dataCounters.other += 2, We.log("WARNING", "Couldn't parse cleaned data " + He([n, i]) + " orig: " + He([t[a], t[a + 1]]))) } else this.dataCounters.padding += 2 }, e.prototype.parseCmd = function (e, t) { var r = null; if (!((20 === e || 28 === e) && t >= 32 && t <= 47) && !((23 === e || 31 === e) && t >= 33 && t <= 35)) return !1; if (e === this.lastCmdA && t === this.lastCmdB) return this.lastCmdA = null, this.lastCmdB = null, We.log("DEBUG", "Repeated command (" + He([e, t]) + ") is dropped"), !0; r = 20 === e || 23 === e ? 1 : 2; var n = this.channels[r - 1]; return 20 === e || 28 === e ? 32 === t ? n.ccRCL() : 33 === t ? n.ccBS() : 34 === t ? n.ccAOF() : 35 === t ? n.ccAON() : 36 === t ? n.ccDER() : 37 === t ? n.ccRU(2) : 38 === t ? n.ccRU(3) : 39 === t ? n.ccRU(4) : 40 === t ? n.ccFON() : 41 === t ? n.ccRDC() : 42 === t ? n.ccTR() : 43 === t ? n.ccRTD() : 44 === t ? n.ccEDM() : 45 === t ? n.ccCR() : 46 === t ? n.ccENM() : 47 === t && n.ccEOC() : n.ccTO(t - 32), this.lastCmdA = e, this.lastCmdB = t, this.currChNr = r, !0 }, e.prototype.parseMidrow = function (e, t) { var r = null; return (17 === e || 25 === e) && t >= 32 && t <= 47 && ((r = 17 === e ? 1 : 2) !== this.currChNr ? (We.log("ERROR", "Mismatch channel in midrow parsing"), !1) : (this.channels[r - 1].ccMIDROW(t), We.log("DEBUG", "MIDROW (" + He([e, t]) + ")"), !0)) }, e.prototype.parsePAC = function (e, t) { var r, n = null; if (!((e >= 17 && e <= 23 || e >= 25 && e <= 31) && t >= 64 && t <= 127) && !((16 === e || 24 === e) && t >= 64 && t <= 95)) return !1; if (e === this.lastCmdA && t === this.lastCmdB) return this.lastCmdA = null, this.lastCmdB = null, !0; r = e <= 23 ? 1 : 2, n = t >= 64 && t <= 95 ? 1 === r ? Ge[e] : ze[e] : 1 === r ? $e[e] : Ke[e]; var i = this.interpretPAC(n, t); return this.channels[r - 1].setPAC(i), this.lastCmdA = e, this.lastCmdB = t, this.currChNr = r, !0 }, e.prototype.interpretPAC = function (e, t) { var r = t, n = { color: null, italics: !1, indent: null, underline: !1, row: e }; return r = t > 95 ? t - 96 : t - 64, n.underline = 1 == (1 & r), r <= 13 ? n.color = ["white", "green", "blue", "cyan", "red", "yellow", "magenta", "white"][Math.floor(r / 2)] : r <= 15 ? (n.italics = !0, n.color = "white") : n.indent = 4 * Math.floor((r - 16) / 2), n }, e.prototype.parseChars = function (e, t) { var r = null, n = null, i = null; if (e >= 25 ? (r = 2, i = e - 8) : (r = 1, i = e), i >= 17 && i <= 19) { var o = t; o = 17 === i ? t + 80 : 18 === i ? t + 112 : t + 144, We.log("INFO", "Special char '" + Be(o) + "' in channel " + r), n = [o] } else e >= 32 && e <= 127 && (n = 0 === t ? [e] : [e, t]); if (n) { var a = He(n); We.log("DEBUG", "Char codes =  " + a.join(",")), this.lastCmdA = null, this.lastCmdB = null } return n }, e.prototype.parseBackgroundAttributes = function (e, t) { var r, n = void 0, i = void 0; return ((16 === e || 24 === e) && t >= 32 && t <= 47 || (23 === e || 31 === e) && t >= 45 && t <= 47) && (n = {}, 16 === e || 24 === e ? (i = Math.floor((t - 32) / 2), n.background = Ve[i], t % 2 == 1 && (n.background = n.background + "_semi")) : 45 === t ? n.background = "transparent" : (n.foreground = "black", 47 === t && (n.underline = !0)), r = e < 24 ? 1 : 2, this.channels[r - 1].setBkgData(n), this.lastCmdA = null, this.lastCmdB = null, !0) }, e.prototype.reset = function () { for (var e = 0; e < this.channels.length; e++)this.channels[e] && this.channels[e].reset(); this.lastCmdA = null, this.lastCmdB = null }, e.prototype.cueSplitAtTime = function (e) { for (var t = 0; t < this.channels.length; t++)this.channels[t] && this.channels[t].cueSplitAtTime(e) }, e }(); var et = function () { function e(t, r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this.timelineController = t, this.track = r, this.startTime = null, this.endTime = null, this.screen = null } return e.prototype.dispatchCue = function () { null !== this.startTime && (this.timelineController.addCues("textTrack" + this.track, this.startTime, this.endTime, this.screen), this.startTime = null) }, e.prototype.newCue = function (e, t, r) { (null === this.startTime || this.startTime > e) && (this.startTime = e), this.endTime = t, this.screen = r, this.timelineController.createCaptionsTrack(this.track) }, e }(), tt = function (e, t, r) { return e.substr(r || 0, t.length) === t }, rt = function (e) { for (var t = 5381, r = e.length; r;)t = 33 * t ^ e.charCodeAt(--r); return (t >>> 0).toString() }, nt = { parse: function (e, t, r, n, i, o) { var a = Object(ae.b)(new Uint8Array(e)).trim().replace(/\r\n|\n\r|\n|\r/g, "\n").split("\n"), s = "00:00.000", u = 0, l = 0, c = 0, f = [], d = void 0, h = !0, p = new Ie; p.oncue = function (e) { var t = r[n], i = r.ccOffset; t && t.new && (void 0 !== l ? i = r.ccOffset = t.start : function (e, t, r) { var n = e[t], i = e[n.prevCC]; if (!i || !i.new && n.new) return e.ccOffset = e.presentationOffset = n.start, void (n.new = !1); for (; i && i.new;)e.ccOffset += n.start - i.start, n.new = !1, i = e[(n = i).prevCC]; e.presentationOffset = r }(r, n, c)), c && (i = c + r.ccOffset - r.presentationOffset), e.startTime += i - l, e.endTime += i - l, e.id = rt(e.startTime.toString()) + rt(e.endTime.toString()) + rt(e.text), e.text = decodeURIComponent(encodeURIComponent(e.text)), e.endTime > 0 && f.push(e) }, p.onparsingerror = function (e) { d = e }, p.onflush = function () { d && o ? o(d) : i(f) }, a.forEach(function (e) { if (h) { if (tt(e, "X-TIMESTAMP-MAP=")) { h = !1, e.substr(16).split(",").forEach(function (e) { tt(e, "LOCAL:") ? s = e.substr(6) : tt(e, "MPEGTS:") && (u = parseInt(e.substr(7))) }); try { u -= t = t < 0 ? t + 8589934592 : t, r = s, n = parseInt(r.substr(-3)), i = parseInt(r.substr(-6, 2)), o = parseInt(r.substr(-9, 2)), a = r.length > 9 ? parseInt(r.substr(0, r.indexOf(":"))) : 0, l = (isNaN(n) || isNaN(i) || isNaN(o) || isNaN(a) ? -1 : (n += 1e3 * i, n += 6e4 * o, n += 36e5 * a)) / 1e3, c = u / 9e4, -1 === l && (d = new Error("Malformed X-TIMESTAMP-MAP: " + e)) } catch (t) { d = new Error("Malformed X-TIMESTAMP-MAP: " + e) } return } "" === e && (h = !1) } var r, n, i, o, a; p.parse(e + "\n") }), p.flush() } }; var it = function (e) { function t(r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); var n = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, e.call(this, r, s.a.MEDIA_ATTACHING, s.a.MEDIA_DETACHING, s.a.FRAG_PARSING_USERDATA, s.a.FRAG_DECRYPTED, s.a.MANIFEST_LOADING, s.a.MANIFEST_LOADED, s.a.FRAG_LOADED, s.a.LEVEL_SWITCHING, s.a.INIT_PTS_FOUND)); if (n.hls = r, n.config = r.config, n.enabled = !0, n.Cues = r.config.cueHandler, n.textTracks = [], n.tracks = [], n.unparsedVttFrags = [], n.initPTS = void 0, n.cueRanges = [], n.config.enableCEA708Captions) { var i = new et(n, 1), o = new et(n, 2); n.cea608Parser = new Ze(0, i, o) } return n } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, e), t.prototype.addCues = function (e, t, r, n) { for (var i, o, a, s, u = this.cueRanges, l = !1, c = u.length; c--;) { var f = u[c], d = (i = f[0], o = f[1], a = t, s = r, Math.min(o, s) - Math.max(i, a)); if (d >= 0 && (f[0] = Math.min(f[0], t), f[1] = Math.max(f[1], r), l = !0, d / (r - t) > .5)) return } l || u.push([t, r]), this.Cues.newCue(this[e], t, r, n) }, t.prototype.onInitPtsFound = function (e) { var t = this; void 0 === this.initPTS && (this.initPTS = e.initPTS), this.unparsedVttFrags.length && (this.unparsedVttFrags.forEach(function (e) { t.onFragLoaded(e) }), this.unparsedVttFrags = []) }, t.prototype.getExistingTrack = function (e) { var t = this.media; if (t) for (var r = 0; r < t.textTracks.length; r++) { var n = t.textTracks[r]; if (!0 === n["textTrack" + e]) return n } return null }, t.prototype.createCaptionsTrack = function (e) { var t = "textTrack" + e; if (!this[t]) { var r = this.getExistingTrack(e); if (r) this[t] = r, ue(this[t]), se(this[t], this.media); else { var n = this.createTextTrack("captions", this.config["captionsTextTrack" + e + "Label"], this.config["captionsTextTrack" + e + "LanguageCode"]); n && (n[t] = !0, this[t] = n) } } }, t.prototype.createTextTrack = function (e, t, r) { var n = this.media; if (n) return n.addTextTrack(e, t, r) }, t.prototype.destroy = function () { f.prototype.destroy.call(this) }, t.prototype.onMediaAttaching = function (e) { this.media = e.media, this._cleanTracks() }, t.prototype.onMediaDetaching = function () { ue(this.textTrack1), ue(this.textTrack2) }, t.prototype.onManifestLoading = function () { this.lastSn = -1, this.prevCC = -1, this.vttCCs = { ccOffset: 0, presentationOffset: 0 }, this._cleanTracks() }, t.prototype._cleanTracks = function () { var e = this.media; if (e) { var t = e.textTracks; if (t) for (var r = 0; r < t.length; r++)ue(t[r]) } }, t.prototype.onManifestLoaded = function (e) { var t = this; if (this.textTracks = [], this.unparsedVttFrags = this.unparsedVttFrags || [], this.initPTS = void 0, this.cueRanges = [], this.config.enableWebVTT) { this.tracks = e.subtitles || []; var r = this.media ? this.media.textTracks : []; this.tracks.forEach(function (e, n) { var i = void 0; if (n < r.length) { var o = r[n]; (function (e, t) { return e && e.label === t.name && !(e.textTrack1 || e.textTrack2) })(o, e) && (i = o) } i || (i = t.createTextTrack("subtitles", e.name, e.lang)), e.default ? i.mode = t.hls.subtitleDisplay ? "showing" : "hidden" : i.mode = "disabled", t.textTracks.push(i) }) } }, t.prototype.onLevelSwitching = function () { this.enabled = "NONE" !== this.hls.currentLevel.closedCaptions }, t.prototype.onFragLoaded = function (e) { var t = e.frag, r = e.payload; if ("main" === t.type) { var n = t.sn; if (n !== this.lastSn + 1) { var i = this.cea608Parser; i && i.reset() } this.lastSn = n } else if ("subtitle" === t.type) if (r.byteLength) { if (void 0 === this.initPTS) return void this.unparsedVttFrags.push(e); var o = t.decryptdata; null != o && null != o.key && "AES-128" === o.method || this._parseVTTs(t, r) } else this.hls.trigger(s.a.SUBTITLE_FRAG_PROCESSED, { success: !1, frag: t }) }, t.prototype._parseVTTs = function (e, t) { var r = this.vttCCs; r[e.cc] || (r[e.cc] = { start: e.start, prevCC: this.prevCC, new: !0 }, this.prevCC = e.cc); var n = this.textTracks, i = this.hls; nt.parse(t, this.initPTS, r, e.cc, function (t) { var r = n[e.trackId]; "disabled" !== r.mode ? (t.forEach(function (e) { if (!r.cues.getCueById(e.id)) try { r.addCue(e) } catch (n) { var t = new window.TextTrackCue(e.startTime, e.endTime, e.text); t.id = e.id, r.addCue(t) } }), i.trigger(s.a.SUBTITLE_FRAG_PROCESSED, { success: !0, frag: e })) : i.trigger(s.a.SUBTITLE_FRAG_PROCESSED, { success: !1, frag: e }) }, function (t) { u.b.log("Failed to parse VTT cue: " + t), i.trigger(s.a.SUBTITLE_FRAG_PROCESSED, { success: !1, frag: e }) }) }, t.prototype.onFragDecrypted = function (e) { var t = e.payload, r = e.frag; if ("subtitle" === r.type) { if (void 0 === this.initPTS) return void this.unparsedVttFrags.push(e); this._parseVTTs(r, t) } }, t.prototype.onFragParsingUserdata = function (e) { if (this.enabled && this.config.enableCEA708Captions) for (var t = 0; t < e.samples.length; t++) { var r = this.extractCea608Data(e.samples[t].bytes); this.cea608Parser.addData(e.samples[t].pts, r) } }, t.prototype.extractCea608Data = function (e) { for (var t = 31 & e[0], r = 2, n = void 0, i = void 0, o = void 0, a = [], s = 0; s < t; s++)n = e[r++], i = 127 & e[r++], o = 127 & e[r++], 0 === i && 0 === o || 0 != (4 & n) && 0 === (3 & n) && (a.push(i), a.push(o)); return a }, t }(f), ot = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }(); function at(e) { for (var t = [], r = 0; r < e.length; r++)"subtitles" === e[r].kind && t.push(e[r]); return t } var st = function (e) { function t(r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); var n = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, e.call(this, r, s.a.MEDIA_ATTACHED, s.a.MEDIA_DETACHING, s.a.MANIFEST_LOADING, s.a.MANIFEST_LOADED, s.a.SUBTITLE_TRACK_LOADED)); return n.tracks = [], n.trackId = -1, n.media = void 0, n.subtitleDisplay = !1, n } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, e), t.prototype._onTextTracksChanged = function () { if (this.media) { for (var e = -1, t = at(this.media.textTracks), r = 0; r < t.length; r++)if ("hidden" === t[r].mode) e = r; else if ("showing" === t[r].mode) { e = r; break } this.subtitleTrack = e } }, t.prototype.destroy = function () { f.prototype.destroy.call(this) }, t.prototype.onMediaAttached = function (e) { var t = this; this.media = e.media, this.media && (void 0 !== this.queuedDefaultTrack && (this.subtitleTrack = this.queuedDefaultTrack, delete this.queuedDefaultTrack), this.trackChangeListener = this._onTextTracksChanged.bind(this), this.useTextTrackPolling = !(this.media.textTracks && "onchange" in this.media.textTracks), this.useTextTrackPolling ? this.subtitlePollingInterval = setInterval(function () { t.trackChangeListener() }, 500) : this.media.textTracks.addEventListener("change", this.trackChangeListener)) }, t.prototype.onMediaDetaching = function () { this.media && (this.useTextTrackPolling ? clearInterval(this.subtitlePollingInterval) : this.media.textTracks.removeEventListener("change", this.trackChangeListener), this.media = void 0) }, t.prototype.onManifestLoading = function () { this.tracks = [], this.trackId = -1 }, t.prototype.onManifestLoaded = function (e) { var t = this, r = e.subtitles || []; this.tracks = r, this.trackId = -1, this.hls.trigger(s.a.SUBTITLE_TRACKS_UPDATED, { subtitleTracks: r }), r.forEach(function (e) { e.default && (t.media ? t.subtitleTrack = e.id : t.queuedDefaultTrack = e.id) }) }, t.prototype.onTick = function () { var e = this.trackId, t = this.tracks[e]; if (t) { var r = t.details; void 0 !== r && !0 !== r.live || (u.b.log("(re)loading playlist for subtitle track " + e), this.hls.trigger(s.a.SUBTITLE_TRACK_LOADING, { url: t.url, id: e })) } }, t.prototype.onSubtitleTrackLoaded = function (e) { var t = this; e.id < this.tracks.length && (u.b.log("subtitle track " + e.id + " loaded"), this.tracks[e.id].details = e.details, e.details.live && !this.timer && (this.timer = setInterval(function () { t.onTick() }, 1e3 * e.details.targetduration, this)), !e.details.live && this.timer && (clearInterval(this.timer), this.timer = null)) }, t.prototype.setSubtitleTrackInternal = function (e) { if (!(e < -1 || e >= this.tracks.length)) { this.timer && (clearInterval(this.timer), this.timer = null); var t = at(this.media.textTracks); if (-1 !== this.trackId && (t[this.trackId].mode = "disabled"), this.trackId = e, u.b.log("switching to subtitle track " + e), this.hls.trigger(s.a.SUBTITLE_TRACK_SWITCH, { id: e }), -1 !== e) { var r = this.tracks[e]; e < t.length && (t[e].mode = this.subtitleDisplay ? "showing" : "hidden"); var n = r.details; void 0 !== n && !0 !== n.live || (u.b.log("(re)loading playlist for subtitle track " + e), this.hls.trigger(s.a.SUBTITLE_TRACK_LOADING, { url: r.url, id: e })) } } }, ot(t, [{ key: "subtitleTracks", get: function () { return this.tracks } }, { key: "subtitleTrack", get: function () { return this.trackId }, set: function (e) { this.trackId !== e && this.setSubtitleTrackInternal(e) } }]), t }(f), ut = r(5); var lt = { STOPPED: "STOPPED", IDLE: "IDLE", KEY_LOADING: "KEY_LOADING", FRAG_LOADING: "FRAG_LOADING" }, ct = function (e) { function t(r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); var n = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, e.call(this, r, s.a.MEDIA_ATTACHED, s.a.ERROR, s.a.KEY_LOADED, s.a.FRAG_LOADED, s.a.SUBTITLE_TRACKS_UPDATED, s.a.SUBTITLE_TRACK_SWITCH, s.a.SUBTITLE_TRACK_LOADED, s.a.SUBTITLE_FRAG_PROCESSED)); return n.config = r.config, n.vttFragSNsProcessed = {}, n.vttFragQueues = void 0, n.currentlyProcessing = null, n.state = lt.STOPPED, n.currentTrackId = -1, n.decrypter = new ut.a(r.observer, r.config), n } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, e), t.prototype.onHandlerDestroyed = function () { this.state = lt.STOPPED }, t.prototype.clearVttFragQueues = function () { var e = this; this.vttFragQueues = {}, this.tracks.forEach(function (t) { e.vttFragQueues[t.id] = [] }) }, t.prototype.nextFrag = function () { if (null === this.currentlyProcessing && this.currentTrackId > -1 && this.vttFragQueues[this.currentTrackId].length) { var e = this.currentlyProcessing = this.vttFragQueues[this.currentTrackId].shift(); this.fragCurrent = e, this.hls.trigger(s.a.FRAG_LOADING, { frag: e }), this.state = lt.FRAG_LOADING } }, t.prototype.onSubtitleFragProcessed = function (e) { e.success && this.vttFragSNsProcessed[e.frag.trackId].push(e.frag.sn), this.currentlyProcessing = null, this.state = lt.IDLE, this.nextFrag() }, t.prototype.onMediaAttached = function () { this.state = lt.IDLE }, t.prototype.onError = function (e) { var t = e.frag; t && "subtitle" !== t.type || this.currentlyProcessing && (this.currentlyProcessing = null, this.nextFrag()) }, t.prototype.doTick = function () { var e = this; switch (this.state) { case lt.IDLE: var t, r = this.tracks, n = this.currentTrackId, i = this.vttFragSNsProcessed[n], o = this.vttFragQueues[n], a = this.currentlyProcessing ? this.currentlyProcessing.sn : -1; if (!r) break; if (n < r.length && (t = r[n].details), void 0 === t) break; t.fragments.forEach(function (t) { (function (e) { return i.indexOf(e.sn) > -1 })(t) || t.sn === a || function (e) { return o.some(function (t) { return t.sn === e.sn }) }(t) || (t.decryptdata && null != t.decryptdata.uri && null == t.decryptdata.key ? (u.b.log("Loading key for " + t.sn), e.state = lt.KEY_LOADING, e.hls.trigger(s.a.KEY_LOADING, { frag: t })) : (t.trackId = n, o.push(t), e.nextFrag())) }) } }, t.prototype.onSubtitleTracksUpdated = function (e) { var t = this; u.b.log("subtitle tracks updated"), this.tracks = e.subtitleTracks, this.clearVttFragQueues(), this.vttFragSNsProcessed = {}, this.tracks.forEach(function (e) { t.vttFragSNsProcessed[e.id] = [] }) }, t.prototype.onSubtitleTrackSwitch = function (e) { (this.currentTrackId = e.id, -1 !== this.currentTrackId) && (void 0 !== this.tracks[this.currentTrackId].details && this.tick()) }, t.prototype.onSubtitleTrackLoaded = function () { this.tick() }, t.prototype.onKeyLoaded = function () { this.state === lt.KEY_LOADING && (this.state = lt.IDLE, this.tick()) }, t.prototype.onFragLoaded = function (e) { var t = this.fragCurrent, r = e.frag.decryptdata, n = e.frag, i = this.hls; if (this.state === lt.FRAG_LOADING && t && "subtitle" === e.frag.type && t.sn === e.frag.sn && e.payload.byteLength > 0 && null != r && null != r.key && "AES-128" === r.method) { var o = void 0; try { o = performance.now() } catch (e) { o = Date.now() } this.decrypter.decrypt(e.payload, r.key.buffer, r.iv.buffer, function (e) { var t = void 0; try { t = performance.now() } catch (e) { t = Date.now() } i.trigger(s.a.FRAG_DECRYPTED, { frag: n, payload: e, stats: { tstart: o, tdecrypt: t } }) }) } }, t }(ee), ft = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }(); var dt = "com.widevine.alpha", ht = "com.microsoft.playready", pt = function (e) { function t(r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); var n = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, e.call(this, r, s.a.MEDIA_ATTACHED, s.a.MANIFEST_PARSED)); return n._widevineLicenseUrl = r.config.widevineLicenseUrl, n._licenseXhrSetup = r.config.licenseXhrSetup, n._emeEnabled = r.config.emeEnabled, n._requestMediaKeySystemAccess = r.config.requestMediaKeySystemAccessFunc, n._mediaKeysList = [], n._media = null, n._hasSetMediaKeys = !1, n._isMediaEncrypted = !1, n._requestLicenseFailureCount = 0, n } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, e), t.prototype.getLicenseServerUrl = function (e) { var t = void 0; switch (e) { case dt: t = this._widevineLicenseUrl; break; default: t = null }return t || (u.b.error('No license server URL configured for key-system "' + e + '"'), this.hls.trigger(s.a.ERROR, { type: a.b.KEY_SYSTEM_ERROR, details: a.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED, fatal: !0 })), t }, t.prototype._attemptKeySystemAccess = function (e, t, r) { var n = this, i = function (e, t, r) { switch (e) { case dt: return function (e, t, r) { var n = { videoCapabilities: [] }; return t.forEach(function (e) { n.videoCapabilities.push({ contentType: 'video/mp4; codecs="' + e + '"' }) }), [n] }(0, r); default: throw Error("Unknown key-system: " + e) } }(e, 0, r); i ? (u.b.log("Requesting encrypted media key-system access"), this.requestMediaKeySystemAccess(e, i).then(function (t) { n._onMediaKeySystemAccessObtained(e, t) }).catch(function (t) { u.b.error('Failed to obtain key-system "' + e + '" access:', t) })) : u.b.warn("Can not create config for key-system (maybe because platform is not supported):", e) }, t.prototype._onMediaKeySystemAccessObtained = function (e, t) { var r = this; u.b.log('Access for key-system "' + e + '" obtained'); var n = { mediaKeys: null, mediaKeysSession: null, mediaKeysSessionInitialized: !1, mediaKeySystemAccess: t, mediaKeySystemDomain: e }; this._mediaKeysList.push(n), t.createMediaKeys().then(function (t) { n.mediaKeys = t, u.b.log('Media-keys created for key-system "' + e + '"'), r._onMediaKeysCreated() }).catch(function (e) { u.b.error("Failed to create media-keys:", e) }) }, t.prototype._onMediaKeysCreated = function () { var e = this; this._mediaKeysList.forEach(function (t) { t.mediaKeysSession || (t.mediaKeysSession = t.mediaKeys.createSession(), e._onNewMediaKeySession(t.mediaKeysSession)) }) }, t.prototype._onNewMediaKeySession = function (e) { var t = this; u.b.log("New key-system session " + e.sessionId), e.addEventListener("message", function (r) { t._onKeySessionMessage(e, r.message) }, !1) }, t.prototype._onKeySessionMessage = function (e, t) { u.b.log("Got EME message event, creating license request"), this._requestLicense(t, function (t) { u.b.log("Received license data, updating key-session"), e.update(t) }) }, t.prototype._onMediaEncrypted = function (e, t) { u.b.log('Media is encrypted using "' + e + '" init data type'), this._isMediaEncrypted = !0, this._mediaEncryptionInitDataType = e, this._mediaEncryptionInitData = t, this._attemptSetMediaKeys(), this._generateRequestWithPreferredKeySession() }, t.prototype._attemptSetMediaKeys = function () { if (!this._hasSetMediaKeys) { var e = this._mediaKeysList[0]; if (!e || !e.mediaKeys) return u.b.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"), void this.hls.trigger(s.a.ERROR, { type: a.b.KEY_SYSTEM_ERROR, details: a.a.KEY_SYSTEM_NO_KEYS, fatal: !0 }); u.b.log("Setting keys for encrypted media"), this._media.setMediaKeys(e.mediaKeys), this._hasSetMediaKeys = !0 } }, t.prototype._generateRequestWithPreferredKeySession = function () { var e = this, t = this._mediaKeysList[0]; if (!t) return u.b.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"), void this.hls.trigger(s.a.ERROR, { type: a.b.KEY_SYSTEM_ERROR, details: a.a.KEY_SYSTEM_NO_ACCESS, fatal: !0 }); if (t.mediaKeysSessionInitialized) u.b.warn("Key-Session already initialized but requested again"); else { var r = t.mediaKeysSession; r || (u.b.error("Fatal: Media is encrypted but no key-session existing"), this.hls.trigger(s.a.ERROR, { type: a.b.KEY_SYSTEM_ERROR, details: a.a.KEY_SYSTEM_NO_SESSION, fatal: !0 })); var n = this._mediaEncryptionInitDataType, i = this._mediaEncryptionInitData; u.b.log('Generating key-session request for "' + n + '" init data type'), t.mediaKeysSessionInitialized = !0, r.generateRequest(n, i).then(function () { u.b.debug("Key-session generation succeeded") }).catch(function (t) { u.b.error("Error generating key-session request:", t), e.hls.trigger(s.a.ERROR, { type: a.b.KEY_SYSTEM_ERROR, details: a.a.KEY_SYSTEM_NO_SESSION, fatal: !1 }) }) } }, t.prototype._createLicenseXhr = function (e, t, r) { var n = new XMLHttpRequest, i = this._licenseXhrSetup; try { if (i) try { i(n, e) } catch (t) { n.open("POST", e, !0), i(n, e) } n.readyState || n.open("POST", e, !0) } catch (e) { return u.b.error("Error setting up key-system license XHR", e), void this.hls.trigger(s.a.ERROR, { type: a.b.KEY_SYSTEM_ERROR, details: a.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED, fatal: !0 }) } return n.responseType = "arraybuffer", n.onreadystatechange = this._onLicenseRequestReadyStageChange.bind(this, n, e, t, r), n }, t.prototype._onLicenseRequestReadyStageChange = function (e, t, r, n) { switch (e.readyState) { case 4: if (200 === e.status) this._requestLicenseFailureCount = 0, u.b.log("License request succeeded"), n(e.response); else { if (u.b.error("License Request XHR failed (" + t + "). Status: " + e.status + " (" + e.statusText + ")"), this._requestLicenseFailureCount++, this._requestLicenseFailureCount <= 3) { var i = 3 - this._requestLicenseFailureCount + 1; return u.b.warn("Retrying license request, " + i + " attempts left"), void this._requestLicense(r, n) } this.hls.trigger(s.a.ERROR, { type: a.b.KEY_SYSTEM_ERROR, details: a.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED, fatal: !0 }) } } }, t.prototype._generateLicenseRequestChallenge = function (e, t) { var r = void 0; return e.mediaKeySystemDomain === ht ? u.b.error("PlayReady is not supported (yet)") : e.mediaKeySystemDomain === dt ? r = t : u.b.error("Unsupported key-system:", e.mediaKeySystemDomain), r }, t.prototype._requestLicense = function (e, t) { u.b.log("Requesting content license for key-system"); var r = this._mediaKeysList[0]; if (!r) return u.b.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"), void this.hls.trigger(s.a.ERROR, { type: a.b.KEY_SYSTEM_ERROR, details: a.a.KEY_SYSTEM_NO_ACCESS, fatal: !0 }); var n = this.getLicenseServerUrl(r.mediaKeySystemDomain), i = this._createLicenseXhr(n, e, t); u.b.log("Sending license request to URL: " + n), i.send(this._generateLicenseRequestChallenge(r, e)) }, t.prototype.onMediaAttached = function (e) { var t = this; if (this._emeEnabled) { var r = e.media; this._media = r, r.addEventListener("encrypted", function (e) { t._onMediaEncrypted(e.initDataType, e.initData) }) } }, t.prototype.onManifestParsed = function (e) { if (this._emeEnabled) { var t = e.levels.map(function (e) { return e.audioCodec }), r = e.levels.map(function (e) { return e.videoCodec }); this._attemptKeySystemAccess(dt, t, r) } }, ft(t, [{ key: "requestMediaKeySystemAccess", get: function () { if (!this._requestMediaKeySystemAccess) throw new Error("No requestMediaKeySystemAccess function configured"); return this._requestMediaKeySystemAccess } }]), t }(f), vt = { autoStartLoad: !0, startPosition: -1, defaultAudioCodec: void 0, debug: !1, capLevelOnFPSDrop: !1, capLevelToPlayerSize: !1, initialLiveManifestSize: 1, maxBufferLength: 30, maxBufferSize: 6e7, maxBufferHole: .5, lowBufferWatchdogPeriod: .5, highBufferWatchdogPeriod: 3, nudgeOffset: .1, nudgeMaxRetry: 3, maxFragLookUpTolerance: .25, liveSyncDurationCount: 3, liveMaxLatencyDurationCount: 1 / 0, liveSyncDuration: void 0, liveMaxLatencyDuration: void 0, liveDurationInfinity: !1, maxMaxBufferLength: 600, enableWorker: !0, enableSoftwareAES: !0, manifestLoadingTimeOut: 1e4, manifestLoadingMaxRetry: 1, manifestLoadingRetryDelay: 1e3, manifestLoadingMaxRetryTimeout: 64e3, startLevel: void 0, levelLoadingTimeOut: 1e4, levelLoadingMaxRetry: 4, levelLoadingRetryDelay: 1e3, levelLoadingMaxRetryTimeout: 64e3, fragLoadingTimeOut: 2e4, fragLoadingMaxRetry: 6, fragLoadingRetryDelay: 1e3, fragLoadingMaxRetryTimeout: 64e3, startFragPrefetch: !1, fpsDroppedMonitoringPeriod: 5e3, fpsDroppedMonitoringThreshold: .2, appendErrorMaxRetry: 3, loader: be, fLoader: void 0, pLoader: void 0, xhrSetup: void 0, licenseXhrSetup: void 0, abrController: he, bufferController: ve, capLevelController: ye, fpsController: ge, stretchShortVideoTrack: !1, maxAudioFramesDrift: 1, forceKeyFrameOnDiscontinuity: !0, abrEwmaFastLive: 3, abrEwmaSlowLive: 9, abrEwmaFastVoD: 3, abrEwmaSlowVoD: 9, abrEwmaDefaultEstimate: 5e5, abrBandWidthFactor: .95, abrBandWidthUpFactor: .7, abrMaxWithRealBitrate: !1, maxStarvationDelay: 4, maxLoadingDelay: 4, minAutoBitrate: 0, emeEnabled: !1, widevineLicenseUrl: void 0, requestMediaKeySystemAccessFunc: window.navigator && window.navigator.requestMediaKeySystemAccess ? window.navigator.requestMediaKeySystemAccess.bind(window.navigator) : null }; vt.subtitleStreamController = ct, vt.subtitleTrackController = st, vt.timelineController = it, vt.cueHandler = n, vt.enableCEA708Captions = !0, vt.enableWebVTT = !0, vt.captionsTextTrack1Label = "English", vt.captionsTextTrack1LanguageCode = "en", vt.captionsTextTrack2Label = "Spanish", vt.captionsTextTrack2LanguageCode = "es", vt.audioStreamController = ke, vt.audioTrackController = we, vt.emeController = pt; var mt = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }(); r(12); var yt = function () { function e() { var t = this, r = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e); var n = e.DefaultConfig; if ((r.liveSyncDurationCount || r.liveMaxLatencyDurationCount) && (r.liveSyncDuration || r.liveMaxLatencyDuration)) throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration"); for (var i in n) i in r || (r[i] = n[i]); if (void 0 !== r.liveMaxLatencyDurationCount && r.liveMaxLatencyDurationCount <= r.liveSyncDurationCount) throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"'); if (void 0 !== r.liveMaxLatencyDuration && (r.liveMaxLatencyDuration <= r.liveSyncDuration || void 0 === r.liveSyncDuration)) throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"'); Object(u.a)(r.debug), this.config = r, this._autoLevelCapping = -1; var o = this.observer = new F.a; o.trigger = function (e) { for (var t = arguments.length, r = Array(t > 1 ? t - 1 : 0), n = 1; n < t; n++)r[n - 1] = arguments[n]; o.emit.apply(o, [e, e].concat(r)) }, o.off = function (e) { for (var t = arguments.length, r = Array(t > 1 ? t - 1 : 0), n = 1; n < t; n++)r[n - 1] = arguments[n]; o.removeListener.apply(o, [e].concat(r)) }, this.on = o.on.bind(o), this.off = o.off.bind(o), this.trigger = o.trigger.bind(o); var a = this.abrController = new r.abrController(this), s = new r.bufferController(this), l = new r.capLevelController(this), c = new r.fpsController(this), f = new x(this), d = new P(this), h = new C(this), p = new le(this), v = this.levelController = new oe(this), m = new H(this), y = [v, this.streamController = new ne(this, m)], g = r.audioStreamController; g && y.push(new g(this, m)), this.networkControllers = y; var b = [f, d, h, a, s, l, c, p, m]; if (g = r.audioTrackController) { var _ = new g(this); this.audioTrackController = _, b.push(_) } if (g = r.subtitleTrackController) { var w = new g(this); this.subtitleTrackController = w, b.push(w) } if (g = r.emeController) { var E = new g(this); this.emeController = E, b.push(E) } [r.subtitleStreamController, r.timelineController].forEach(function (e) { e && b.push(new e(t)) }), this.coreComponents = b } return e.isSupported = function () { return e = j(), t = window.SourceBuffer || window.WebKitSourceBuffer, r = e && "function" == typeof e.isTypeSupported && e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'), n = !t || t.prototype && "function" == typeof t.prototype.appendBuffer && "function" == typeof t.prototype.remove, !!r && !!n; var e, t, r, n }, mt(e, null, [{ key: "version", get: function () { return "0.9.1" } }, { key: "Events", get: function () { return s.a } }, { key: "ErrorTypes", get: function () { return a.b } }, { key: "ErrorDetails", get: function () { return a.a } }, { key: "DefaultConfig", get: function () { return e.defaultConfig ? e.defaultConfig : vt }, set: function (t) { e.defaultConfig = t } }]), e.prototype.destroy = function () { u.b.log("destroy"), this.trigger(s.a.DESTROYING), this.detachMedia(), this.coreComponents.concat(this.networkControllers).forEach(function (e) { e.destroy() }), this.url = null, this.observer.removeAllListeners(), this._autoLevelCapping = -1 }, e.prototype.attachMedia = function (e) { u.b.log("attachMedia"), this.media = e, this.trigger(s.a.MEDIA_ATTACHING, { media: e }) }, e.prototype.detachMedia = function () { u.b.log("detachMedia"), this.trigger(s.a.MEDIA_DETACHING), this.media = null }, e.prototype.loadSource = function (e) { e = o.a.buildAbsoluteURL(window.location.href, e, { alwaysNormalize: !0 }), u.b.log("loadSource:" + e), this.url = e, this.trigger(s.a.MANIFEST_LOADING, { url: e }) }, e.prototype.startLoad = function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : -1; u.b.log("startLoad(" + e + ")"), this.networkControllers.forEach(function (t) { t.startLoad(e) }) }, e.prototype.stopLoad = function () { u.b.log("stopLoad"), this.networkControllers.forEach(function (e) { e.stopLoad() }) }, e.prototype.swapAudioCodec = function () { u.b.log("swapAudioCodec"), this.streamController.swapAudioCodec() }, e.prototype.recoverMediaError = function () { u.b.log("recoverMediaError"); var e = this.media; this.detachMedia(), this.attachMedia(e) }, mt(e, [{ key: "levels", get: function () { return this.levelController.levels } }, { key: "currentLevel", get: function () { return this.streamController.currentLevel }, set: function (e) { u.b.log("set currentLevel:" + e), this.loadLevel = e, this.streamController.immediateLevelSwitch() } }, { key: "nextLevel", get: function () { return this.streamController.nextLevel }, set: function (e) { u.b.log("set nextLevel:" + e), this.levelController.manualLevel = e, this.streamController.nextLevelSwitch() } }, { key: "loadLevel", get: function () { return this.levelController.level }, set: function (e) { u.b.log("set loadLevel:" + e), this.levelController.manualLevel = e } }, { key: "nextLoadLevel", get: function () { return this.levelController.nextLoadLevel }, set: function (e) { this.levelController.nextLoadLevel = e } }, { key: "firstLevel", get: function () { return Math.max(this.levelController.firstLevel, this.minAutoLevel) }, set: function (e) { u.b.log("set firstLevel:" + e), this.levelController.firstLevel = e } }, { key: "startLevel", get: function () { return this.levelController.startLevel }, set: function (e) { u.b.log("set startLevel:" + e); -1 !== e && (e = Math.max(e, this.minAutoLevel)), this.levelController.startLevel = e } }, { key: "autoLevelCapping", get: function () { return this._autoLevelCapping }, set: function (e) { u.b.log("set autoLevelCapping:" + e), this._autoLevelCapping = e } }, { key: "autoLevelEnabled", get: function () { return -1 === this.levelController.manualLevel } }, { key: "manualLevel", get: function () { return this.levelController.manualLevel } }, { key: "minAutoLevel", get: function () { for (var e = this.levels, t = this.config.minAutoBitrate, r = e ? e.length : 0, n = 0; n < r; n++) { if ((e[n].realBitrate ? Math.max(e[n].realBitrate, e[n].bitrate) : e[n].bitrate) > t) return n } return 0 } }, { key: "maxAutoLevel", get: function () { var e = this.levels, t = this.autoLevelCapping; return -1 === t && e && e.length ? e.length - 1 : t } }, { key: "nextAutoLevel", get: function () { return Math.min(Math.max(this.abrController.nextAutoLevel, this.minAutoLevel), this.maxAutoLevel) }, set: function (e) { this.abrController.nextAutoLevel = Math.max(this.minAutoLevel, e) } }, { key: "audioTracks", get: function () { var e = this.audioTrackController; return e ? e.audioTracks : [] } }, { key: "audioTrack", get: function () { var e = this.audioTrackController; return e ? e.audioTrack : -1 }, set: function (e) { var t = this.audioTrackController; t && (t.audioTrack = e) } }, { key: "liveSyncPosition", get: function () { return this.streamController.liveSyncPosition } }, { key: "subtitleTracks", get: function () { var e = this.subtitleTrackController; return e ? e.subtitleTracks : [] } }, { key: "subtitleTrack", get: function () { var e = this.subtitleTrackController; return e ? e.subtitleTrack : -1 }, set: function (e) { var t = this.subtitleTrackController; t && (t.subtitleTrack = e) } }, { key: "subtitleDisplay", get: function () { var e = this.subtitleTrackController; return !!e && e.subtitleDisplay }, set: function (e) { var t = this.subtitleTrackController; t && (t.subtitleDisplay = e) } }]), e }(); t.default = yt }, function (e, t, r) { function n(e) { var t = {}; function r(n) { if (t[n]) return t[n].exports; var i = t[n] = { i: n, l: !1, exports: {} }; return e[n].call(i.exports, i, i.exports, r), i.l = !0, i.exports } r.m = e, r.c = t, r.i = function (e) { return e }, r.d = function (e, t, n) { r.o(e, t) || Object.defineProperty(e, t, { configurable: !1, enumerable: !0, get: n }) }, r.r = function (e) { Object.defineProperty(e, "__esModule", { value: !0 }) }, r.n = function (e) { var t = e && e.__esModule ? function () { return e.default } : function () { return e }; return r.d(t, "a", t), t }, r.o = function (e, t) { return Object.prototype.hasOwnProperty.call(e, t) }, r.p = "/", r.oe = function (e) { throw console.error(e), e }; var n = r(r.s = ENTRY_MODULE); return n.default || n } var i = "[\\.|\\-|\\+|\\w|/|@]+", o = "\\((/\\*.*?\\*/)?s?.*?(" + i + ").*?\\)"; function a(e) { return (e + "").replace(/[.?*+^$[\]\\(){}|-]/g, "\\$&") } function s(e, t, n) { var s = {}; s[n] = []; var u = t.toString(), l = u.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/); if (!l) return s; for (var c, f = l[1], d = new RegExp("(\\\\n|\\W)" + a(f) + o, "g"); c = d.exec(u);)"dll-reference" !== c[3] && s[n].push(c[3]); for (d = new RegExp("\\(" + a(f) + '\\("(dll-reference\\s(' + i + '))"\\)\\)' + o, "g"); c = d.exec(u);)e[c[2]] || (s[n].push(c[1]), e[c[2]] = r(c[1]).m), s[c[2]] = s[c[2]] || [], s[c[2]].push(c[4]); return s } function u(e) { return Object.keys(e).reduce(function (t, r) { return t || e[r].length > 0 }, !1) } e.exports = function (e, t) { t = t || {}; var i = { main: r.m }, o = t.all ? { main: Object.keys(i) } : function (e, t) { for (var r = { main: [t] }, n = { main: [] }, i = { main: {} }; u(r);)for (var o = Object.keys(r), a = 0; a < o.length; a++) { var l = o[a], c = r[l].pop(); if (i[l] = i[l] || {}, !i[l][c] && e[l][c]) { i[l][c] = !0, n[l] = n[l] || [], n[l].push(c); for (var f = s(e, e[l][c], l), d = Object.keys(f), h = 0; h < d.length; h++)r[d[h]] = r[d[h]] || [], r[d[h]] = r[d[h]].concat(f[d[h]]) } } return n }(i, e), a = ""; Object.keys(o).filter(function (e) { return "main" !== e }).forEach(function (e) { for (var t = 0; o[e][t];)t++; o[e].push(t), i[e][t] = "(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })", a = a + "var " + e + " = (" + n.toString().replace("ENTRY_MODULE", JSON.stringify(t)) + ")({" + o[e].map(function (t) { return JSON.stringify(t) + ": " + i[e][t].toString() }).join(",") + "});\n" }), a = a + "(" + n.toString().replace("ENTRY_MODULE", JSON.stringify(e)) + ")({" + o.main.map(function (e) { return JSON.stringify(e) + ": " + i.main[e].toString() }).join(",") + "})(self);"; var l = new window.Blob([a], { type: "text/javascript" }); if (t.bare) return l; var c = (window.URL || window.webkitURL || window.mozURL || window.msURL).createObjectURL(l), f = new window.Worker(c); return f.objectURL = c, f } }, function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r(8), i = r(1), o = r(0), a = r(6), s = r.n(a); t.default = function (e) { var t = new s.a; t.trigger = function (e) { for (var r = arguments.length, n = Array(r > 1 ? r - 1 : 0), i = 1; i < r; i++)n[i - 1] = arguments[i]; t.emit.apply(t, [e, e].concat(n)) }, t.off = function (e) { for (var r = arguments.length, n = Array(r > 1 ? r - 1 : 0), i = 1; i < r; i++)n[i - 1] = arguments[i]; t.removeListener.apply(t, [e].concat(n)) }; var r = function (t, r) { e.postMessage({ event: t, data: r }) }; e.addEventListener("message", function (i) { var a = i.data; switch (a.cmd) { case "init": var s = JSON.parse(a.config); e.demuxer = new n.a(t, a.typeSupported, s, a.vendor); try { Object(o.a)(!0 === s.debug) } catch (e) { console.warn("demuxerWorker: unable to enable logs") } r("init", null); break; case "demux": e.demuxer.push(a.data, a.decryptdata, a.initSegment, a.audioCodec, a.videoCodec, a.timeOffset, a.discontinuity, a.trackSwitch, a.contiguous, a.duration, a.accurateTimeOffset, a.defaultInitPTS) } }), t.on(i.a.FRAG_DECRYPTED, r), t.on(i.a.FRAG_PARSING_INIT_SEGMENT, r), t.on(i.a.FRAG_PARSED, r), t.on(i.a.ERROR, r), t.on(i.a.FRAG_PARSING_METADATA, r), t.on(i.a.FRAG_PARSING_USERDATA, r), t.on(i.a.INIT_PTS_FOUND, r), t.on(i.a.FRAG_PARSING_DATA, function (t, r) { var n = [], i = { event: t, data: r }; r.data1 && (i.data1 = r.data1.buffer, n.push(r.data1.buffer), delete r.data1), r.data2 && (i.data2 = r.data2.buffer, n.push(r.data2.buffer), delete r.data2), e.postMessage(i, n) }) } }, function (e, t) { var r, n, i; String.prototype.endsWith || (r = function () { try { var e = {}, t = Object.defineProperty, r = t(e, e, e) && t } catch (e) { } return r }(), n = {}.toString, i = function (e) { if (null == this) throw TypeError(); var t = String(this); if (e && "[object RegExp]" == n.call(e)) throw TypeError(); var r = t.length, i = String(e), o = i.length, a = r; if (arguments.length > 1) { var s = arguments[1]; void 0 !== s && (a = s ? Number(s) : 0) != a && (a = 0) } var u = Math.min(Math.max(a, 0), r) - o; if (u < 0) return !1; for (var l = -1; ++l < o;)if (t.charCodeAt(u + l) != i.charCodeAt(l)) return !1; return !0 }, r ? r(String.prototype, "endsWith", { value: i, configurable: !0, writable: !0 }) : String.prototype.endsWith = i) }]).default }, e.exports = r() })), Xc = { debug: !1, enableWorker: !0 }; var Qc = "chimee-kernel-hls", Jc = (function (e, t, r, n, i) { var o = {}; Object.keys(n).forEach(function (e) { o[e] = n[e] }), o.enumerable = !!o.enumerable, o.configurable = !!o.configurable, ("value" in o || o.initializer) && (o.writable = !0), o = r.slice().reverse().reduce(function (r, n) { return n(e, t, r) || r }, o), i && void 0 !== o.initializer && (o.value = o.initializer ? o.initializer.call(i) : void 0, o.initializer = void 0), void 0 === o.initializer && (Object.defineProperty(e, t, o), o = null) }((Wc = function (e) { function t(e, r) { var n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}; Mt(this, t); var i = Nt(this, (t.__proto__ || It(t)).call(this)); if (i.version = "1.3.2", !Or(e)) throw new Error("video element passed in " + Qc + " must be a HTMLVideoElement, but not " + (void 0 === e ? "undefined" : xt(e))); if (!gr(r)) throw new Error("config of " + Qc + " must be an Object but not " + (void 0 === r ? "undefined" : xt(r))); return i.video = e, i.config = r, i.customConfig = Jr({}, Xc, n), i.hlsKernel = new Yc(i.customConfig), i.bindEvents(), i.attachMedia(), i } return Xt(t, wi), Gt(t, null, [{ key: "isSupport", value: function () { return Yc.isSupported() } }]), Gt(t, [{ key: "bindEvents", value: function () { var e = arguments.length > 0 && void 0 !== arguments[0] && arguments[0], t = this.hlsKernel; t && t[e ? "off" : "on"](Yc.Events.ERROR, this.hlsErrorHandler) } }, { key: "load", value: function () { return this.hlsKernel.loadSource(this.config.src) } }, { key: "startLoad", value: function () { return this.hlsKernel.startLoad() } }, { key: "stopLoad", value: function () { return this.hlsKernel.stopLoad() } }, { key: "attachMedia", value: function () { return this.hlsKernel.attachMedia(this.video) } }, { key: "play", value: function () { return this.video.play() } }, { key: "destroy", value: function () { return this.bindEvents(!0), this.hlsKernel.destroy() } }, { key: "seek", value: function (e) { this.video.currentTime = e } }, { key: "pause", value: function () { return this.video.pause() } }, { key: "refresh", value: function () { return this.hlsKernel.stopLoad(), this.hlsKernel.loadSource(this.config.src) } }, { key: "hlsErrorHandler", value: function (e, t) { this.emit("error", t), this.emit(e, t), Cr.error(Qc + (e ? " " + e : ""), t.details) } }]), t }()).prototype, "hlsErrorHandler", [Qo], eo(Wc.prototype, "hlsErrorHandler"), Wc.prototype), Wc), Zc = r(n(function (e, t) { var r; r = function () { return function (e) { var t = {}; function r(n) { if (t[n]) return t[n].exports; var i = t[n] = { i: n, l: !1, exports: {} }; return e[n].call(i.exports, i, i.exports, r), i.l = !0, i.exports } return r.m = e, r.c = t, r.d = function (e, t, n) { r.o(e, t) || Object.defineProperty(e, t, { configurable: !1, enumerable: !0, get: n }) }, r.n = function (e) { var t = e && e.__esModule ? function () { return e.default } : function () { return e }; return r.d(t, "a", t), t }, r.o = function (e, t) { return Object.prototype.hasOwnProperty.call(e, t) }, r.p = "", r(r.s = 6) }([function (e, t, r) { !function (e) { function t(e) { return e && e.__esModule ? e.default : e } function r(e, t) { return e(t = { exports: {} }, t.exports), t.exports } var n = Math.ceil, i = Math.floor, o = function (e) { return isNaN(e = +e) ? 0 : (e > 0 ? i : n)(e) }, a = function (e) { if (null == e) throw TypeError("Can't call method on  " + e); return e }, s = r(function (e) { var t = e.exports = "undefined" != typeof window && window.Math == Math ? window : "undefined" != typeof self && self.Math == Math ? self : Function("return this")(); "number" == typeof __g && (__g = t) }), u = r(function (e) { var t = e.exports = { version: "2.4.0" }; "number" == typeof __e && (__e = t) }), l = function (e, t, r) { if (function (e) { if ("function" != typeof e) throw TypeError(e + " is not a function!") }(e), void 0 === t) return e; switch (r) { case 1: return function (r) { return e.call(t, r) }; case 2: return function (r, n) { return e.call(t, r, n) }; case 3: return function (r, n, i) { return e.call(t, r, n, i) } }return function () { return e.apply(t, arguments) } }, c = function (e) { return "object" == typeof e ? null !== e : "function" == typeof e }, f = function (e) { if (!c(e)) throw TypeError(e + " is not an object!"); return e }, d = function (e) { try { return !!e() } catch (e) { return !0 } }, h = !d(function () { return 7 != Object.defineProperty({}, "a", { get: function () { return 7 } }).a }), p = s.document, v = c(p) && c(p.createElement), m = function (e) { return v ? p.createElement(e) : {} }, y = !h && !d(function () { return 7 != Object.defineProperty(m("div"), "a", { get: function () { return 7 } }).a }), g = function (e, t) { if (!c(e)) return e; var r, n; if (t && "function" == typeof (r = e.toString) && !c(n = r.call(e))) return n; if ("function" == typeof (r = e.valueOf) && !c(n = r.call(e))) return n; if (!t && "function" == typeof (r = e.toString) && !c(n = r.call(e))) return n; throw TypeError("Can't convert object to primitive value") }, b = Object.defineProperty, _ = { f: h ? Object.defineProperty : function (e, t, r) { if (f(e), t = g(t, !0), f(r), y) try { return b(e, t, r) } catch (e) { } if ("get" in r || "set" in r) throw TypeError("Accessors not supported!"); return "value" in r && (e[t] = r.value), e } }, w = function (e, t) { return { enumerable: !(1 & e), configurable: !(2 & e), writable: !(4 & e), value: t } }, E = h ? function (e, t, r) { return _.f(e, t, w(1, r)) } : function (e, t, r) { return e[t] = r, e }, S = function (e, t, r) { var n, i, o, a = e & S.F, c = e & S.G, f = e & S.S, d = e & S.P, h = e & S.B, p = e & S.W, v = c ? u : u[t] || (u[t] = {}), m = v.prototype, y = c ? s : f ? s[t] : (s[t] || {}).prototype; for (n in c && (r = t), r) (i = !a && y && void 0 !== y[n]) && n in v || (o = i ? y[n] : r[n], v[n] = c && "function" != typeof y[n] ? r[n] : h && i ? l(o, s) : p && y[n] == o ? function (e) { var t = function (t, r, n) { if (this instanceof e) { switch (arguments.length) { case 0: return new e; case 1: return new e(t); case 2: return new e(t, r) }return new e(t, r, n) } return e.apply(this, arguments) }; return t.prototype = e.prototype, t }(o) : d && "function" == typeof o ? l(Function.call, o) : o, d && ((v.virtual || (v.virtual = {}))[n] = o, e & S.R && m && !m[n] && E(m, n, o))) }; S.F = 1, S.G = 2, S.S = 4, S.P = 8, S.B = 16, S.W = 32, S.U = 64, S.R = 128; var k, T = S, A = E, R = {}.hasOwnProperty, O = function (e, t) { return R.call(e, t) }, L = {}.toString, x = function (e) { return L.call(e).slice(8, -1) }, P = Object("z").propertyIsEnumerable(0) ? Object : function (e) { return "String" == x(e) ? e.split("") : Object(e) }, C = function (e) { return P(a(e)) }, D = Math.min, I = Math.max, M = Math.min, N = s["__core-js_shared__"] || (s["__core-js_shared__"] = {}), F = function (e) { return N[e] || (N[e] = {}) }, B = 0, U = Math.random(), j = function (e) { return "Symbol(".concat(void 0 === e ? "" : e, ")_", (++B + U).toString(36)) }, G = F("keys"), $ = function (e) { return G[e] || (G[e] = j(e)) }, z = (k = !1, function (e, t, r) { var n, i, a = C(e), s = (i = a.length) > 0 ? D(o(i), 9007199254740991) : 0, u = function (e, t) { return (e = o(e)) < 0 ? I(e + t, 0) : M(e, t) }(r, s); if (k && t != t) { for (; s > u;)if ((n = a[u++]) != n) return !0 } else for (; s > u; u++)if ((k || u in a) && a[u] === t) return k || u || 0; return !k && -1 }), K = $("IE_PROTO"), V = function (e, t) { var r, n = C(e), i = 0, o = []; for (r in n) r != K && O(n, r) && o.push(r); for (; t.length > i;)O(n, r = t[i++]) && (~z(o, r) || o.push(r)); return o }, W = "constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","), H = Object.keys || function (e) { return V(e, W) }, q = h ? Object.defineProperties : function (e, t) { f(e); for (var r, n = H(t), i = n.length, o = 0; i > o;)_.f(e, r = n[o++], t[r]); return e }, Y = s.document && document.documentElement, X = $("IE_PROTO"), Q = function () { }, J = function () { var e, t = m("iframe"), r = W.length; for (t.style.display = "none", Y.appendChild(t), t.src = "javascript:", (e = t.contentWindow.document).open(), e.write("<script>document.F=Object<\/script>"), e.close(), J = e.F; r--;)delete J.prototype[W[r]]; return J() }, Z = Object.create || function (e, t) { var r; return null !== e ? (Q.prototype = f(e), r = new Q, Q.prototype = null, r[X] = e) : r = J(), void 0 === t ? r : q(r, t) }, ee = r(function (e) { var t = F("wks"), r = s.Symbol, n = "function" == typeof r, i = e.exports = function (e) { return t[e] || (t[e] = n && r[e] || (n ? r : j)("Symbol." + e)) }; i.store = t }), te = _.f, re = ee("toStringTag"), ne = function (e, t, r) { e && !O(e = r ? e : e.prototype, re) && te(e, re, { configurable: !0, value: t }) }, ie = {}; E(ie, ee("iterator"), function () { return this }); var oe, ae = function (e, t, r) { e.prototype = Z(ie, { next: w(1, r) }), ne(e, t + " Iterator") }, se = function (e) { return Object(a(e)) }, ue = $("IE_PROTO"), le = Object.prototype, ce = Object.getPrototypeOf || function (e) { return e = se(e), O(e, ue) ? e[ue] : "function" == typeof e.constructor && e instanceof e.constructor ? e.constructor.prototype : e instanceof Object ? le : null }, fe = ee("iterator"), de = !([].keys && "next" in [].keys()), he = function (e, t, r, n, i, o, a) { ae(r, t, n); var s, u, l, c = function (e) { if (!de && e in p) return p[e]; switch (e) { case "keys": case "values": return function () { return new r(this, e) } }return function () { return new r(this, e) } }, f = t + " Iterator", d = "values" == i, h = !1, p = e.prototype, v = p[fe] || p["@@iterator"] || i && p[i], m = v || c(i), y = i ? d ? c("entries") : m : void 0, g = "Array" == t && p.entries || v; if (g && (l = ce(g.call(new e))) !== Object.prototype && ne(l, f, !0), d && v && "values" !== v.name && (h = !0, m = function () { return v.call(this) }), a && (de || h || !p[fe]) && E(p, fe, m), i) if (s = { values: d ? m : c("values"), keys: o ? m : c("keys"), entries: y }, a) for (u in s) u in p || A(p, u, s[u]); else T(T.P + T.F * (de || h), t, s); return s }, pe = (oe = !0, function (e, t) { var r, n, i = String(a(e)), s = o(t), u = i.length; return s < 0 || s >= u ? oe ? "" : void 0 : (r = i.charCodeAt(s)) < 55296 || r > 56319 || s + 1 === u || (n = i.charCodeAt(s + 1)) < 56320 || n > 57343 ? oe ? i.charAt(s) : r : oe ? i.slice(s, s + 2) : n - 56320 + (r - 55296 << 10) + 65536 }); he(String, "String", function (e) { this._t = String(e), this._i = 0 }, function () { var e, t = this._t, r = this._i; return r >= t.length ? { value: void 0, done: !0 } : (e = pe(t, r), this._i += e.length, { value: e, done: !1 }) }); for (var ve = function (e, t) { return { value: t, done: !!e } }, me = (he(Array, "Array", function (e, t) { this._t = C(e), this._i = 0, this._k = t }, function () { var e = this._t, t = this._k, r = this._i++; return !e || r >= e.length ? (this._t = void 0, ve(1)) : ve(0, "keys" == t ? r : "values" == t ? e[r] : [r, e[r]]) }, "values"), ee("toStringTag")), ye = ["NodeList", "DOMTokenList", "MediaList", "StyleSheetList", "CSSRuleList"], ge = 0; ge < 5; ge++) { var be = ye[ge], _e = s[be], we = _e && _e.prototype; we && !we[me] && E(we, me, be) } var Ee = { f: ee }, Se = Ee.f("iterator"), ke = r(function (e) { e.exports = { default: Se, __esModule: !0 } }), Te = r(function (e) { var t = j("meta"), r = _.f, n = 0, i = Object.isExtensible || function () { return !0 }, o = !d(function () { return i(Object.preventExtensions({})) }), a = function (e) { r(e, t, { value: { i: "O" + ++n, w: {} } }) }, s = e.exports = { KEY: t, NEED: !1, fastKey: function (e, r) { if (!c(e)) return "symbol" == typeof e ? e : ("string" == typeof e ? "S" : "P") + e; if (!O(e, t)) { if (!i(e)) return "F"; if (!r) return "E"; a(e) } return e[t].i }, getWeak: function (e, r) { if (!O(e, t)) { if (!i(e)) return !0; if (!r) return !1; a(e) } return e[t].w }, onFreeze: function (e) { return o && s.NEED && i(e) && !O(e, t) && a(e), e } } }), Ae = _.f, Re = function (e) { var t = u.Symbol || (u.Symbol = {}); "_" == e.charAt(0) || e in t || Ae(t, e, { value: Ee.f(e) }) }, Oe = { f: Object.getOwnPropertySymbols }, Le = { f: {}.propertyIsEnumerable }, xe = Array.isArray || function (e) { return "Array" == x(e) }, Pe = W.concat("length", "prototype"), Ce = { f: Object.getOwnPropertyNames || function (e) { return V(e, Pe) } }, De = Ce.f, Ie = {}.toString, Me = "object" == typeof window && window && Object.getOwnPropertyNames ? Object.getOwnPropertyNames(window) : [], Ne = { f: function (e) { return Me && "[object Window]" == Ie.call(e) ? function (e) { try { return De(e) } catch (e) { return Me.slice() } }(e) : De(C(e)) } }, Fe = Object.getOwnPropertyDescriptor, Be = { f: h ? Fe : function (e, t) { if (e = C(e), t = g(t, !0), y) try { return Fe(e, t) } catch (e) { } if (O(e, t)) return w(!Le.f.call(e, t), e[t]) } }, Ue = Te.KEY, je = Be.f, Ge = _.f, $e = Ne.f, ze = s.Symbol, Ke = s.JSON, Ve = Ke && Ke.stringify, We = ee("_hidden"), He = ee("toPrimitive"), qe = {}.propertyIsEnumerable, Ye = F("symbol-registry"), Xe = F("symbols"), Qe = F("op-symbols"), Je = Object.prototype, Ze = "function" == typeof ze, et = s.QObject, tt = !et || !et.prototype || !et.prototype.findChild, rt = h && d(function () { return 7 != Z(Ge({}, "a", { get: function () { return Ge(this, "a", { value: 7 }).a } })).a }) ? function (e, t, r) { var n = je(Je, t); n && delete Je[t], Ge(e, t, r), n && e !== Je && Ge(Je, t, n) } : Ge, nt = function (e) { var t = Xe[e] = Z(ze.prototype); return t._k = e, t }, it = Ze && "symbol" == typeof ze.iterator ? function (e) { return "symbol" == typeof e } : function (e) { return e instanceof ze }, ot = function (e, t, r) { return e === Je && ot(Qe, t, r), f(e), t = g(t, !0), f(r), O(Xe, t) ? (r.enumerable ? (O(e, We) && e[We][t] && (e[We][t] = !1), r = Z(r, { enumerable: w(0, !1) })) : (O(e, We) || Ge(e, We, w(1, {})), e[We][t] = !0), rt(e, t, r)) : Ge(e, t, r) }, at = function (e, t) { f(e); for (var r, n = function (e) { var t = H(e), r = Oe.f; if (r) for (var n, i = r(e), o = Le.f, a = 0; i.length > a;)o.call(e, n = i[a++]) && t.push(n); return t }(t = C(t)), i = 0, o = n.length; o > i;)ot(e, r = n[i++], t[r]); return e }, st = function (e) { var t = qe.call(this, e = g(e, !0)); return !(this === Je && O(Xe, e) && !O(Qe, e)) && (!(t || !O(this, e) || !O(Xe, e) || O(this, We) && this[We][e]) || t) }, ut = function (e, t) { if (e = C(e), t = g(t, !0), e !== Je || !O(Xe, t) || O(Qe, t)) { var r = je(e, t); return !r || !O(Xe, t) || O(e, We) && e[We][t] || (r.enumerable = !0), r } }, lt = function (e) { for (var t, r = $e(C(e)), n = [], i = 0; r.length > i;)O(Xe, t = r[i++]) || t == We || t == Ue || n.push(t); return n }, ct = function (e) { for (var t, r = e === Je, n = $e(r ? Qe : C(e)), i = [], o = 0; n.length > o;)!O(Xe, t = n[o++]) || r && !O(Je, t) || i.push(Xe[t]); return i }; Ze || (A((ze = function () { if (this instanceof ze) throw TypeError("Symbol is not a constructor!"); var e = j(arguments.length > 0 ? arguments[0] : void 0), t = function (r) { this === Je && t.call(Qe, r), O(this, We) && O(this[We], e) && (this[We][e] = !1), rt(this, e, w(1, r)) }; return h && tt && rt(Je, e, { configurable: !0, set: t }), nt(e) }).prototype, "toString", function () { return this._k }), Be.f = ut, _.f = ot, Ce.f = Ne.f = lt, Le.f = st, Oe.f = ct, Ee.f = function (e) { return nt(ee(e)) }), T(T.G + T.W + T.F * !Ze, { Symbol: ze }); for (var ft = "hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","), dt = 0; ft.length > dt;)ee(ft[dt++]); for (var ft = H(ee.store), dt = 0; ft.length > dt;)Re(ft[dt++]); T(T.S + T.F * !Ze, "Symbol", { for: function (e) { return O(Ye, e += "") ? Ye[e] : Ye[e] = ze(e) }, keyFor: function (e) { if (it(e)) return function (e, t) { for (var r, n = C(e), i = H(n), o = i.length, a = 0; o > a;)if (n[r = i[a++]] === t) return r }(Ye, e); throw TypeError(e + " is not a symbol!") }, useSetter: function () { tt = !0 }, useSimple: function () { tt = !1 } }), T(T.S + T.F * !Ze, "Object", { create: function (e, t) { return void 0 === t ? Z(e) : at(Z(e), t) }, defineProperty: ot, defineProperties: at, getOwnPropertyDescriptor: ut, getOwnPropertyNames: lt, getOwnPropertySymbols: ct }), Ke && T(T.S + T.F * (!Ze || d(function () { var e = ze(); return "[null]" != Ve([e]) || "{}" != Ve({ a: e }) || "{}" != Ve(Object(e)) })), "JSON", { stringify: function (e) { if (void 0 !== e && !it(e)) { for (var t, r, n = [e], i = 1; arguments.length > i;)n.push(arguments[i++]); return "function" == typeof (t = n[1]) && (r = t), !r && xe(t) || (t = function (e, t) { if (r && (t = r.call(this, e, t)), !it(t)) return t }), n[1] = t, Ve.apply(Ke, n) } } }), ze.prototype[He] || E(ze.prototype, He, ze.prototype.valueOf), ne(ze, "Symbol"), ne(Math, "Math", !0), ne(s.JSON, "JSON", !0), Re("asyncIterator"), Re("observable"); var ht = u.Symbol, pt = r(function (e) { e.exports = { default: ht, __esModule: !0 } }), vt = t(r(function (e, t) { t.__esModule = !0; var r = o(ke), n = o(pt), i = "function" == typeof n.default && "symbol" == typeof r.default ? function (e) { return typeof e } : function (e) { return e && "function" == typeof n.default && e.constructor === n.default && e !== n.default.prototype ? "symbol" : typeof e }; function o(e) { return e && e.__esModule ? e : { default: e } } t.default = "function" == typeof n.default && "symbol" === i(r.default) ? function (e) { return void 0 === e ? "undefined" : i(e) } : function (e) { return e && "function" == typeof n.default && e.constructor === n.default && e !== n.default.prototype ? "symbol" : void 0 === e ? "undefined" : i(e) } })), mt = t(r(function (e, t) { t.__esModule = !0, t.default = function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } })); T(T.S + T.F * !h, "Object", { defineProperty: _.f }); var yt = u.Object, gt = function (e, t, r) { return yt.defineProperty(e, t, r) }, bt = r(function (e) { e.exports = { default: gt, __esModule: !0 } }), _t = t(r(function (e, t) { t.__esModule = !0; var r, n = (r = bt) && r.__esModule ? r : { default: r }; t.default = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var i = t[r]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), (0, n.default)(e, i.key, i) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }() })), wt = Object.assign, Et = !wt || d(function () { var e = {}, t = {}, r = Symbol(), n = "abcdefghijklmnopqrst"; return e[r] = 7, n.split("").forEach(function (e) { t[e] = e }), 7 != wt({}, e)[r] || Object.keys(wt({}, t)).join("") != n }) ? function (e, t) { for (var r = se(e), n = arguments.length, i = 1, o = Oe.f, a = Le.f; n > i;)for (var s, u = P(arguments[i++]), l = o ? H(u).concat(o(u)) : H(u), c = l.length, f = 0; c > f;)a.call(u, s = l[f++]) && (r[s] = u[s]); return r } : wt; T(T.S + T.F, "Object", { assign: Et }); var St = u.Object.assign, kt = t(r(function (e) { e.exports = { default: St, __esModule: !0 } })); T(T.S, "Object", { create: Z }); var Tt, At, Rt, Ot, Lt = u.Object, xt = function (e, t) { return Lt.create(e, t) }, Pt = t(r(function (e) { e.exports = { default: xt, __esModule: !0 } })); Tt = "keys", At = function () { return function (e) { return H(se(e)) } }, Rt = (u.Object || {})[Tt] || Object[Tt], (Ot = {})[Tt] = At(Rt), T(T.S + T.F * d(function () { Rt(1) }), "Object", Ot); var Ct = u.Object.keys, Dt = (r(function (e) { e.exports = { default: Ct, __esModule: !0 } }), Math.floor); T(T.S, "Number", { isInteger: function (e) { return !c(e) && isFinite(e) && Dt(e) === e } }); var It = u.Number.isInteger, Mt = (r(function (e) { e.exports = { default: It, __esModule: !0 } }), "\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"), Nt = "[" + Mt + "]", Ft = RegExp("^" + Nt + Nt + "*"), Bt = RegExp(Nt + Nt + "*$"), Ut = function (e, t, r) { var n = {}, i = d(function () { return !!Mt[e]() || "​" != "​"[e]() }), o = n[e] = i ? t(jt) : Mt[e]; r && (n[r] = o), T(T.P + T.F * i, "String", n) }, jt = Ut.trim = function (e, t) { return e = String(a(e)), 1 & t && (e = e.replace(Ft, "")), 2 & t && (e = e.replace(Bt, "")), e }, Gt = Ut, $t = s.parseFloat, zt = Gt.trim, Kt = 1 / $t(Mt + "-0") != -1 / 0 ? function (e) { var t = zt(String(e), 3), r = $t(t); return 0 === r && "-" == t.charAt(0) ? -0 : r } : $t; T(T.S + T.F * (Number.parseFloat != Kt), "Number", { parseFloat: Kt }); var Vt = parseFloat; function Wt(e) { return "function" == typeof e } function Ht(e) { return Object(e) === e && "[object Object]" === String(e) && !Wt(e) && (t = e, !Array.isArray(t)); var t } r(function (e) { e.exports = { default: Vt, __esModule: !0 } }); var qt = Pt(null); function Yt(e, t) { var r = e.__evt_id; r || (Object.defineProperty(e, "__evt_id", { writable: !0, enumerable: !1, configurable: !0 }), r = e.__evt_id = ++qt.count); var n = r + "_" + t, i = qt[n]; return i || (i = qt[n] = []), i } function Xt(e, t, r) { var n = Pt(null); n.type = t, n.target = e, r && kt(n, Ht(r) ? r : { data: r }), Yt(e, t).forEach(function (t) { (t[1] || t[0]).apply(e, [n]) }) } function Qt(e, t, r) { var n = arguments.length > 3 && void 0 !== arguments[3] && arguments[3], i = arguments[4]; Wt(n) && !i && (i = n, n = void 0); var o = [r, void 0, n]; n && !i && (i = function () { Jt(e, t, r, n); for (var i = arguments.length, o = Array(i), a = 0; a < i; a++)o[a] = arguments[a]; r.apply(e, o) }), i && (o[1] = i), Yt(e, t).push(o) } function Jt(e, t, r) { var n = arguments.length > 3 && void 0 !== arguments[3] && arguments[3], i = Yt(e, t); if (r || n) { var o = -1, a = void 0; return i.find(function (e, t) { if ((!r || e[0] === r) && (!n || e[2])) return o = t, a = e[1], !0 }), -1 !== o && i.splice(o, 1), a } i.length = 0 } qt.count = 0; var Zt = function () { function e(t, r) { var n = this; if (mt(this, e), Object.defineProperty(this, "__target", { writable: !0, enumerable: !1, configurable: !0 }), this.__target = this, t) { if ("object" !== (void 0 === t ? "undefined" : vt(t))) throw new Error("CusEvent target are not object"); this.__target = t, r && ["on", "once", "off", "emit"].forEach(function (e) { t[e] = n[e] }) } } return _t(e, [{ key: "on", value: function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] && arguments[2]; return Qt(this.__target, e, t, r), this } }, { key: "once", value: function (e, t) { return this.on(e, t, !0) } }, { key: "off", value: function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] && arguments[2]; return Jt(this.__target, e, t, r), this } }, { key: "emit", value: function (e, t) { return Xt(this.__target, e, { data: t }), this } }]), e }(); e.emitEventCache = Xt, e.addEventCache = Qt, e.removeEventCache = Jt, e.CustEvent = Zt, Object.defineProperty(e, "__esModule", { value: !0 }) }(t) }, function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); t.ERRORNO = { NET_ERROR: 100, CODEC_ERROR: 101, CANNOT_SEEK: 102, ENDOFSTREAM_ERROR: 103, MEDIASOURCE_ERROR: 104, SOURCEBUFFER_ERROR: 105, SBABORT_ERROR: 106, APPENDBUFFER_ERROR: 107 } }, function (e, t, r) { e.exports = function () { function e(e) { return e && e.__esModule ? e.default : e } function t(e, t) { return e(t = { exports: {} }, t.exports), t.exports } var r = e(t(function (e, t) { t.__esModule = !0, t.default = function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } })), n = t(function (e) { var t = e.exports = "undefined" != typeof window && window.Math == Math ? window : "undefined" != typeof self && self.Math == Math ? self : Function("return this")(); "number" == typeof __g && (__g = t) }), i = t(function (e) { var t = e.exports = { version: "2.5.0" }; "number" == typeof __e && (__e = t) }), o = function (e, t, r) { if (function (e) { if ("function" != typeof e) throw TypeError(e + " is not a function!") }(e), void 0 === t) return e; switch (r) { case 1: return function (r) { return e.call(t, r) }; case 2: return function (r, n) { return e.call(t, r, n) }; case 3: return function (r, n, i) { return e.call(t, r, n, i) } }return function () { return e.apply(t, arguments) } }, a = function (e) { return "object" == typeof e ? null !== e : "function" == typeof e }, s = function (e) { if (!a(e)) throw TypeError(e + " is not an object!"); return e }, u = function (e) { try { return !!e() } catch (e) { return !0 } }, l = !u(function () { return 7 != Object.defineProperty({}, "a", { get: function () { return 7 } }).a }), c = n.document, f = a(c) && a(c.createElement), d = function (e) { return f ? c.createElement(e) : {} }, h = !l && !u(function () { return 7 != Object.defineProperty(d("div"), "a", { get: function () { return 7 } }).a }), p = function (e, t) { if (!a(e)) return e; var r, n; if (t && "function" == typeof (r = e.toString) && !a(n = r.call(e))) return n; if ("function" == typeof (r = e.valueOf) && !a(n = r.call(e))) return n; if (!t && "function" == typeof (r = e.toString) && !a(n = r.call(e))) return n; throw TypeError("Can't convert object to primitive value") }, v = Object.defineProperty, m = { f: l ? Object.defineProperty : function (e, t, r) { if (s(e), t = p(t, !0), s(r), h) try { return v(e, t, r) } catch (e) { } if ("get" in r || "set" in r) throw TypeError("Accessors not supported!"); return "value" in r && (e[t] = r.value), e } }, y = function (e, t) { return { enumerable: !(1 & e), configurable: !(2 & e), writable: !(4 & e), value: t } }, g = l ? function (e, t, r) { return m.f(e, t, y(1, r)) } : function (e, t, r) { return e[t] = r, e }, b = function (e, t, r) { var a, s, u, l = e & b.F, c = e & b.G, f = e & b.S, d = e & b.P, h = e & b.B, p = e & b.W, v = c ? i : i[t] || (i[t] = {}), m = v.prototype, y = c ? n : f ? n[t] : (n[t] || {}).prototype; for (a in c && (r = t), r) (s = !l && y && void 0 !== y[a]) && a in v || (u = s ? y[a] : r[a], v[a] = c && "function" != typeof y[a] ? r[a] : h && s ? o(u, n) : p && y[a] == u ? function (e) { var t = function (t, r, n) { if (this instanceof e) { switch (arguments.length) { case 0: return new e; case 1: return new e(t); case 2: return new e(t, r) }return new e(t, r, n) } return e.apply(this, arguments) }; return t.prototype = e.prototype, t }(u) : d && "function" == typeof u ? o(Function.call, u) : u, d && ((v.virtual || (v.virtual = {}))[a] = u, e & b.R && m && !m[a] && g(m, a, u))) }; b.F = 1, b.G = 2, b.S = 4, b.P = 8, b.B = 16, b.W = 32, b.U = 64, b.R = 128; var _ = b; _(_.S + _.F * !l, "Object", { defineProperty: m.f }); var w, E = i.Object, S = function (e, t, r) { return E.defineProperty(e, t, r) }, k = t(function (e) { e.exports = { default: S, __esModule: !0 } }), T = e(t(function (e, t) { t.__esModule = !0; var r, n = (r = k) && r.__esModule ? r : { default: r }; t.default = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var i = t[r]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), (0, n.default)(e, i.key, i) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }() })), A = Math.ceil, R = Math.floor, O = function (e) { return isNaN(e = +e) ? 0 : (e > 0 ? R : A)(e) }, L = function (e) { if (null == e) throw TypeError("Can't call method on  " + e); return e }, x = g, P = {}.hasOwnProperty, C = function (e, t) { return P.call(e, t) }, D = {}.toString, I = function (e) { return D.call(e).slice(8, -1) }, M = Object("z").propertyIsEnumerable(0) ? Object : function (e) { return "String" == I(e) ? e.split("") : Object(e) }, N = function (e) { return M(L(e)) }, F = Math.min, B = Math.max, U = Math.min, j = n["__core-js_shared__"] || (n["__core-js_shared__"] = {}), G = function (e) { return j[e] || (j[e] = {}) }, $ = 0, z = Math.random(), K = function (e) { return "Symbol(".concat(void 0 === e ? "" : e, ")_", (++$ + z).toString(36)) }, V = G("keys"), W = function (e) { return V[e] || (V[e] = K(e)) }, H = (w = !1, function (e, t, r) { var n, i, o = N(e), a = (n = o.length) > 0 ? F(O(n), 9007199254740991) : 0, s = function (e, t) { return (e = O(e)) < 0 ? B(e + t, 0) : U(e, t) }(r, a); if (w && t != t) { for (; a > s;)if ((i = o[s++]) != i) return !0 } else for (; a > s; s++)if ((w || s in o) && o[s] === t) return w || s || 0; return !w && -1 }), q = W("IE_PROTO"), Y = function (e, t) { var r, n = N(e), i = 0, o = []; for (r in n) r != q && C(n, r) && o.push(r); for (; t.length > i;)C(n, r = t[i++]) && (~H(o, r) || o.push(r)); return o }, X = "constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","), Q = Object.keys || function (e) { return Y(e, X) }, J = l ? Object.defineProperties : function (e, t) { s(e); for (var r, n = Q(t), i = n.length, o = 0; i > o;)m.f(e, r = n[o++], t[r]); return e }, Z = n.document, ee = Z && Z.documentElement, te = W("IE_PROTO"), re = function () { }, ne = function () { var e, t = d("iframe"), r = X.length; for (t.style.display = "none", ee.appendChild(t), t.src = "javascript:", (e = t.contentWindow.document).open(), e.write("<script>document.F=Object<\/script>"), e.close(), ne = e.F; r--;)delete ne.prototype[X[r]]; return ne() }, ie = Object.create || function (e, t) { var r; return null !== e ? (re.prototype = s(e), r = new re, re.prototype = null, r[te] = e) : r = ne(), void 0 === t ? r : J(r, t) }, oe = t(function (e) { var t = G("wks"), r = n.Symbol, i = "function" == typeof r, o = e.exports = function (e) { return t[e] || (t[e] = i && r[e] || (i ? r : K)("Symbol." + e)) }; o.store = t }), ae = m.f, se = oe("toStringTag"), ue = function (e, t, r) { e && !C(e = r ? e : e.prototype, se) && ae(e, se, { configurable: !0, value: t }) }, le = {}; g(le, oe("iterator"), function () { return this }); var ce, fe = function (e, t, r) { e.prototype = ie(le, { next: y(1, r) }), ue(e, t + " Iterator") }, de = function (e) { return Object(L(e)) }, he = W("IE_PROTO"), pe = Object.prototype, ve = Object.getPrototypeOf || function (e) { return e = de(e), C(e, he) ? e[he] : "function" == typeof e.constructor && e instanceof e.constructor ? e.constructor.prototype : e instanceof Object ? pe : null }, me = oe("iterator"), ye = !([].keys && "next" in [].keys()), ge = function (e, t, r, n, i, o, a) { fe(r, t, n); var s, u, l, c = function (e) { if (!ye && e in p) return p[e]; switch (e) { case "keys": case "values": return function () { return new r(this, e) } }return function () { return new r(this, e) } }, f = t + " Iterator", d = "values" == i, h = !1, p = e.prototype, v = p[me] || p["@@iterator"] || i && p[i], m = v || c(i), y = i ? d ? c("entries") : m : void 0, b = "Array" == t && p.entries || v; if (b && (l = ve(b.call(new e))) !== Object.prototype && l.next && ue(l, f, !0), d && v && "values" !== v.name && (h = !0, m = function () { return v.call(this) }), a && (ye || h || !p[me]) && g(p, me, m), i) if (s = { values: d ? m : c("values"), keys: o ? m : c("keys"), entries: y }, a) for (u in s) u in p || x(p, u, s[u]); else _(_.P + _.F * (ye || h), t, s); return s }, be = (ce = !0, function (e, t) { var r, n, i = String(L(e)), o = O(t), a = i.length; return o < 0 || o >= a ? ce ? "" : void 0 : (r = i.charCodeAt(o)) < 55296 || r > 56319 || o + 1 === a || (n = i.charCodeAt(o + 1)) < 56320 || n > 57343 ? ce ? i.charAt(o) : r : ce ? i.slice(o, o + 2) : n - 56320 + (r - 55296 << 10) + 65536 }); ge(String, "String", function (e) { this._t = String(e), this._i = 0 }, function () { var e, t = this._t, r = this._i; return r >= t.length ? { value: void 0, done: !0 } : (e = be(t, r), this._i += e.length, { value: e, done: !1 }) }); for (var _e = function (e, t) { return { value: t, done: !!e } }, we = (ge(Array, "Array", function (e, t) { this._t = N(e), this._i = 0, this._k = t }, function () { var e = this._t, t = this._k, r = this._i++; return !e || r >= e.length ? (this._t = void 0, _e(1)) : _e(0, "keys" == t ? r : "values" == t ? e[r] : [r, e[r]]) }, "values"), oe("toStringTag")), Ee = "CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","), Se = 0; Se < Ee.length; Se++) { var ke = Ee[Se], Te = n[ke], Ae = Te && Te.prototype; Ae && !Ae[we] && g(Ae, we, ke) } var Re = { f: oe }, Oe = Re.f("iterator"), Le = t(function (e) { e.exports = { default: Oe, __esModule: !0 } }), xe = t(function (e) { var t = K("meta"), r = m.f, n = 0, i = Object.isExtensible || function () { return !0 }, o = !u(function () { return i(Object.preventExtensions({})) }), s = function (e) { r(e, t, { value: { i: "O" + ++n, w: {} } }) }, l = e.exports = { KEY: t, NEED: !1, fastKey: function (e, r) { if (!a(e)) return "symbol" == typeof e ? e : ("string" == typeof e ? "S" : "P") + e; if (!C(e, t)) { if (!i(e)) return "F"; if (!r) return "E"; s(e) } return e[t].i }, getWeak: function (e, r) { if (!C(e, t)) { if (!i(e)) return !0; if (!r) return !1; s(e) } return e[t].w }, onFreeze: function (e) { return o && l.NEED && i(e) && !C(e, t) && s(e), e } } }), Pe = m.f, Ce = function (e) { var t = i.Symbol || (i.Symbol = {}); "_" == e.charAt(0) || e in t || Pe(t, e, { value: Re.f(e) }) }, De = { f: Object.getOwnPropertySymbols }, Ie = { f: {}.propertyIsEnumerable }, Me = Array.isArray || function (e) { return "Array" == I(e) }, Ne = X.concat("length", "prototype"), Fe = { f: Object.getOwnPropertyNames || function (e) { return Y(e, Ne) } }, Be = Fe.f, Ue = {}.toString, je = "object" == typeof window && window && Object.getOwnPropertyNames ? Object.getOwnPropertyNames(window) : [], Ge = { f: function (e) { return je && "[object Window]" == Ue.call(e) ? function (e) { try { return Be(e) } catch (e) { return je.slice() } }(e) : Be(N(e)) } }, $e = Object.getOwnPropertyDescriptor, ze = { f: l ? $e : function (e, t) { if (e = N(e), t = p(t, !0), h) try { return $e(e, t) } catch (e) { } if (C(e, t)) return y(!Ie.f.call(e, t), e[t]) } }, Ke = xe.KEY, Ve = ze.f, We = m.f, He = Ge.f, qe = n.Symbol, Ye = n.JSON, Xe = Ye && Ye.stringify, Qe = oe("_hidden"), Je = oe("toPrimitive"), Ze = {}.propertyIsEnumerable, et = G("symbol-registry"), tt = G("symbols"), rt = G("op-symbols"), nt = Object.prototype, it = "function" == typeof qe, ot = n.QObject, at = !ot || !ot.prototype || !ot.prototype.findChild, st = l && u(function () { return 7 != ie(We({}, "a", { get: function () { return We(this, "a", { value: 7 }).a } })).a }) ? function (e, t, r) { var n = Ve(nt, t); n && delete nt[t], We(e, t, r), n && e !== nt && We(nt, t, n) } : We, ut = function (e) { var t = tt[e] = ie(qe.prototype); return t._k = e, t }, lt = it && "symbol" == typeof qe.iterator ? function (e) { return "symbol" == typeof e } : function (e) { return e instanceof qe }, ct = function (e, t, r) { return e === nt && ct(rt, t, r), s(e), t = p(t, !0), s(r), C(tt, t) ? (r.enumerable ? (C(e, Qe) && e[Qe][t] && (e[Qe][t] = !1), r = ie(r, { enumerable: y(0, !1) })) : (C(e, Qe) || We(e, Qe, y(1, {})), e[Qe][t] = !0), st(e, t, r)) : We(e, t, r) }, ft = function (e, t) { s(e); for (var r, n = function (e) { var t = Q(e), r = De.f; if (r) for (var n, i = r(e), o = Ie.f, a = 0; i.length > a;)o.call(e, n = i[a++]) && t.push(n); return t }(t = N(t)), i = 0, o = n.length; o > i;)ct(e, r = n[i++], t[r]); return e }, dt = function (e) { var t = Ze.call(this, e = p(e, !0)); return !(this === nt && C(tt, e) && !C(rt, e)) && (!(t || !C(this, e) || !C(tt, e) || C(this, Qe) && this[Qe][e]) || t) }, ht = function (e, t) { if (e = N(e), t = p(t, !0), e !== nt || !C(tt, t) || C(rt, t)) { var r = Ve(e, t); return !r || !C(tt, t) || C(e, Qe) && e[Qe][t] || (r.enumerable = !0), r } }, pt = function (e) { for (var t, r = He(N(e)), n = [], i = 0; r.length > i;)C(tt, t = r[i++]) || t == Qe || t == Ke || n.push(t); return n }, vt = function (e) { for (var t, r = e === nt, n = He(r ? rt : N(e)), i = [], o = 0; n.length > o;)!C(tt, t = n[o++]) || r && !C(nt, t) || i.push(tt[t]); return i }; it || (x((qe = function () { if (this instanceof qe) throw TypeError("Symbol is not a constructor!"); var e = K(arguments.length > 0 ? arguments[0] : void 0), t = function (r) { this === nt && t.call(rt, r), C(this, Qe) && C(this[Qe], e) && (this[Qe][e] = !1), st(this, e, y(1, r)) }; return l && at && st(nt, e, { configurable: !0, set: t }), ut(e) }).prototype, "toString", function () { return this._k }), ze.f = ht, m.f = ct, Fe.f = Ge.f = pt, Ie.f = dt, De.f = vt, Re.f = function (e) { return ut(oe(e)) }), _(_.G + _.W + _.F * !it, { Symbol: qe }); for (var mt = "hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","), yt = 0; mt.length > yt;)oe(mt[yt++]); for (var gt = Q(oe.store), bt = 0; gt.length > bt;)Ce(gt[bt++]); _(_.S + _.F * !it, "Symbol", { for: function (e) { return C(et, e += "") ? et[e] : et[e] = qe(e) }, keyFor: function (e) { if (lt(e)) return function (e, t) { for (var r, n = N(e), i = Q(n), o = i.length, a = 0; o > a;)if (n[r = i[a++]] === t) return r }(et, e); throw TypeError(e + " is not a symbol!") }, useSetter: function () { at = !0 }, useSimple: function () { at = !1 } }), _(_.S + _.F * !it, "Object", { create: function (e, t) { return void 0 === t ? ie(e) : ft(ie(e), t) }, defineProperty: ct, defineProperties: ft, getOwnPropertyDescriptor: ht, getOwnPropertyNames: pt, getOwnPropertySymbols: vt }), Ye && _(_.S + _.F * (!it || u(function () { var e = qe(); return "[null]" != Xe([e]) || "{}" != Xe({ a: e }) || "{}" != Xe(Object(e)) })), "JSON", { stringify: function (e) { if (void 0 !== e && !lt(e)) { for (var t, r, n = [e], i = 1; arguments.length > i;)n.push(arguments[i++]); return "function" == typeof (t = n[1]) && (r = t), !r && Me(t) || (t = function (e, t) { if (r && (t = r.call(this, e, t)), !lt(t)) return t }), n[1] = t, Xe.apply(Ye, n) } } }), qe.prototype[Je] || g(qe.prototype, Je, qe.prototype.valueOf), ue(qe, "Symbol"), ue(Math, "Math", !0), ue(n.JSON, "JSON", !0), Ce("asyncIterator"), Ce("observable"); var _t, wt, Et, St, kt = i.Symbol, Tt = t(function (e) { e.exports = { default: kt, __esModule: !0 } }), At = e(t(function (e, t) { t.__esModule = !0; var r = o(Le), n = o(Tt), i = "function" == typeof n.default && "symbol" == typeof r.default ? function (e) { return typeof e } : function (e) { return e && "function" == typeof n.default && e.constructor === n.default && e !== n.default.prototype ? "symbol" : typeof e }; function o(e) { return e && e.__esModule ? e : { default: e } } t.default = "function" == typeof n.default && "symbol" === i(r.default) ? function (e) { return void 0 === e ? "undefined" : i(e) } : function (e) { return e && "function" == typeof n.default && e.constructor === n.default && e !== n.default.prototype ? "symbol" : void 0 === e ? "undefined" : i(e) } })); _t = "keys", wt = function () { return function (e) { return Q(de(e)) } }, Et = (i.Object || {})[_t] || Object[_t], (St = {})[_t] = wt(Et), _(_.S + _.F * u(function () { Et(1) }), "Object", St); var Rt = i.Object.keys, Ot = (t(function (e) { e.exports = { default: Rt, __esModule: !0 } }), Math.floor); _(_.S, "Number", { isInteger: function (e) { return !a(e) && isFinite(e) && Ot(e) === e } }); var Lt = i.Number.isInteger, xt = (t(function (e) { e.exports = { default: Lt, __esModule: !0 } }), "\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"), Pt = "[" + xt + "]", Ct = RegExp("^" + Pt + Pt + "*"), Dt = RegExp(Pt + Pt + "*$"), It = function (e, t, r) { var n = {}, i = u(function () { return !!xt[e]() || "​" != "​"[e]() }), o = n[e] = i ? t(Mt) : xt[e]; r && (n[r] = o), _(_.P + _.F * i, "String", n) }, Mt = It.trim = function (e, t) { return e = String(L(e)), 1 & t && (e = e.replace(Ct, "")), 2 & t && (e = e.replace(Dt, "")), e }, Nt = It, Ft = n.parseFloat, Bt = Nt.trim, Ut = 1 / Ft(xt + "-0") != -1 / 0 ? function (e) { var t = Bt(String(e), 3), r = Ft(t); return 0 === r && "-" == t.charAt(0) ? -0 : r } : Ft; _(_.S + _.F * (Number.parseFloat != Ut), "Number", { parseFloat: Ut }); var jt = parseFloat; function Gt(e) { return "string" == typeof e || e instanceof String } function $t(e, t) { if (!Gt(e)) throw new TypeError("Log's method only acccept string as argument, but not " + e + " in " + (void 0 === e ? "undefined" : At(e))); return Gt(t) ? "[" + (e = zt.FORCE_GLOBAL_TAG ? zt.GLOBAL_TAG : e || zt.GLOBAL_TAG) + "] > " + t : "[" + zt.GLOBAL_TAG + "] > " + e } t(function (e) { e.exports = { default: jt, __esModule: !0 } }); var zt = function () { function e() { r(this, e) } return T(e, null, [{ key: "error", value: function (t, r) { e.ENABLE_ERROR && (console.error || console.warn || console.log)($t(t, r)) } }, { key: "info", value: function (t, r) { e.ENABLE_INFO && (console.info || console.log)($t(t, r)) } }, { key: "warn", value: function (t, r) { e.ENABLE_WARN && (console.warn || console.log)($t(t, r)) } }, { key: "debug", value: function (t, r) { e.ENABLE_DEBUG && (console.debug || console.log)($t(t, r)) } }, { key: "verbose", value: function (t, r) { e.ENABLE_VERBOSE && console.log($t(t, r)) } }]), e }(); return zt.GLOBAL_TAG = "chimee", zt.FORCE_GLOBAL_TAG = !1, zt.ENABLE_ERROR = !0, zt.ENABLE_INFO = !0, zt.ENABLE_WARN = !0, zt.ENABLE_DEBUG = !0, zt.ENABLE_VERBOSE = !0, zt }() }, function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }(), i = l(r(10)), o = l(r(12)), a = l(r(13)), s = l(r(14)), u = r(0); function l(e) { return e && e.__esModule ? e : { default: e } } var c = function (e) { function t(e) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); var r = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this)); return r.loader = null, r.config = {}, r.config = e || {}, r.bufferSize = 3145728, r.cacheBuffer = new ArrayBuffer(r.bufferSize), r.cacheRemain = 0, r.stashByteStart = 0, r.enableStash = !0, r.stashSize = r.config.stashSize || 393216, r.resumeFrom = 0, r.currentRange = {}, r.totalReceive = 0, r.seekPonit = void 0, r.timer = null, r.heartBeatInterval = null, r.preTotalReceive = 0, r.seekLock = !1, r.webSocketURLReg = /wss?:\/\/(.+?)/, r.selectLoader(), r.bindEvent(), r } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, u.CustEvent), n(t, [{ key: "selectLoader", value: function () { var e = this.config, t = this.config.src; this.webSocketURLReg.test(t) ? this.loader = new a.default(t, e, this.queryHandle) : i.default.isSupport() ? this.loader = new i.default(t, e, this.queryHandle) : s.default.isSupport() ? this.loader = new s.default(t, e, this.queryHandle) : o.default.isSupport() && (this.loader = new o.default(t, e, this.queryHandle)), this.loader.arrivalDataCallback = this.onLoaderChunkArrival.bind(this) } }, { key: "bindEvent", value: function () { var e = this; this.loader.on("end", function () { var t = e.cacheBuffer.slice(0, e.cacheRemain); e.arrivalDataCallback(t, e.stashByteStart), e.emit("end") }), this.loader.on("error", function (t) { e.emit("error", t.data) }) } }, { key: "onLoaderChunkArrival", value: function (e, t, r) { if ((!this.seekLock || void 0 !== r) && (void 0 !== r && (this.seekPonit = r, this.seekLock = !1), this.arrivalDataCallback)) if (this.totalReceive += e.byteLength, 0 === this.cacheRemain && 0 === this.stashByteStart && (this.stashByteStart = t), this.cacheRemain + e.byteLength <= this.stashSize) { new Uint8Array(this.cacheBuffer, 0, this.stashSize).set(new Uint8Array(e), this.cacheRemain), this.cacheRemain += e.byteLength } else { var n = new Uint8Array(this.cacheBuffer, 0, this.bufferSize); if (this.cacheRemain > 0) { var i = this.cacheBuffer.slice(0, this.cacheRemain), o = 0; if (void 0 !== this.seekPonit ? (o = this.arrivalDataCallback(i, this.stashByteStart, this.seekPonit), this.seekPonit = void 0) : o = this.arrivalDataCallback(i, this.stashByteStart), o < i.byteLength) { if (o > 0) { var a = new Uint8Array(i, o); n.set(a, 0), this.cacheRemain = a.byteLength, this.stashByteStart += o } } else this.cacheRemain = 0, this.stashByteStart += o; this.cacheRemain + e.byteLength > this.bufferSize && (this.expandBuffer(this.cacheRemain + e.byteLength), n = new Uint8Array(this.cacheBuffer, 0, this.bufferSize)), n.set(new Uint8Array(e), this.cacheRemain), this.cacheRemain += e.byteLength } else { var s = 0; if (void 0 !== this.seekPonit ? (s = this.arrivalDataCallback(e, t, this.seekPonit), this.seekPonit = void 0) : s = this.arrivalDataCallback(e, t), s < e.byteLength) { var u = e.byteLength - s; u > this.bufferSize && (this.expandBuffer(u), n = new Uint8Array(this.cacheBuffer, 0, this.bufferSize)), n.set(new Uint8Array(e, s), 0), this.cacheRemain += u, this.stashByteStart = t + s } } } } }, { key: "initCacheBuffer", value: function () { this.cacheRemain = 0, this.totalReceive = 0, this.cacheBuffer = new ArrayBuffer(this.bufferSize) } }, { key: "expandBuffer", value: function (e) { var t = this.bufferSize; t < e && (t = e), this.cacheBuffer = new ArrayBuffer(t), this.bufferSize = t } }, { key: "pause", value: function () { this.loader.pause() } }, { key: "open", value: function (e, t) { this.loader.open({ from: e || 0, to: -1 }, t), this.heartbeat() } }, { key: "heartbeat", value: function () { var e = this; window.clearInterval(this.heartBeatInterval), this.heartBeatInterval = setInterval(function () { e.emit("heartbeat", { speed: e.totalReceive - e.preTotalReceive, totalReceive: e.totalReceive }), e.preTotalReceive = e.totalReceive }, 1e3) } }, { key: "resume", value: function () { this.paused = !1; var e = this.totalReceive; this.open(e) } }, { key: "seek", value: function (e, t, r) { this.seekLock = !0, this.totalReceive = e, this.preTotalReceive = e, this.initCacheBuffer(), this.cacheRemain = 0, this.stashByteStart = 0, this.open(e, r) } }, { key: "destroy", value: function () { this.pause(), this.initCacheBuffer(), window.clearInterval(this.heartBeatInterval), this.heartBeatInterval = null } }]), t }(); t.default = c }, function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }), t.default = function (e) { var t = {}, r = void 0; return r = -1 !== e.to ? "bytes=" + e.from.toString() + "-" + e.to.toString() : "bytes=" + e.from.toString() + "-", t.Range = r, { headers: t } } }, function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r(0); r.n(n); function i(e) { return e && e.__esModule && Object.prototype.hasOwnProperty.call(e, "default") ? e.default : e } function o(e, t) { return e(t = { exports: {} }, t.exports), t.exports } var a = function (e) { if (null == e) throw TypeError("Can't call method on  " + e); return e }, s = function (e) { return Object(a(e)) }, u = {}.hasOwnProperty, l = function (e, t) { return u.call(e, t) }, c = o(function (e) { var t = e.exports = "undefined" != typeof window && window.Math == Math ? window : "undefined" != typeof self && self.Math == Math ? self : Function("return this")(); "number" == typeof __g && (__g = t) }), f = c["__core-js_shared__"] || (c["__core-js_shared__"] = {}), d = function (e) { return f[e] || (f[e] = {}) }, h = 0, p = Math.random(), m = function (e) { return "Symbol(".concat(void 0 === e ? "" : e, ")_", (++h + p).toString(36)) }, y = d("keys"), g = function (e) { return y[e] || (y[e] = m(e)) }, b = g("IE_PROTO"), _ = Object.prototype, w = Object.getPrototypeOf || function (e) { return e = s(e), l(e, b) ? e[b] : "function" == typeof e.constructor && e instanceof e.constructor ? e.constructor.prototype : e instanceof Object ? _ : null }, E = o(function (e) { var t = e.exports = { version: "2.5.1" }; "number" == typeof __e && (__e = t) }), S = function (e, t, r) { if (function (e) { if ("function" != typeof e) throw TypeError(e + " is not a function!") }(e), void 0 === t) return e; switch (r) { case 1: return function (r) { return e.call(t, r) }; case 2: return function (r, n) { return e.call(t, r, n) }; case 3: return function (r, n, i) { return e.call(t, r, n, i) } }return function () { return e.apply(t, arguments) } }, k = function (e) { return "object" == typeof e ? null !== e : "function" == typeof e }, T = function (e) { if (!k(e)) throw TypeError(e + " is not an object!"); return e }, A = function (e) { try { return !!e() } catch (e) { return !0 } }, R = !A(function () { return 7 != Object.defineProperty({}, "a", { get: function () { return 7 } }).a }), O = c.document, L = k(O) && k(O.createElement), x = function (e) { return L ? O.createElement(e) : {} }, P = !R && !A(function () { return 7 != Object.defineProperty(x("div"), "a", { get: function () { return 7 } }).a }), C = function (e, t) { if (!k(e)) return e; var r, n; if (t && "function" == typeof (r = e.toString) && !k(n = r.call(e))) return n; if ("function" == typeof (r = e.valueOf) && !k(n = r.call(e))) return n; if (!t && "function" == typeof (r = e.toString) && !k(n = r.call(e))) return n; throw TypeError("Can't convert object to primitive value") }, D = Object.defineProperty, I = { f: R ? Object.defineProperty : function (e, t, r) { if (T(e), t = C(t, !0), T(r), P) try { return D(e, t, r) } catch (e) { } if ("get" in r || "set" in r) throw TypeError("Accessors not supported!"); return "value" in r && (e[t] = r.value), e } }, M = function (e, t) { return { enumerable: !(1 & e), configurable: !(2 & e), writable: !(4 & e), value: t } }, N = R ? function (e, t, r) { return I.f(e, t, M(1, r)) } : function (e, t, r) { return e[t] = r, e }, F = function (e, t, r) { var n, i, o, a = e & F.F, s = e & F.G, u = e & F.S, l = e & F.P, f = e & F.B, d = e & F.W, h = s ? E : E[t] || (E[t] = {}), p = h.prototype, v = s ? c : u ? c[t] : (c[t] || {}).prototype; for (n in s && (r = t), r) (i = !a && v && void 0 !== v[n]) && n in h || (o = i ? v[n] : r[n], h[n] = s && "function" != typeof v[n] ? r[n] : f && i ? S(o, c) : d && v[n] == o ? function (e) { var t = function (t, r, n) { if (this instanceof e) { switch (arguments.length) { case 0: return new e; case 1: return new e(t); case 2: return new e(t, r) }return new e(t, r, n) } return e.apply(this, arguments) }; return t.prototype = e.prototype, t }(o) : l && "function" == typeof o ? S(Function.call, o) : o, l && ((h.virtual || (h.virtual = {}))[n] = o, e & F.R && p && !p[n] && N(p, n, o))) }; F.F = 1, F.G = 2, F.S = 4, F.P = 8, F.B = 16, F.W = 32, F.U = 64, F.R = 128; var B, U, j, G, $ = F; B = "getPrototypeOf", U = function () { return function (e) { return w(s(e)) } }, j = (E.Object || {})[B] || Object[B], (G = {})[B] = U(j), $($.S + $.F * A(function () { j(1) }), "Object", G); var z, K = E.Object.getPrototypeOf, V = i(o(function (e) { e.exports = { default: K, __esModule: !0 } })), W = Math.ceil, H = Math.floor, q = function (e) { return isNaN(e = +e) ? 0 : (e > 0 ? H : W)(e) }, Y = N, X = {}.toString, Q = function (e) { return X.call(e).slice(8, -1) }, J = Object("z").propertyIsEnumerable(0) ? Object : function (e) { return "String" == Q(e) ? e.split("") : Object(e) }, Z = function (e) { return J(a(e)) }, ee = Math.min, te = Math.max, re = Math.min, ne = (z = !1, function (e, t, r) { var n, i, o = Z(e), a = (n = o.length) > 0 ? ee(q(n), 9007199254740991) : 0, s = function (e, t) { return (e = q(e)) < 0 ? te(e + t, 0) : re(e, t) }(r, a); if (z && t != t) { for (; a > s;)if ((i = o[s++]) != i) return !0 } else for (; a > s; s++)if ((z || s in o) && o[s] === t) return z || s || 0; return !z && -1 }), ie = g("IE_PROTO"), oe = function (e, t) { var r, n = Z(e), i = 0, o = []; for (r in n) r != ie && l(n, r) && o.push(r); for (; t.length > i;)l(n, r = t[i++]) && (~ne(o, r) || o.push(r)); return o }, ae = "constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","), se = Object.keys || function (e) { return oe(e, ae) }, ue = R ? Object.defineProperties : function (e, t) { T(e); for (var r, n = se(t), i = n.length, o = 0; i > o;)I.f(e, r = n[o++], t[r]); return e }, le = c.document, ce = le && le.documentElement, fe = g("IE_PROTO"), de = function () { }, he = function () { var e, t = x("iframe"), r = ae.length; for (t.style.display = "none", ce.appendChild(t), t.src = "javascript:", (e = t.contentWindow.document).open(), e.write("<script>document.F=Object<\/script>"), e.close(), he = e.F; r--;)delete he.prototype[ae[r]]; return he() }, pe = Object.create || function (e, t) { var r; return null !== e ? (de.prototype = T(e), r = new de, de.prototype = null, r[fe] = e) : r = he(), void 0 === t ? r : ue(r, t) }, ve = o(function (e) { var t = d("wks"), r = c.Symbol, n = "function" == typeof r; (e.exports = function (e) { return t[e] || (t[e] = n && r[e] || (n ? r : m)("Symbol." + e)) }).store = t }), me = I.f, ye = ve("toStringTag"), ge = function (e, t, r) { e && !l(e = r ? e : e.prototype, ye) && me(e, ye, { configurable: !0, value: t }) }, be = {}; N(be, ve("iterator"), function () { return this }); var _e, we = function (e, t, r) { e.prototype = pe(be, { next: M(1, r) }), ge(e, t + " Iterator") }, Ee = ve("iterator"), Se = !([].keys && "next" in [].keys()), ke = function (e, t, r, n, i, o, a) { we(r, t, n); var s, u, l, c = function (e) { if (!Se && e in p) return p[e]; switch (e) { case "keys": case "values": return function () { return new r(this, e) } }return function () { return new r(this, e) } }, f = t + " Iterator", d = "values" == i, h = !1, p = e.prototype, v = p[Ee] || p["@@iterator"] || i && p[i], m = v || c(i), y = i ? d ? c("entries") : m : void 0, g = "Array" == t && p.entries || v; if (g && (l = w(g.call(new e))) !== Object.prototype && l.next && ge(l, f, !0), d && v && "values" !== v.name && (h = !0, m = function () { return v.call(this) }), a && (Se || h || !p[Ee]) && N(p, Ee, m), i) if (s = { values: d ? m : c("values"), keys: o ? m : c("keys"), entries: y }, a) for (u in s) u in p || Y(p, u, s[u]); else $($.P + $.F * (Se || h), t, s); return s }, Te = (_e = !0, function (e, t) { var r, n, i = String(a(e)), o = q(t), s = i.length; return o < 0 || o >= s ? _e ? "" : void 0 : (r = i.charCodeAt(o)) < 55296 || r > 56319 || o + 1 === s || (n = i.charCodeAt(o + 1)) < 56320 || n > 57343 ? _e ? i.charAt(o) : r : _e ? i.slice(o, o + 2) : n - 56320 + (r - 55296 << 10) + 65536 }); ke(String, "String", function (e) { this._t = String(e), this._i = 0 }, function () { var e, t = this._t, r = this._i; return r >= t.length ? { value: void 0, done: !0 } : (e = Te(t, r), this._i += e.length, { value: e, done: !1 }) }); for (var Ae = function (e, t) { return { value: t, done: !!e } }, Re = (ke(Array, "Array", function (e, t) { this._t = Z(e), this._i = 0, this._k = t }, function () { var e = this._t, t = this._k, r = this._i++; return !e || r >= e.length ? (this._t = void 0, Ae(1)) : Ae(0, "keys" == t ? r : "values" == t ? e[r] : [r, e[r]]) }, "values"), ve("toStringTag")), Oe = "CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","), Le = 0; Le < Oe.length; Le++) { var xe = Oe[Le], Pe = c[xe], Ce = Pe && Pe.prototype; Ce && !Ce[Re] && N(Ce, Re, xe) } var De = { f: ve }, Ie = De.f("iterator"), Me = o(function (e) { e.exports = { default: Ie, __esModule: !0 } }); i(Me); var Ne = o(function (e) { var t = m("meta"), r = I.f, n = 0, i = Object.isExtensible || function () { return !0 }, o = !A(function () { return i(Object.preventExtensions({})) }), a = function (e) { r(e, t, { value: { i: "O" + ++n, w: {} } }) }, s = e.exports = { KEY: t, NEED: !1, fastKey: function (e, r) { if (!k(e)) return "symbol" == typeof e ? e : ("string" == typeof e ? "S" : "P") + e; if (!l(e, t)) { if (!i(e)) return "F"; if (!r) return "E"; a(e) } return e[t].i }, getWeak: function (e, r) { if (!l(e, t)) { if (!i(e)) return !0; if (!r) return !1; a(e) } return e[t].w }, onFreeze: function (e) { return o && s.NEED && i(e) && !l(e, t) && a(e), e } } }), Fe = I.f, Be = function (e) { var t = E.Symbol || (E.Symbol = {}); "_" == e.charAt(0) || e in t || Fe(t, e, { value: De.f(e) }) }, Ue = { f: Object.getOwnPropertySymbols }, je = { f: {}.propertyIsEnumerable }, Ge = Array.isArray || function (e) { return "Array" == Q(e) }, $e = ae.concat("length", "prototype"), ze = { f: Object.getOwnPropertyNames || function (e) { return oe(e, $e) } }, Ke = ze.f, Ve = {}.toString, We = "object" == typeof window && window && Object.getOwnPropertyNames ? Object.getOwnPropertyNames(window) : [], He = { f: function (e) { return We && "[object Window]" == Ve.call(e) ? function (e) { try { return Ke(e) } catch (e) { return We.slice() } }(e) : Ke(Z(e)) } }, qe = Object.getOwnPropertyDescriptor, Ye = { f: R ? qe : function (e, t) { if (e = Z(e), t = C(t, !0), P) try { return qe(e, t) } catch (e) { } if (l(e, t)) return M(!je.f.call(e, t), e[t]) } }, Xe = Ne.KEY, Qe = Ye.f, Je = I.f, Ze = He.f, et = c.Symbol, tt = c.JSON, rt = tt && tt.stringify, nt = ve("_hidden"), it = ve("toPrimitive"), ot = {}.propertyIsEnumerable, at = d("symbol-registry"), st = d("symbols"), ut = d("op-symbols"), lt = Object.prototype, ct = "function" == typeof et, ft = c.QObject, dt = !ft || !ft.prototype || !ft.prototype.findChild, ht = R && A(function () { return 7 != pe(Je({}, "a", { get: function () { return Je(this, "a", { value: 7 }).a } })).a }) ? function (e, t, r) { var n = Qe(lt, t); n && delete lt[t], Je(e, t, r), n && e !== lt && Je(lt, t, n) } : Je, pt = function (e) { var t = st[e] = pe(et.prototype); return t._k = e, t }, vt = ct && "symbol" == typeof et.iterator ? function (e) { return "symbol" == typeof e } : function (e) { return e instanceof et }, mt = function (e, t, r) { return e === lt && mt(ut, t, r), T(e), t = C(t, !0), T(r), l(st, t) ? (r.enumerable ? (l(e, nt) && e[nt][t] && (e[nt][t] = !1), r = pe(r, { enumerable: M(0, !1) })) : (l(e, nt) || Je(e, nt, M(1, {})), e[nt][t] = !0), ht(e, t, r)) : Je(e, t, r) }, yt = function (e, t) { T(e); for (var r, n = function (e) { var t = se(e), r = Ue.f; if (r) for (var n, i = r(e), o = je.f, a = 0; i.length > a;)o.call(e, n = i[a++]) && t.push(n); return t }(t = Z(t)), i = 0, o = n.length; o > i;)mt(e, r = n[i++], t[r]); return e }, gt = function (e) { var t = ot.call(this, e = C(e, !0)); return !(this === lt && l(st, e) && !l(ut, e)) && (!(t || !l(this, e) || !l(st, e) || l(this, nt) && this[nt][e]) || t) }, bt = function (e, t) { if (e = Z(e), t = C(t, !0), e !== lt || !l(st, t) || l(ut, t)) { var r = Qe(e, t); return !r || !l(st, t) || l(e, nt) && e[nt][t] || (r.enumerable = !0), r } }, _t = function (e) { for (var t, r = Ze(Z(e)), n = [], i = 0; r.length > i;)l(st, t = r[i++]) || t == nt || t == Xe || n.push(t); return n }, wt = function (e) { for (var t, r = e === lt, n = Ze(r ? ut : Z(e)), i = [], o = 0; n.length > o;)!l(st, t = n[o++]) || r && !l(lt, t) || i.push(st[t]); return i }; ct || (Y((et = function () { if (this instanceof et) throw TypeError("Symbol is not a constructor!"); var e = m(arguments.length > 0 ? arguments[0] : void 0), t = function (r) { this === lt && t.call(ut, r), l(this, nt) && l(this[nt], e) && (this[nt][e] = !1), ht(this, e, M(1, r)) }; return R && dt && ht(lt, e, { configurable: !0, set: t }), pt(e) }).prototype, "toString", function () { return this._k }), Ye.f = bt, I.f = mt, ze.f = He.f = _t, je.f = gt, Ue.f = wt, De.f = function (e) { return pt(ve(e)) }), $($.G + $.W + $.F * !ct, { Symbol: et }); for (var Et = "hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","), St = 0; Et.length > St;)ve(Et[St++]); for (var kt = se(ve.store), Tt = 0; kt.length > Tt;)Be(kt[Tt++]); $($.S + $.F * !ct, "Symbol", { for: function (e) { return l(at, e += "") ? at[e] : at[e] = et(e) }, keyFor: function (e) { if (!vt(e)) throw TypeError(e + " is not a symbol!"); for (var t in at) if (at[t] === e) return t }, useSetter: function () { dt = !0 }, useSimple: function () { dt = !1 } }), $($.S + $.F * !ct, "Object", { create: function (e, t) { return void 0 === t ? pe(e) : yt(pe(e), t) }, defineProperty: mt, defineProperties: yt, getOwnPropertyDescriptor: bt, getOwnPropertyNames: _t, getOwnPropertySymbols: wt }), tt && $($.S + $.F * (!ct || A(function () { var e = et(); return "[null]" != rt([e]) || "{}" != rt({ a: e }) || "{}" != rt(Object(e)) })), "JSON", { stringify: function (e) { if (void 0 !== e && !vt(e)) { for (var t, r, n = [e], i = 1; arguments.length > i;)n.push(arguments[i++]); return "function" == typeof (t = n[1]) && (r = t), !r && Ge(t) || (t = function (e, t) { if (r && (t = r.call(this, e, t)), !vt(t)) return t }), n[1] = t, rt.apply(tt, n) } } }), et.prototype[it] || N(et.prototype, it, et.prototype.valueOf), ge(et, "Symbol"), ge(Math, "Math", !0), ge(c.JSON, "JSON", !0), Be("asyncIterator"), Be("observable"); var At = E.Symbol, Rt = o(function (e) { e.exports = { default: At, __esModule: !0 } }); i(Rt); var Ot = o(function (e, t) { t.__esModule = !0; var r = o(Me), n = o(Rt), i = "function" == typeof n.default && "symbol" == typeof r.default ? function (e) { return typeof e } : function (e) { return e && "function" == typeof n.default && e.constructor === n.default && e !== n.default.prototype ? "symbol" : typeof e }; function o(e) { return e && e.__esModule ? e : { default: e } } t.default = "function" == typeof n.default && "symbol" === i(r.default) ? function (e) { return void 0 === e ? "undefined" : i(e) } : function (e) { return e && "function" == typeof n.default && e.constructor === n.default && e !== n.default.prototype ? "symbol" : void 0 === e ? "undefined" : i(e) } }), Lt = i(Ot), xt = i(o(function (e, t) { t.__esModule = !0; var r, n = (r = Ot) && r.__esModule ? r : { default: r }; t.default = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" !== (void 0 === t ? "undefined" : (0, n.default)(t)) && "function" != typeof t ? e : t } })), Pt = function (e, t) { if (T(e), !k(t) && null !== t) throw TypeError(t + ": can't set as prototype!") }, Ct = { set: Object.setPrototypeOf || ("__proto__" in {} ? function (e, t, r) { try { (r = S(Function.call, Ye.f(Object.prototype, "__proto__").set, 2))(e, []), t = !(e instanceof Array) } catch (e) { t = !0 } return function (e, n) { return Pt(e, n), t ? e.__proto__ = n : r(e, n), e } }({}, !1) : void 0), check: Pt }; $($.S, "Object", { setPrototypeOf: Ct.set }); var Dt = E.Object.setPrototypeOf, It = o(function (e) { e.exports = { default: Dt, __esModule: !0 } }); i(It), $($.S, "Object", { create: pe }); var Mt = E.Object, Nt = function (e, t) { return Mt.create(e, t) }, Ft = o(function (e) { e.exports = { default: Nt, __esModule: !0 } }); i(Ft); var Bt = i(o(function (e, t) { t.__esModule = !0; var r = o(It), n = o(Ft), i = o(Ot); function o(e) { return e && e.__esModule ? e : { default: e } } t.default = function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + (void 0 === t ? "undefined" : (0, i.default)(t))); e.prototype = (0, n.default)(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (r.default ? (0, r.default)(e, t) : e.__proto__ = t) } })), Ut = Object.assign, jt = !Ut || A(function () { var e = {}, t = {}, r = Symbol(), n = "abcdefghijklmnopqrst"; return e[r] = 7, n.split("").forEach(function (e) { t[e] = e }), 7 != Ut({}, e)[r] || Object.keys(Ut({}, t)).join("") != n }) ? function (e, t) { for (var r = s(e), n = arguments.length, i = 1, o = Ue.f, a = je.f; n > i;)for (var u, l = J(arguments[i++]), c = o ? se(l).concat(o(l)) : se(l), f = c.length, d = 0; f > d;)a.call(l, u = c[d++]) && (r[u] = l[u]); return r } : Ut; $($.S + $.F, "Object", { assign: jt }); var Gt = E.Object.assign, $t = i(o(function (e) { e.exports = { default: Gt, __esModule: !0 } })), zt = i(o(function (e, t) { t.__esModule = !0, t.default = function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } })); $($.S + $.F * !R, "Object", { defineProperty: I.f }); var Kt = E.Object, Vt = function (e, t, r) { return Kt.defineProperty(e, t, r) }, Wt = o(function (e) { e.exports = { default: Vt, __esModule: !0 } }); i(Wt); var Ht = i(o(function (e, t) { t.__esModule = !0; var r, n = (r = Wt) && r.__esModule ? r : { default: r }; t.default = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var i = t[r]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), (0, n.default)(e, i.key, i) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }() })), qt = function () { function e() { zt(this, e), this.tagType = -1, this.dataSize = -1, this.Timestamp = -1, this.StreamID = -1, this.body = -1, this.time = -1, this.arr = [], this.size = -1 } return Ht(e, [{ key: "getTime", value: function () { this.arr = []; for (var e = 0; e < this.Timestamp.length; e++)this.arr.push(1 == this.Timestamp[e].toString(16).length ? "0" + this.Timestamp[e].toString(16) : this.Timestamp[e].toString(16)); this.arr.pop(); var t = this.arr.join(""); return this.time = parseInt(t, 16), parseInt(t, 16) } }]), e }(); function Yt(e) { for (var t = [], r = e, n = 0, i = e.length; n < i;)if (r[n] < 128) t.push(String.fromCharCode(r[n])), ++n; else { if (r[n] < 192); else if (r[n] < 224) { if (Xt(r, n, 1)) { var o = (31 & r[n]) << 6 | 63 & r[n + 1]; if (o >= 128) { t.push(String.fromCharCode(65535 & o)), n += 2; continue } } } else if (r[n] < 240) { if (Xt(r, n, 2)) { var a = (15 & r[n]) << 12 | (63 & r[n + 1]) << 6 | 63 & r[n + 2]; if (a >= 2048 && 55296 != (63488 & a)) { t.push(String.fromCharCode(65535 & a)), n += 3; continue } } } else if (r[n] < 248 && Xt(r, n, 3)) { var s = (7 & r[n]) << 18 | (63 & r[n + 1]) << 12 | (63 & r[n + 2]) << 6 | 63 & r[n + 3]; if (s > 65536 && s < 1114112) { s -= 65536, t.push(String.fromCharCode(s >>> 10 | 55296)), t.push(String.fromCharCode(1023 & s | 56320)), n += 4; continue } } t.push(String.fromCharCode(65533)), ++n } return t.join("") } function Xt(e, t, r) { var n = e; if (t + r < n.length) { for (; r--;)if (128 != (192 & n[++t])) return !1; return !0 } return !1 } var Qt = function () { function e(t) { zt(this, e), this.TAG = this.constructor.name, this._buffer = t, this._buffer_index = 0, this._total_bytes = t.byteLength, this._total_bits = 8 * t.byteLength, this._current_word = 0, this._current_word_bits_left = 0 } return Ht(e, [{ key: "destroy", value: function () { this._buffer = null } }, { key: "_fillCurrentWord", value: function () { var e = this._total_bytes - this._buffer_index; if (e <= 0) throw new IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available"); var t = Math.min(4, e), r = new Uint8Array(4); r.set(this._buffer.subarray(this._buffer_index, this._buffer_index + t)), this._current_word = new DataView(r.buffer).getUint32(0, !1), this._buffer_index += t, this._current_word_bits_left = 8 * t } }, { key: "readBits", value: function (e) { if (e > 32) throw new InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!"); if (e <= this._current_word_bits_left) { var t = this._current_word >>> 32 - e; return this._current_word <<= e, this._current_word_bits_left -= e, t } var r = this._current_word_bits_left ? this._current_word : 0; r >>>= 32 - this._current_word_bits_left; var n = e - this._current_word_bits_left; this._fillCurrentWord(); var i = Math.min(n, this._current_word_bits_left), o = this._current_word >>> 32 - i; return this._current_word <<= i, this._current_word_bits_left -= i, r = r << i | o } }, { key: "readBool", value: function () { return 1 === this.readBits(1) } }, { key: "readByte", value: function () { return this.readBits(8) } }, { key: "_skipLeadingZero", value: function () { var e = void 0; for (e = 0; e < this._current_word_bits_left; e++)if (0 != (this._current_word & 2147483648 >>> e)) return this._current_word <<= e, this._current_word_bits_left -= e, e; return this._fillCurrentWord(), e + this._skipLeadingZero() } }, { key: "readUEG", value: function () { var e = this._skipLeadingZero(); return this.readBits(e + 1) - 1 } }, { key: "readSEG", value: function () { var e = this.readUEG(); return 1 & e ? e + 1 >>> 1 : -1 * (e >>> 1) } }]), e }(), Jt = function () { function e() { zt(this, e) } return Ht(e, null, [{ key: "_ebsp2rbsp", value: function (e) { for (var t = e, r = t.byteLength, n = new Uint8Array(r), i = 0, o = 0; o < r; o++)o >= 2 && 3 === t[o] && 0 === t[o - 1] && 0 === t[o - 2] || (n[i] = t[o], i++); return new Uint8Array(n.buffer, 0, i) } }, { key: "parseSPS", value: function (t) { var r = e._ebsp2rbsp(t), n = new Qt(r); n.readByte(); var i = n.readByte(); n.readByte(); var o = n.readByte(); n.readUEG(); var a = e.getProfileString(i), s = e.getLevelString(o), u = 1, l = 420, c = 8; if ((100 === i || 110 === i || 122 === i || 244 === i || 44 === i || 83 === i || 86 === i || 118 === i || 128 === i || 138 === i || 144 === i) && (3 === (u = n.readUEG()) && n.readBits(1), u <= 3 && (l = [0, 420, 422, 444][u]), c = n.readUEG() + 8, n.readUEG(), n.readBits(1), n.readBool())) for (var f = 3 !== u ? 8 : 12, d = 0; d < f; d++)n.readBool() && (d < 6 ? e._skipScalingList(n, 16) : e._skipScalingList(n, 64)); n.readUEG(); var h = n.readUEG(); if (0 === h) n.readUEG(); else if (1 === h) { n.readBits(1), n.readSEG(), n.readSEG(); for (var p = n.readUEG(), v = 0; v < p; v++)n.readSEG() } n.readUEG(), n.readBits(1); var m = n.readUEG(), y = n.readUEG(), g = n.readBits(1); 0 === g && n.readBits(1), n.readBits(1); var b = 0, _ = 0, w = 0, E = 0; n.readBool() && (b = n.readUEG(), _ = n.readUEG(), w = n.readUEG(), E = n.readUEG()); var S = 1, k = 1, T = 0, A = !0, R = 0, O = 0; if (n.readBool()) { if (n.readBool()) { var L = n.readByte(); L > 0 && L < 16 ? (S = [1, 12, 10, 16, 40, 24, 20, 32, 80, 18, 15, 64, 160, 4, 3, 2][L - 1], k = [1, 11, 11, 11, 33, 11, 11, 11, 33, 11, 11, 33, 99, 3, 2, 1][L - 1]) : 255 === L && (S = n.readByte() << 8 | n.readByte(), k = n.readByte() << 8 | n.readByte()) } if (n.readBool() && n.readBool(), n.readBool() && (n.readBits(4), n.readBool() && n.readBits(24)), n.readBool() && (n.readUEG(), n.readUEG()), n.readBool()) { var x = n.readBits(32), P = n.readBits(32); A = n.readBool(), T = (R = P) / (O = 2 * x) } } var C = 1; 1 === S && 1 === k || (C = S / k); var D = 0, I = 0; 0 === u ? (D = 1, I = 2 - g) : (D = 3 === u ? 1 : 2, I = (1 === u ? 2 : 1) * (2 - g)); var M = 16 * (m + 1), N = 16 * (y + 1) * (2 - g); M -= (b + _) * D, N -= (w + E) * I; var F = Math.ceil(M * C); return n.destroy(), n = null, { profile_string: a, level_string: s, bit_depth: c, chroma_format: l, chroma_format_string: e.getChromaFormatString(l), frame_rate: { fixed: A, fps: T, fps_den: O, fps_num: R }, sar_ratio: { width: S, height: k }, codec_size: { width: M, height: N }, present_size: { width: F, height: N } } } }, { key: "_skipScalingList", value: function (e, t) { for (var r = 8, n = 8, i = 0; i < t; i++)0 !== n && (n = (r + e.readSEG() + 256) % 256), r = 0 === n ? r : n } }, { key: "getProfileString", value: function (e) { switch (e) { case 66: return "Baseline"; case 77: return "Main"; case 88: return "Extended"; case 100: return "High"; case 110: return "High10"; case 122: return "High422"; case 244: return "High444"; default: return "Unknown" } } }, { key: "getLevelString", value: function (e) { return (e / 10).toFixed(1) } }, { key: "getChromaFormatString", value: function (e) { switch (e) { case 420: return "4:2:0"; case 422: return "4:2:2"; case 444: return "4:4:4"; default: return "Unknown" } } }]), e }(), Zt = null, er = function () { function e() { zt(this, e) } return Ht(e, null, [{ key: "parseObject", value: function (t, r, n) { var i = e.parseString(t, r, n), o = e.parseScript(t, r + i.size), a = o.objectEnd; return { data: { name: i.data, value: o.data }, size: o.size, objectEnd: a } } }, { key: "parseVariable", value: function (t, r, n) { return e.parseObject(t, r, n) } }, { key: "parseLongString", value: function (e, t, r) { var n = new DataView(e, t).getUint32(0, !Zt); return { data: n > 0 ? Yt(new Uint8Array(e, t + 4, n)) : "", size: 4 + n } } }, { key: "parseDate", value: function (e, t, r) { var n = new DataView(e, t), i = n.getFloat64(0, !Zt), o = n.getInt16(8, !Zt); return { data: new Date(i += 60 * o * 1e3), size: 10 } } }, { key: "parseString", value: function (e, t, r) { var n = new DataView(e, t).getUint16(0, !Zt); return { data: n > 0 ? Yt(new Uint8Array(e, t + 2, n)) : "", size: 2 + n } } }, { key: "parseMetadata", value: function (t) { var r; r = new ArrayBuffer(2), new DataView(r).setInt16(0, 256, !0), Zt = 256 === new Int16Array(r)[0]; var n = e.parseScript(t, 0), i = e.parseScript(t, n.size, t.length - n.size), o = {}; return o[n.data] = i.data, o } }, { key: "parseScript", value: function (t, r, n) { var i = r, o = new Uint8Array(t).buffer, a = new DataView(o, 0, n), s = null, u = a.getUint8(i); switch (i += 1, u) { case 0: s = a.getFloat64(i, !Zt), i += 8; break; case 1: s = !!a.getUint8(i), i += 1; break; case 2: var l = e.parseString(o, i); s = l.data, i += l.size; break; case 3: s = {}; var c = 0; for (9 == (16777215 & a.getUint32(n - 4, !Zt)) && (c = 3); i < n - 4;) { var f = e.parseObject(o, i, n - r - c); if (f.objectEnd) break; s[f.data.name] = f.data.value, i = f.size } if (i <= n - 3) 9 === (16777215 & v.getUint32(i - 1, !Zt)) && (i += 3); break; case 8: for (s = {}, i += 4, a.getUint32(n - 4, !Zt); i < n - 8;) { var d = e.parseVariable(o, i); if (d.objectEnd) break; s[d.data.name] = d.data.value, i = d.size } if (i <= n - 3) 9 === (16777215 & a.getUint32(i - 1, !Zt)) && (i += 3); break; case 9: s = void 0, i = 1; break; case 10: s = []; var h = a.getUint32(i, !Zt); i += 4; for (var p = 0; p < h; p++) { var m = e.parseScript(o, i); s.push(m.data), i = m.size } break; case 11: var y = e.parseDate(o, i + 1, n - 1); s = y.data, i += y.size; break; case 12: var g = e.parseString(o, i + 1, n - 1); s = g.data, i += g.size; break; default: i = n, console.log("AMF", "Unsupported AMF value type " + u) }return { data: s, size: i } } }]), e }(), tr = function () { function e() { zt(this, e), this.mimeType = null, this.duration = null, this.hasAudio = null, this.hasVideo = null, this.audioCodec = null, this.videoCodec = null, this.audioDataRate = null, this.videoDataRate = null, this.audioSampleRate = null, this.audioChannelCount = null, this.width = null, this.height = null, this.fps = null, this.profile = null, this.level = null, this.chromaFormat = null, this.sarNum = null, this.sarDen = null, this.metadata = null, this.segments = null, this.segmentCount = null, this.hasKeyframesIndex = null, this.keyframesIndex = null } return Ht(e, [{ key: "isComplete", value: function () { var e = !1 === this.hasAudio || !0 === this.hasAudio && null != this.audioCodec && null != this.audioSampleRate && null != this.audioChannelCount, t = !1 === this.hasVideo || !0 === this.hasVideo && null != this.videoCodec && null != this.width && null != this.height && null != this.fps && null != this.profile && null != this.level && null != this.chromaFormat && null != this.sarNum && null != this.sarDen; return null != this.mimeType && null != this.duration && null != this.metadata && null != this.hasKeyframesIndex && e && t } }, { key: "isSeekable", value: function () { return !0 === this.hasKeyframesIndex } }]), e }(), rr = function e(t) { zt(this, e), this.type = t }, nr = function () { function e() { var t; zt(this, e), this.TAG = this.constructor.name, this._config = {}, this._onError = null, this._onMediaInfo = null, this._onTrackMetadata = null, this._onDataAvailable = null, this._dataOffset = 0, this._firstParse = !0, this._dispatch = !1, this._hasAudio = !1, this._hasVideo = !1, this._audioInitialMetadataDispatched = !1, this._videoInitialMetadataDispatched = !1, this._mediaInfo = new tr, this._mediaInfo.hasAudio = this._hasAudio, this._mediaInfo.hasVideo = this._hasVideo, this._metadata = null, this._audioMetadata = null, this._videoMetadata = null, this._naluLengthSize = 4, this._timestampBase = 0, this._timescale = 1e3, this._duration = 0, this._durationOverrided = !1, this._referenceFrameRate = { fixed: !0, fps: 23.976, fps_num: 23976, fps_den: 1e3 }, this._videoTrack = { type: "video", id: 1, sequenceNumber: 0, addcoefficient: 2, samples: [], length: 0 }, this._audioTrack = { type: "audio", id: 2, sequenceNumber: 0, addcoefficient: 2, samples: [], length: 0 }, this._littleEndian = (t = new ArrayBuffer(2), new DataView(t).setInt16(0, 256, !0), 256 === new Int16Array(t)[0]) } return Ht(e, [{ key: "onMediaInfo", value: function (e) { this._onMediaInfo = e } }, { key: "parseMetadata", value: function (e) { var t = er.parseMetadata(e); this._parseScriptData(t) } }, { key: "_parseScriptData", value: function (e) { var t = e; if (t.hasOwnProperty("onMetaData")) { this._metadata = t; var r = this._metadata.onMetaData; if ("boolean" == typeof r.hasAudio && (this._hasAudio = r.hasAudio, this._mediaInfo.hasAudio = this._hasAudio), "boolean" == typeof r.hasVideo && (this._hasVideo = r.hasVideo, this._mediaInfo.hasVideo = this._hasVideo), "number" == typeof r.audiodatarate && (this._mediaInfo.audioDataRate = r.audiodatarate), "number" == typeof r.videodatarate && (this._mediaInfo.videoDataRate = r.videodatarate), "number" == typeof r.width && (this._mediaInfo.width = r.width), "number" == typeof r.height && (this._mediaInfo.height = r.height), "number" == typeof r.duration) { if (!this._durationOverrided) { var n = Math.floor(r.duration * this._timescale); this._duration = n, this._mediaInfo.duration = n } } else this._mediaInfo.duration = 0; if ("number" == typeof r.framerate) { var i = Math.floor(1e3 * r.framerate); if (i > 0) { var o = i / 1e3; this._referenceFrameRate.fixed = !0, this._referenceFrameRate.fps = o, this._referenceFrameRate.fps_num = i, this._referenceFrameRate.fps_den = 1e3, this._mediaInfo.fps = o } } if ("object" === Lt(r.keyframes)) { this._mediaInfo.hasKeyframesIndex = !0; var a = r.keyframes; a.times = r.times, a.filepositions = r.filepositions, this._mediaInfo.keyframesIndex = this._parseKeyframesIndex(a), r.keyframes = null } else this._mediaInfo.hasKeyframesIndex = !1; return this._dispatch = !1, this._mediaInfo.metadata = r, console.log(this.TAG, "Parsed onMetaData"), this._mediaInfo } } }, { key: "_parseKeyframesIndex", value: function (e) { for (var t = [], r = [], n = 1; n < e.times.length; n++) { var i = this._timestampBase + Math.floor(1e3 * e.times[n]); t.push(i), r.push(e.filepositions[n]) } return { times: t, filepositions: r } } }, { key: "moofTag", value: function (e) { for (var t = 0; t < e.length; t++)this._dispatch = !0, this.parseChunks(e[t]); this._isInitialMetadataDispatched() && this._dispatch && (this._audioTrack.length || this._videoTrack.length) && this._onDataAvailable(this._audioTrack, this._videoTrack) } }, { key: "parseChunks", value: function (e) { switch (e.tagType) { case 8: this._parseAudioData(e.body.buffer, 0, e.body.length, e.getTime()); break; case 9: this._parseVideoData(e.body.buffer, 0, e.body.length, e.getTime(), 0); break; case 18: this.parseMetadata(e.body) } } }, { key: "_parseVideoData", value: function (e, t, r, n, i) { if (n == this._timestampBase && 0 != this._timestampBase) throw new rr(n, this._timestampBase, "夭寿啦这个视频不是从0开始"); if (r <= 1) console.log(this.TAG, "Flv: Invalid video packet, missing VideoData payload!"); else { var o = new Uint8Array(e, t, r)[0], a = (240 & o) >>> 4, s = 15 & o; 7 === s ? this._parseAVCVideoPacket(e, t + 1, r - 1, n, i, a) : this._onError && this._onError("Flv: Unsupported codec in video frame: " + s) } } }, { key: "_parseAVCVideoPacket", value: function (e, t, r, n, i, o) { if (r < 4) console.log(this.TAG, "Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime"); else { var a = this._littleEndian, s = new DataView(e, t, r), u = s.getUint8(0), l = 16777215 & s.getUint32(0, !a); if (0 === u) this._parseAVCDecoderConfigurationRecord(e, t + 4, r - 4); else if (1 === u) this._parseAVCVideoData(e, t + 4, r - 4, n, i, o, l); else if (2 !== u) return void this._onError("Flv: Invalid video packet type " + u) } } }, { key: "_parseAVCDecoderConfigurationRecord", value: function (e, t, r) { if (r < 7) console.log(this.TAG, "Flv: Invalid AVCDecoderConfigurationRecord, lack of data!"); else { var n = this._videoMetadata, i = this._videoTrack, o = this._littleEndian, a = new DataView(e, t, r); n ? void 0 !== n.avcc && console.log(this.TAG, "Found another AVCDecoderConfigurationRecord!") : ((n = this._videoMetadata = {}).type = "video", n.id = i.id, n.timescale = this._timescale, n.duration = this._duration); var s = a.getUint8(0), u = a.getUint8(1); a.getUint8(2), a.getUint8(3); if (1 === s && 0 !== u) if (this._naluLengthSize = 1 + (3 & a.getUint8(4)), 3 === this._naluLengthSize || 4 === this._naluLengthSize) { var l = 31 & a.getUint8(5); if (0 === l || l > 1) this._onError(DemuxErrors.FORMAT_ERROR, "Flv: Invalid H264 SPS count: " + l); else { for (var c = 6, f = 0; f < l; f++) { var d = a.getUint16(c, !o); if (c += 2, 0 !== d) { var h = new Uint8Array(e, t + c, d); c += d; var p = Jt.parseSPS(h); n.codecWidth = p.codec_size.width, n.codecHeight = p.codec_size.height, n.presentWidth = p.present_size.width, n.presentHeight = p.present_size.height, n.config = p, n.profile = p.profile_string, n.level = p.level_string, n.bitDepth = p.bit_depth, n.chromaFormat = p.chroma_format, n.sarRatio = p.sar_ratio, n.frameRate = p.frame_rate, !1 !== p.frame_rate.fixed && 0 !== p.frame_rate.fps_num && 0 !== p.frame_rate.fps_den || (n.frameRate = this._referenceFrameRate); var v = n.frameRate.fps_den, m = n.frameRate.fps_num; n.refSampleDuration = Math.floor(n.timescale * (v / m)); for (var y = h.subarray(1, 4), g = "avc1.", b = 0; b < 3; b++) { var _ = y[b].toString(16); _.length < 2 && (_ = "0" + _), g += _ } n.codec = g; var w = this._mediaInfo; w.width = n.codecWidth, w.height = n.codecHeight, w.fps = n.frameRate.fps, w.profile = n.profile, w.level = n.level, w.chromaFormat = p.chroma_format_string, w.sarNum = n.sarRatio.width, w.sarDen = n.sarRatio.height, w.videoCodec = g, w.meta = n, w.hasAudio ? null != w.audioCodec && (w.mimeType = 'video/x-flv; codecs="' + w.videoCodec + "," + w.audioCodec + '"') : w.mimeType = 'video/x-flv; codecs="' + w.videoCodec + '"', w.isComplete() && this._onMediaInfo(w) } } var E = a.getUint8(c); if (0 === E || E > 1) this._onError(DemuxErrors.FORMAT_ERROR, "Flv: Invalid H264 PPS count: " + E); else { c++; for (var S = 0; S < E; S++) { var k = a.getUint16(c, !o); c += 2, 0 !== k && (c += k) } n.avcc = new Uint8Array(r), n.avcc.set(new Uint8Array(e, t, r), 0), console.log(this.TAG, "Parsed AVCDecoderConfigurationRecord"), this._isInitialMetadataDispatched() ? this._dispatch && (this._audioTrack.length || this._videoTrack.length) && this._onDataAvailable(this._audioTrack, this._videoTrack) : this._videoInitialMetadataDispatched = !0, this._dispatch = !1, this._onTrackMetadata("video", n) } } } else this._onError(DemuxErrors.FORMAT_ERROR, "Flv: Strange NaluLengthSizeMinusOne: " + (this._naluLengthSize - 1)); else this._onError(DemuxErrors.FORMAT_ERROR, "Flv: Invalid AVCDecoderConfigurationRecord") } } }, { key: "timestampBase", value: function (e) { this._timestampBase = e } }, { key: "_parseAVCVideoData", value: function (e, t, r, n, i, o, a) { for (var s = this._littleEndian, u = new DataView(e, t, r), l = [], c = 0, f = 0, d = this._naluLengthSize, h = this._timestampBase + n, p = 1 === o; f < r;) { if (f + 4 >= r) { console.log(this.TAG, "Malformed Nalu near timestamp " + h + ", offset = " + f + ", dataSize = " + r); break } var v = u.getUint32(f, !s); if (3 === d && (v >>>= 8), v > r - d) return void console.log(this.TAG, "Malformed Nalus near timestamp " + h + ", NaluSize > DataSize!"); var m = 31 & u.getUint8(f + d); 5 === m && (p = !0); var y = new Uint8Array(e, t + f, d + v), g = { type: m, data: y }; l.push(g), c += y.byteLength, f += d + v } if (l.length) { var b = this._videoTrack, _ = { units: l, length: c, isKeyframe: p, dts: h, cts: a, pts: h + a }; p && (_.fileposition = i), b.samples.push(_), b.length += c } } }, { key: "_parseAudioData", value: function (e, t, r, n) { if (n == this._timestampBase && 0 != this._timestampBase && console.log(n, this._timestampBase, "夭寿啦这个视频不是从0开始"), r <= 1) console.log(this.TAG, "Flv: Invalid audio packet, missing SoundData payload!"); else { var i = this._audioMetadata, o = this._audioTrack; if (!i || !i.codec) { (i = this._audioMetadata = {}).type = "audio", i.id = o.id, i.timescale = this._timescale, i.duration = this._duration; var a = new DataView(e, t, r).getUint8(0), s = a >>> 4; if (10 !== s) return void this._onError(DemuxErrors.CODEC_UNSUPPORTED, "Flv: Unsupported audio codec idx: " + s); var u = 0, l = (12 & a) >>> 2, c = [5500, 11025, 22050, 44100, 48e3]; if (!(l < c.length)) return void this._onError(DemuxErrors.FORMAT_ERROR, "Flv: Invalid audio sample rate idx: " + l); u = c[l]; var f = 1 & a; i.audioSampleRate = u, i.channelCount = 0 === f ? 1 : 2, i.refSampleDuration = Math.floor(1024 / i.audioSampleRate * i.timescale), i.codec = "mp4a.40.5" } var d = this._parseAACAudioData(e, t + 1, r - 1); if (null != d) { if (0 === d.packetType) { i.config && console.log(this.TAG, "Found another AudioSpecificConfig!"); var h = d.data; i.audioSampleRate = h.samplingRate, i.channelCount = h.channelCount, i.codec = h.codec, i.config = h.config, i.refSampleDuration = Math.floor(1024 / i.audioSampleRate * i.timescale), console.log(this.TAG, "Parsed AudioSpecificConfig"), this._isInitialMetadataDispatched() ? this._dispatch && (this._audioTrack.length || this._videoTrack.length) && this._onDataAvailable(this._audioTrack, this._videoTrack) : this._audioInitialMetadataDispatched = !0, this._dispatch = !1; var p = this._mediaInfo; return p.audioCodec = "mp4a.40." + h.originalAudioObjectType, p.audioSampleRate = i.audioSampleRate, p.audioChannelCount = i.channelCount, p.hasVideo ? null != p.videoCodec && (p.mimeType = 'video/x-flv; codecs="' + p.videoCodec + "," + p.audioCodec + '"') : p.mimeType = 'video/x-flv; codecs="' + p.audioCodec + '"', this._onTrackMetadata("audio", i), void (p.isComplete() && this._onMediaInfo(p)) } if (1 === d.packetType) { var v = this._timestampBase + n, m = { unit: d.data, dts: v, pts: v }; o.samples.push(m), o.length += d.data.length } else console.log(this.TAG, "Flv: Unsupported AAC data type " + d.packetType) } } } }, { key: "_parseAACAudioData", value: function (e, t, r) { if (!(r <= 1)) { var n = {}, i = new Uint8Array(e, t, r); return n.packetType = i[0], 0 === i[0] ? n.data = this._parseAACAudioSpecificConfig(e, t + 1, r - 1) : n.data = i.subarray(1), n } console.log(this.TAG, "Flv: Invalid AAC packet, missing AACPacketType or/and Data!") } }, { key: "_parseAACAudioSpecificConfig", value: function (e, t, r) { var n, i, o = new Uint8Array(e, t, r), a = null, s = [96e3, 88200, 64e3, 48e3, 44100, 32e3, 24e3, 22050, 16e3, 12e3, 11025, 8e3, 7350], u = 0, l = null; if (u = n = o[0] >>> 3, (i = (7 & o[0]) << 1 | o[1] >>> 7) < 0 || i >= s.length) this._onError(DemuxErrors.FORMAT_ERROR, "Flv: AAC invalid sampling frequency index!"); else { var c = s[i], f = (120 & o[1]) >>> 3; if (!(f < 0 || f >= 8)) { 5 === u && (l = (7 & o[1]) << 1 | o[2] >>> 7); var d = self.navigator.userAgent.toLowerCase(); return -1 !== d.indexOf("firefox") ? i >= 6 ? (u = 5, a = new Array(4), l = i - 3) : (u = 2, a = new Array(2), l = i) : -1 !== d.indexOf("android") ? (u = 2, a = new Array(2), l = i) : (u = 5, l = i, a = new Array(4), i >= 6 ? l = i - 3 : 1 === f && (u = 2, a = new Array(2), l = i)), a[0] = u << 3, a[0] |= (15 & i) >>> 1, a[1] = (15 & i) << 7, a[1] |= (15 & f) << 3, 5 === u && (a[1] |= (15 & l) >>> 1, a[2] = (1 & l) << 7, a[2] |= 8, a[3] = 0), { config: a, samplingRate: c, channelCount: f, codec: "mp4a.40." + u, originalAudioObjectType: n } } this._onError(DemuxErrors.FORMAT_ERROR, "Flv: AAC invalid channel configuration") } } }, { key: "_isInitialMetadataDispatched", value: function () { return this._hasAudio && this._hasVideo ? this._audioInitialMetadataDispatched && this._videoInitialMetadataDispatched : this._hasAudio && !this._hasVideo ? this._audioInitialMetadataDispatched : !this._hasAudio && this._hasVideo ? this._videoInitialMetadataDispatched : void 0 } }, { key: "hasAudio", set: function (e) { this._mediaInfo.hasAudio = this._hasAudio = e } }, { key: "hasVideo", set: function (e) { this._mediaInfo.hasVideo = this._hasVideo = e } }]), e }(), ir = function () { function e() { zt(this, e), this.tempUint8 = new Uint8Array, this.arrTag = [], this.index = 0, this.tempArr = [], this.stop = !1, this.offset = 0, this.frist = !0, this._hasAudio = !1, this._hasVideo = !1, this._dispose = !1, this.busy = !1, this.busyArr = [] } return Ht(e, [{ key: "setFlv", value: function (e) { return this.busy = !0, this._dispose = !1, this.stop = !1, this.arrTag = [], this.index = 0, this.tempUint8 = e, this.tempUint8.length > 13 && 70 == this.tempUint8[0] && 76 == this.tempUint8[1] && 86 == this.tempUint8[2] ? (this.probe(this.tempUint8.buffer), this.read(9), this.read(4), this.parse(), this.frist = !1, this.busy = !1, this.offset) : this.frist ? this.offset : (this.parse(), this.offset) } }, { key: "probe", value: function (e) { var t = new Uint8Array(e), r = { match: !1 }; if (70 !== t[0] || 76 !== t[1] || 86 !== t[2] || 1 !== t[3]) return r; var n = (4 & t[4]) >>> 2 != 0, i = 0 != (1 & t[4]); return n || i ? (this._hasAudio = nr._hasAudio = n, this._hasVideo = nr._hasVideo = i, { match: !0, hasAudioTrack: n, hasVideoTrack: i }) : r } }, { key: "dispose", value: function () { } }, { key: "parse", value: function () { for (; this.index < this.tempUint8.length && !this.stop;) { this.offset = this.index; var e = new qt; if (this.tempUint8.length - this.index >= 11) { if (e.tagType = this.read(1)[0], e.dataSize = this.read(3), e.Timestamp = this.read(4), e.StreamID = this.read(3), 18 != e.tagType && 8 != e.tagType && 9 != e.tagType) throw new rr("wrong tagType" + e.tagType); this.tempUint8.length - this.index >= this.getBodySum(e.dataSize) + 4 ? (e.body = this.read(this.getBodySum(e.dataSize)), 9 == e.tagType && this._hasVideo && this.arrTag.push(e), 8 == e.tagType && this._hasAudio && this.arrTag.push(e), 18 == e.tagType && 0 == this.arrTag.length && this.arrTag.push(e), e.size = this.read(4), this.offset = this.index) : this.stop = !0 } else this.stop = !0 } return this.offset } }, { key: "read", value: function (e) { var t = this.tempUint8.slice(this.index, this.index + e); return this.index += e, t } }, { key: "getBodySum", value: function (e) { var t = ""; return t += 1 == e[0].toString(16).length ? "0" + e[0].toString(16) : e[0].toString(16), t += 1 == e[1].toString(16).length ? "0" + e[1].toString(16) : e[1].toString(16), t += 1 == e[2].toString(16).length ? "0" + e[2].toString(16) : e[2].toString(16), parseInt(t, 16) } }]), e }(), or = function () { function e() { zt(this, e) } return Ht(e, null, [{ key: "init", value: function () { for (var t in e.types = { avc1: [], avcC: [], btrt: [], dinf: [], dref: [], esds: [], ftyp: [], hdlr: [], mdat: [], mdhd: [], mdia: [], mfhd: [], minf: [], moof: [], moov: [], mp4a: [], mvex: [], mvhd: [], sdtp: [], stbl: [], stco: [], stsc: [], stsd: [], stsz: [], stts: [], tfdt: [], tfhd: [], traf: [], trak: [], trun: [], trex: [], tkhd: [], vmhd: [], smhd: [] }, e.types) e.types.hasOwnProperty(t) && (e.types[t] = [t.charCodeAt(0), t.charCodeAt(1), t.charCodeAt(2), t.charCodeAt(3)]); var r = e.constants = {}; r.FTYP = new Uint8Array([105, 115, 111, 109, 0, 0, 0, 1, 105, 115, 111, 109, 97, 118, 99, 49]), r.STSD_PREFIX = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1]), r.STTS = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]), r.STSC = r.STCO = r.STTS, r.STSZ = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]), r.HDLR_VIDEO = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 118, 105, 100, 101, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86, 105, 100, 101, 111, 72, 97, 110, 100, 108, 101, 114, 0]), r.HDLR_AUDIO = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 115, 111, 117, 110, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 83, 111, 117, 110, 100, 72, 97, 110, 100, 108, 101, 114, 0]), r.DREF = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 12, 117, 114, 108, 32, 0, 0, 0, 1]), r.SMHD = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]), r.VMHD = new Uint8Array([0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0]) } }, { key: "box", value: function (e) { for (var t = 8, r = null, n = Array.prototype.slice.call(arguments, 1), i = n.length, o = 0; o < i; o++)t += n[o].byteLength; (r = new Uint8Array(t))[0] = t >>> 24 & 255, r[1] = t >>> 16 & 255, r[2] = t >>> 8 & 255, r[3] = 255 & t, r.set(e, 4); for (var a = 8, s = 0; s < i; s++)r.set(n[s], a), a += n[s].byteLength; return r } }, { key: "generateInitSegment", value: function (t) { t.constructor != Array && (t = [t]); var r = e.box(e.types.ftyp, e.constants.FTYP), n = e.moov(t), i = new Uint8Array(r.byteLength + n.byteLength); return i.set(r, 0), i.set(n, r.byteLength), i } }, { key: "moov", value: function (t) { var r = e.mvhd(t[0].timescale, t[0].duration), n = e.trak(t[0]), i = void 0; t.length > 1 && (i = e.trak(t[1])); var o = e.mvex(t); return t.length > 1 ? e.box(e.types.moov, r, n, i, o) : e.box(e.types.moov, r, n, o) } }, { key: "mvhd", value: function (t, r) { return e.box(e.types.mvhd, new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, t >>> 24 & 255, t >>> 16 & 255, t >>> 8 & 255, 255 & t, r >>> 24 & 255, r >>> 16 & 255, r >>> 8 & 255, 255 & r, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255])) } }, { key: "trak", value: function (t) { return e.box(e.types.trak, e.tkhd(t), e.mdia(t)) } }, { key: "tkhd", value: function (t) { var r = t.id, n = t.duration, i = t.presentWidth, o = t.presentHeight; return e.box(e.types.tkhd, new Uint8Array([0, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 0, r >>> 24 & 255, r >>> 16 & 255, r >>> 8 & 255, 255 & r, 0, 0, 0, 0, n >>> 24 & 255, n >>> 16 & 255, n >>> 8 & 255, 255 & n, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 0, 0, i >>> 8 & 255, 255 & i, 0, 0, o >>> 8 & 255, 255 & o, 0, 0])) } }, { key: "mdia", value: function (t) { return e.box(e.types.mdia, e.mdhd(t), e.hdlr(t), e.minf(t)) } }, { key: "mdhd", value: function (t) { var r = t.timescale, n = t.duration; return e.box(e.types.mdhd, new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, r >>> 24 & 255, r >>> 16 & 255, r >>> 8 & 255, 255 & r, n >>> 24 & 255, n >>> 16 & 255, n >>> 8 & 255, 255 & n, 85, 196, 0, 0])) } }, { key: "hdlr", value: function (t) { var r = null; return r = "audio" === t.type ? e.constants.HDLR_AUDIO : e.constants.HDLR_VIDEO, e.box(e.types.hdlr, r) } }, { key: "minf", value: function (t) { var r = null; return r = "audio" === t.type ? e.box(e.types.smhd, e.constants.SMHD) : e.box(e.types.vmhd, e.constants.VMHD), e.box(e.types.minf, r, e.dinf(), e.stbl(t)) } }, { key: "dinf", value: function () { return e.box(e.types.dinf, e.box(e.types.dref, e.constants.DREF)) } }, { key: "stbl", value: function (t) { return e.box(e.types.stbl, e.stsd(t), e.box(e.types.stts, e.constants.STTS), e.box(e.types.stsc, e.constants.STSC), e.box(e.types.stsz, e.constants.STSZ), e.box(e.types.stco, e.constants.STCO)) } }, { key: "stsd", value: function (t) { return "audio" === t.type ? e.box(e.types.stsd, e.constants.STSD_PREFIX, e.mp4a(t)) : e.box(e.types.stsd, e.constants.STSD_PREFIX, e.avc1(t)) } }, { key: "mp4a", value: function (t) { var r = t.channelCount, n = t.audioSampleRate, i = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, r, 0, 16, 0, 0, 0, 0, n >>> 8 & 255, 255 & n, 0, 0]); return e.box(e.types.mp4a, i, e.esds(t)) } }, { key: "esds", value: function (t) { var r = t.config, n = r.length, i = new Uint8Array([0, 0, 0, 0, 3, 23 + n, 0, 1, 0, 4, 15 + n, 64, 21, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5].concat([n]).concat(r).concat([6, 1, 2])); return e.box(e.types.esds, i) } }, { key: "avc1", value: function (t) { var r = t.avcc, n = t.codecWidth, i = t.codecHeight, o = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, n >>> 8 & 255, 255 & n, i >>> 8 & 255, 255 & i, 0, 72, 0, 0, 0, 72, 0, 0, 0, 0, 0, 0, 0, 1, 4, 103, 49, 49, 49, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 255, 255]); return e.box(e.types.avc1, o, e.box(e.types.avcC, r)) } }, { key: "mvex", value: function (t) { return t.length > 1 ? e.box(e.types.mvex, e.trex(t[0]), e.trex(t[1])) : e.box(e.types.mvex, e.trex(t[0])) } }, { key: "trex", value: function (t) { var r = t.id, n = new Uint8Array([0, 0, 0, 0, r >>> 24 & 255, r >>> 16 & 255, r >>> 8 & 255, 255 & r, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1]); return e.box(e.types.trex, n) } }, { key: "moof", value: function (t, r) { return e.box(e.types.moof, e.mfhd(t.sequenceNumber), e.traf(t, r)) } }, { key: "mfhd", value: function (t) { var r = new Uint8Array([0, 0, 0, 0, t >>> 24 & 255, t >>> 16 & 255, t >>> 8 & 255, 255 & t]); return e.box(e.types.mfhd, r) } }, { key: "traf", value: function (t, r) { var n = t.id, i = e.box(e.types.tfhd, new Uint8Array([0, 0, 0, 0, n >>> 24 & 255, n >>> 16 & 255, n >>> 8 & 255, 255 & n])), o = e.box(e.types.tfdt, new Uint8Array([0, 0, 0, 0, r >>> 24 & 255, r >>> 16 & 255, r >>> 8 & 255, 255 & r])), a = e.sdtp(t), s = e.trun(t, a.byteLength + 16 + 16 + 8 + 16 + 8 + 8); return e.box(e.types.traf, i, o, s, a) } }, { key: "sdtp", value: function (t) { for (var r = t.samples || [], n = r.length, i = new Uint8Array(4 + n), o = 0; o < n; o++) { var a = r[o].flags; i[o + 4] = a.isLeading << 6 | a.dependsOn << 4 | a.isDependedOn << 2 | a.hasRedundancy } return e.box(e.types.sdtp, i) } }, { key: "trun", value: function (t, r) { var n = t.samples || [], i = n.length, o = 12 + 16 * i, a = new Uint8Array(o); r += 8 + o, a.set([0, 0, 15, 1, i >>> 24 & 255, i >>> 16 & 255, i >>> 8 & 255, 255 & i, r >>> 24 & 255, r >>> 16 & 255, r >>> 8 & 255, 255 & r], 0); for (var s = 0; s < i; s++) { var u = n[s].duration, l = n[s].size, c = n[s].flags, f = n[s].cts; a.set([u >>> 24 & 255, u >>> 16 & 255, u >>> 8 & 255, 255 & u, l >>> 24 & 255, l >>> 16 & 255, l >>> 8 & 255, 255 & l, c.isLeading << 2 | c.dependsOn, c.isDependedOn << 6 | c.hasRedundancy << 4 | c.isNonSync, 0, 0, f >>> 24 & 255, f >>> 16 & 255, f >>> 8 & 255, 255 & f], 12 + 16 * s) } return e.box(e.types.trun, a) } }, { key: "mdat", value: function (t) { return e.box(e.types.mdat, t) } }]), e }(), ar = function () { function e() { zt(this, e) } return Ht(e, null, [{ key: "getSilentFrame", value: function (e) { return 1 === e ? new Uint8Array([0, 200, 0, 128, 35, 128]) : 2 === e ? new Uint8Array([33, 0, 73, 144, 2, 25, 0, 35, 128]) : 3 === e ? new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 142]) : 4 === e ? new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 128, 44, 128, 8, 2, 56]) : 5 === e ? new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 130, 48, 4, 153, 0, 33, 144, 2, 56]) : 6 === e ? new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 130, 48, 4, 153, 0, 33, 144, 2, 0, 178, 0, 32, 8, 224]) : null } }]), e }(), sr = {}; !function () { var e = self.navigator.userAgent.toLowerCase(), t = /(edge)\/([\w.]+)/.exec(e) || /(opr)[\/]([\w.]+)/.exec(e) || /(chrome)[ \/]([\w.]+)/.exec(e) || /(iemobile)[\/]([\w.]+)/.exec(e) || /(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e) || /(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e) || /(webkit)[ \/]([\w.]+)/.exec(e) || /(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e) || /(msie) ([\w.]+)/.exec(e) || e.indexOf("trident") >= 0 && /(rv)(?::| )([\w.]+)/.exec(e) || e.indexOf("compatible") < 0 && /(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e) || [], r = /(ipad)/.exec(e) || /(ipod)/.exec(e) || /(windows phone)/.exec(e) || /(iphone)/.exec(e) || /(kindle)/.exec(e) || /(android)/.exec(e) || /(windows)/.exec(e) || /(mac)/.exec(e) || /(linux)/.exec(e) || /(cros)/.exec(e) || [], n = { browser: t[5] || t[3] || t[1] || "", version: t[2] || t[4] || "0", majorVersion: t[4] || t[2] || "0", platform: r[0] || "" }, i = {}; if (n.browser) { i[n.browser] = !0; var o = n.majorVersion.split("."); i.version = { major: parseInt(n.majorVersion, 10), string: n.version }, o.length > 1 && (i.version.minor = parseInt(o[1], 10)), o.length > 2 && (i.version.build = parseInt(o[2], 10)) } n.platform && (i[n.platform] = !0), (i.chrome || i.opr || i.safari) && (i.webkit = !0), (i.rv || i.iemobile) && (i.rv && delete i.rv, n.browser = "msie", i.msie = !0); i.edge && (delete i.edge, n.browser = "msedge", i.msedge = !0); i.opr && (n.browser = "opera", i.opera = !0); i.safari && i.android && (n.browser = "android", i.android = !0); for (var a in i.name = n.browser, i.platform = n.platform, sr) sr.hasOwnProperty(a) && delete sr[a]; sr = i }(); var ur = sr, lr = function e(t, r, n, i, o) { zt(this, e), this.dts = t, this.pts = r, this.duration = n, this.originalDts = i, this.isSyncPoint = o, this.fileposition = null }, cr = function () { function e() { zt(this, e), this.beginDts = 0, this.endDts = 0, this.beginPts = 0, this.endPts = 0, this.originalBeginDts = 0, this.originalEndDts = 0, this.syncPoints = [], this.firstSample = null, this.lastSample = null } return Ht(e, [{ key: "appendSyncPoint", value: function (e) { e.isSyncPoint = !0, this.syncPoints.push(e) } }]), e }(), fr = (function () { function e() { zt(this, e), this._list = [] } Ht(e, [{ key: "clear", value: function () { this._list = [] } }, { key: "appendArray", value: function (e) { var t = this._list; 0 !== e.length && (t.length > 0 && e[0].originalDts < t[t.length - 1].originalDts && this.clear(), Array.prototype.push.apply(t, e)) } }, { key: "getLastSyncPointBeforeDts", value: function (e) { if (0 == this._list.length) return null; var t = this._list, r = 0, n = t.length - 1, i = 0, o = 0, a = n; for (e < t[0].dts && (r = 0, o = a + 1); o <= a;) { if ((i = o + Math.floor((a - o) / 2)) === n || e >= t[i].dts && e < t[i + 1].dts) { r = i; break } t[i].dts < e ? o = i + 1 : a = i - 1 } return this._list[r] } }]) }(), function () { function e(t) { zt(this, e), this._type = t, this._list = [], this._lastAppendLocation = -1 } return Ht(e, [{ key: "isEmpty", value: function () { return 0 === this._list.length } }, { key: "clear", value: function () { this._list = [], this._lastAppendLocation = -1 } }, { key: "_searchNearestSegmentBefore", value: function (e) { var t = this._list; if (0 === t.length) return -2; var r = t.length - 1, n = 0, i = 0, o = r, a = 0; if (e < t[0].originalBeginDts) return a = -1; for (; i <= o;) { if ((n = i + Math.floor((o - i) / 2)) === r || e > t[n].lastSample.originalDts && e < t[n + 1].originalBeginDts) { a = n; break } t[n].originalBeginDts < e ? i = n + 1 : o = n - 1 } return a } }, { key: "_searchNearestSegmentAfter", value: function (e) { return this._searchNearestSegmentBefore(e) + 1 } }, { key: "append", value: function (e) { var t = this._list, r = e, n = this._lastAppendLocation, i = 0; -1 !== n && n < t.length && r.originalBeginDts >= t[n].lastSample.originalDts && (n === t.length - 1 || n < t.length - 1 && r.originalBeginDts < t[n + 1].originalBeginDts) ? i = n + 1 : t.length > 0 && (i = this._searchNearestSegmentBefore(r.originalBeginDts) + 1), this._lastAppendLocation = i, this._list.splice(i, 0, r) } }, { key: "getLastSegmentBefore", value: function (e) { var t = this._searchNearestSegmentBefore(e); return t >= 0 ? this._list[t] : null } }, { key: "getLastSampleBefore", value: function (e) { var t = this.getLastSegmentBefore(e); return null != t ? t.lastSample : null } }, { key: "getLastSyncPointBefore", value: function (e) { for (var t = this._searchNearestSegmentBefore(e), r = this._list[t].syncPoints; 0 === r.length && t > 0;)t--, r = this._list[t].syncPoints; return r.length > 0 ? r[r.length - 1] : null } }, { key: "type", get: function () { return this._type } }, { key: "length", get: function () { return this._list.length } }]), e }()), dr = function () { function e(t) { zt(this, e), this.TAG = "MP4Remuxer", this._config = t, this._isLive = !0 === t.isLive, this._dtsBase = -1, this._dtsBaseInited = !1, this._audioDtsBase = 1 / 0, this._videoDtsBase = 1 / 0, this._audioNextDts = void 0, this._videoNextDts = void 0, this._audioMeta = null, this._videoMeta = null, this._audioSegmentInfoList = new fr("audio"), this._videoSegmentInfoList = new fr("video"), this._onInitSegment = null, this._onMediaSegment = null, this._forceFirstIDR = !(!ur.chrome || !(ur.version.major < 50 || 50 === ur.version.major && ur.version.build < 2661)), this._fillSilentAfterSeek = ur.msedge || ur.msie, this._mp3UseMpegAudio = !ur.firefox } return Ht(e, [{ key: "destroy", value: function () { this._dtsBase = -1, this._dtsBaseInited = !1, this._audioMeta = null, this._videoMeta = null, this._audioSegmentInfoList.clear(), this._audioSegmentInfoList = null, this._videoSegmentInfoList.clear(), this._videoSegmentInfoList = null, this._onInitSegment = null, this._onMediaSegment = null } }, { key: "bindDataSource", value: function (e) { return e.onDataAvailable = this.remux.bind(this), e.onTrackMetadata = this._onTrackMetadataReceived.bind(this), this } }, { key: "insertDiscontinuity", value: function () { this._audioNextDts = this._videoNextDts = void 0 } }, { key: "seek", value: function (e) { this._videoSegmentInfoList.clear(), this._audioSegmentInfoList.clear() } }, { key: "remux", value: function (e, t) { if (!this._onMediaSegment) throw new IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!"); this._dtsBaseInited || this._calculateDtsBase(e, t), this._remuxVideo(t), this._remuxAudio(e) } }, { key: "_onTrackMetadataReceived", value: function (e, t) { var r = null, n = "mp4", i = t.codec; if ("audio" === e) this._audioMeta = t, "mp3" === t.codec && this._mp3UseMpegAudio ? (n = "mpeg", i = "", r = new Uint8Array) : r = or.generateInitSegment(t); else { if ("video" !== e) return; this._videoMeta = t, r = or.generateInitSegment(t) } if (!this._onInitSegment) throw new IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!"); this._onInitSegment(e, { type: e, data: r.buffer, codec: i, container: e + "/" + n, mediaDuration: t.duration }) } }, { key: "_calculateDtsBase", value: function (e, t) { this._dtsBaseInited || (e.samples && e.samples.length && (this._audioDtsBase = e.samples[0].dts), t.samples && t.samples.length && (this._videoDtsBase = t.samples[0].dts), this._dtsBase = Math.min(this._audioDtsBase, this._videoDtsBase), this._dtsBaseInited = !0) } }, { key: "_remuxAudio", value: function (e) { if (null != this._audioMeta) { var t, r = e, n = r.samples, i = void 0, o = -1, a = this._audioMeta.refSampleDuration, s = "mp3" === this._audioMeta.codec && this._mp3UseMpegAudio, u = this._dtsBaseInited && void 0 === this._audioNextDts, l = !1; if (n && !(n.length <= 1)) { var c = 0, f = null, d = 0; s ? (c = 0, d = r.length) : (c = 8, d = 8 + r.length); var h = n[0].dts - this._dtsBase; if (this._audioNextDts) i = h - this._audioNextDts; else if (this._audioSegmentInfoList.isEmpty()) i = 0, this._fillSilentAfterSeek && !this._videoSegmentInfoList.isEmpty() && "mp3" !== this._audioMeta.originalCodec && (l = !0); else { var p = this._audioSegmentInfoList.getLastSampleBefore(h); if (null != p) { var v = h - (p.originalDts + p.duration); v <= 3 && (v = 0), i = h - (p.dts + p.duration + v) } else i = 0 } if (l) { var m = h - i, y = this._videoSegmentInfoList.getLastSegmentBefore(h); if (null != y && y.beginDts < m) { var g = ar.getSilentFrame(this._audioMeta.originalCodec, this._audioMeta.channelCount); if (g) { var b = y.beginDts, _ = m - y.beginDts; Log.v(this.TAG, "InsertPrefixSilentAudio: dts: " + b + ", duration: " + _), n.unshift({ unit: g, dts: b, pts: b }), d += g.byteLength } } else l = !1 } var w = []; i = 0; for (var E = 0; E + 1 < n.length; E++) { var S = n[E], k = S.dts - this._dtsBase, T = k - i; -1 === o && (o = T); var A = 0; if (E !== n.length - 1) A = n[E + 1].dts - this._dtsBase - i - T; else A = w.length >= 1 ? w[w.length - 1].duration : Math.floor(a); w.push({ dts: T, pts: T, cts: 0, unit: S.unit, size: S.unit.byteLength, duration: A, originalDts: k, flags: { isLeading: 0, dependsOn: 1, isDependedOn: 0, hasRedundancy: 0 } }) } if (s) f = new Uint8Array(d); else { for (var R = 8, O = 0; O < w.length; ++O)R += w[O].size; (f = new Uint8Array(R))[0] = R >>> 24 & 255, f[1] = R >>> 16 & 255, f[2] = R >>> 8 & 255, f[3] = 255 & R, f.set(or.types.mdat, 4) } for (var L = 0; L < w.length; L++) { var x = w[L].unit; f.set(x, c), c += x.byteLength } var P = w[w.length - 1]; t = P.dts + P.duration, this._audioNextDts = t; var C = new cr; C.beginDts = o, C.endDts = t, C.beginPts = o, C.endPts = t, C.originalBeginDts = w[0].originalDts, C.originalEndDts = P.originalDts + P.duration, C.firstSample = new lr(w[0].dts, w[0].pts, w[0].duration, w[0].originalDts, !1), C.lastSample = new lr(P.dts, P.pts, P.duration, P.originalDts, !1), this._isLive || this._audioSegmentInfoList.append(C), r.samples = w, r.sequenceNumber++; var D = null; D = s ? new Uint8Array : or.moof(r, o), r.samples = [n[n.length - 1]], r.length = 0; var I = { type: "audio", data: this._mergeBoxes(D, f).buffer, sampleCount: w.length, info: C }; s && u && (I.timestampOffset = o), this._onMediaSegment("audio", I) } } } }, { key: "_remuxVideo", value: function (e) { if (null != this._videoMeta) { var t, r, n = e, i = n.samples, o = void 0, a = -1, s = -1; if (i && !(i.length <= 1)) { var u = i[0].dts - this._dtsBase; if (this._videoNextDts) o = Math.max(u - this._videoNextDts, 0); else if (this._videoSegmentInfoList.isEmpty()) o = 0; else { var l = this._videoSegmentInfoList.getLastSampleBefore(u); if (null != l) { var c = u - (l.originalDts + l.duration); c <= 3 && (c = 0), o = u - (l.dts + l.duration + c) } else o = 0 } var f = new cr, d = [], h = o; o = 0; for (var p = 0; p + 1 < i.length; p++) { var v = i[p], m = v.dts - this._dtsBase - (0 == p ? h : 0), y = v.isKeyframe, g = m - o, b = v.cts, _ = g + b; -1 === a && (a = g, s = _); var w = 0; if (p !== i.length - 1) w = i[p + 1].dts - this._dtsBase - o - g; else w = d.length >= 1 ? d[d.length - 1].duration : Math.floor(this._videoMeta.refSampleDuration); if (y) { var E = new lr(g, _, w, v.dts, !0); E.fileposition = v.fileposition, f.appendSyncPoint(E) } d.push({ dts: g, pts: _, cts: b, units: v.units, size: v.length, isKeyframe: y, duration: w, originalDts: m, flags: { isLeading: 0, dependsOn: y ? 2 : 1, isDependedOn: y ? 1 : 0, hasRedundancy: 0, isNonSync: y ? 0 : 1 } }) } for (var S = 8, k = 8, T = 0; T < d.length; ++T)k += d[T].size; var A = new Uint8Array(k); A[0] = k >>> 24 & 255, A[1] = k >>> 16 & 255, A[2] = k >>> 8 & 255, A[3] = 255 & k, A.set(or.types.mdat, 4); for (var R = 0; R < d.length; R++)for (var O = d[R].units; O.length;) { var L = O.shift().data; A.set(L, S), S += L.byteLength } var x = d[d.length - 1]; if (t = x.dts + x.duration, r = x.pts + x.duration, this._videoNextDts = t, f.beginDts = a, f.endDts = t, f.beginPts = s, f.endPts = r, f.originalBeginDts = d[0].originalDts, f.originalEndDts = x.originalDts + x.duration, f.firstSample = new lr(d[0].dts, d[0].pts, d[0].duration, d[0].originalDts, d[0].isKeyframe), f.lastSample = new lr(x.dts, x.pts, x.duration, x.originalDts, x.isKeyframe), this._isLive || this._videoSegmentInfoList.append(f), n.samples = d, n.sequenceNumber++, this._forceFirstIDR) { var P = d[0].flags; P.dependsOn = 2, P.isNonSync = 0 } var C = or.moof(n, a); n.samples = [i[i.length - 1]], n.length = 0, this._onMediaSegment("video", { type: "video", data: this._mergeBoxes(C, A).buffer, sampleCount: d.length, info: f }) } } } }, { key: "_mergeBoxes", value: function (e, t) { var r = new Uint8Array(e.byteLength + t.byteLength); return r.set(e, 0), r.set(t, e.byteLength), r } }, { key: "onInitSegment", get: function () { return this._onInitSegment }, set: function (e) { this._onInitSegment = e } }, { key: "onMediaSegment", get: function () { return this._onMediaSegment }, set: function (e) { this._onMediaSegment = e } }]), e }(), hr = function () { function e(t) { zt(this, e), or.init(), this._config = { _isLive: !1 }, $t(this._config, t), this.onInitSegment = null, this.onMediaSegment = null, this.onMediaInfo = null, this.seekCallBack = null, this.loadmetadata = !1, this.ftyp_moov = null, this._tagdemux = new nr, this._flvparse = new ir, this.ftyp_moov_v = null, this.ftyp_moov_a = null, this.metaSuccRun = !1, this.metas = [], this.parseChunk = null, this.hasVideo = !1, this.hasAudio = !1, this._error = null, this._pendingResolveSeekPoint = -1, this._tempBaseTime = 0, this.setflvBase = this.setflvBasefrist, this._tagdemux._onTrackMetadata = this.Metadata.bind(this), this._tagdemux._onMediaInfo = this.metaSucc.bind(this), this._tagdemux._onDataAvailable = this.onDataAvailable.bind(this), this._tagdemux._onError = this.error.bind(this), this.m4mof = new dr(this._config), this.m4mof.onMediaSegment = this.onMdiaSegment.bind(this) } return Ht(e, [{ key: "seek", value: function (e) { this._flvparse.dispose(), this.setflvBase = this.setflvBasefrist, null != e && 0 != e || (e = 0, this._pendingResolveSeekPoint = -1), this._tempBaseTime != e && (this._tempBaseTime = e, this._tagdemux._timestampBase = e, this.m4mof.seek(e), this.m4mof.insertDiscontinuity(), this._pendingResolveSeekPoint = e) } }, { key: "setflvBasefrist", value: function (e, t) { var r = 0; try { r = this._flvparse.setFlv(new Uint8Array(e)) } catch (e) { this.error(e) } if (0 == this._flvparse.arrTag.length) return r; if (this._flvparse.arrTag.length > 0) { this._tagdemux.hasAudio = this.hasAudio = this._flvparse._hasAudio, this._tagdemux.hasVideo = this.hasVideo = this._flvparse._hasVideo, 0 != this._tempBaseTime && this._tempBaseTime == this._flvparse.arrTag[0].getTime() && (this._tagdemux._timestampBase = 0); try { this._tagdemux.moofTag(this._flvparse.arrTag) } catch (e) { this.error(e) } this.setflvBase = this.setflvBaseUsually } return r } }, { key: "setflvBaseUsually", value: function (e, t) { var r = 0; try { r = this._flvparse.setFlv(new Uint8Array(e)) } catch (e) { this.error(e) } if (this._flvparse.arrTag.length > 0) try { this._tagdemux.moofTag(this._flvparse.arrTag) } catch (e) { this.error(e) } return r } }, { key: "onMdiaSegment", value: function (e, t) { if (this.onMediaSegment && this.onMediaSegment(e, new Uint8Array(t.data)), -1 != this._pendingResolveSeekPoint && "video" == e) { var r = this._pendingResolveSeekPoint; this._pendingResolveSeekPoint = -1, this.seekCallBack && this.seekCallBack(r) } } }, { key: "Metadata", value: function (e, t) { switch (e) { case "video": if (this.metas.push(["video", t]), this.m4mof._videoMeta = t, this.hasVideo && !this.hasAudio) return void this.metaSucc(); break; case "audio": if (this.metas.push(["audio", t]), this.m4mof._audioMeta = t, !this.hasVideo && this.hasAudio) return void this.metaSucc() }this.hasVideo && this.hasAudio && this.m4mof._videoMeta && this.m4mof._audioMeta && this.metaSucc() } }, { key: "metaSucc", value: function (e) { var t = this; this.onMediaInfo && e && this.onMediaInfo(e || this._tagdemux._mediaInfo, { hasAudio: this.hasAudio, hasVideo: this.hasVideo }), 0 != this.metas.length ? e || (this.metas.length > 1 ? this.metas.map(function (e) { "video" == e[0] ? t.ftyp_moov_v = or.generateInitSegment([e[1]]) : t.ftyp_moov_a = or.generateInitSegment([e[1]]) }) : this.ftyp_moov = or.generateInitSegment([this.metas[0][1]]), this.onInitSegment && 0 == this.loadmetadata && (this.ftyp_moov ? this.onInitSegment(this.ftyp_moov) : this.onInitSegment(this.ftyp_moov_v, this.ftyp_moov_a), this.loadmetadata = !0)) : this.metaSuccRun = !0 } }, { key: "onDataAvailable", value: function (e, t) { try { this.m4mof.remux(e, t) } catch (e) { this.error(e) } } }, { key: "setflv", value: function (e, t) { return this.setflvBase(e, t) } }, { key: "setflvloc", value: function (e) { ir.setFlv(new Uint8Array(e)); if (ir.arrTag.length > 0) return ir.arrTag } }, { key: "error", value: function (e) { this._error && this._error(e) } }]), e }(), pr = function (e) { function t(e) { zt(this, t); var r = xt(this, (t.__proto__ || V(t)).call(this)); return r.f2m = new hr(e), r.f2m._error = r.error.bind(r), r._onInitSegment = null, r._onMediaSegment = null, r._onMediaInfo = null, r._seekCallBack = null, r } return Bt(t, e), Ht(t, [{ key: "error", value: function (e) { this.emit("error", e.type) } }, { key: "seek", value: function (e) { this.f2m.seek(e) } }, { key: "setflv", value: function (e) { return this.f2m.setflv(e, 0) } }, { key: "setflvloc", value: function (e) { return this.f2m.setflvloc(e) } }, { key: "onInitSegment", set: function (e) { this._onInitSegment = e, this.f2m.onInitSegment = e } }, { key: "onMediaSegment", set: function (e) { this._onMediaSegment = e, this.f2m.onMediaSegment = e } }, { key: "onMediaInfo", set: function (e) { this._onMediaInfo = e, this.f2m.onMediaInfo = e } }, { key: "seekCallBack", set: function (e) { this._seekCallBack = e, this.f2m.seekCallBack = e } }]), t }(n.CustEvent); t.default = pr }, function (e, t, r) { e.exports = r(7) }, function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }(), i = u(r(8)), o = u(r(9)), a = u(r(17)), s = r(18); function u(e) { return e && e.__esModule ? e : { default: e } } var l = function (e) { function t(e, r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); var n = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this)); return n.tag = "flv-player", n.video = e, n.box = "flv", n.timer = null, n.seekTimer = null, n.config = (0, s.deepAssign)({}, a.default, r), n.requestSetTime = !1, n.throttle = null, n.bindEvents(), n.attachMedia(), n } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, s.CustEvent), n(t, null, [{ key: "isSupport", value: function () { var e = (new s.UAParser).getBrowser(); return !("Safari" === e.name && parseInt(e.major) < 10) && !(!window.MediaSource || !window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.640020,mp4a.40.2"')) } }, { key: "version", get: function () { return "1.4.9" } }]), n(t, [{ key: "internalPropertyHandle", value: function () { if (Object.getOwnPropertyDescriptor) { var e = this, t = Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype, "currentTime"); Object.defineProperty(this.video, "currentTime", { get: function () { return t.get.call(e.video) }, set: function (r) { if (e.currentTimeLock) return t.set.call(e.video, r); throw new Error("can not set currentTime by youself") } }) } } }, { key: "bindEvents", value: function () { var e = this; this.video && this.video.addEventListener("canplay", function () { e.config.isLive && e.video.play(), e.config.lockInternalProperty && e.internalPropertyHandle() }) } }, { key: "attachMedia", value: function () { var e = this; this.mediaSource = new i.default(this.video, this.config), this.mediaSource.on("error", function (t) { e.emit("error", t.data), e.transmuxer && e.transmuxer.pause() }), this.mediaSource.on("bufferFull", function () { e.pauseTransmuxer() }), this.mediaSource.on("updateend", function () { e.onmseUpdateEnd() }) } }, { key: "load", value: function (e) { e && (this.config.src = e), this.transmuxer = new o.default(this.mediaSource, this.config, this.globalEvent), this.transmuxerEvent(this.transmuxer), this.transmuxer.loadSource() } }, { key: "transmuxerEvent", value: function (e) { var t = this, r = this.mediaSource; e.on("mediaSegment", function (e) { r.emit("mediaSegment", e.data) }), e.on("mediaSegmentInit", function (e) { r.emit("mediaSegmentInit", e.data) }), e.on("error", function (n) { t.emit("error", n.data), e.pause(), r.pause() }), e.on("end", function (e) { r.endOfStream() }), e.on("heartbeat", function (e) { t.emit("heartbeat", e.data) }), e.on("mediaInfo", function (e) { t.mediaInfo || (t.mediaInfo = e, t.emit("mediaInfo", e.data), r.init(e.data), t.video.src = URL.createObjectURL(r.mediaSource), t.video.addEventListener("seeking", t._throttle.call(t))) }) } }, { key: "_throttle", value: function () { return this.throttle = (0, s.throttle)(this._seek.bind(this), 200, { leading: !1 }), this.throttle } }, { key: "isTimeinBuffered", value: function (e) { for (var t = this.video.buffered, r = 0; r < t.length; r++) { var n = t.start(r), i = t.end(r); if (e >= n && e < i) return !0 } return !1 } }, { key: "getCurrentBufferEnd", value: function () { for (var e = this.video.buffered, t = this.video.currentTime, r = 0; r < e.length; r++) { var n = e.start(r), i = e.end(r); if (n <= t && t < i) return i } } }, { key: "_seek", value: function (e) { var t = this; this.currentTimeLock = !0; var r = (0, s.isNumber)(e) && !isNaN(e) ? e : this.video.currentTime; if (this.requestSetTime) return this.requestSetTime = !1, void (this.currentTimeLock = !1); if (this.isTimeinBuffered(r)) { if (this.config.alwaysSeekKeyframe) { var n = this.transmuxer.getNearestKeyframe(Math.floor(1e3 * r)); n && (this.requestSetTime = !0, this.video.currentTime = n.keyframetime / 1e3) } } else { s.Log.verbose(this.tag, "do seek"), this.transmuxer.pause(); var i = this.transmuxer.getNearestKeyframe(Math.floor(1e3 * r)); r = i.keyframetime / 1e3, this.seekTimer = setTimeout(function () { t.mediaSource.seek(r), t.transmuxer.seek(i) }, 100), this.requestSetTime = !0, this.video.currentTime = r, window.clearInterval(this.timer), this.timer = null } return this.currentTimeLock = !1, r } }, { key: "onmseUpdateEnd", value: function () { this.config.isLive || this.getCurrentBufferEnd() >= this.video.currentTime + this.config.lazyLoadMaxDuration && null === this.timer && (s.Log.verbose(this.tag, "Maximum buffering duration exceeded, suspend transmuxing task"), this.pauseTransmuxer()) } }, { key: "heartbeat", value: function () { for (var e = this.video.currentTime, t = this.video.buffered, r = !1, n = 0; n < t.length; n++) { var i = t.start(n), o = t.end(n); if (e >= i && e < o) { e >= o - this.config.lazyLoadRecoverDuration && (r = !0); break } } r && (window.clearInterval(this.timer), this.timer = null, s.Log.verbose(this.tag, "Continue loading from paused position"), this.transmuxer.resume(), this.mediaSource.resume()) } }, { key: "pauseTransmuxer", value: function () { this.transmuxer.pause(), this.mediaSource.pause(), this.timer || (this.timer = setInterval(this.heartbeat.bind(this), 1e3)) } }, { key: "resume", value: function () { this._seek(0) } }, { key: "destroy", value: function () { window.clearInterval(this.timer), window.clearInterval(this.seekTimer), this.video.removeEventListener("seeking", this.throttle), this.video && (URL.revokeObjectURL(this.video.src), this.video.src = "", this.video.removeAttribute("src"), this.transmuxer && (this.transmuxer.pause(), this.transmuxer.destroy(), this.transmuxer = null), this.mediaSource && (this.mediaSource.destroy(), this.mediaSource = null)) } }, { key: "seek", value: function (e) { return this._seek(e) } }, { key: "play", value: function () { return this.video.play() } }, { key: "pause", value: function () { return this.video.pause() } }, { key: "refresh", value: function () { this.transmuxer && this.mediaSource ? this._seek(0) : s.Log.verbose(this.tag, "transmuxer & mediaSource not ready") } }, { key: "stopLoad", value: function () { this.transmuxer && this.transmuxer.pause(), this.mediaSource && this.mediaSource.pause() } }]), t }(); t.default = l }, function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n, i = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }(), o = r(0), a = r(2), s = (n = a) && n.__esModule ? n : { default: n }, u = r(1); var l = function (e) { function t(e, r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); var n = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this)); return n.video = e, n.config = r, n.tag = "mse-controller", n.e = { onSourceOpen: n.onSourceOpen.bind(n), onSourceEnded: n.onSourceEnded.bind(n), onSourceClose: n.onSourceClose.bind(n), onSourceBufferError: n.onSourceBufferError.bind(n) }, n.hasVideo = !0, n.hasAudio = !0, n.removeRangesList = { video: [], audio: [] }, n.removeBucketing = !1, n.timer = { video: null, audio: null }, n.queue = { video: [], audio: [] }, n.sourceBuffer = { video: null, audio: null }, n.mimeCodec = { video: null, audio: null }, n.sourceBufferEvent(), n.complete = !1, n } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, o.CustEvent), i(t, [{ key: "init", value: function (e) { if (this.mediaSource) return s.default.Error(this.tag, "MediaSource has been attached to an HTMLMediaElement!"), void this.emit("error", { errno: u.ERRORNO.MEDIASOURCE_ERROR, errmsg: "MediaSource has been attached to an HTMLMediaElement!" }); e.hasAudio ? this.mimeCodec.audio = 'audio/mp4; codecs="' + e.audioCodec + '"' : this.hasAudio = !1, e.hasVideo ? this.mimeCodec.video = 'video/mp4; codecs="' + e.videoCodec + '"' : this.hasVideo = !1; var t = this.mediaSource = new window.MediaSource; t.addEventListener("sourceopen", this.e.onSourceOpen), t.addEventListener("sourceended", this.e.onSourceEnded), t.addEventListener("sourceclose", this.e.onSourceClose) } }, { key: "onSourceOpen", value: function () { s.default.verbose(this.tag, "MediaSource onSourceOpen"), this.mediaSource.removeEventListener("sourceopen", this.e.onSourceOpen), this.hasAudio && this.addSourceBuffer("audio"), this.hasVideo && this.addSourceBuffer("video"), this.hasQueueList() && this.doUpdate(), this.emit("source_open") } }, { key: "addSourceBuffer", value: function (e) { var t = this; this.sourceBuffer[e] = this.mediaSource.addSourceBuffer(this.mimeCodec[e]), s.default.verbose(this.tag, "add sourcebuffer " + e); var r = this.sourceBuffer[e]; r.addEventListener("error", this.e.onSourceBufferError), r.addEventListener("abort", function () { return s.default.verbose(t.tag, "sourceBuffer: abort") }), r.addEventListener("updateend", function () { t.sourceBuffer && (t.hasRemoveList() ? (t.removeRangesList.video.length && t.cleanRangesList("video"), t.removeRangesList.audio.length && t.cleanRangesList("audio")) : t.hasQueueList() ? t.doUpdate() : t.complete && !t.sourceBuffer[e].updating && t.endOfStream(), t.emit("updateend")) }) } }, { key: "hasRemoveList", value: function () { return this.removeRangesList.video.length || this.removeRangesList.audio.length } }, { key: "hasQueueList", value: function () { return this.queue.video.length || this.queue.audio.length } }, { key: "doUpdate", value: function () { for (var e in this.queue) if (this.queue[e].length > 0 && !this.sourceBuffer[e].updating) { var t = this.queue[e].shift(); this.appendBuffer(t, e) } } }, { key: "sourceBufferEvent", value: function () { var e = this; this.on("mediaSegment", function (t) { var r = t.data, n = r.type; e.needCleanupSourceBuffer(n) && e.doCleanupSourceBuffer(n), e.queue[n].push(r.data), e.sourceBuffer[n] && !e.hasRemoveList() && e.doUpdate() }), this.on("mediaSegmentInit", function (t) { var r = t.data, n = r.type; e.queue[n].push(r.data) }) } }, { key: "needCleanupSourceBuffer", value: function (e) { var t = this.video.currentTime, r = this.video.buffered; return r.length >= 1 && t - r.start(0) >= this.config.autoCleanupMaxBackwardDuration } }, { key: "doCleanupSourceBuffer", value: function (e) { for (var t = this.video.currentTime, r = this.sourceBuffer[e].buffered, n = !1, i = 0; i < r.length; i++) { var o = r.start(i), a = r.end(i); if (o <= t && t < a + 3 && t - o >= this.config.autoCleanupMaxBackwardDuration) { n = !0; var s = t - this.config.autoCleanupMinBackwardDuration; this.removeRangesList[e].push({ start: o, end: s }) } } n && !this.sourceBuffer[e].updating && this.cleanRangesList(e) } }, { key: "cleanRangesList", value: function (e) { if (!this.sourceBuffer[e].updating) for (var t = this.sourceBuffer[e]; this.removeRangesList[e].length && !t.updating;) { var r = this.removeRangesList[e].shift(); t.remove(r.start, r.end) } } }, { key: "appendBuffer", value: function (e, t) { if (this.sourceBuffer[t]) try { this.sourceBuffer[t].appendBuffer(e.buffer) } catch (r) { this.queue[t].unshift(e), 22 === r.code && (s.default.verbose(this.tag, "MediaSource bufferFull"), this.emit("bufferFull")) } } }, { key: "onSourceEnded", value: function () { s.default.verbose(this.tag, "MediaSource onSourceEnded") } }, { key: "onSourceClose", value: function () { s.default.verbose(this.tag, "MediaSource onSourceClose"), this.mediaSource && null !== this.e && (this.mediaSource.removeEventListener("sourceopen", this.e.onSourceOpen), this.mediaSource.removeEventListener("sourceended", this.e.onSourceEnded), this.mediaSource.removeEventListener("sourceclose", this.e.onSourceClose)) } }, { key: "onSourceBufferError", value: function (e) { this.emit("error", { errnono: u.ERRORNO.SOURCEBUFFER_ERROR, errmsg: e }), s.default.error(this.tag, "SourceBuffer Error: " + e) } }, { key: "seek", value: function () { for (var e in this.sourceBuffer) { var t = this.sourceBuffer[e]; if (t) { if ("open" === this.mediaSource.readyState) try { t.abort() } catch (e) { this.emit("error", { errno: u.ERRORNO.SBABORT_ERROR, errmsg: e }), s.default.error(this.tag, e.message) } this.queue[e] = []; for (var r = 0; r < t.buffered.length; r++) { var n = t.buffered.start(r), i = t.buffered.end(r); this.removeRangesList[e].push({ start: n, end: i }) } t.updating || this.cleanRangesList(e) } } } }, { key: "resume", value: function () { this.doUpdate() } }, { key: "pause", value: function () { } }, { key: "endOfStream", value: function () { if (this.mediaSource) { var e = this.mediaSource; this.complete = !0; var t = this.sourceBuffer; if (t.video && t.video.updating || t.audio && t.audio.updating) return; if ("open" === e.readyState) try { e.endOfStream(), this.complete = !1 } catch (e) { s.default.verbose(this.tag, e), this.emit("error", { errno: u.ERRORNO.ENDOFSTREAM_ERROR, errmsg: e }) } } } }, { key: "destroy", value: function () { if (this.mediaSource) { var e = this.mediaSource; this.queue = { video: [], audio: [] }, this.sourceBuffer = { video: null, audio: null }, this.mimeCodec = { video: null, audio: null }; var t = this.sourceBuffer; this.complete = !1, this.endOfStream(), t && ("closed" !== e.readyState && (e.removeSourceBuffer(t), t.removeEventListener("error", this.e.onSourceBufferError), t.removeEventListener("updateend", this.e.onSourceBufferUpdateEnd)), this.sourceBuffer = null), e.removeEventListener("sourceopen", this.e.onSourceOpen), e.removeEventListener("sourceended", this.e.onSourceEnded), e.removeEventListener("sourceclose", this.e.onSourceClose), this.mediaSource = null } } }]), t }(); t.default = l }, function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }(), i = l(r(3)), o = r(0), a = l(r(15)), s = l(r(5)), u = r(1); function l(e) { return e && e.__esModule ? e : { default: e } } var c = function (e) { function t(e, r, n) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); var i = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this)); return i.config = r || {}, i.tag = "transmuxer", i.loader = null, i.CPU = null, i.keyframePoint = !1, i.w = null, i.config.webWorker && (i.w = (0, a.default)(16), i.w.addEventListener("message", function (e) { i.parseCallback.call(i, e.data) }), i.w.postMessage({ cmd: "init", data: r })), i.lock = 0, i } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, o.CustEvent), n(t, [{ key: "loadSource", value: function () { this.config.webWorker ? this.w.postMessage({ cmd: "loadSource" }) : (this.loader = new i.default(this.config), this.loader.arrivalDataCallback = this.arrivalDataCallback.bind(this), this.loader.open(), this.loaderBindEvent(this.loader)) } }, { key: "loaderBindEvent", value: function (e) { var t = this; e.on("end", function () { t.emit("end") }), e.on("error", function (e) { t.emit("error", e.data) }), e.on("heartbeat", function (e) { t.emit("heartbeat", e.data) }) } }, { key: "arrivalDataCallback", value: function (e, t, r) { var n = this; return this.CPU || (this.config.isLive ? this.config._isLive = !0 : this.config._isLive = !1, this.CPU = new s.default(this.config), this.CPU.onInitSegment = this.onRemuxerInitSegmentArrival.bind(this), this.CPU.onMediaSegment = this.onRemuxerMediaSegmentArrival.bind(this), this.CPU.onMediaInfo = this.onMediaInfo.bind(this), this.CPU.on("error", function (e) { n.emit("error", { errno: u.ERRORNO.CODEC_ERROR, errmsg: e.data }) })), void 0 !== r && this.CPU.seek(r), this.CPU.setflv(e) } }, { key: "parseCallback", value: function (e) { switch (e.cmd) { case "mediaSegmentInit": this.emit("mediaSegmentInit", e.source); break; case "mediaSegment": this.emit("mediaSegment", e.source); break; case "mediainfo": this.mediaInfo = e.source, this.emit("mediaInfo", e.source); break; case "error": this.emit("error", e.source) } } }, { key: "onMediaInfo", value: function (e) { this.mediaInfo = e, this.emit("mediaInfo", e) } }, { key: "onRemuxerInitSegmentArrival", value: function (e, t) { this.emit("mediaSegmentInit", { type: "video", data: e }), t && this.emit("mediaSegmentInit", { type: "audio", data: t }) } }, { key: "onRemuxerMediaSegmentArrival", value: function (e, t) { this.emit("mediaSegment", { type: e, data: t }) } }, { key: "getMediaInfo", value: function () { return this.mediaInfo } }, { key: "pause", value: function () { this.config.webWorker ? this.w.postMessage({ cmd: "pause" }) : this.loader.pause() } }, { key: "resume", value: function () { this.config.webWorker ? this.w.postMessage({ cmd: "resume" }) : this.loader.resume() } }, { key: "isSeekable", value: function () { return this.mediaInfo.hasKeyframesIndex } }, { key: "seek", value: function (e) { if (!this.isSeekable()) return this.emit("error", { errno: u.ERRORNO.CANNOT_SEEK, errmsg: "这个flv视频不支持seek" }), !1; this.config.webWorker ? this.w.postMessage({ cmd: "seek", keyframe: e }) : this.loader.seek(e.keyframePoint, !1, e.keyframetime) } }, { key: "destroy", value: function () { this.config.webWorker ? this.w.postMessage({ cmd: "destroy" }) : (this.loader.destroy(), this.loader = null, this.CPU = null) } }, { key: "getNearestKeyframe", value: function (e) { if (this.mediaInfo && this.mediaInfo.keyframesIndex) { var t = this.mediaInfo.keyframesIndex.times, r = this.mediaInfo.keyframesIndex.filepositions; return function e(n, i) { var o = n.length, a = Math.floor(o / 2); if (1 === o) { var s = t.indexOf(n[0]); return { keyframetime: n[0], keyframePoint: r[s] } } if (n[a] > i) return e(n.slice(0, a), i); if (n[a] < i) return e(n.slice(a), i); var u = t.indexOf(n[0]); return { keyframetime: n[0], keyframePoint: r[u] } }(t, e) } return 0 } }]), t }(); t.default = c }, function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }(), i = u(r(11)), o = r(0), a = u(r(2)), s = r(1); function u(e) { return e && e.__esModule ? e : { default: e } } var l = function (e) { function t(e, r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); var n = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this)); return n.tag = "fetch", n.fetching = !1, n.config = r, n.range = { from: 0, to: 524288 }, n.src = e, n.totalRange = null, n.block = 524288, n.reader = null, n.requestAbort = !1, n.arrivalDataCallback = null, n.bytesStart = 0, n.heartbeat = null, n } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, o.CustEvent), n(t, null, [{ key: "isSupport", value: function () { return !(!self.fetch || !self.ReadableStream) } }]), n(t, [{ key: "open", value: function (e, t) { var r = this; this.requestAbort = !1; var n = new Headers, o = e || { from: 0, to: -1 }; if (!this.config.isLive) { this.range.from = o.from, this.range.to = o.to; var a = (0, i.default)(o, this.config); if ("string" == typeof a) this.src = this.config.src + a; else for (var u in a) n.append(u, a[u]) } t && (this.bytesStart = 0), this.bytesStart = e.from; var l = { method: "GET", headers: n, mode: "cors", cache: "default", referrerPolicy: "no-referrer-when-downgrade" }; fetch(this.src, l).then(function (e) { if (e.ok) { var n = e.body.getReader(); return r.pump(n, t) } }).catch(function (e) { r.emit("error", { errno: s.ERRORNO.NET_ERROR, errmsg: e }) }) } }, { key: "pause", value: function () { this.requestAbort = !0 } }, { key: "pump", value: function (e, t) { var r = this; return e.read().then(function (n) { if (!n.done) { if (!0 === r.requestAbort) return r.requestAbort = !1, e.cancel(); var i = n.value.buffer; return r.arrivalDataCallback && (r.arrivalDataCallback(i, r.bytesStart, t), r.bytesStart += i.byteLength), r.pump(e) } r.emit("end"), a.default.verbose(r.tag, "load end") }).catch(function (e) { r.emit("error", { errno: s.ERRORNO.NET_ERROR, errmsg: e.message }) }) } }]), t }(); t.default = l }, function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }), t.default = function (e, t) { if ("range" === t.seekType) { var r = {}, n = void 0; return n = -1 !== e.to ? "bytes=" + e.from.toString() + "-" + e.to.toString() : "bytes=" + e.from.toString() + "-", r.Range = n, r } return -1 !== e.to ? "?start=" + e.from.toString() + "&end=" + e.to.toString() : "?start=" + e.from.toString() } }, function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n, i = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }(), o = r(4), a = (n = o) && n.__esModule ? n : { default: n }, s = r(0), u = r(1); var l = function (e) { function t(e, r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); var n = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this)); return n.tag = "RangeLoader", n.xhr = null, n.src = e, n.totalLength = null, n.chunkSizeKB = 524288, n.range = {}, n.bytesStart = 0, n.needSeek = !1, n.keyframePoint = null, n } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, s.CustEvent), i(t, null, [{ key: "isSupport", value: function () { try { var e = new XMLHttpRequest; return e.open("GET", "https://example.com", !0), e.responseType = "arraybuffer", "arraybuffer" === e.responseType } catch (e) { return !1 } } }]), i(t, [{ key: "open", value: function (e, t) { var r = this.xhr = new XMLHttpRequest; r.open("GET", this.src, !0), r.responseType = "arraybuffer", r.onreadystatechange = this.onReadyStateChange.bind(this), r.onprogress = this.onProgress.bind(this), r.onload = this.onLoad.bind(this), r.onerror = this.onXhrError.bind(this); var n = e || { from: 0, to: -1 }; this.range.from = n.from, -1 === n.to && (n.to = n.from + this.chunkSizeKB), t && (this.bytesStart = e.from, this.needSeek = !0, this.keyframePoint = t), this.range.to = n.to; var i = (0, a.default)(n).headers; for (var o in i) r.setRequestHeader(o, i[o]); r.send() } }, { key: "pause", value: function () { this.abort() } }, { key: "abort", value: function () { this.xhr && (this.xhr.onreadystatechange = null, this.xhr.onprogress = null, this.xhr.onload = null, this.xhr.onerror = null, this.xhr.abort(), this.xhr = null) } }, { key: "destroy", value: function () { this.xhr && (this.abort(), this.xhr.onreadystatechange = null, this.xhr.onprogress = null, this.xhr.onload = null, this.xhr.onerror = null, this.xhr = null), this.totalLength = null, this.bytesStart = null, this.range = {} } }, { key: "onReadyStateChange", value: function (e) { var t = this.xhr; if (2 === t.readyState && t.status < 200 && t.status > 299) { var r = { from: this.range.from, to: this.range.to, url: this.src, msg: "http Error: http code " + t.status }; this.emit("error", { errno: u.ERRORNO.NET_ERROR, errmsg: r }) } } }, { key: "onProgress", value: function (e) { this.totalLength || (this.totalLength = e.total, this.abort(), this.open()) } }, { key: "onLoad", value: function (e) { if (this.totalLength && this.arrivalDataCallback) { var t = e.target.response; this.needSeek ? (this.needSeek = !1, this.arrivalDataCallback(t, this.bytesStart, this.keyframePoint)) : this.arrivalDataCallback(t, this.bytesStart), this.bytesStart += t.byteLength, this.open({ from: this.bytesStart, to: -1 }) } } }, { key: "onXhrError", value: function (e) { var t = { from: this.range.from, to: this.range.to, url: this.src, msg: e.constructor.name + " " + e.type }; this.emit("error", { errno: u.ERRORNO.NET_ERROR, errmsg: t }) } }]), t }(); t.default = l }, function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }(), i = r(0), o = r(1); var a = function (e) { function t(e, r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); var n = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this)); return n.tag = "WebSocket", n.src = e, n._ws = null, n._requestAbort = !1, n._receivedLength = 0, n } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, i.CustEvent), n(t, null, [{ key: "isSupported", value: function () { try { return void 0 !== window.WebSocket } catch (e) { return !1 } } }]), n(t, [{ key: "destroy", value: function () { this._ws && this.abort() } }, { key: "open", value: function (e, t) { try { var r = this._ws = new self.WebSocket(this.src); r.binaryType = "arraybuffer", r.onopen = this.onWebSocketOpen.bind(this), r.onclose = this.onWebSocketClose.bind(this), r.onmessage = this.onWebSocketMessage.bind(this), r.onerror = this.onWebSocketError.bind(this) } catch (e) { var n = { code: e.code, msg: e.message }; this.emit("error", { errno: o.ERRORNO.NET_ERROR, errmsg: n }) } } }, { key: "abort", value: function () { var e = this._ws; !e || 0 !== e.readyState && 1 !== e.readyState || (this._requestAbort = !0, e.close()), this._ws = null } }, { key: "onWebSocketClose", value: function (e) { !0 !== this._requestAbort ? this.emit("end") : this._requestAbort = !1 } }, { key: "onWebSocketOpen", value: function () { } }, { key: "onWebSocketMessage", value: function (e) { var t = this; if (e.data instanceof ArrayBuffer) this.dispatchArrayBuffer(e.data); else if (e.data instanceof Blob) { var r = new FileReader; r.onload = function () { t.dispatchArrayBuffer(r.result) }, r.readAsArrayBuffer(e.data) } else { var n = { code: -1, msg: "Unsupported WebSocket message type: " + e.data.constructor.name }; this.emit("error", { errno: o.ERRORNO.NET_ERROR, errmsg: n }) } } }, { key: "dispatchArrayBuffer", value: function (e) { var t = e, r = this.receivedLength; this.receivedLength += t.byteLength, this.arrivalDataCallback && this.arrivalDataCallback(t, r) } }, { key: "onWebSocketError", value: function (e) { var t = { code: e.code, msg: e.message }; this.emit("error", { errno: o.ERRORNO.NET_ERROR, errmsg: t }) } }]), t }(); t.default = a }, function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n, i = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }(), o = r(4), a = (n = o) && n.__esModule ? n : { default: n }, s = r(0), u = r(1); var l = function (e) { function t(e, r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t); var n = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this)); return n.tag = "mozChunkLoader", n.xhr = null, n.src = e, n.config = r, n.totalLength = null, n.chunkSizeKB = 393216, n.range = {}, n.bytesStart = 0, n.keyframePoint = null, n } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }(t, s.CustEvent), i(t, null, [{ key: "isSupport", value: function () { try { var e = new XMLHttpRequest; return e.open("GET", "https://example.com", !0), e.responseType = "moz-chunked-arraybuffer", "moz-chunked-arraybuffer" === e.responseType } catch (e) { return !1 } } }]), i(t, [{ key: "open", value: function (e, t) { var r = this.xhr = new XMLHttpRequest; if (r.open("GET", this.src, !0), r.responseType = "moz-chunked-arraybuffer", r.onreadystatechange = this.onReadyStateChange.bind(this), r.onprogress = this.onProgress.bind(this), r.onload = this.onLoadEnd.bind(this), r.onerror = this.onXhrError.bind(this), !this.config.isLive) { var n = e || { from: 0, to: -1 }; this.range.from = n.from, this.range.to = n.to, t && (this.needSeek = !0, this.keyframePoint = t); var i = (0, a.default)(n).headers; for (var o in i) r.setRequestHeader(o, i[o]) } r.send() } }, { key: "pause", value: function () { this.abort() } }, { key: "abort", value: function () { this.xhr && (this.xhr.onreadystatechange = null, this.xhr.onprogress = null, this.xhr.onload = null, this.xhr.onerror = null, this.xhr.abort(), this.xhr = null) } }, { key: "destroy", value: function () { this.xhr && (this.abort(), this.xhr.onreadystatechange = null, this.xhr.onprogress = null, this.xhr.onload = null, this.xhr.onerror = null, this.xhr = null), this.totalLength = null, this.bytesStart = null, this.range = {} } }, { key: "onReadyStateChange", value: function (e) { var t = this.xhr; if (2 === t.readyState && t.status < 200 && t.status > 299) { var r = { from: this.range.from, to: this.range.to, url: this.src, msg: "http Error: http code " + t.status }; this.emit("error", { errno: u.ERRORNO.NET_ERROR, errmsg: r }) } } }, { key: "onProgress", value: function (e) { this.totalLength || (this.totalLength = e.total, null !== e.total && 0 !== e.total && (this.totalLength = e.total)); var t = e.target.response; this.needSeek ? (this.needSeek = !1, this.arrivalDataCallback(t, this.bytesStart, this.keyframePoint)) : this.arrivalDataCallback(t, this.bytesStart), this.bytesStart += t.byteLength } }, { key: "onLoadEnd", value: function (e) { this.emit(this.tag, "video load end") } }, { key: "onXhrError", value: function (e) { var t = { from: this.range.from, to: this.range.to, url: this.src, msg: e.constructor.name + " " + e.type }; this.emit("error", { errno: u.ERRORNO.NET_ERROR, errmsg: t }) } }]), t }(); t.default = l }, function (e, t, r) { function n(e) { var t = {}; function r(n) { if (t[n]) return t[n].exports; var i = t[n] = { i: n, l: !1, exports: {} }; return e[n].call(i.exports, i, i.exports, r), i.l = !0, i.exports } r.m = e, r.c = t, r.i = function (e) { return e }, r.d = function (e, t, n) { r.o(e, t) || Object.defineProperty(e, t, { configurable: !1, enumerable: !0, get: n }) }, r.n = function (e) { var t = e && e.__esModule ? function () { return e.default } : function () { return e }; return r.d(t, "a", t), t }, r.o = function (e, t) { return Object.prototype.hasOwnProperty.call(e, t) }, r.p = "/", r.oe = function (e) { throw console.error(e), e }; var n = r(r.s = ENTRY_MODULE); return n.default || n } var i = "[\\.|\\-|\\+|\\w|/|@]+", o = "\\((/\\*.*?\\*/)?s?.*?(" + i + ").*?\\)"; function a(e) { return (e + "").replace(/[.?*+^$[\]\\(){}|-]/g, "\\$&") } function s(e, t, n) { var s = {}; s[n] = []; var u = t.toString(), l = u.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/); if (!l) return s; for (var c, f = l[1], d = new RegExp("(\\\\n|\\W)" + a(f) + o, "g"); c = d.exec(u);)"dll-reference" !== c[3] && s[n].push(c[3]); for (d = new RegExp("\\(" + a(f) + '\\("(dll-reference\\s(' + i + '))"\\)\\)' + o, "g"); c = d.exec(u);)e[c[2]] || (s[n].push(c[1]), e[c[2]] = r(c[1]).m), s[c[2]] = s[c[2]] || [], s[c[2]].push(c[4]); return s } function u(e) { return Object.keys(e).reduce(function (t, r) { return t || e[r].length > 0 }, !1) } e.exports = function (e, t) { t = t || {}; var i = { main: r.m }, o = t.all ? { main: Object.keys(i) } : function (e, t) { for (var r = { main: [t] }, n = { main: [] }, i = { main: {} }; u(r);)for (var o = Object.keys(r), a = 0; a < o.length; a++) { var l = o[a], c = r[l].pop(); if (i[l] = i[l] || {}, !i[l][c] && e[l][c]) { i[l][c] = !0, n[l] = n[l] || [], n[l].push(c); for (var f = s(e, e[l][c], l), d = Object.keys(f), h = 0; h < d.length; h++)r[d[h]] = r[d[h]] || [], r[d[h]] = r[d[h]].concat(f[d[h]]) } } return n }(i, e), a = ""; Object.keys(o).filter(function (e) { return "main" !== e }).forEach(function (e) { for (var t = 0; o[e][t];)t++; o[e].push(t), i[e][t] = "(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })", a = a + "var " + e + " = (" + n.toString().replace("ENTRY_MODULE", JSON.stringify(t)) + ")({" + o[e].map(function (t) { return JSON.stringify(t) + ": " + i[e][t].toString() }).join(",") + "});\n" }), a = a + "(" + n.toString().replace("ENTRY_MODULE", JSON.stringify(e)) + ")({" + o.main.map(function (e) { return JSON.stringify(e) + ": " + i.main[e].toString() }).join(",") + "})(self);"; var l = new window.Blob([a], { type: "text/javascript" }); if (t.bare) return l; var c = (window.URL || window.webkitURL || window.mozURL || window.msURL).createObjectURL(l), f = new window.Worker(c); return f.objectURL = c, f } }, function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }), t.default = function (e) { var t = null, r = null, o = {}; function a(e, t) { self.postMessage({ cmd: "mediaSegmentInit", source: { type: "video", data: e } }), t && self.postMessage({ cmd: "mediaSegmentInit", source: { type: "audio", data: t } }) } function s(e, t) { self.postMessage({ cmd: "mediaSegment", source: { type: e, data: t } }) } function u(e) { self.postMessage({ cmd: "error", source: e }) } function l(e) { self.postMessage({ cmd: "mediainfo", source: e }) } function c(e, r, i) { return t || ((t = new n.default).onInitSegment = a, t.onMediaSegment = s, t.onError = u, t.onMediaInfo = l, t.on("error", function (e) { self.postMessage({ cmd: "error", source: e.data }) })), i && t.seek(i), t.setflv(e) } e.addEventListener("message", function (e) { switch (e.data.cmd) { case "init": o = e.data.data; break; case "loadSource": (r = new i.default(o)).arrivalDataCallback = c, r.open(); break; case "pause": r.pause(); break; case "seek": n = e.data.keyframe, r.pause(), (r = new i.default(o)).arrivalDataCallback = c, r.seek(n.keyframePoint, !1, n.keyframetime); break; case "resume": r.resume(); break; case "destroy": r.destroy(), r = null, t = null }var n }) }; var n = o(r(5)), i = o(r(3)); function o(e) { return e && e.__esModule ? e : { default: e } } }, function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }), t.default = { isLive: !1, box: "flv", seekInKeyframe: !0, alwaysSeekKeyframe: !0, lazyLoadMaxDuration: 120, lazyLoadRecoverDuration: 30, lockInternalProperty: !1, debug: !0, webWorker: !1, autoCleanupSourceBuffer: !0, autoCleanupMaxBackwardDuration: 30, autoCleanupMinBackwardDuration: 30, stashSize: 393216, seekType: "range" } }, function (e, t, r) { (function (e) { (function (t) { var r = "undefined" != typeof window ? window : void 0 !== e ? e : "undefined" != typeof self ? self : {}; function n(e) { return e && e.__esModule && Object.prototype.hasOwnProperty.call(e, "default") ? e.default : e } function i(e, t) { return e(t = { exports: {} }, t.exports), t.exports } var o = Math.ceil, a = Math.floor, s = function (e) { return isNaN(e = +e) ? 0 : (e > 0 ? a : o)(e) }, u = function (e) { if (null == e) throw TypeError("Can't call method on  " + e); return e }, l = i(function (e) { var t = e.exports = "undefined" != typeof window && window.Math == Math ? window : "undefined" != typeof self && self.Math == Math ? self : Function("return this")(); "number" == typeof __g && (__g = t) }), c = i(function (e) { var t = e.exports = { version: "2.5.1" }; "number" == typeof __e && (__e = t) }), f = function (e) { if ("function" != typeof e) throw TypeError(e + " is not a function!"); return e }, d = function (e, t, r) { if (f(e), void 0 === t) return e; switch (r) { case 1: return function (r) { return e.call(t, r) }; case 2: return function (r, n) { return e.call(t, r, n) }; case 3: return function (r, n, i) { return e.call(t, r, n, i) } }return function () { return e.apply(t, arguments) } }, h = function (e) { return "object" == typeof e ? null !== e : "function" == typeof e }, p = function (e) { if (!h(e)) throw TypeError(e + " is not an object!"); return e }, v = function (e) { try { return !!e() } catch (e) { return !0 } }, m = !v(function () { return 7 != Object.defineProperty({}, "a", { get: function () { return 7 } }).a }), y = l.document, g = h(y) && h(y.createElement), b = function (e) { return g ? y.createElement(e) : {} }, _ = !m && !v(function () { return 7 != Object.defineProperty(b("div"), "a", { get: function () { return 7 } }).a }), w = function (e, t) { if (!h(e)) return e; var r, n; if (t && "function" == typeof (r = e.toString) && !h(n = r.call(e))) return n; if ("function" == typeof (r = e.valueOf) && !h(n = r.call(e))) return n; if (!t && "function" == typeof (r = e.toString) && !h(n = r.call(e))) return n; throw TypeError("Can't convert object to primitive value") }, E = Object.defineProperty, S = { f: m ? Object.defineProperty : function (e, t, r) { if (p(e), t = w(t, !0), p(r), _) try { return E(e, t, r) } catch (e) { } if ("get" in r || "set" in r) throw TypeError("Accessors not supported!"); return "value" in r && (e[t] = r.value), e } }, k = function (e, t) { return { enumerable: !(1 & e), configurable: !(2 & e), writable: !(4 & e), value: t } }, T = m ? function (e, t, r) { return S.f(e, t, k(1, r)) } : function (e, t, r) { return e[t] = r, e }, A = function (e, t, r) { var n, i, o, a = e & A.F, s = e & A.G, u = e & A.S, f = e & A.P, h = e & A.B, p = e & A.W, v = s ? c : c[t] || (c[t] = {}), m = v.prototype, y = s ? l : u ? l[t] : (l[t] || {}).prototype; for (n in s && (r = t), r) (i = !a && y && void 0 !== y[n]) && n in v || (o = i ? y[n] : r[n], v[n] = s && "function" != typeof y[n] ? r[n] : h && i ? d(o, l) : p && y[n] == o ? function (e) { var t = function (t, r, n) { if (this instanceof e) { switch (arguments.length) { case 0: return new e; case 1: return new e(t); case 2: return new e(t, r) }return new e(t, r, n) } return e.apply(this, arguments) }; return t.prototype = e.prototype, t }(o) : f && "function" == typeof o ? d(Function.call, o) : o, f && ((v.virtual || (v.virtual = {}))[n] = o, e & A.R && m && !m[n] && T(m, n, o))) }; A.F = 1, A.G = 2, A.S = 4, A.P = 8, A.B = 16, A.W = 32, A.U = 64, A.R = 128; var R, O = A, L = T, x = {}.hasOwnProperty, P = function (e, t) { return x.call(e, t) }, C = {}, D = {}.toString, I = function (e) { return D.call(e).slice(8, -1) }, M = Object("z").propertyIsEnumerable(0) ? Object : function (e) { return "String" == I(e) ? e.split("") : Object(e) }, N = function (e) { return M(u(e)) }, F = Math.min, B = function (e) { return e > 0 ? F(s(e), 9007199254740991) : 0 }, U = Math.max, j = Math.min, G = l["__core-js_shared__"] || (l["__core-js_shared__"] = {}), $ = function (e) { return G[e] || (G[e] = {}) }, z = 0, K = Math.random(), V = function (e) { return "Symbol(".concat(void 0 === e ? "" : e, ")_", (++z + K).toString(36)) }, W = $("keys"), H = function (e) { return W[e] || (W[e] = V(e)) }, q = (R = !1, function (e, t, r) { var n, i = N(e), o = B(i.length), a = function (e, t) { return (e = s(e)) < 0 ? U(e + t, 0) : j(e, t) }(r, o); if (R && t != t) { for (; o > a;)if ((n = i[a++]) != n) return !0 } else for (; o > a; a++)if ((R || a in i) && i[a] === t) return R || a || 0; return !R && -1 }), Y = H("IE_PROTO"), X = function (e, t) { var r, n = N(e), i = 0, o = []; for (r in n) r != Y && P(n, r) && o.push(r); for (; t.length > i;)P(n, r = t[i++]) && (~q(o, r) || o.push(r)); return o }, Q = "constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","), J = Object.keys || function (e) { return X(e, Q) }, Z = m ? Object.defineProperties : function (e, t) { p(e); for (var r, n = J(t), i = n.length, o = 0; i > o;)S.f(e, r = n[o++], t[r]); return e }, ee = l.document, te = ee && ee.documentElement, re = H("IE_PROTO"), ne = function () { }, ie = function () { var e, t = b("iframe"), r = Q.length; for (t.style.display = "none", te.appendChild(t), t.src = "javascript:", (e = t.contentWindow.document).open(), e.write("<script>document.F=Object<\/script>"), e.close(), ie = e.F; r--;)delete ie.prototype[Q[r]]; return ie() }, oe = Object.create || function (e, t) { var r; return null !== e ? (ne.prototype = p(e), r = new ne, ne.prototype = null, r[re] = e) : r = ie(), void 0 === t ? r : Z(r, t) }, ae = i(function (e) { var t = $("wks"), r = l.Symbol, n = "function" == typeof r; (e.exports = function (e) { return t[e] || (t[e] = n && r[e] || (n ? r : V)("Symbol." + e)) }).store = t }), se = S.f, ue = ae("toStringTag"), le = function (e, t, r) { e && !P(e = r ? e : e.prototype, ue) && se(e, ue, { configurable: !0, value: t }) }, ce = {}; T(ce, ae("iterator"), function () { return this }); var fe, de = function (e, t, r) { e.prototype = oe(ce, { next: k(1, r) }), le(e, t + " Iterator") }, he = function (e) { return Object(u(e)) }, pe = H("IE_PROTO"), ve = Object.prototype, me = Object.getPrototypeOf || function (e) { return e = he(e), P(e, pe) ? e[pe] : "function" == typeof e.constructor && e instanceof e.constructor ? e.constructor.prototype : e instanceof Object ? ve : null }, ye = ae("iterator"), ge = !([].keys && "next" in [].keys()), be = function () { return this }, _e = function (e, t, r, n, i, o, a) { de(r, t, n); var s, u, l, c = function (e) { if (!ge && e in p) return p[e]; switch (e) { case "keys": case "values": return function () { return new r(this, e) } }return function () { return new r(this, e) } }, f = t + " Iterator", d = "values" == i, h = !1, p = e.prototype, v = p[ye] || p["@@iterator"] || i && p[i], m = v || c(i), y = i ? d ? c("entries") : m : void 0, g = "Array" == t && p.entries || v; if (g && (l = me(g.call(new e))) !== Object.prototype && l.next && le(l, f, !0), d && v && "values" !== v.name && (h = !0, m = function () { return v.call(this) }), a && (ge || h || !p[ye]) && T(p, ye, m), C[t] = m, C[f] = be, i) if (s = { values: d ? m : c("values"), keys: o ? m : c("keys"), entries: y }, a) for (u in s) u in p || L(p, u, s[u]); else O(O.P + O.F * (ge || h), t, s); return s }, we = (fe = !0, function (e, t) { var r, n, i = String(u(e)), o = s(t), a = i.length; return o < 0 || o >= a ? fe ? "" : void 0 : (r = i.charCodeAt(o)) < 55296 || r > 56319 || o + 1 === a || (n = i.charCodeAt(o + 1)) < 56320 || n > 57343 ? fe ? i.charAt(o) : r : fe ? i.slice(o, o + 2) : n - 56320 + (r - 55296 << 10) + 65536 }); _e(String, "String", function (e) { this._t = String(e), this._i = 0 }, function () { var e, t = this._t, r = this._i; return r >= t.length ? { value: void 0, done: !0 } : (e = we(t, r), this._i += e.length, { value: e, done: !1 }) }); var Ee = function (e, t, r, n) { try { return n ? t(p(r)[0], r[1]) : t(r) } catch (t) { var i = e.return; throw void 0 !== i && p(i.call(e)), t } }, Se = ae("iterator"), ke = Array.prototype, Te = function (e) { return void 0 !== e && (C.Array === e || ke[Se] === e) }, Ae = function (e, t, r) { t in e ? S.f(e, t, k(0, r)) : e[t] = r }, Re = ae("toStringTag"), Oe = "Arguments" == I(function () { return arguments }()), Le = function (e) { var t, r, n; return void 0 === e ? "Undefined" : null === e ? "Null" : "string" == typeof (r = function (e, t) { try { return e[t] } catch (e) { } }(t = Object(e), Re)) ? r : Oe ? I(t) : "Object" == (n = I(t)) && "function" == typeof t.callee ? "Arguments" : n }, xe = ae("iterator"), Pe = c.getIteratorMethod = function (e) { if (null != e) return e[xe] || e["@@iterator"] || C[Le(e)] }, Ce = ae("iterator"), De = !1; try { [7][Ce]().return = function () { De = !0 } } catch (e) { } var Ie = function (e, t) { if (!t && !De) return !1; var r = !1; try { var n = [7], i = n[Ce](); i.next = function () { return { done: r = !0 } }, n[Ce] = function () { return i }, e(n) } catch (e) { } return r }; O(O.S + O.F * !Ie(function (e) { }), "Array", { from: function (e) { var t, r, n, i, o = he(e), a = "function" == typeof this ? this : Array, s = arguments.length, u = s > 1 ? arguments[1] : void 0, l = void 0 !== u, c = 0, f = Pe(o); if (l && (u = d(u, s > 2 ? arguments[2] : void 0, 2)), null == f || a == Array && Te(f)) for (r = new a(t = B(o.length)); t > c; c++)Ae(r, c, l ? u(o[c], c) : o[c]); else for (i = f.call(o), r = new a; !(n = i.next()).done; c++)Ae(r, c, l ? Ee(i, u, [n.value, c], !0) : n.value); return r.length = c, r } }); var Me = c.Array.from, Ne = i(function (e) { e.exports = { default: Me, __esModule: !0 } }), Fe = n(Ne), Be = n(i(function (e, t) { t.__esModule = !0; var r, n = (r = Ne) && r.__esModule ? r : { default: r }; t.default = function (e) { if (Array.isArray(e)) { for (var t = 0, r = Array(e.length); t < e.length; t++)r[t] = e[t]; return r } return (0, n.default)(e) } })), Ue = function (e, t) { return { value: t, done: !!e } }; _e(Array, "Array", function (e, t) { this._t = N(e), this._i = 0, this._k = t }, function () { var e = this._t, t = this._k, r = this._i++; return !e || r >= e.length ? (this._t = void 0, Ue(1)) : Ue(0, "keys" == t ? r : "values" == t ? e[r] : [r, e[r]]) }, "values"), C.Arguments = C.Array; for (var je = ae("toStringTag"), Ge = "CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","), $e = 0; $e < Ge.length; $e++) { var ze = Ge[$e], Ke = l[ze], Ve = Ke && Ke.prototype; Ve && !Ve[je] && T(Ve, je, ze), C[ze] = C.Array } var We = { f: ae }, He = We.f("iterator"), qe = i(function (e) { e.exports = { default: He, __esModule: !0 } }); n(qe); var Ye = i(function (e) { var t = V("meta"), r = S.f, n = 0, i = Object.isExtensible || function () { return !0 }, o = !v(function () { return i(Object.preventExtensions({})) }), a = function (e) { r(e, t, { value: { i: "O" + ++n, w: {} } }) }, s = e.exports = { KEY: t, NEED: !1, fastKey: function (e, r) { if (!h(e)) return "symbol" == typeof e ? e : ("string" == typeof e ? "S" : "P") + e; if (!P(e, t)) { if (!i(e)) return "F"; if (!r) return "E"; a(e) } return e[t].i }, getWeak: function (e, r) { if (!P(e, t)) { if (!i(e)) return !0; if (!r) return !1; a(e) } return e[t].w }, onFreeze: function (e) { return o && s.NEED && i(e) && !P(e, t) && a(e), e } } }), Xe = S.f, Qe = function (e) { var t = c.Symbol || (c.Symbol = {}); "_" == e.charAt(0) || e in t || Xe(t, e, { value: We.f(e) }) }, Je = { f: Object.getOwnPropertySymbols }, Ze = { f: {}.propertyIsEnumerable }, et = Array.isArray || function (e) { return "Array" == I(e) }, tt = Q.concat("length", "prototype"), rt = { f: Object.getOwnPropertyNames || function (e) { return X(e, tt) } }, nt = rt.f, it = {}.toString, ot = "object" == typeof window && window && Object.getOwnPropertyNames ? Object.getOwnPropertyNames(window) : [], at = { f: function (e) { return ot && "[object Window]" == it.call(e) ? function (e) { try { return nt(e) } catch (e) { return ot.slice() } }(e) : nt(N(e)) } }, st = Object.getOwnPropertyDescriptor, ut = { f: m ? st : function (e, t) { if (e = N(e), t = w(t, !0), _) try { return st(e, t) } catch (e) { } if (P(e, t)) return k(!Ze.f.call(e, t), e[t]) } }, lt = Ye.KEY, ct = ut.f, ft = S.f, dt = at.f, ht = l.Symbol, pt = l.JSON, vt = pt && pt.stringify, mt = ae("_hidden"), yt = ae("toPrimitive"), gt = {}.propertyIsEnumerable, bt = $("symbol-registry"), _t = $("symbols"), wt = $("op-symbols"), Et = Object.prototype, St = "function" == typeof ht, kt = l.QObject, Tt = !kt || !kt.prototype || !kt.prototype.findChild, At = m && v(function () { return 7 != oe(ft({}, "a", { get: function () { return ft(this, "a", { value: 7 }).a } })).a }) ? function (e, t, r) { var n = ct(Et, t); n && delete Et[t], ft(e, t, r), n && e !== Et && ft(Et, t, n) } : ft, Rt = function (e) { var t = _t[e] = oe(ht.prototype); return t._k = e, t }, Ot = St && "symbol" == typeof ht.iterator ? function (e) { return "symbol" == typeof e } : function (e) { return e instanceof ht }, Lt = function (e, t, r) { return e === Et && Lt(wt, t, r), p(e), t = w(t, !0), p(r), P(_t, t) ? (r.enumerable ? (P(e, mt) && e[mt][t] && (e[mt][t] = !1), r = oe(r, { enumerable: k(0, !1) })) : (P(e, mt) || ft(e, mt, k(1, {})), e[mt][t] = !0), At(e, t, r)) : ft(e, t, r) }, xt = function (e, t) { p(e); for (var r, n = function (e) { var t = J(e), r = Je.f; if (r) for (var n, i = r(e), o = Ze.f, a = 0; i.length > a;)o.call(e, n = i[a++]) && t.push(n); return t }(t = N(t)), i = 0, o = n.length; o > i;)Lt(e, r = n[i++], t[r]); return e }, Pt = function (e) { var t = gt.call(this, e = w(e, !0)); return !(this === Et && P(_t, e) && !P(wt, e)) && (!(t || !P(this, e) || !P(_t, e) || P(this, mt) && this[mt][e]) || t) }, Ct = function (e, t) { if (e = N(e), t = w(t, !0), e !== Et || !P(_t, t) || P(wt, t)) { var r = ct(e, t); return !r || !P(_t, t) || P(e, mt) && e[mt][t] || (r.enumerable = !0), r } }, Dt = function (e) { for (var t, r = dt(N(e)), n = [], i = 0; r.length > i;)P(_t, t = r[i++]) || t == mt || t == lt || n.push(t); return n }, It = function (e) { for (var t, r = e === Et, n = dt(r ? wt : N(e)), i = [], o = 0; n.length > o;)!P(_t, t = n[o++]) || r && !P(Et, t) || i.push(_t[t]); return i }; St || (L((ht = function () { if (this instanceof ht) throw TypeError("Symbol is not a constructor!"); var e = V(arguments.length > 0 ? arguments[0] : void 0), t = function (r) { this === Et && t.call(wt, r), P(this, mt) && P(this[mt], e) && (this[mt][e] = !1), At(this, e, k(1, r)) }; return m && Tt && At(Et, e, { configurable: !0, set: t }), Rt(e) }).prototype, "toString", function () { return this._k }), ut.f = Ct, S.f = Lt, rt.f = at.f = Dt, Ze.f = Pt, Je.f = It, We.f = function (e) { return Rt(ae(e)) }), O(O.G + O.W + O.F * !St, { Symbol: ht }); for (var Mt = "hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","), Nt = 0; Mt.length > Nt;)ae(Mt[Nt++]); for (var Ft = J(ae.store), Bt = 0; Ft.length > Bt;)Qe(Ft[Bt++]); O(O.S + O.F * !St, "Symbol", { for: function (e) { return P(bt, e += "") ? bt[e] : bt[e] = ht(e) }, keyFor: function (e) { if (!Ot(e)) throw TypeError(e + " is not a symbol!"); for (var t in bt) if (bt[t] === e) return t }, useSetter: function () { Tt = !0 }, useSimple: function () { Tt = !1 } }), O(O.S + O.F * !St, "Object", { create: function (e, t) { return void 0 === t ? oe(e) : xt(oe(e), t) }, defineProperty: Lt, defineProperties: xt, getOwnPropertyDescriptor: Ct, getOwnPropertyNames: Dt, getOwnPropertySymbols: It }), pt && O(O.S + O.F * (!St || v(function () { var e = ht(); return "[null]" != vt([e]) || "{}" != vt({ a: e }) || "{}" != vt(Object(e)) })), "JSON", { stringify: function (e) { if (void 0 !== e && !Ot(e)) { for (var t, r, n = [e], i = 1; arguments.length > i;)n.push(arguments[i++]); return "function" == typeof (t = n[1]) && (r = t), !r && et(t) || (t = function (e, t) { if (r && (t = r.call(this, e, t)), !Ot(t)) return t }), n[1] = t, vt.apply(pt, n) } } }), ht.prototype[yt] || T(ht.prototype, yt, ht.prototype.valueOf), le(ht, "Symbol"), le(Math, "Math", !0), le(l.JSON, "JSON", !0), Qe("asyncIterator"), Qe("observable"); var Ut = c.Symbol, jt = i(function (e) { e.exports = { default: Ut, __esModule: !0 } }); n(jt); var Gt, $t, zt, Kt, Vt = n(i(function (e, t) { t.__esModule = !0; var r = o(qe), n = o(jt), i = "function" == typeof n.default && "symbol" == typeof r.default ? function (e) { return typeof e } : function (e) { return e && "function" == typeof n.default && e.constructor === n.default && e !== n.default.prototype ? "symbol" : typeof e }; function o(e) { return e && e.__esModule ? e : { default: e } } t.default = "function" == typeof n.default && "symbol" === i(r.default) ? function (e) { return void 0 === e ? "undefined" : i(e) } : function (e) { return e && "function" == typeof n.default && e.constructor === n.default && e !== n.default.prototype ? "symbol" : void 0 === e ? "undefined" : i(e) } })); Gt = "keys", $t = function () { return function (e) { return J(he(e)) } }, zt = (c.Object || {})[Gt] || Object[Gt], (Kt = {})[Gt] = $t(zt), O(O.S + O.F * v(function () { zt(1) }), "Object", Kt); var Wt = c.Object.keys, Ht = n(i(function (e) { e.exports = { default: Wt, __esModule: !0 } })), qt = Math.floor; O(O.S, "Number", { isInteger: function (e) { return !h(e) && isFinite(e) && qt(e) === e } }); var Yt = c.Number.isInteger, Xt = n(i(function (e) { e.exports = { default: Yt, __esModule: !0 } })), Qt = "\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff", Jt = "[" + Qt + "]", Zt = RegExp("^" + Jt + Jt + "*"), er = RegExp(Jt + Jt + "*$"), tr = function (e, t, r) { var n = {}, i = v(function () { return !!Qt[e]() || "​" != "​"[e]() }), o = n[e] = i ? t(rr) : Qt[e]; r && (n[r] = o), O(O.P + O.F * i, "String", n) }, rr = tr.trim = function (e, t) { return e = String(u(e)), 1 & t && (e = e.replace(Zt, "")), 2 & t && (e = e.replace(er, "")), e }, nr = tr, ir = l.parseFloat, or = nr.trim, ar = 1 / ir(Qt + "-0") != -1 / 0 ? function (e) { var t = or(String(e), 3), r = ir(t); return 0 === r && "-" == t.charAt(0) ? -0 : r } : ir; O(O.S + O.F * (Number.parseFloat != ar), "Number", { parseFloat: ar }); var sr = parseFloat, ur = n(i(function (e) { e.exports = { default: sr, __esModule: !0 } })); function lr(e) { return null == e } function cr(e) { return Array.isArray(e) } function fr(e) { return "function" == typeof e } function dr(e) { return Object(e) === e && "[object Object]" === String(e) && !fr(e) && !cr(e) } function hr(e) { return "number" == typeof e } function pr(e) { return e instanceof Blob } function vr(e) { return "string" == typeof e || e instanceof String } function mr(e) { return "boolean" == typeof e } function yr(e) { return lr(e) || mr(e) || vr(e) || hr(e) } function gr(e) { return !!("object" === ("undefined" == typeof Node ? "undefined" : Vt(Node)) ? e instanceof Node : e && "object" === (void 0 === e ? "undefined" : Vt(e)) && "number" == typeof e.nodeType && "string" == typeof e.nodeName) } function br(e) { return function t(r, n, i) { if (cr(r) || dr(r)) { for (var o in n = yr(n) ? dr(r) ? {} : [] : n, r) n[o] = t(r[o], n[o], o); return n } return e(r, n, i) } } var _r = br(function (e) { return e }); function wr(e, t) { return e.replace(/(^|[^a-zA-Z]+)([a-zA-Z])/g, function (e, r, n, i) { return t || 0 !== i ? n.toUpperCase() : n.toLowerCase() }) } function Er() { return (65536 * (1 + Math.random()) | 0).toString(16).substring(1) } var Sr, kr, Tr, Ar = i(function (e) { var t = {}, r = {}, n = e.exports = function (e, n, i, o, a) { var s, u, l, c, f = a ? function () { return e } : Pe(e), h = d(i, o, n ? 2 : 1), v = 0; if ("function" != typeof f) throw TypeError(e + " is not iterable!"); if (Te(f)) { for (s = B(e.length); s > v; v++)if ((c = n ? h(p(u = e[v])[0], u[1]) : h(e[v])) === t || c === r) return c } else for (l = f.call(e); !(u = l.next()).done;)if ((c = Ee(l, h, u.value, n)) === t || c === r) return c }; n.BREAK = t, n.RETURN = r }), Rr = ae("species"), Or = function (e, t) { var r, n = p(e).constructor; return void 0 === n || null == (r = p(n)[Rr]) ? t : f(r) }, Lr = l.process, xr = l.setImmediate, Pr = l.clearImmediate, Cr = l.MessageChannel, Dr = l.Dispatch, Ir = 0, Mr = {}, Nr = function () { var e = +this; if (Mr.hasOwnProperty(e)) { var t = Mr[e]; delete Mr[e], t() } }, Fr = function (e) { Nr.call(e.data) }; xr && Pr || (xr = function (e) { for (var t = [], r = 1; arguments.length > r;)t.push(arguments[r++]); return Mr[++Ir] = function () { !function (e, t, r) { var n = void 0 === r; switch (t.length) { case 0: return n ? e() : e.call(r); case 1: return n ? e(t[0]) : e.call(r, t[0]); case 2: return n ? e(t[0], t[1]) : e.call(r, t[0], t[1]); case 3: return n ? e(t[0], t[1], t[2]) : e.call(r, t[0], t[1], t[2]); case 4: return n ? e(t[0], t[1], t[2], t[3]) : e.call(r, t[0], t[1], t[2], t[3]) }e.apply(r, t) }("function" == typeof e ? e : Function(e), t) }, Sr(Ir), Ir }, Pr = function (e) { delete Mr[e] }, "process" == I(Lr) ? Sr = function (e) { Lr.nextTick(d(Nr, e, 1)) } : Dr && Dr.now ? Sr = function (e) { Dr.now(d(Nr, e, 1)) } : Cr ? (Tr = (kr = new Cr).port2, kr.port1.onmessage = Fr, Sr = d(Tr.postMessage, Tr, 1)) : l.addEventListener && "function" == typeof postMessage && !l.importScripts ? (Sr = function (e) { l.postMessage(e + "", "*") }, l.addEventListener("message", Fr, !1)) : Sr = "onreadystatechange" in b("script") ? function (e) { te.appendChild(b("script")).onreadystatechange = function () { te.removeChild(this), Nr.call(e) } } : function (e) { setTimeout(d(Nr, e, 1), 0) }); var Br = { set: xr, clear: Pr }, Ur = Br.set, jr = l.MutationObserver || l.WebKitMutationObserver, Gr = l.process, $r = l.Promise, zr = "process" == I(Gr); function Kr(e) { var t, r; this.promise = new e(function (e, n) { if (void 0 !== t || void 0 !== r) throw TypeError("Bad Promise constructor"); t = e, r = n }), this.resolve = f(t), this.reject = f(r) } var Vr, Wr, Hr, qr, Yr = { f: function (e) { return new Kr(e) } }, Xr = function (e) { try { return { e: !1, v: e() } } catch (e) { return { e: !0, v: e } } }, Qr = function (e, t) { if (p(e), h(t) && t.constructor === e) return t; var r = Yr.f(e); return (0, r.resolve)(t), r.promise }, Jr = ae("species"), Zr = Br.set, en = function () { var e, t, r, n = function () { var n, i; for (zr && (n = Gr.domain) && n.exit(); e;) { i = e.fn, e = e.next; try { i() } catch (n) { throw e ? r() : t = void 0, n } } t = void 0, n && n.enter() }; if (zr) r = function () { Gr.nextTick(n) }; else if (jr) { var i = !0, o = document.createTextNode(""); new jr(n).observe(o, { characterData: !0 }), r = function () { o.data = i = !i } } else if ($r && $r.resolve) { var a = $r.resolve(); r = function () { a.then(n) } } else r = function () { Ur.call(l, n) }; return function (n) { var i = { fn: n, next: void 0 }; t && (t.next = i), e || (e = i, r()), t = i } }(), tn = l.TypeError, rn = l.process, nn = l.Promise, on = "process" == Le(rn), an = function () { }, sn = Wr = Yr.f, un = !!function () { try { var e = nn.resolve(1), t = (e.constructor = {})[ae("species")] = function (e) { e(an, an) }; return (on || "function" == typeof PromiseRejectionEvent) && e.then(an) instanceof t } catch (e) { } }(), ln = function (e) { var t; return !(!h(e) || "function" != typeof (t = e.then)) && t }, cn = function (e, t) { if (!e._n) { e._n = !0; var r = e._c; en(function () { for (var n = e._v, i = 1 == e._s, o = 0, a = function (t) { var r, o, a = i ? t.ok : t.fail, s = t.resolve, u = t.reject, l = t.domain; try { a ? (i || (2 == e._h && hn(e), e._h = 1), !0 === a ? r = n : (l && l.enter(), r = a(n), l && l.exit()), r === t.promise ? u(tn("Promise-chain cycle")) : (o = ln(r)) ? o.call(r, s, u) : s(r)) : u(n) } catch (e) { u(e) } }; r.length > o;)a(r[o++]); e._c = [], e._n = !1, t && !e._h && fn(e) }) } }, fn = function (e) { Zr.call(l, function () { var t, r, n, i = e._v, o = dn(e); if (o && (t = Xr(function () { on ? rn.emit("unhandledRejection", i, e) : (r = l.onunhandledrejection) ? r({ promise: e, reason: i }) : (n = l.console) && n.error && n.error("Unhandled promise rejection", i) }), e._h = on || dn(e) ? 2 : 1), e._a = void 0, o && t.e) throw t.v }) }, dn = function (e) { if (1 == e._h) return !1; for (var t, r = e._a || e._c, n = 0; r.length > n;)if ((t = r[n++]).fail || !dn(t.promise)) return !1; return !0 }, hn = function (e) { Zr.call(l, function () { var t; on ? rn.emit("rejectionHandled", e) : (t = l.onrejectionhandled) && t({ promise: e, reason: e._v }) }) }, pn = function (e) { var t = this; t._d || (t._d = !0, (t = t._w || t)._v = e, t._s = 2, t._a || (t._a = t._c.slice()), cn(t, !0)) }, vn = function (e) { var t, r = this; if (!r._d) { r._d = !0, r = r._w || r; try { if (r === e) throw tn("Promise can't be resolved itself"); (t = ln(e)) ? en(function () { var n = { _w: r, _d: !1 }; try { t.call(e, d(vn, n, 1), d(pn, n, 1)) } catch (e) { pn.call(n, e) } }) : (r._v = e, r._s = 1, cn(r, !1)) } catch (e) { pn.call({ _w: r, _d: !1 }, e) } } }; un || (nn = function (e) { !function (e, t, r, n) { if (!(e instanceof t) || void 0 !== n && n in e) throw TypeError(r + ": incorrect invocation!") }(this, nn, "Promise", "_h"), f(e), Vr.call(this); try { e(d(vn, this, 1), d(pn, this, 1)) } catch (e) { pn.call(this, e) } }, (Vr = function (e) { this._c = [], this._a = void 0, this._s = 0, this._d = !1, this._v = void 0, this._h = 0, this._n = !1 }).prototype = function (e, t, r) { for (var n in t) r && e[n] ? e[n] = t[n] : T(e, n, t[n]); return e }(nn.prototype, { then: function (e, t) { var r = sn(Or(this, nn)); return r.ok = "function" != typeof e || e, r.fail = "function" == typeof t && t, r.domain = on ? rn.domain : void 0, this._c.push(r), this._a && this._a.push(r), this._s && cn(this, !1), r.promise }, catch: function (e) { return this.then(void 0, e) } }), Hr = function () { var e = new Vr; this.promise = e, this.resolve = d(vn, e, 1), this.reject = d(pn, e, 1) }, Yr.f = sn = function (e) { return e === nn || e === qr ? new Hr(e) : Wr(e) }), O(O.G + O.W + O.F * !un, { Promise: nn }), le(nn, "Promise"), function (e) { var t = "function" == typeof c[e] ? c[e] : l[e]; m && t && !t[Jr] && S.f(t, Jr, { configurable: !0, get: function () { return this } }) }("Promise"), qr = c.Promise, O(O.S + O.F * !un, "Promise", { reject: function (e) { var t = sn(this); return (0, t.reject)(e), t.promise } }), O(O.S + !0 * O.F, "Promise", { resolve: function (e) { return Qr(this === qr ? nn : this, e) } }), O(O.S + O.F * !(un && Ie(function (e) { nn.all(e).catch(an) })), "Promise", { all: function (e) { var t = this, r = sn(t), n = r.resolve, i = r.reject, o = Xr(function () { var r = [], o = 0, a = 1; Ar(e, !1, function (e) { var s = o++, u = !1; r.push(void 0), a++, t.resolve(e).then(function (e) { u || (u = !0, r[s] = e, --a || n(r)) }, i) }), --a || n(r) }); return o.e && i(o.v), r.promise }, race: function (e) { var t = this, r = sn(t), n = r.reject, i = Xr(function () { Ar(e, !1, function (e) { t.resolve(e).then(r.resolve, n) }) }); return i.e && n(i.v), r.promise } }), O(O.P + O.R, "Promise", { finally: function (e) { var t = Or(this, c.Promise || l.Promise), r = "function" == typeof e; return this.then(r ? function (r) { return Qr(t, e()).then(function () { return r }) } : e, r ? function (r) { return Qr(t, e()).then(function () { throw r }) } : e) } }), O(O.S, "Promise", { try: function (e) { var t = Yr.f(this), r = Xr(e); return (r.e ? t.reject : t.resolve)(r.v), t.promise } }); var mn = c.Promise, yn = n(i(function (e) { e.exports = { default: mn, __esModule: !0 } })), gn = "undefined" != typeof window && "[object Object]" !== Object.prototype.toString.call(window); function bn(e, t, r) { var n = e; if (t + r < n.length) { for (; r--;)if (128 != (192 & n[++t])) return !1; return !0 } return !1 } var _n = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || window.oRequestAnimationFrame || function (e) { return setTimeout(e, 17) }, wn = window.cancelAnimationFrame || window.mozCancelAnimationFrame || window.webkitCancelAnimationFrame || window.webkitCancelRequestAnimationFrame || window.msCancelAnimationFrame || window.oCancelAnimationFrame || function (e) { clearTimeout(e) }; function En(e, t) { var r = t, n = (e = "" + (e || "")).length; return (((t = (t || n) - n) > 0 ? e.repeat ? "0".repeat(t) : new Array(t + 1).join("0") : "") + e).slice(0, r) } var Sn = n(i(function (e, t) { t.__esModule = !0, t.default = function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } })); O(O.S + O.F * !m, "Object", { defineProperty: S.f }); var kn = c.Object, Tn = function (e, t, r) { return kn.defineProperty(e, t, r) }, An = i(function (e) { e.exports = { default: Tn, __esModule: !0 } }); n(An); var Rn = n(i(function (e, t) { t.__esModule = !0; var r, n = (r = An) && r.__esModule ? r : { default: r }; t.default = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var i = t[r]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), (0, n.default)(e, i.key, i) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }() })), On = Object.assign, Ln = !On || v(function () { var e = {}, t = {}, r = Symbol(), n = "abcdefghijklmnopqrst"; return e[r] = 7, n.split("").forEach(function (e) { t[e] = e }), 7 != On({}, e)[r] || Object.keys(On({}, t)).join("") != n }) ? function (e, t) { for (var r = he(e), n = arguments.length, i = 1, o = Je.f, a = Ze.f; n > i;)for (var s, u = M(arguments[i++]), l = o ? J(u).concat(o(u)) : J(u), c = l.length, f = 0; c > f;)a.call(u, s = l[f++]) && (r[s] = u[s]); return r } : On; O(O.S + O.F, "Object", { assign: Ln }); var xn = c.Object.assign, Pn = n(i(function (e) { e.exports = { default: xn, __esModule: !0 } })); O(O.S, "Object", { create: oe }); var Cn = c.Object, Dn = function (e, t) { return Cn.create(e, t) }, In = n(i(function (e) { e.exports = { default: Dn, __esModule: !0 } })), Mn = In(null); function Nn(e, t) { var r = e.__evt_id; r || (Object.defineProperty(e, "__evt_id", { writable: !0, enumerable: !1, configurable: !0 }), r = e.__evt_id = ++Mn.count); var n = r + "_" + t, i = Mn[n]; return i || (i = Mn[n] = []), i } function Fn(e, t, r) { var n = In(null); n.type = t, n.target = e, r && Pn(n, dr(r) ? r : { data: r }), Nn(e, t).forEach(function (t) { (t[1] || t[0]).apply(e, [n]) }) } function Bn(e, t, r) { var n = arguments.length > 3 && void 0 !== arguments[3] && arguments[3], i = arguments[4]; fr(n) && !i && (i = n, n = void 0); var o = [r, void 0, n]; n && !i && (i = function () { Un(e, t, r, n); for (var i = arguments.length, o = Array(i), a = 0; a < i; a++)o[a] = arguments[a]; r.apply(e, o) }), i && (o[1] = i), Nn(e, t).push(o) } function Un(e, t, r) { var n = arguments.length > 3 && void 0 !== arguments[3] && arguments[3], i = Nn(e, t); if (r || n) { var o = -1, a = void 0; return i.find(function (e, t) { if ((!r || e[0] === r) && (!n || e[2])) return o = t, a = e[1], !0 }), -1 !== o && i.splice(o, 1), a } i.length = 0 } Mn.count = 0; var jn = function () { function e(t, r) { var n = this; if (Sn(this, e), Object.defineProperty(this, "__target", { writable: !0, enumerable: !1, configurable: !0 }), this.__target = this, t) { if ("object" !== (void 0 === t ? "undefined" : Vt(t))) throw new Error("CusEvent target are not object"); this.__target = t, r && ["on", "once", "off", "emit"].forEach(function (e) { t[e] = n[e] }) } } return Rn(e, [{ key: "on", value: function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] && arguments[2]; return Bn(this.__target, e, t, r), this } }, { key: "once", value: function (e, t) { return this.on(e, t, !0) } }, { key: "off", value: function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] && arguments[2]; return Un(this.__target, e, t, r), this } }, { key: "emit", value: function (e, t) { return Fn(this.__target, e, { data: t }), this } }]), e }(), Gn = In(null); function $n(e, t) { var r = e.__evt_id; r || (Object.defineProperty(e, "__evt_id", { writable: !0, enumerable: !1, configurable: !0 }), r = e.__evt_id = ++Gn.count); var n = r + "_" + t, i = Gn[n]; return i || (i = Gn[n] = []), i } function zn(e, t, r) { var n = arguments.length > 3 && void 0 !== arguments[3] && arguments[3], i = arguments[4]; fr(n) && !i && (i = n, n = void 0); var o = [r, void 0, n]; n && !i && (i = function () { Kn(e, t, r, n); for (var i = arguments.length, o = Array(i), a = 0; a < i; a++)o[a] = arguments[a]; r.apply(e, o) }), i && (o[1] = i), $n(e, t).push(o) } function Kn(e, t, r) { var n = arguments.length > 3 && void 0 !== arguments[3] && arguments[3], i = $n(e, t); if (r || n) { var o = -1, a = void 0; return i.find(function (e, t) { if ((!r || e[0] === r) && (!n || e[2])) return o = t, a = e[1], !0 }), -1 !== o && i.splice(o, 1), a } i.length = 0 } Gn.count = 0, function () { function e(t, r) { var n = this; if (Sn(this, e), Object.defineProperty(this, "__target", { writable: !0, enumerable: !1, configurable: !0 }), this.__target = this, t) { if ("object" !== (void 0 === t ? "undefined" : Vt(t))) throw new Error("CusEvent target are not object"); this.__target = t, r && ["on", "once", "off", "emit"].forEach(function (e) { t[e] = n[e] }) } } Rn(e, [{ key: "on", value: function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] && arguments[2]; return zn(this.__target, e, t, r), this } }, { key: "once", value: function (e, t) { return this.on(e, t, !0) } }, { key: "off", value: function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] && arguments[2]; return Kn(this.__target, e, t, r), this } }, { key: "emit", value: function (e, t) { return function (e, t, r) { var n = In(null); n.type = t, n.target = e, r && Pn(n, dr(r) ? r : { data: r }), $n(e, t).forEach(function (t) { (t[1] || t[0]).apply(e, [n]) }) }(this.__target, e, { data: t }), this } }]) }(), "undefined" != typeof window && Object.prototype.toString.call(window); var Vn = document.createElement("div"), Wn = "innerText"; "textContent" in Vn && (Wn = "textContent"); var Hn = Array.prototype; function qn(e, t) { return e.getAttribute(t) } function Yn(e, t, r) { void 0 === r ? e.removeAttribute(t) : e.setAttribute(t, r) } function Xn(e, t) { if (t && (t = t.trim())) { var r = t.split(/\s+/); if (e.classList) r.forEach(function (t) { return e.classList.add(t) }); else { var n = " " + (e.className || "") + " "; r.forEach(function (e) { -1 === n.indexOf(" " + e + " ") && (n += " " + e) }), e.className = n.trim() } } } function Qn(e, t) { if (t && (t = t.trim())) { var r = t.split(/\s+/); if (e.classList) r.forEach(function (t) { return e.classList.remove(t) }); else { var n = " " + e.className + " "; r.forEach(function (e) { for (var t = " " + e + " "; -1 !== n.indexOf(t);)n = n.replace(t, " ") }), e.className = n.trim() } } } function Jn(e, t) { return new RegExp("(?:^|\\s)" + t + "(?=\\s|$)").test(e.className) } t.supportsPassive = !1; try { var Zn = Object.defineProperty({}, "passive", { get: function () { t.supportsPassive = !0 } }); window.addEventListener("test", null, Zn) } catch (e) { } var ei = !!t.supportsPassive && { passive: !0 }; function ti(e, t, r) { var n = arguments.length > 3 && void 0 !== arguments[3] && arguments[3], i = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : ei; if (n) { var o = Kn(e, t + "_once", r); o && (r = o) } e.removeEventListener(t, r, i) } function ri(e, t, r) { var n = arguments.length > 3 && void 0 !== arguments[3] && arguments[3], i = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : ei; if (n) { var o = r; r = function () { for (var a = arguments.length, s = Array(a), u = 0; u < a; u++)s[u] = arguments[u]; o.apply(this, s), ti(e, t, r, n, i) }, zn(e, t + "_once", o, r) } e.addEventListener(t, r, i) } function ni(e, t, r, n) { var i = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : ei, o = function (r) { var i = li(r.target || r.srcElement, e, !0), o = si(t, e, !0), a = void 0; o.find ? a = o.find(function (e) { return i.find(function (t) { return e === t }) }) : o.forEach(function (e) { return !a && i.forEach(function (t) { a || e !== t || (a = t) }) }), a && n.apply(a, arguments) }; zn(e, r + "_delegate_" + t, n, o), e.addEventListener(r, o, i) } function ii(e, t, r, n) { var i = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : ei, o = Kn(e, r + "_delegate_" + t, n); o && e.removeEventListener(r, o, i) } function oi(e, t) { return (e.currentStyle || document.defaultView.getComputedStyle(e, null))[t] || e.style[t] } function ai(e, t, r) { if (dr(t)) for (var n in t) ai(e, n, t[n]); else e.style[t] = r } function si(e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : document, r = arguments[2], n = t.querySelectorAll(e); return r ? Fe(n) : n } function ui(e) { e.parentNode.removeChild(e) } function li(e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null, r = arguments[2], n = arguments[3], i = []; for (r && i.push(e); e && e.parentNode !== t;)(e = e.parentNode) && i.push(e); return n && i.push(t), i } function ci(e, t) { return e.constructor === fi ? e : new fi(e, t) } var fi = function () { function e(t) { var r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : document; Sn(this, e); this.selector = t; var n = void 0; t && t.constructor === NodeList ? n = Fe(t) : cr(t) ? n = t : vr(t) ? 0 === t.indexOf("<") ? (Vn.innerHTML = t, n = si("*", Vn, !0)) : n = si(t, r, !0) : n = [t], Pn(this, n), this.length = n.length } return Rn(e, [{ key: "each", value: function () { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; return Hn.forEach.apply(this, t), this } }, { key: "push", value: function () { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; return Hn.push.apply(this, t), this } }, { key: "splice", value: function () { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; return ci(Hn.splice.apply(this, t)) } }, { key: "find", value: function (e) { var t = []; this.each(function (r) { t = t.concat(si(e, r, !0)) }); var r = ci(t); return r.parent = this, r.selector = e, r } }, { key: "append", value: function (e) { var t = ci(e), r = this[0]; return t.each(function (e) { return r.appendChild(e) }), this } }, { key: "appendTo", value: function (e) { return ci(e).append(this), this } }, { key: "text", value: function (e) { return 0 === arguments.length ? this[0][Wn] : this.each(function (t) { t[Wn] = e }) } }, { key: "html", value: function (e) { return 0 === arguments.length ? this[0].innerHTML : this.each(function (t) { t.innerHTML = e }) } }, { key: "attr", value: function (e, t) { return 1 === arguments.length ? qn(this[0], e) : this.each(function (r) { return Yn(r, e, t) }) } }, { key: "data", value: function (e, t) { return 0 === arguments.length ? this[0].dataset || {} : 1 === arguments.length ? (this[0].dataset || {})[e] : this.each(function (r) { (r.dataset || (r.dataset = {}))[e] = t }) } }, { key: "css", value: function (e, t) { return 1 !== arguments.length || dr(e) ? this.each(function (r) { return ai(r, e, t) }) : oi(this[0], e) } }, { key: "addClass", value: function (e) { return this.each(function (t) { return Xn(t, e) }) } }, { key: "removeClass", value: function (e) { return this.each(function (t) { return Qn(t, e) }) } }, { key: "hasClass", value: function (e) { return Jn(this[0], e) } }, { key: "on", value: function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] && arguments[2], n = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : ei; return this.each(function (i) { return ri(i, e, t, r, n) }) } }, { key: "off", value: function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] && arguments[2], n = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : ei; return this.each(function (i) { return ti(i, e, t, r, n) }) } }, { key: "delegate", value: function (e, t, r) { var n = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : ei; return this.each(function (i) { return ni(i, e, t, r, n) }) } }, { key: "undelegate", value: function (e, t, r) { var n = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : ei; return this.each(function (i) { return ii(i, e, t, r, n) }) } }, { key: "remove", value: function () { return this.each(function (e) { return ui(e) }) } }]), e }(); function di(e, t) { if (!vr(e)) throw new TypeError("Log's method only acccept string as argument, but not " + e + " in " + (void 0 === e ? "undefined" : Vt(e))); return vr(t) ? "[" + (e = hi.FORCE_GLOBAL_TAG ? hi.GLOBAL_TAG : e || hi.GLOBAL_TAG) + "] > " + t : "[" + hi.GLOBAL_TAG + "] > " + e } var hi = function () { function e() { Sn(this, e) } return Rn(e, null, [{ key: "error", value: function (t, r) { e.ENABLE_ERROR && (console.error || console.warn || console.log)(di(t, r)) } }, { key: "info", value: function (t, r) { e.ENABLE_INFO && (console.info || console.log)(di(t, r)) } }, { key: "warn", value: function (t, r) { e.ENABLE_WARN && (console.warn || console.log)(di(t, r)) } }, { key: "debug", value: function (t, r) { e.ENABLE_DEBUG && (console.debug || console.log)(di(t, r)) } }, { key: "verbose", value: function (t, r) { e.ENABLE_VERBOSE && console.log(di(t, r)) } }]), e }(); hi.GLOBAL_TAG = "chimee", hi.FORCE_GLOBAL_TAG = !1, hi.ENABLE_ERROR = !0, hi.ENABLE_INFO = !0, hi.ENABLE_WARN = !0, hi.ENABLE_DEBUG = !0, hi.ENABLE_VERBOSE = !0; var pi = i(function (e, t) { !function (r, n) { var i = "model", o = "name", a = "type", s = "vendor", u = "version", l = "mobile", c = "tablet", f = { extend: function (e, t) { var r = {}; for (var n in e) t[n] && t[n].length % 2 == 0 ? r[n] = t[n].concat(e[n]) : r[n] = e[n]; return r }, has: function (e, t) { return "string" == typeof e && -1 !== t.toLowerCase().indexOf(e.toLowerCase()) }, lowerize: function (e) { return e.toLowerCase() }, major: function (e) { return "string" == typeof e ? e.replace(/[^\d\.]/g, "").split(".")[0] : void 0 }, trim: function (e) { return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, "") } }, d = { rgx: function (e, t) { for (var r, n, i, o, a, s, u = 0; u < t.length && !a;) { var l = t[u], c = t[u + 1]; for (r = n = 0; r < l.length && !a;)if (a = l[r++].exec(e)) for (i = 0; i < c.length; i++)s = a[++n], "object" == typeof (o = c[i]) && o.length > 0 ? 2 == o.length ? "function" == typeof o[1] ? this[o[0]] = o[1].call(this, s) : this[o[0]] = o[1] : 3 == o.length ? "function" != typeof o[1] || o[1].exec && o[1].test ? this[o[0]] = s ? s.replace(o[1], o[2]) : void 0 : this[o[0]] = s ? o[1].call(this, s, o[2]) : void 0 : 4 == o.length && (this[o[0]] = s ? o[3].call(this, s.replace(o[1], o[2])) : void 0) : this[o] = s || void 0; u += 2 } }, str: function (e, t) { for (var r in t) if ("object" == typeof t[r] && t[r].length > 0) { for (var n = 0; n < t[r].length; n++)if (f.has(t[r][n], e)) return "?" === r ? void 0 : r } else if (f.has(t[r], e)) return "?" === r ? void 0 : r; return e } }, h = { browser: { oldsafari: { version: { "1.0": "/8", 1.2: "/1", 1.3: "/3", "2.0": "/412", "2.0.2": "/416", "2.0.3": "/417", "2.0.4": "/419", "?": "/" } } }, device: { amazon: { model: { "Fire Phone": ["SD", "KF"] } }, sprint: { model: { "Evo Shift 4G": "7373KT" }, vendor: { HTC: "APA", Sprint: "Sprint" } } }, os: { windows: { version: { ME: "4.90", "NT 3.11": "NT3.51", "NT 4.0": "NT4.0", 2000: "NT 5.0", XP: ["NT 5.1", "NT 5.2"], Vista: "NT 6.0", 7: "NT 6.1", 8: "NT 6.2", 8.1: "NT 6.3", 10: ["NT 6.4", "NT 10.0"], RT: "ARM" } } } }, p = { browser: [[/(opera\smini)\/([\w\.-]+)/i, /(opera\s[mobiletab]+).+version\/([\w\.-]+)/i, /(opera).+version\/([\w\.]+)/i, /(opera)[\/\s]+([\w\.]+)/i], [o, u], [/(opios)[\/\s]+([\w\.]+)/i], [[o, "Opera Mini"], u], [/\s(opr)\/([\w\.]+)/i], [[o, "Opera"], u], [/(kindle)\/([\w\.]+)/i, /(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i, /(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i, /(?:ms|\()(ie)\s([\w\.]+)/i, /(rekonq)\/([\w\.]+)*/i, /(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser)\/([\w\.-]+)/i], [o, u], [/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i], [[o, "IE"], u], [/(edge)\/((\d+)?[\w\.]+)/i], [o, u], [/(yabrowser)\/([\w\.]+)/i], [[o, "Yandex"], u], [/(puffin)\/([\w\.]+)/i], [[o, "Puffin"], u], [/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i], [[o, "UCBrowser"], u], [/(comodo_dragon)\/([\w\.]+)/i], [[o, /_/g, " "], u], [/(micromessenger)\/([\w\.]+)/i], [[o, "WeChat"], u], [/(QQ)\/([\d\.]+)/i], [o, u], [/m?(qqbrowser)[\/\s]?([\w\.]+)/i], [o, u], [/xiaomi\/miuibrowser\/([\w\.]+)/i], [u, [o, "MIUI Browser"]], [/;fbav\/([\w\.]+);/i], [u, [o, "Facebook"]], [/headlesschrome(?:\/([\w\.]+)|\s)/i], [u, [o, "Chrome Headless"]], [/\swv\).+(chrome)\/([\w\.]+)/i], [[o, /(.+)/, "$1 WebView"], u], [/((?:oculus|samsung)browser)\/([\w\.]+)/i], [[o, /(.+(?:g|us))(.+)/, "$1 $2"], u], [/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i], [u, [o, "Android Browser"]], [/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i], [o, u], [/(dolfin)\/([\w\.]+)/i], [[o, "Dolphin"], u], [/((?:android.+)crmo|crios)\/([\w\.]+)/i], [[o, "Chrome"], u], [/(coast)\/([\w\.]+)/i], [[o, "Opera Coast"], u], [/fxios\/([\w\.-]+)/i], [u, [o, "Firefox"]], [/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i], [u, [o, "Mobile Safari"]], [/version\/([\w\.]+).+?(mobile\s?safari|safari)/i], [u, o], [/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i], [[o, "GSA"], u], [/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i], [o, [u, d.str, h.browser.oldsafari.version]], [/(konqueror)\/([\w\.]+)/i, /(webkit|khtml)\/([\w\.]+)/i], [o, u], [/(navigator|netscape)\/([\w\.-]+)/i], [[o, "Netscape"], u], [/(swiftfox)/i, /(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i, /(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i, /(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i, /(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i, /(links)\s\(([\w\.]+)/i, /(gobrowser)\/?([\w\.]+)*/i, /(ice\s?browser)\/v?([\w\._]+)/i, /(mosaic)[\/\s]([\w\.]+)/i], [o, u]], cpu: [[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i], [["architecture", "amd64"]], [/(ia32(?=;))/i], [["architecture", f.lowerize]], [/((?:i[346]|x)86)[;\)]/i], [["architecture", "ia32"]], [/windows\s(ce|mobile);\sppc;/i], [["architecture", "arm"]], [/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i], [["architecture", /ower/, "", f.lowerize]], [/(sun4\w)[;\)]/i], [["architecture", "sparc"]], [/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i], [["architecture", f.lowerize]]], device: [[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i], [i, s, [a, c]], [/applecoremedia\/[\w\.]+ \((ipad)/], [i, [s, "Apple"], [a, c]], [/(apple\s{0,1}tv)/i], [[i, "Apple TV"], [s, "Apple"]], [/(archos)\s(gamepad2?)/i, /(hp).+(touchpad)/i, /(hp).+(tablet)/i, /(kindle)\/([\w\.]+)/i, /\s(nook)[\w\s]+build\/(\w+)/i, /(dell)\s(strea[kpr\s\d]*[\dko])/i], [s, i, [a, c]], [/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i], [i, [s, "Amazon"], [a, c]], [/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i], [[i, d.str, h.device.amazon.model], [s, "Amazon"], [a, l]], [/\((ip[honed|\s\w*]+);.+(apple)/i], [i, s, [a, l]], [/\((ip[honed|\s\w*]+);/i], [i, [s, "Apple"], [a, l]], [/(blackberry)[\s-]?(\w+)/i, /(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i, /(hp)\s([\w\s]+\w)/i, /(asus)-?(\w+)/i], [s, i, [a, l]], [/\(bb10;\s(\w+)/i], [i, [s, "BlackBerry"], [a, l]], [/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i], [i, [s, "Asus"], [a, c]], [/(sony)\s(tablet\s[ps])\sbuild\//i, /(sony)?(?:sgp.+)\sbuild\//i], [[s, "Sony"], [i, "Xperia Tablet"], [a, c]], [/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i], [i, [s, "Sony"], [a, l]], [/\s(ouya)\s/i, /(nintendo)\s([wids3u]+)/i], [s, i, [a, "console"]], [/android.+;\s(shield)\sbuild/i], [i, [s, "Nvidia"], [a, "console"]], [/(playstation\s[34portablevi]+)/i], [i, [s, "Sony"], [a, "console"]], [/(sprint\s(\w+))/i], [[s, d.str, h.device.sprint.vendor], [i, d.str, h.device.sprint.model], [a, l]], [/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i], [s, i, [a, c]], [/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i, /(zte)-(\w+)*/i, /(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i], [s, [i, /_/g, " "], [a, l]], [/(nexus\s9)/i], [i, [s, "HTC"], [a, c]], [/d\/huawei([\w\s-]+)[;\)]/i, /(nexus\s6p)/i], [i, [s, "Huawei"], [a, l]], [/(microsoft);\s(lumia[\s\w]+)/i], [s, i, [a, l]], [/[\s\(;](xbox(?:\sone)?)[\s\);]/i], [i, [s, "Microsoft"], [a, "console"]], [/(kin\.[onetw]{3})/i], [[i, /\./g, " "], [s, "Microsoft"], [a, l]], [/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i, /mot[\s-]?(\w+)*/i, /(XT\d{3,4}) build\//i, /(nexus\s6)/i], [i, [s, "Motorola"], [a, l]], [/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i], [i, [s, "Motorola"], [a, c]], [/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i], [[s, f.trim], [i, f.trim], [a, "smarttv"]], [/hbbtv.+maple;(\d+)/i], [[i, /^/, "SmartTV"], [s, "Samsung"], [a, "smarttv"]], [/\(dtv[\);].+(aquos)/i], [i, [s, "Sharp"], [a, "smarttv"]], [/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i, /((SM-T\w+))/i], [[s, "Samsung"], i, [a, c]], [/smart-tv.+(samsung)/i], [s, [a, "smarttv"], i], [/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i, /(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i, /sec-((sgh\w+))/i], [[s, "Samsung"], i, [a, l]], [/sie-(\w+)*/i], [i, [s, "Siemens"], [a, l]], [/(maemo|nokia).*(n900|lumia\s\d+)/i, /(nokia)[\s_-]?([\w-]+)*/i], [[s, "Nokia"], i, [a, l]], [/android\s3\.[\s\w;-]{10}(a\d{3})/i], [i, [s, "Acer"], [a, c]], [/android.+([vl]k\-?\d{3})\s+build/i], [i, [s, "LG"], [a, c]], [/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i], [[s, "LG"], i, [a, c]], [/(lg) netcast\.tv/i], [s, i, [a, "smarttv"]], [/(nexus\s[45])/i, /lg[e;\s\/-]+(\w+)*/i, /android.+lg(\-?[\d\w]+)\s+build/i], [i, [s, "LG"], [a, l]], [/android.+(ideatab[a-z0-9\-\s]+)/i], [i, [s, "Lenovo"], [a, c]], [/linux;.+((jolla));/i], [s, i, [a, l]], [/((pebble))app\/[\d\.]+\s/i], [s, i, [a, "wearable"]], [/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i], [s, i, [a, l]], [/crkey/i], [[i, "Chromecast"], [s, "Google"]], [/android.+;\s(glass)\s\d/i], [i, [s, "Google"], [a, "wearable"]], [/android.+;\s(pixel c)\s/i], [i, [s, "Google"], [a, c]], [/android.+;\s(pixel xl|pixel)\s/i], [i, [s, "Google"], [a, l]], [/android.+(\w+)\s+build\/hm\1/i, /android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i, /android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d\w)?)\s+build/i, /android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+)?)\s+build/i], [[i, /_/g, " "], [s, "Xiaomi"], [a, l]], [/android.+(mi[\s\-_]*(?:pad)?(?:[\s_]*[\w\s]+)?)\s+build/i], [[i, /_/g, " "], [s, "Xiaomi"], [a, c]], [/android.+;\s(m[1-5]\snote)\sbuild/i], [i, [s, "Meizu"], [a, c]], [/android.+a000(1)\s+build/i], [i, [s, "OnePlus"], [a, l]], [/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i], [i, [s, "RCA"], [a, c]], [/android.+[;\/]\s*(Venue[\d\s]*)\s+build/i], [i, [s, "Dell"], [a, c]], [/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i], [i, [s, "Verizon"], [a, c]], [/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i], [[s, "Barnes & Noble"], i, [a, c]], [/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i], [i, [s, "NuVision"], [a, c]], [/android.+[;\/]\s*(zte)?.+(k\d{2})\s+build/i], [[s, "ZTE"], i, [a, c]], [/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i], [i, [s, "Swiss"], [a, l]], [/android.+[;\/]\s*(zur\d{3})\s+build/i], [i, [s, "Swiss"], [a, c]], [/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i], [i, [s, "Zeki"], [a, c]], [/(android).+[;\/]\s+([YR]\d{2}x?.*)\s+build/i, /android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(.+)\s+build/i], [[s, "Dragon Touch"], i, [a, c]], [/android.+[;\/]\s*(NS-?.+)\s+build/i], [i, [s, "Insignia"], [a, c]], [/android.+[;\/]\s*((NX|Next)-?.+)\s+build/i], [i, [s, "NextBook"], [a, c]], [/android.+[;\/]\s*(Xtreme\_?)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i], [[s, "Voice"], i, [a, l]], [/android.+[;\/]\s*(LVTEL\-?)?(V1[12])\s+build/i], [[s, "LvTel"], i, [a, l]], [/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i], [i, [s, "Envizen"], [a, c]], [/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(.*\b)\s+build/i], [s, i, [a, c]], [/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i], [i, [s, "MachSpeed"], [a, c]], [/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i], [s, i, [a, c]], [/android.+[;\/]\s*TU_(1491)\s+build/i], [i, [s, "Rotor"], [a, c]], [/android.+(KS(.+))\s+build/i], [i, [s, "Amazon"], [a, c]], [/android.+(Gigaset)[\s\-]+(Q.+)\s+build/i], [s, i, [a, c]], [/\s(tablet|tab)[;\/]/i, /\s(mobile)(?:[;\/]|\ssafari)/i], [[a, f.lowerize], s, i], [/(android.+)[;\/].+build/i], [i, [s, "Generic"]]], engine: [[/windows.+\sedge\/([\w\.]+)/i], [u, [o, "EdgeHTML"]], [/(presto)\/([\w\.]+)/i, /(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i, /(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i, /(icab)[\/\s]([23]\.[\d\.]+)/i], [o, u], [/rv\:([\w\.]+).*(gecko)/i], [u, o]], os: [[/microsoft\s(windows)\s(vista|xp)/i], [o, u], [/(windows)\snt\s6\.2;\s(arm)/i, /(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i, /(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i], [o, [u, d.str, h.os.windows.version]], [/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i], [[o, "Windows"], [u, d.str, h.os.windows.version]], [/\((bb)(10);/i], [[o, "BlackBerry"], u], [/(blackberry)\w*\/?([\w\.]+)*/i, /(tizen)[\/\s]([\w\.]+)/i, /(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i, /linux;.+(sailfish);/i], [o, u], [/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i], [[o, "Symbian"], u], [/\((series40);/i], [o], [/mozilla.+\(mobile;.+gecko.+firefox/i], [[o, "Firefox OS"], u], [/(nintendo|playstation)\s([wids34portablevu]+)/i, /(mint)[\/\s\(]?(\w+)*/i, /(mageia|vectorlinux)[;\s]/i, /(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i, /(hurd|linux)\s?([\w\.]+)*/i, /(gnu)\s?([\w\.]+)*/i], [o, u], [/(cros)\s[\w]+\s([\w\.]+\w)/i], [[o, "Chromium OS"], u], [/(sunos)\s?([\w\.]+\d)*/i], [[o, "Solaris"], u], [/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i], [o, u], [/(haiku)\s(\w+)/i], [o, u], [/cfnetwork\/.+darwin/i, /ip[honead]+(?:.*os\s([\w]+)\slike\smac|;\sopera)/i], [[u, /_/g, "."], [o, "iOS"]], [/(mac\sos\sx)\s?([\w\s\.]+\w)*/i, /(macintosh|mac(?=_powerpc)\s)/i], [[o, "Mac OS"], [u, /_/g, "."]], [/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i, /(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i, /(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i, /(unix)\s?([\w\.]+)*/i], [o, u]] }, v = function (e, t) { if ("object" == typeof e && (t = e, e = void 0), !(this instanceof v)) return new v(e, t).getResult(); var n = e || (r && r.navigator && r.navigator.userAgent ? r.navigator.userAgent : ""), i = t ? f.extend(p, t) : p; return this.getBrowser = function () { var e = { name: void 0, version: void 0 }; return d.rgx.call(e, n, i.browser), e.major = f.major(e.version), e }, this.getCPU = function () { var e = { architecture: void 0 }; return d.rgx.call(e, n, i.cpu), e }, this.getDevice = function () { var e = { vendor: void 0, model: void 0, type: void 0 }; return d.rgx.call(e, n, i.device), e }, this.getEngine = function () { var e = { name: void 0, version: void 0 }; return d.rgx.call(e, n, i.engine), e }, this.getOS = function () { var e = { name: void 0, version: void 0 }; return d.rgx.call(e, n, i.os), e }, this.getResult = function () { return { ua: this.getUA(), browser: this.getBrowser(), engine: this.getEngine(), os: this.getOS(), device: this.getDevice(), cpu: this.getCPU() } }, this.getUA = function () { return n }, this.setUA = function (e) { return n = e, this }, this }; v.VERSION = "0.7.17", v.BROWSER = { NAME: o, MAJOR: "major", VERSION: u }, v.CPU = { ARCHITECTURE: "architecture" }, v.DEVICE = { MODEL: i, VENDOR: s, TYPE: a, CONSOLE: "console", MOBILE: l, SMARTTV: "smarttv", TABLET: c, WEARABLE: "wearable", EMBEDDED: "embedded" }, v.ENGINE = { NAME: o, VERSION: u }, v.OS = { NAME: o, VERSION: u }, e.exports && (t = e.exports = v), t.UAParser = v; var m = r && (r.jQuery || r.Zepto); if (void 0 !== m) { var y = new v; m.ua = y.getResult(), m.ua.get = function () { return y.getUA() }, m.ua.set = function (e) { y.setUA(e); var t = y.getResult(); for (var r in t) m.ua[r] = t[r] } } }("object" == typeof window ? window : r) }); t.Log = hi, t.UAParser = pi, t.genTraversalHandler = br, t.deepClone = function (e) { if (yr(e)) throw new TypeError("deepClone only accept non primitive type"); return _r(e) }, t.deepAssign = function () { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; if (t.length < 2) throw new Error("deepAssign accept two and more argument"); for (var n = t.length - 1; n > -1; n--)if (yr(t[n])) throw new TypeError("deepAssign only accept non primitive type"); var i = t.shift(); return t.forEach(function (e) { return _r(e, i) }), i }, t.camelize = wr, t.hypenate = function (e) { return wr(e).replace(/([A-Z])/g, function (e) { return "-" + e.toLowerCase() }) }, t.bind = function (e, t) { return e.bind ? e.bind(t) : e.apply ? function () { for (var r = arguments.length, n = Array(r), i = 0; i < r; i++)n[i] = arguments[i]; return e.apply(t, n) } : function () { for (var r = arguments.length, n = Array(r), i = 0; i < r; i++)n[i] = arguments[i]; return e.call.apply(e, [t].concat(Be(n))) } }, t.uuid = function () { return Er() + Er() + "-" + Er() + "-" + Er() + "-" + Er() + "-" + Er() + Er() + Er() }, t.S4 = Er, t.rand = function (e) { for (var t = ""; t.length < e;)t += Er(); return t.slice(0, e) }, t.getDeepProperty = function (e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}, n = r.throwError, i = void 0 !== n && n, o = r.backup; if (vr(t) && (t = t.split(".")), !cr(t)) throw new TypeError("keys of getDeepProperty must be string or Array<string>"); for (var a = [], s = e, u = 0, l = t.length; u < l; u++) { var c = t[u]; if (lr(s)) { if (i) throw new Error("obj" + (a.length > 0 ? "." + a.join(".") : " itself") + " is " + s); return o } s = s[c], a.push(c) } return s }, t.defined = function (e) { return void 0 !== e }, t.isVoid = lr, t.isArray = cr, t.isFunction = fr, t.isObject = dr, t.isNumber = hr, t.isNumeric = function (e) { return !cr(e) && e - ur(e) + 1 >= 0 }, t.isInteger = function (e) { return Xt(e) }, t.isEmpty = function (e) { return cr(e) ? 0 === e.length : dr(e) ? 0 === Ht(e).length : !e }, t.isEvent = function (e) { return e instanceof Event || (e && e.originalEvent) instanceof Event }, t.isBlob = pr, t.isFile = function (e) { return pr(e) && vr(e.name) }, t.isDate = function (e) { return "[object Date]" === Object.prototype.toString.call(e) }, t.isString = vr, t.isBoolean = mr, t.isPromise = function (e) { return !!e && ("object" === (void 0 === e ? "undefined" : Vt(e)) || "function" == typeof e) && "function" == typeof e.then }, t.isPrimitive = yr, t.isUrl = function (e) { return vr(e) && !!e.match(/^((https?|ftp|rtsp|mms):\/\/)(([0-9a-z_!~*'().&=+$%-]+: )?[0-9a-z_!~*'().&=+$%-]+@)?(([0-9]{1,3}\.){3}[0-9]{1,3}|([0-9a-z_!~*'()-]+\.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z]\.[a-z]{2,6}|localhost)(:[0-9]{1,4})?((\/?)|(\/[0-9a-z_!~*'().;?:@&=+$,%#-]+)+\/?)$/i) }, t.isNode = gr, t.isElement = function (e) { return !!("object" === ("undefined" == typeof HTMLElement ? "undefined" : Vt(HTMLElement)) ? e instanceof HTMLElement : e && "object" === (void 0 === e ? "undefined" : Vt(e)) && null !== e && 1 === e.nodeType && "string" == typeof e.nodeName) }, t.isChildNode = function (e, t) { return !(!gr(e) || !gr(t)) && t.parentNode === e }, t.isPosterityNode = function (e, t) { if (!gr(e) || !gr(t)) return !1; for (; t.parentNode;)if ((t = t.parentNode) === e) return !0; return !1 }, t.isHTMLString = function (e) { return /<[^>]+?>/.test(e) }, t.isError = function (e) { return e instanceof Error }, t.isRegExp = function (e) { return e instanceof RegExp }, t.inBrowser = gn, t.makeArray = function (e) { return Fe(e) }, t.transObjectAttrIntoArray = function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : function (e, t) { return +e - +t }; return Ht(e).sort(t).reduce(function (t, r) { return t.concat(e[r]) }, []) }, t.runRejectableQueue = function (e) { for (var t = arguments.length, r = Array(t > 1 ? t - 1 : 0), n = 1; n < t; n++)r[n - 1] = arguments[n]; return new yn(function (t, n) { !function i(o) { if (!(o >= e.length)) { var a = fr(e[o]) ? e[o].apply(e, Be(r)) : e[o]; return !1 === a ? n("stop") : yn.resolve(a).then(function () { return i(o + 1) }).catch(function (e) { return n(e || "stop") }) } t() }(0) }) }, t.runStoppableQueue = function (e) { for (var t = arguments.length, r = Array(t > 1 ? t - 1 : 0), n = 1; n < t; n++)r[n - 1] = arguments[n]; return function t(n) { return n >= e.length || !1 !== (fr(e[n]) ? e[n].apply(e, Be(r)) : e[n]) && t(++n) }(0) }, t.decodeUTF8 = function (e) { for (var t = [], r = e, n = 0, i = e.length; n < i;)if (r[n] < 128) t.push(String.fromCharCode(r[n])), ++n; else { if (r[n] < 192); else if (r[n] < 224) { if (bn(r, n, 1)) { var o = (31 & r[n]) << 6 | 63 & r[n + 1]; if (o >= 128) { t.push(String.fromCharCode(65535 & o)), n += 2; continue } } } else if (r[n] < 240) { if (bn(r, n, 2)) { var a = (15 & r[n]) << 12 | (63 & r[n + 1]) << 6 | 63 & r[n + 2]; if (a >= 2048 && 55296 != (63488 & a)) { t.push(String.fromCharCode(65535 & a)), n += 3; continue } } } else if (r[n] < 248 && bn(r, n, 3)) { var s = (7 & r[n]) << 18 | (63 & r[n + 1]) << 12 | (63 & r[n + 2]) << 6 | 63 & r[n + 3]; if (s > 65536 && s < 1114112) { s -= 65536, t.push(String.fromCharCode(s >>> 10 | 55296)), t.push(String.fromCharCode(1023 & s | 56320)), n += 4; continue } } t.push(String.fromCharCode(65533)), ++n } return t.join("") }, t.debounce = function (e, t, r) { var n = void 0, i = void 0, o = void 0, a = void 0, s = void 0, u = function u() { var l = new Date - a; l < t && l >= 0 ? n = setTimeout(u, t - l) : (n = null, r || (s = e.apply(o, i), n || (o = i = null))) }; return function () { o = this, i = arguments, a = new Date; var l = r && !n; return n || (n = setTimeout(u, t)), l && (s = e.apply(o, i), o = i = null), s } }, t.throttle = function (e, t, r, n) { var i = void 0, o = void 0, a = void 0, s = null, u = 0; r || (r = {}); var l = function () { u = !1 === r.leading ? 0 : new Date - 0, s = null, a = e.apply(i, o), s || (i = o = null) }; return t = t || 0, function () { var c = new Date; u || !1 !== r.leading || (u = c); var f = t - (c - u); return i = n || this, o = arguments, f <= 0 || f > t ? (s && (clearTimeout(s), s = null), u = c, a = e.apply(i, o), s || (i = o = null)) : s || !1 === r.trailing || (s = setTimeout(l, f)), a } }, t.raf = _n, t.caf = wn, t.strRepeat = En, t.formatTime = function (e) { var t = Math.floor(e / 3600); e = Math.floor(e % 3600); var r = En(Math.floor(e / 60), 2), n = En(e = Math.floor(e % 60), 2); return t >= 1 ? t + ":" + r + ":" + n : r + ":" + n }, t.appendCSS = function (e) { var t = document, r = t.querySelector("style"); if (!r) { r = t.createElement("style"); var n = t.querySelector("head"); n && n.appendChild(r) } return r.appendChild(t.createTextNode(e)), r }, t.formatDate = function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : new Date, t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "yyyy-MM-dd hh:mm:ss.i", r = e.getFullYear().toString(), n = { M: e.getMonth() + 1, d: e.getDate(), h: e.getHours(), m: e.getMinutes(), s: e.getSeconds(), i: e.getMilliseconds() }; t = t.replace(/(y+)/gi, function (e, t) { return r.substr(4 - Math.min(4, t.length)) }); var i = function (e) { t = t.replace(new RegExp("(" + e + "+)", "g"), function (t, r) { return (n[e] < 10 && r.length > 1 ? "0" : "") + n[e] }) }; for (var o in n) i(o); return t }, t.getLocalStorage = function (e) { try { return window.localStorage.getItem(e) } catch (r) { try { var t = document.cookie.match(new RegExp("(^| )" + e + "=([^;]*)(;|$)")); return cr(t) ? unescape(t[2]) : "" } catch (e) { return "" } } }, t.setLocalStorage = function (e, t) { try { window.localStorage.setItem(e, t) } catch (n) { var r = new Date; r.setTime(r.getTime() + 2592e7); try { document.cookie = e + "=" + escape(t) + ";expires=" + r.toUTCString() + ";path=/;" } catch (e) { } } }, t.emitEventCache = Fn, t.addEventCache = Bn, t.removeEventCache = Un, t.CustEvent = jn, t.getAttr = qn, t.setAttr = Yn, t.addClassName = Xn, t.removeClassName = Qn, t.hasClassName = Jn, t.removeEvent = ti, t.addEvent = ri, t.addDelegate = ni, t.removeDelegate = ii, t.getStyle = oi, t.setStyle = ai, t.query = si, t.removeEl = ui, t.findParents = li, t.$ = ci, t.NodeWrap = fi, Object.defineProperty(t, "__esModule", { value: !0 }) })(t) }).call(t, r(19)) }, function (e, t) { var r; r = function () { return this }(); try { r = r || Function("return this")() || (0, eval)("this") } catch (e) { "object" == typeof window && (r = window) } e.exports = r }]).default }, e.exports = r() })); nc.install(Ic), nc.install(qc), nc.install(Uc), nc.install(Kc); var ef = function (t) { function r(t) { var n; if (e(this, r), !gr(t)) throw new TypeError("You must pass an Object as config when you new ChimeePlayer"); t.plugin = t.plugin || t.plugins, mr(t.plugin) || (t.plugin = []); var i = [Ic.name, qc.name, Uc.name, Kc.name], o = t.plugin.map(function (e) { return gr(e) ? e.name : e }); return i.forEach(function (e) { o.indexOf(e) > -1 || t.plugin.push(e) }), t.kernels = Jr(t.kernels || {}, { hls: { handler: Jc }, flv: { handler: Zc } }), (n = a(this, s(r).call(this, t))).on("play", function () { return n.chimeeContextmenu.updatemenu([{ text: "暂停", action: "pause" }]) }), n.on("pause", function () { return n.chimeeContextmenu.updatemenu([{ text: "播放", action: "play" }]) }), n } return l(r, nc), r }(); return ef.popupFactory = function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, t = e.tagName, r = void 0 === t ? "chimee-popup" : t, n = e.className, i = e.name, o = void 0 === i ? "popup" : i, a = e.html, s = e.title, u = void 0 === s ? "这是一个信息框" : s, l = e.body, c = void 0 === l ? "这里是信息内容" : l, f = e.offsetAttr, d = void 0 === f ? "left top" : f, h = e.offset, p = void 0 === h ? "50% 50%" : h, v = e.translate, m = void 0 === v ? "" : v, y = e.width, g = e.height, b = e.level, _ = e.init, w = e.inited, E = e.data, S = e.create, k = e.beforeCreate, T = e.destroy, A = e.events, R = e.computed, O = e.methods, L = void 0 === O ? {} : O, x = e.penetrate, P = void 0 !== x && x, C = e.operable, D = void 0 === C || C, I = e.hide, M = void 0 !== I && I, N = e.opened, F = e.closed, B = e.autoFocus, U = { html: a || "\n      <cm-pp-close>×</cm-pp-close>\n      ".concat(!1 !== u ? "<cm-pp-head>".concat(u, "</cm-pp-head>") : "", "\n      ").concat(!1 !== c ? "<cm-pp-body>".concat(c, "</cm-pp-body>") : "", "\n    "), closeSelector: "._close" }; return { name: o, el: r, className: n, beforeCreate: function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, t = e.events, r = e.methods, n = arguments.length > 1 ? arguments[1] : void 0; gr(n) && (gr(n.events) && Jr(t, n.events), gr(n.methods) && Jr(r, n.methods)), k && k.apply(this, arguments) }, create: function () { var e = gr(this.$config) ? Jr(U, this.$config) : U; (this.$domWrap = Bi(this.$dom).css("display", "none")).html(e.html).delegate("cm-pp-close, " + e.closeSelector, "click", this.close), this.width(y).height(g).offset(p).translate(m), this._hide = M; for (var t = arguments.length, r = new Array(t), n = 0; n < t; n++)r[n] = arguments[n]; S && S.apply(this, r), !this._hide && this.open() }, destroy: function () { for (var e = arguments.length, t = new Array(e), r = 0; r < e; r++)t[r] = arguments[r]; T && T.apply(this, t), this.$domWrap.undelegate(this.$config.closeSelector, "click", this.close).remove() }, level: b, init: _, inited: w, data: E, events: A, computed: R, penetrate: P, operable: D, autoFocus: B, methods: Jr({ open: function () { if (this.destroyed) return this; this.$domWrap.css("display", "block"), this._hide = !1; for (var e = arguments.length, t = new Array(e), r = 0; r < e; r++)t[r] = arguments[r]; return this.$emit("popupOpen", t, this), yr(N) && N.apply(this, t), this }, close: function () { if (this.destroyed) return this; this.$domWrap.css("display", "none"), this._hide = !0; for (var e = arguments.length, t = new Array(e), r = 0; r < e; r++)t[r] = arguments[r]; return this.$emit("popupClose", t, this), yr(F) && F.apply(this, t), this }, width: function (e) { return e && this.$domWrap.css("width", e), this }, height: function (e) { return e && this.$domWrap.css("height", e), this }, offset: function (e) { var t = "".concat(e || "").split(" "), r = {}; if (t.length > 2) return ["top", "right", "bottom", "left"].forEach(function (e, n) { t[n] && (r[e] = t[n]) }), this.$domWrap.css(r), this; var n = Bc(t, 2), i = n[0], o = n[1]; if ("" === i) return this; var a = o || i, s = d.split(" "); r[s[0]] = i, r[s[1]] = a, this.$domWrap.css(r); var u = []; return "50%" === i && u.push("-50%"), "50%" === a && u.push("-50%"), u.length > 0 && this.translate(u.join(" ")), this }, translate: function (e) { var t = "".concat(e || "").split(" "), r = Bc(t, 2), n = r[0], i = r[1]; return "" !== n && (this.$domWrap.css("transform", "translate(".concat(n, ", ").concat(i || n, ")")), "transform" in document.createElement("a").style || !window.console || !window.console.warn || console.warn("[chimee-plugin-popup] 当前环境不支持CSS3的transform特性，Dom元素无法正常使用translate。")), this } }, L) } }, ef });
    </script>
    <style>
        #mse {
            width: 90%;
            height: 90%;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: auto;
        }
    </style>
</head>

<body bgcolor="black">
    <div><a style="color:white">%D这是提示%</a></div>
    <div id="mse"></div>
    <script>
        !function (e) { if ("object" == typeof exports && "undefined" != typeof module) module.exports = e(); else if ("function" == typeof define && define.amd) define([], e); else { var t; t = "undefined" != typeof window ? window : "undefined" != typeof global ? global : "undefined" != typeof self ? self : this, t.flvjs = e() } }(function () {
    var e; return function e(t, n, i) { function r(a, o) { if (!n[a]) { if (!t[a]) { var u = "function" == typeof require && require; if (!o && u) return u(a, !0); if (s) return s(a, !0); var l = new Error("Cannot find module '" + a + "'"); throw l.code = "MODULE_NOT_FOUND", l } var d = n[a] = { exports: {} }; t[a][0].call(d.exports, function (e) { var n = t[a][1][e]; return r(n || e) }, d, d.exports, e, t, n, i) } return n[a].exports } for (var s = "function" == typeof require && require, a = 0; a < i.length; a++)r(i[a]); return r }({
        1: [function (t, n, i) { (function (r, s) { !function (t, r) { "object" == typeof i && void 0 !== n ? n.exports = r() : "function" == typeof e && e.amd ? e(r) : t.ES6Promise = r() }(this, function () { "use strict"; function e(e) { var t = typeof e; return null !== e && ("object" === t || "function" === t) } function n(e) { return "function" == typeof e } function i(e) { V = e } function a(e) { z = e } function o() { return void 0 !== G ? function () { G(l) } : u() } function u() { var e = setTimeout; return function () { return e(l, 1) } } function l() { for (var e = 0; e < F; e += 2) { (0, Y[e])(Y[e + 1]), Y[e] = void 0, Y[e + 1] = void 0 } F = 0 } function d(e, t) { var n = this, i = new this.constructor(f); void 0 === i[Q] && C(i); var r = n._state; if (r) { var s = arguments[r - 1]; z(function () { return w(r, i, s, n._result) }) } else L(n, i, e, t); return i } function h(e) { var t = this; if (e && "object" == typeof e && e.constructor === t) return e; var n = new t(f); return E(n, e), n } function f() { } function c() { return new TypeError("You cannot resolve a promise with itself") } function _() { return new TypeError("A promises callback cannot return that same promise.") } function m(e) { try { return e.then } catch (e) { return te.error = e, te } } function p(e, t, n, i) { try { e.call(t, n, i) } catch (e) { return e } } function v(e, t, n) { z(function (e) { var i = !1, r = p(n, t, function (n) { i || (i = !0, t !== n ? E(e, n) : S(e, n)) }, function (t) { i || (i = !0, k(e, t)) }, "Settle: " + (e._label || " unknown promise")); !i && r && (i = !0, k(e, r)) }, e) } function g(e, t) { t._state === $ ? S(e, t._result) : t._state === ee ? k(e, t._result) : L(t, void 0, function (t) { return E(e, t) }, function (t) { return k(e, t) }) } function y(e, t, i) { t.constructor === e.constructor && i === d && t.constructor.resolve === h ? g(e, t) : i === te ? (k(e, te.error), te.error = null) : void 0 === i ? S(e, t) : n(i) ? v(e, t, i) : S(e, t) } function E(t, n) { t === n ? k(t, c()) : e(n) ? y(t, n, m(n)) : S(t, n) } function b(e) { e._onerror && e._onerror(e._result), R(e) } function S(e, t) { e._state === J && (e._result = t, e._state = $, 0 !== e._subscribers.length && z(R, e)) } function k(e, t) { e._state === J && (e._state = ee, e._result = t, z(b, e)) } function L(e, t, n, i) { var r = e._subscribers, s = r.length; e._onerror = null, r[s] = t, r[s + $] = n, r[s + ee] = i, 0 === s && e._state && z(R, e) } function R(e) { var t = e._subscribers, n = e._state; if (0 !== t.length) { for (var i = void 0, r = void 0, s = e._result, a = 0; a < t.length; a += 3)i = t[a], r = t[a + n], i ? w(n, i, r, s) : r(s); e._subscribers.length = 0 } } function A(e, t) { try { return e(t) } catch (e) { return te.error = e, te } } function w(e, t, i, r) { var s = n(i), a = void 0, o = void 0, u = void 0, l = void 0; if (s) { if (a = A(i, r), a === te ? (l = !0, o = a.error, a.error = null) : u = !0, t === a) return void k(t, _()) } else a = r, u = !0; t._state !== J || (s && u ? E(t, a) : l ? k(t, o) : e === $ ? S(t, a) : e === ee && k(t, a)) } function T(e, t) { try { t(function (t) { E(e, t) }, function (t) { k(e, t) }) } catch (t) { k(e, t) } } function O() { return ne++ } function C(e) { e[Q] = ne++, e._state = void 0, e._result = void 0, e._subscribers = [] } function I() { return new Error("Array Methods must be provided an Array") } function D(e) { return new ie(this, e).promise } function x(e) { var t = this; return new t(N(e) ? function (n, i) { for (var r = e.length, s = 0; s < r; s++)t.resolve(e[s]).then(n, i) } : function (e, t) { return t(new TypeError("You must pass an array to race.")) }) } function M(e) { var t = this, n = new t(f); return k(n, e), n } function B() { throw new TypeError("You must pass a resolver function as the first argument to the promise constructor") } function j() { throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.") } function P() { var e = void 0; if (void 0 !== s) e = s; else if ("undefined" != typeof self) e = self; else try { e = Function("return this")() } catch (e) { throw new Error("polyfill failed because global object is unavailable in this environment") } var t = e.Promise; if (t) { var n = null; try { n = Object.prototype.toString.call(t.resolve()) } catch (e) { } if ("[object Promise]" === n && !t.cast) return } e.Promise = re } var U = void 0; U = Array.isArray ? Array.isArray : function (e) { return "[object Array]" === Object.prototype.toString.call(e) }; var N = U, F = 0, G = void 0, V = void 0, z = function (e, t) { Y[F] = e, Y[F + 1] = t, 2 === (F += 2) && (V ? V(l) : Z()) }, H = "undefined" != typeof window ? window : void 0, K = H || {}, q = K.MutationObserver || K.WebKitMutationObserver, W = "undefined" == typeof self && void 0 !== r && "[object process]" === {}.toString.call(r), X = "undefined" != typeof Uint8ClampedArray && "undefined" != typeof importScripts && "undefined" != typeof MessageChannel, Y = new Array(1e3), Z = void 0; Z = W ? function () { return function () { return r.nextTick(l) } }() : q ? function () { var e = 0, t = new q(l), n = document.createTextNode(""); return t.observe(n, { characterData: !0 }), function () { n.data = e = ++e % 2 } }() : X ? function () { var e = new MessageChannel; return e.port1.onmessage = l, function () { return e.port2.postMessage(0) } }() : void 0 === H && "function" == typeof t ? function () { try { var e = Function("return this")().require("vertx"); return G = e.runOnLoop || e.runOnContext, o() } catch (e) { return u() } }() : u(); var Q = Math.random().toString(36).substring(2), J = void 0, $ = 1, ee = 2, te = { error: null }, ne = 0, ie = function () { function e(e, t) { this._instanceConstructor = e, this.promise = new e(f), this.promise[Q] || C(this.promise), N(t) ? (this.length = t.length, this._remaining = t.length, this._result = new Array(this.length), 0 === this.length ? S(this.promise, this._result) : (this.length = this.length || 0, this._enumerate(t), 0 === this._remaining && S(this.promise, this._result))) : k(this.promise, I()) } return e.prototype._enumerate = function (e) { for (var t = 0; this._state === J && t < e.length; t++)this._eachEntry(e[t], t) }, e.prototype._eachEntry = function (e, t) { var n = this._instanceConstructor, i = n.resolve; if (i === h) { var r = m(e); if (r === d && e._state !== J) this._settledAt(e._state, t, e._result); else if ("function" != typeof r) this._remaining--, this._result[t] = e; else if (n === re) { var s = new n(f); y(s, e, r), this._willSettleAt(s, t) } else this._willSettleAt(new n(function (t) { return t(e) }), t) } else this._willSettleAt(i(e), t) }, e.prototype._settledAt = function (e, t, n) { var i = this.promise; i._state === J && (this._remaining--, e === ee ? k(i, n) : this._result[t] = n), 0 === this._remaining && S(i, this._result) }, e.prototype._willSettleAt = function (e, t) { var n = this; L(e, void 0, function (e) { return n._settledAt($, t, e) }, function (e) { return n._settledAt(ee, t, e) }) }, e }(), re = function () { function e(t) { this[Q] = O(), this._result = this._state = void 0, this._subscribers = [], f !== t && ("function" != typeof t && B(), this instanceof e ? T(this, t) : j()) } return e.prototype.catch = function (e) { return this.then(null, e) }, e.prototype.finally = function (e) { var t = this, i = t.constructor; return n(e) ? t.then(function (t) { return i.resolve(e()).then(function () { return t }) }, function (t) { return i.resolve(e()).then(function () { throw t }) }) : t.then(e, e) }, e }(); return re.prototype.then = d, re.all = D, re.race = x, re.resolve = h, re.reject = M, re._setScheduler = i, re._setAsap = a, re._asap = z, re.polyfill = P, re.Promise = re, re }) }).call(this, t("_process"), "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, { _process: 3 }], 2: [function (e, t, n) { function i() { this._events = this._events || {}, this._maxListeners = this._maxListeners || void 0 } function r(e) { return "function" == typeof e } function s(e) { return "number" == typeof e } function a(e) { return "object" == typeof e && null !== e } function o(e) { return void 0 === e } t.exports = i, i.EventEmitter = i, i.prototype._events = void 0, i.prototype._maxListeners = void 0, i.defaultMaxListeners = 10, i.prototype.setMaxListeners = function (e) { if (!s(e) || e < 0 || isNaN(e)) throw TypeError("n must be a positive number"); return this._maxListeners = e, this }, i.prototype.emit = function (e) { var t, n, i, s, u, l; if (this._events || (this._events = {}), "error" === e && (!this._events.error || a(this._events.error) && !this._events.error.length)) { if ((t = arguments[1]) instanceof Error) throw t; var d = new Error('Uncaught, unspecified "error" event. (' + t + ")"); throw d.context = t, d } if (n = this._events[e], o(n)) return !1; if (r(n)) switch (arguments.length) { case 1: n.call(this); break; case 2: n.call(this, arguments[1]); break; case 3: n.call(this, arguments[1], arguments[2]); break; default: s = Array.prototype.slice.call(arguments, 1), n.apply(this, s) } else if (a(n)) for (s = Array.prototype.slice.call(arguments, 1), l = n.slice(), i = l.length, u = 0; u < i; u++)l[u].apply(this, s); return !0 }, i.prototype.addListener = function (e, t) { var n; if (!r(t)) throw TypeError("listener must be a function"); return this._events || (this._events = {}), this._events.newListener && this.emit("newListener", e, r(t.listener) ? t.listener : t), this._events[e] ? a(this._events[e]) ? this._events[e].push(t) : this._events[e] = [this._events[e], t] : this._events[e] = t, a(this._events[e]) && !this._events[e].warned && (n = o(this._maxListeners) ? i.defaultMaxListeners : this._maxListeners) && n > 0 && this._events[e].length > n && (this._events[e].warned = !0, console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.", this._events[e].length), "function" == typeof console.trace && console.trace()), this }, i.prototype.on = i.prototype.addListener, i.prototype.once = function (e, t) { function n() { this.removeListener(e, n), i || (i = !0, t.apply(this, arguments)) } if (!r(t)) throw TypeError("listener must be a function"); var i = !1; return n.listener = t, this.on(e, n), this }, i.prototype.removeListener = function (e, t) { var n, i, s, o; if (!r(t)) throw TypeError("listener must be a function"); if (!this._events || !this._events[e]) return this; if (n = this._events[e], s = n.length, i = -1, n === t || r(n.listener) && n.listener === t) delete this._events[e], this._events.removeListener && this.emit("removeListener", e, t); else if (a(n)) { for (o = s; o-- > 0;)if (n[o] === t || n[o].listener && n[o].listener === t) { i = o; break } if (i < 0) return this; 1 === n.length ? (n.length = 0, delete this._events[e]) : n.splice(i, 1), this._events.removeListener && this.emit("removeListener", e, t) } return this }, i.prototype.removeAllListeners = function (e) { var t, n; if (!this._events) return this; if (!this._events.removeListener) return 0 === arguments.length ? this._events = {} : this._events[e] && delete this._events[e], this; if (0 === arguments.length) { for (t in this._events) "removeListener" !== t && this.removeAllListeners(t); return this.removeAllListeners("removeListener"), this._events = {}, this } if (n = this._events[e], r(n)) this.removeListener(e, n); else if (n) for (; n.length;)this.removeListener(e, n[n.length - 1]); return delete this._events[e], this }, i.prototype.listeners = function (e) { return this._events && this._events[e] ? r(this._events[e]) ? [this._events[e]] : this._events[e].slice() : [] }, i.prototype.listenerCount = function (e) { if (this._events) { var t = this._events[e]; if (r(t)) return 1; if (t) return t.length } return 0 }, i.listenerCount = function (e, t) { return e.listenerCount(t) } }, {}], 3: [function (e, t, n) { function i() { throw new Error("setTimeout has not been defined") } function r() { throw new Error("clearTimeout has not been defined") } function s(e) { if (h === setTimeout) return setTimeout(e, 0); if ((h === i || !h) && setTimeout) return h = setTimeout, setTimeout(e, 0); try { return h(e, 0) } catch (t) { try { return h.call(null, e, 0) } catch (t) { return h.call(this, e, 0) } } } function a(e) { if (f === clearTimeout) return clearTimeout(e); if ((f === r || !f) && clearTimeout) return f = clearTimeout, clearTimeout(e); try { return f(e) } catch (t) { try { return f.call(null, e) } catch (t) { return f.call(this, e) } } } function o() { p && _ && (p = !1, _.length ? m = _.concat(m) : v = -1, m.length && u()) } function u() { if (!p) { var e = s(o); p = !0; for (var t = m.length; t;) { for (_ = m, m = []; ++v < t;)_ && _[v].run(); v = -1, t = m.length } _ = null, p = !1, a(e) } } function l(e, t) { this.fun = e, this.array = t } function d() { } var h, f, c = t.exports = {}; !function () { try { h = "function" == typeof setTimeout ? setTimeout : i } catch (e) { h = i } try { f = "function" == typeof clearTimeout ? clearTimeout : r } catch (e) { f = r } }(); var _, m = [], p = !1, v = -1; c.nextTick = function (e) { var t = new Array(arguments.length - 1); if (arguments.length > 1) for (var n = 1; n < arguments.length; n++)t[n - 1] = arguments[n]; m.push(new l(e, t)), 1 !== m.length || p || s(u) }, l.prototype.run = function () { this.fun.apply(null, this.array) }, c.title = "browser", c.browser = !0, c.env = {}, c.argv = [], c.version = "", c.versions = {}, c.on = d, c.addListener = d, c.once = d, c.off = d, c.removeListener = d, c.removeAllListeners = d, c.emit = d, c.prependListener = d, c.prependOnceListener = d, c.listeners = function (e) { return [] }, c.binding = function (e) { throw new Error("process.binding is not supported") }, c.cwd = function () { return "/" }, c.chdir = function (e) { throw new Error("process.chdir is not supported") }, c.umask = function () { return 0 } }, {}], 4: [function (e, t, n) { var i = arguments[3], r = arguments[4], s = arguments[5], a = JSON.stringify; t.exports = function (e, t) { function n(e) { p[e] = !0; for (var t in r[e][1]) { var i = r[e][1][t]; p[i] || n(i) } } for (var o, u = Object.keys(s), l = 0, d = u.length; l < d; l++) { var h = u[l], f = s[h].exports; if (f === e || f && f.default === e) { o = h; break } } if (!o) { o = Math.floor(Math.pow(16, 8) * Math.random()).toString(16); for (var c = {}, l = 0, d = u.length; l < d; l++) { var h = u[l]; c[h] = h } r[o] = ["function(require,module,exports){" + e + "(self); }", c] } var _ = Math.floor(Math.pow(16, 8) * Math.random()).toString(16), m = {}; m[o] = o, r[_] = ["function(require,module,exports){var f = require(" + a(o) + ");(f.default ? f.default : f)(self);}", m]; var p = {}; n(_); var v = "(" + i + ")({" + Object.keys(p).map(function (e) { return a(e) + ":[" + r[e][0] + "," + a(r[e][1]) + "]" }).join(",") + "},{},[" + a(_) + "])", g = window.URL || window.webkitURL || window.mozURL || window.msURL, y = new Blob([v], { type: "text/javascript" }); if (t && t.bare) return y; var E = g.createObjectURL(y), b = new Worker(E); return b.objectURL = E, b } }, {}], 5: [function (e, t, n) { "use strict"; function i() { return Object.assign({}, r) } Object.defineProperty(n, "__esModule", { value: !0 }), n.createDefaultConfig = i; var r = n.defaultConfig = { enableWorker: !1, enableStashBuffer: !0, stashInitialSize: void 0, isLive: !1, lazyLoad: !0, lazyLoadMaxDuration: 180, lazyLoadRecoverDuration: 30, deferLoadAfterSourceOpen: !0, autoCleanupMaxBackwardDuration: 180, autoCleanupMinBackwardDuration: 120, statisticsInfoReportInterval: 600, fixAudioTimestampGap: !0, accurateSeek: !1, seekType: "range", seekParamStart: "bstart", seekParamEnd: "bend", rangeLoadZeroStart: !1, customSeekHandler: void 0, reuseRedirectedURL: !1, headers: void 0, customLoader: void 0 } }, {}], 6: [function (e, t, n) { "use strict"; function i(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(n, "__esModule", { value: !0 }); var r = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), s = e("../io/io-controller.js"), a = function (e) { return e && e.__esModule ? e : { default: e } }(s), o = e("../config.js"), u = function () { function e() { i(this, e) } return r(e, null, [{ key: "supportMSEH264Playback", value: function () { return window.MediaSource && window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"') } }, { key: "supportNetworkStreamIO", value: function () { var e = new a.default({}, (0, o.createDefaultConfig)()), t = e.loaderType; return e.destroy(), "fetch-stream-loader" == t || "xhr-moz-chunked-loader" == t } }, { key: "getNetworkLoaderTypeName", value: function () { var e = new a.default({}, (0, o.createDefaultConfig)()), t = e.loaderType; return e.destroy(), t } }, { key: "supportNativeMediaPlayback", value: function (t) { void 0 == e.videoElement && (e.videoElement = window.document.createElement("video")); var n = e.videoElement.canPlayType(t); return "probably" === n || "maybe" == n } }, { key: "getFeatureList", value: function () { var t = { mseFlvPlayback: !1, mseLiveFlvPlayback: !1, networkStreamIO: !1, networkLoaderName: "", nativeMP4H264Playback: !1, nativeWebmVP8Playback: !1, nativeWebmVP9Playback: !1 }; return t.mseFlvPlayback = e.supportMSEH264Playback(), t.networkStreamIO = e.supportNetworkStreamIO(), t.networkLoaderName = e.getNetworkLoaderTypeName(), t.mseLiveFlvPlayback = t.mseFlvPlayback && t.networkStreamIO, t.nativeMP4H264Playback = e.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'), t.nativeWebmVP8Playback = e.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'), t.nativeWebmVP9Playback = e.supportNativeMediaPlayback('video/webm; codecs="vp9"'), t } }]), e }(); n.default = u }, { "../config.js": 5, "../io/io-controller.js": 23 }], 7: [function (e, t, n) { "use strict"; function i(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(n, "__esModule", { value: !0 }); var r = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), s = function () { function e() { i(this, e), this.mimeType = null, this.duration = null, this.hasAudio = null, this.hasVideo = null, this.audioCodec = null, this.videoCodec = null, this.audioDataRate = null, this.videoDataRate = null, this.audioSampleRate = null, this.audioChannelCount = null, this.width = null, this.height = null, this.fps = null, this.profile = null, this.level = null, this.refFrames = null, this.chromaFormat = null, this.sarNum = null, this.sarDen = null, this.metadata = null, this.segments = null, this.segmentCount = null, this.hasKeyframesIndex = null, this.keyframesIndex = null } return r(e, [{ key: "isComplete", value: function () { var e = !1 === this.hasAudio || !0 === this.hasAudio && null != this.audioCodec && null != this.audioSampleRate && null != this.audioChannelCount, t = !1 === this.hasVideo || !0 === this.hasVideo && null != this.videoCodec && null != this.width && null != this.height && null != this.fps && null != this.profile && null != this.level && null != this.refFrames && null != this.chromaFormat && null != this.sarNum && null != this.sarDen; return null != this.mimeType && null != this.duration && null != this.metadata && null != this.hasKeyframesIndex && e && t } }, { key: "isSeekable", value: function () { return !0 === this.hasKeyframesIndex } }, { key: "getNearestKeyframe", value: function (e) { if (null == this.keyframesIndex) return null; var t = this.keyframesIndex, n = this._search(t.times, e); return { index: n, milliseconds: t.times[n], fileposition: t.filepositions[n] } } }, { key: "_search", value: function (e, t) { var n = 0, i = e.length - 1, r = 0, s = 0, a = i; for (t < e[0] && (n = 0, s = a + 1); s <= a;) { if ((r = s + Math.floor((a - s) / 2)) === i || t >= e[r] && t < e[r + 1]) { n = r; break } e[r] < t ? s = r + 1 : a = r - 1 } return n } }]), e }(); n.default = s }, {}], 8: [function (e, t, n) { "use strict"; function i(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(n, "__esModule", { value: !0 }); var r = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(); n.SampleInfo = function e(t, n, r, s, a) { i(this, e), this.dts = t, this.pts = n, this.duration = r, this.originalDts = s, this.isSyncPoint = a, this.fileposition = null }, n.MediaSegmentInfo = function () { function e() { i(this, e), this.beginDts = 0, this.endDts = 0, this.beginPts = 0, this.endPts = 0, this.originalBeginDts = 0, this.originalEndDts = 0, this.syncPoints = [], this.firstSample = null, this.lastSample = null } return r(e, [{ key: "appendSyncPoint", value: function (e) { e.isSyncPoint = !0, this.syncPoints.push(e) } }]), e }(), n.IDRSampleList = function () { function e() { i(this, e), this._list = [] } return r(e, [{ key: "clear", value: function () { this._list = [] } }, { key: "appendArray", value: function (e) { var t = this._list; 0 !== e.length && (t.length > 0 && e[0].originalDts < t[t.length - 1].originalDts && this.clear(), Array.prototype.push.apply(t, e)) } }, { key: "getLastSyncPointBeforeDts", value: function (e) { if (0 == this._list.length) return null; var t = this._list, n = 0, i = t.length - 1, r = 0, s = 0, a = i; for (e < t[0].dts && (n = 0, s = a + 1); s <= a;) { if ((r = s + Math.floor((a - s) / 2)) === i || e >= t[r].dts && e < t[r + 1].dts) { n = r; break } t[r].dts < e ? s = r + 1 : a = r - 1 } return this._list[n] } }]), e }(), n.MediaSegmentInfoList = function () { function e(t) { i(this, e), this._type = t, this._list = [], this._lastAppendLocation = -1 } return r(e, [{ key: "isEmpty", value: function () { return 0 === this._list.length } }, { key: "clear", value: function () { this._list = [], this._lastAppendLocation = -1 } }, { key: "_searchNearestSegmentBefore", value: function (e) { var t = this._list; if (0 === t.length) return -2; var n = t.length - 1, i = 0, r = 0, s = n, a = 0; if (e < t[0].originalBeginDts) return a = -1; for (; r <= s;) { if ((i = r + Math.floor((s - r) / 2)) === n || e > t[i].lastSample.originalDts && e < t[i + 1].originalBeginDts) { a = i; break } t[i].originalBeginDts < e ? r = i + 1 : s = i - 1 } return a } }, { key: "_searchNearestSegmentAfter", value: function (e) { return this._searchNearestSegmentBefore(e) + 1 } }, { key: "append", value: function (e) { var t = this._list, n = e, i = this._lastAppendLocation, r = 0; -1 !== i && i < t.length && n.originalBeginDts >= t[i].lastSample.originalDts && (i === t.length - 1 || i < t.length - 1 && n.originalBeginDts < t[i + 1].originalBeginDts) ? r = i + 1 : t.length > 0 && (r = this._searchNearestSegmentBefore(n.originalBeginDts) + 1), this._lastAppendLocation = r, this._list.splice(r, 0, n) } }, { key: "getLastSegmentBefore", value: function (e) { var t = this._searchNearestSegmentBefore(e); return t >= 0 ? this._list[t] : null } }, { key: "getLastSampleBefore", value: function (e) { var t = this.getLastSegmentBefore(e); return null != t ? t.lastSample : null } }, { key: "getLastSyncPointBefore", value: function (e) { for (var t = this._searchNearestSegmentBefore(e), n = this._list[t].syncPoints; 0 === n.length && t > 0;)t--, n = this._list[t].syncPoints; return n.length > 0 ? n[n.length - 1] : null } }, { key: "type", get: function () { return this._type } }, { key: "length", get: function () { return this._list.length } }]), e }() }, {}], 9: [function (e, t, n) { "use strict"; function i(e) { return e && e.__esModule ? e : { default: e } } function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(n, "__esModule", { value: !0 }); var s = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), a = e("events"), o = i(a), u = e("../utils/logger.js"), l = i(u), d = e("../utils/browser.js"), h = i(d), f = e("./mse-events.js"), c = i(f), _ = e("./media-segment-info.js"), m = e("../utils/exception.js"), p = function () { function e(t) { r(this, e), this.TAG = "MSEController", this._config = t, this._emitter = new o.default, this._config.isLive && void 0 == this._config.autoCleanupSourceBuffer && (this._config.autoCleanupSourceBuffer = !0), this.e = { onSourceOpen: this._onSourceOpen.bind(this), onSourceEnded: this._onSourceEnded.bind(this), onSourceClose: this._onSourceClose.bind(this), onSourceBufferError: this._onSourceBufferError.bind(this), onSourceBufferUpdateEnd: this._onSourceBufferUpdateEnd.bind(this) }, this._mediaSource = null, this._mediaSourceObjectURL = null, this._mediaElement = null, this._isBufferFull = !1, this._hasPendingEos = !1, this._requireSetMediaDuration = !1, this._pendingMediaDuration = 0, this._pendingSourceBufferInit = [], this._mimeTypes = { video: null, audio: null }, this._sourceBuffers = { video: null, audio: null }, this._lastInitSegments = { video: null, audio: null }, this._pendingSegments = { video: [], audio: [] }, this._pendingRemoveRanges = { video: [], audio: [] }, this._idrList = new _.IDRSampleList } return s(e, [{ key: "destroy", value: function () { (this._mediaElement || this._mediaSource) && this.detachMediaElement(), this.e = null, this._emitter.removeAllListeners(), this._emitter = null } }, { key: "on", value: function (e, t) { this._emitter.addListener(e, t) } }, { key: "off", value: function (e, t) { this._emitter.removeListener(e, t) } }, { key: "attachMediaElement", value: function (e) { if (this._mediaSource) throw new m.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!"); var t = this._mediaSource = new window.MediaSource; t.addEventListener("sourceopen", this.e.onSourceOpen), t.addEventListener("sourceended", this.e.onSourceEnded), t.addEventListener("sourceclose", this.e.onSourceClose), this._mediaElement = e, this._mediaSourceObjectURL = window.URL.createObjectURL(this._mediaSource), e.src = this._mediaSourceObjectURL } }, { key: "detachMediaElement", value: function () { if (this._mediaSource) { var e = this._mediaSource; for (var t in this._sourceBuffers) { var n = this._pendingSegments[t]; n.splice(0, n.length), this._pendingSegments[t] = null, this._pendingRemoveRanges[t] = null, this._lastInitSegments[t] = null; var i = this._sourceBuffers[t]; if (i) { if ("closed" !== e.readyState) { try { e.removeSourceBuffer(i) } catch (e) { l.default.e(this.TAG, e.message) } i.removeEventListener("error", this.e.onSourceBufferError), i.removeEventListener("updateend", this.e.onSourceBufferUpdateEnd) } this._mimeTypes[t] = null, this._sourceBuffers[t] = null } } if ("open" === e.readyState) try { e.endOfStream() } catch (e) { l.default.e(this.TAG, e.message) } e.removeEventListener("sourceopen", this.e.onSourceOpen), e.removeEventListener("sourceended", this.e.onSourceEnded), e.removeEventListener("sourceclose", this.e.onSourceClose), this._pendingSourceBufferInit = [], this._isBufferFull = !1, this._idrList.clear(), this._mediaSource = null } this._mediaElement && (this._mediaElement.src = "", this._mediaElement.removeAttribute("src"), this._mediaElement = null), this._mediaSourceObjectURL && (window.URL.revokeObjectURL(this._mediaSourceObjectURL), this._mediaSourceObjectURL = null) } }, { key: "appendInitSegment", value: function (e, t) { if (!this._mediaSource || "open" !== this._mediaSource.readyState) return this._pendingSourceBufferInit.push(e), void this._pendingSegments[e.type].push(e); var n = e, i = "" + n.container; n.codec && n.codec.length > 0 && (i += ";codecs=" + n.codec); var r = !1; if (l.default.v(this.TAG, "Received Initialization Segment, mimeType: " + i), this._lastInitSegments[n.type] = n, i !== this._mimeTypes[n.type]) { if (this._mimeTypes[n.type]) l.default.v(this.TAG, "Notice: " + n.type + " mimeType changed, origin: " + this._mimeTypes[n.type] + ", target: " + i); else { r = !0; try { var s = this._sourceBuffers[n.type] = this._mediaSource.addSourceBuffer(i); s.addEventListener("error", this.e.onSourceBufferError), s.addEventListener("updateend", this.e.onSourceBufferUpdateEnd) } catch (e) { return l.default.e(this.TAG, e.message), void this._emitter.emit(c.default.ERROR, { code: e.code, msg: e.message }) } } this._mimeTypes[n.type] = i } t || this._pendingSegments[n.type].push(n), r || this._sourceBuffers[n.type] && !this._sourceBuffers[n.type].updating && this._doAppendSegments(), h.default.safari && "audio/mpeg" === n.container && n.mediaDuration > 0 && (this._requireSetMediaDuration = !0, this._pendingMediaDuration = n.mediaDuration / 1e3, this._updateMediaSourceDuration()) } }, { key: "appendMediaSegment", value: function (e) { var t = e; this._pendingSegments[t.type].push(t), this._config.autoCleanupSourceBuffer && this._needCleanupSourceBuffer() && this._doCleanupSourceBuffer(); var n = this._sourceBuffers[t.type]; !n || n.updating || this._hasPendingRemoveRanges() || this._doAppendSegments() } }, { key: "seek", value: function (e) { for (var t in this._sourceBuffers) if (this._sourceBuffers[t]) { var n = this._sourceBuffers[t]; if ("open" === this._mediaSource.readyState) try { n.abort() } catch (e) { l.default.e(this.TAG, e.message) } this._idrList.clear(); var i = this._pendingSegments[t]; if (i.splice(0, i.length), "closed" !== this._mediaSource.readyState) { for (var r = 0; r < n.buffered.length; r++) { var s = n.buffered.start(r), a = n.buffered.end(r); this._pendingRemoveRanges[t].push({ start: s, end: a }) } if (n.updating || this._doRemoveRanges(), h.default.safari) { var o = this._lastInitSegments[t]; o && (this._pendingSegments[t].push(o), n.updating || this._doAppendSegments()) } } } } }, { key: "endOfStream", value: function () { var e = this._mediaSource, t = this._sourceBuffers; if (!e || "open" !== e.readyState) return void (e && "closed" === e.readyState && this._hasPendingSegments() && (this._hasPendingEos = !0)); t.video && t.video.updating || t.audio && t.audio.updating ? this._hasPendingEos = !0 : (this._hasPendingEos = !1, e.endOfStream()) } }, { key: "getNearestKeyframe", value: function (e) { return this._idrList.getLastSyncPointBeforeDts(e) } }, { key: "_needCleanupSourceBuffer", value: function () { if (!this._config.autoCleanupSourceBuffer) return !1; var e = this._mediaElement.currentTime; for (var t in this._sourceBuffers) { var n = this._sourceBuffers[t]; if (n) { var i = n.buffered; if (i.length >= 1 && e - i.start(0) >= this._config.autoCleanupMaxBackwardDuration) return !0 } } return !1 } }, { key: "_doCleanupSourceBuffer", value: function () { var e = this._mediaElement.currentTime; for (var t in this._sourceBuffers) { var n = this._sourceBuffers[t]; if (n) { for (var i = n.buffered, r = !1, s = 0; s < i.length; s++) { var a = i.start(s), o = i.end(s); if (a <= e && e < o + 3) { if (e - a >= this._config.autoCleanupMaxBackwardDuration) { r = !0; var u = e - this._config.autoCleanupMinBackwardDuration; this._pendingRemoveRanges[t].push({ start: a, end: u }) } } else o < e && (r = !0, this._pendingRemoveRanges[t].push({ start: a, end: o })) } r && !n.updating && this._doRemoveRanges() } } } }, { key: "_updateMediaSourceDuration", value: function () { var e = this._sourceBuffers; if (0 !== this._mediaElement.readyState && "open" === this._mediaSource.readyState && !(e.video && e.video.updating || e.audio && e.audio.updating)) { var t = this._mediaSource.duration, n = this._pendingMediaDuration; n > 0 && (isNaN(t) || n > t) && (l.default.v(this.TAG, "Update MediaSource duration from " + t + " to " + n), this._mediaSource.duration = n), this._requireSetMediaDuration = !1, this._pendingMediaDuration = 0 } } }, { key: "_doRemoveRanges", value: function () { for (var e in this._pendingRemoveRanges) if (this._sourceBuffers[e] && !this._sourceBuffers[e].updating) for (var t = this._sourceBuffers[e], n = this._pendingRemoveRanges[e]; n.length && !t.updating;) { var i = n.shift(); t.remove(i.start, i.end) } } }, { key: "_doAppendSegments", value: function () { var e = this._pendingSegments; for (var t in e) if (this._sourceBuffers[t] && !this._sourceBuffers[t].updating && e[t].length > 0) { var n = e[t].shift(); if (n.timestampOffset) { var i = this._sourceBuffers[t].timestampOffset, r = n.timestampOffset / 1e3, s = Math.abs(i - r); s > .1 && (l.default.v(this.TAG, "Update MPEG audio timestampOffset from " + i + " to " + r), this._sourceBuffers[t].timestampOffset = r), delete n.timestampOffset } if (!n.data || 0 === n.data.byteLength) continue; try { this._sourceBuffers[t].appendBuffer(n.data), this._isBufferFull = !1, "video" === t && n.hasOwnProperty("info") && this._idrList.appendArray(n.info.syncPoints) } catch (e) { this._pendingSegments[t].unshift(n), 22 === e.code ? (this._isBufferFull || this._emitter.emit(c.default.BUFFER_FULL), this._isBufferFull = !0) : (l.default.e(this.TAG, e.message), this._emitter.emit(c.default.ERROR, { code: e.code, msg: e.message })) } } } }, { key: "_onSourceOpen", value: function () { if (l.default.v(this.TAG, "MediaSource onSourceOpen"), this._mediaSource.removeEventListener("sourceopen", this.e.onSourceOpen), this._pendingSourceBufferInit.length > 0) for (var e = this._pendingSourceBufferInit; e.length;) { var t = e.shift(); this.appendInitSegment(t, !0) } this._hasPendingSegments() && this._doAppendSegments(), this._emitter.emit(c.default.SOURCE_OPEN) } }, { key: "_onSourceEnded", value: function () { l.default.v(this.TAG, "MediaSource onSourceEnded") } }, { key: "_onSourceClose", value: function () { l.default.v(this.TAG, "MediaSource onSourceClose"), this._mediaSource && null != this.e && (this._mediaSource.removeEventListener("sourceopen", this.e.onSourceOpen), this._mediaSource.removeEventListener("sourceended", this.e.onSourceEnded), this._mediaSource.removeEventListener("sourceclose", this.e.onSourceClose)) } }, { key: "_hasPendingSegments", value: function () { var e = this._pendingSegments; return e.video.length > 0 || e.audio.length > 0 } }, { key: "_hasPendingRemoveRanges", value: function () { var e = this._pendingRemoveRanges; return e.video.length > 0 || e.audio.length > 0 } }, { key: "_onSourceBufferUpdateEnd", value: function () { this._requireSetMediaDuration ? this._updateMediaSourceDuration() : this._hasPendingRemoveRanges() ? this._doRemoveRanges() : this._hasPendingSegments() ? this._doAppendSegments() : this._hasPendingEos && this.endOfStream(), this._emitter.emit(c.default.UPDATE_END) } }, { key: "_onSourceBufferError", value: function (e) { l.default.e(this.TAG, "SourceBuffer Error: " + e) } }]), e }(); n.default = p }, { "../utils/browser.js": 39, "../utils/exception.js": 40, "../utils/logger.js": 41, "./media-segment-info.js": 8, "./mse-events.js": 10, events: 2 }], 10: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }); var i = { ERROR: "error", SOURCE_OPEN: "source_open", UPDATE_END: "update_end", BUFFER_FULL: "buffer_full" }; n.default = i }, {}], 11: [function (e, t, n) {
            "use strict"; function i(e) { return e && e.__esModule ? e : { default: e } } function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(n, "__esModule", { value: !0 }); var s = function () {
                function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t }
            }(), a = e("events"), o = i(a), u = e("../utils/logger.js"), l = i(u), d = e("../utils/logging-control.js"), h = i(d), f = e("./transmuxing-controller.js"), c = i(f), _ = e("./transmuxing-events.js"), m = i(_), p = e("./transmuxing-worker.js"), v = i(p), g = e("./media-info.js"), y = i(g), E = function () { function t(n, i) { if (r(this, t), this.TAG = "Transmuxer", this._emitter = new o.default, i.enableWorker && "undefined" != typeof Worker) try { var s = e("webworkify"); this._worker = s(v.default), this._workerDestroying = !1, this._worker.addEventListener("message", this._onWorkerMessage.bind(this)), this._worker.postMessage({ cmd: "init", param: [n, i] }), this.e = { onLoggingConfigChanged: this._onLoggingConfigChanged.bind(this) }, h.default.registerListener(this.e.onLoggingConfigChanged), this._worker.postMessage({ cmd: "logging_config", param: h.default.getConfig() }) } catch (e) { l.default.e(this.TAG, "Error while initialize transmuxing worker, fallback to inline transmuxing"), this._worker = null, this._controller = new c.default(n, i) } else this._controller = new c.default(n, i); if (this._controller) { var a = this._controller; a.on(m.default.IO_ERROR, this._onIOError.bind(this)), a.on(m.default.DEMUX_ERROR, this._onDemuxError.bind(this)), a.on(m.default.INIT_SEGMENT, this._onInitSegment.bind(this)), a.on(m.default.MEDIA_SEGMENT, this._onMediaSegment.bind(this)), a.on(m.default.LOADING_COMPLETE, this._onLoadingComplete.bind(this)), a.on(m.default.RECOVERED_EARLY_EOF, this._onRecoveredEarlyEof.bind(this)), a.on(m.default.MEDIA_INFO, this._onMediaInfo.bind(this)), a.on(m.default.METADATA_ARRIVED, this._onMetaDataArrived.bind(this)), a.on(m.default.SCRIPTDATA_ARRIVED, this._onScriptDataArrived.bind(this)), a.on(m.default.STATISTICS_INFO, this._onStatisticsInfo.bind(this)), a.on(m.default.RECOMMEND_SEEKPOINT, this._onRecommendSeekpoint.bind(this)) } } return s(t, [{ key: "destroy", value: function () { this._worker ? this._workerDestroying || (this._workerDestroying = !0, this._worker.postMessage({ cmd: "destroy" }), h.default.removeListener(this.e.onLoggingConfigChanged), this.e = null) : (this._controller.destroy(), this._controller = null), this._emitter.removeAllListeners(), this._emitter = null } }, { key: "on", value: function (e, t) { this._emitter.addListener(e, t) } }, { key: "off", value: function (e, t) { this._emitter.removeListener(e, t) } }, { key: "hasWorker", value: function () { return null != this._worker } }, { key: "open", value: function () { this._worker ? this._worker.postMessage({ cmd: "start" }) : this._controller.start() } }, { key: "close", value: function () { this._worker ? this._worker.postMessage({ cmd: "stop" }) : this._controller.stop() } }, { key: "seek", value: function (e) { this._worker ? this._worker.postMessage({ cmd: "seek", param: e }) : this._controller.seek(e) } }, { key: "pause", value: function () { this._worker ? this._worker.postMessage({ cmd: "pause" }) : this._controller.pause() } }, { key: "resume", value: function () { this._worker ? this._worker.postMessage({ cmd: "resume" }) : this._controller.resume() } }, { key: "_onInitSegment", value: function (e, t) { var n = this; Promise.resolve().then(function () { n._emitter.emit(m.default.INIT_SEGMENT, e, t) }) } }, { key: "_onMediaSegment", value: function (e, t) { var n = this; Promise.resolve().then(function () { n._emitter.emit(m.default.MEDIA_SEGMENT, e, t) }) } }, { key: "_onLoadingComplete", value: function () { var e = this; Promise.resolve().then(function () { e._emitter.emit(m.default.LOADING_COMPLETE) }) } }, { key: "_onRecoveredEarlyEof", value: function () { var e = this; Promise.resolve().then(function () { e._emitter.emit(m.default.RECOVERED_EARLY_EOF) }) } }, { key: "_onMediaInfo", value: function (e) { var t = this; Promise.resolve().then(function () { t._emitter.emit(m.default.MEDIA_INFO, e) }) } }, { key: "_onMetaDataArrived", value: function (e) { var t = this; Promise.resolve().then(function () { t._emitter.emit(m.default.METADATA_ARRIVED, e) }) } }, { key: "_onScriptDataArrived", value: function (e) { var t = this; Promise.resolve().then(function () { t._emitter.emit(m.default.SCRIPTDATA_ARRIVED, e) }) } }, { key: "_onStatisticsInfo", value: function (e) { var t = this; Promise.resolve().then(function () { t._emitter.emit(m.default.STATISTICS_INFO, e) }) } }, { key: "_onIOError", value: function (e, t) { var n = this; Promise.resolve().then(function () { n._emitter.emit(m.default.IO_ERROR, e, t) }) } }, { key: "_onDemuxError", value: function (e, t) { var n = this; Promise.resolve().then(function () { n._emitter.emit(m.default.DEMUX_ERROR, e, t) }) } }, { key: "_onRecommendSeekpoint", value: function (e) { var t = this; Promise.resolve().then(function () { t._emitter.emit(m.default.RECOMMEND_SEEKPOINT, e) }) } }, { key: "_onLoggingConfigChanged", value: function (e) { this._worker && this._worker.postMessage({ cmd: "logging_config", param: e }) } }, { key: "_onWorkerMessage", value: function (e) { var t = e.data, n = t.data; if ("destroyed" === t.msg || this._workerDestroying) return this._workerDestroying = !1, this._worker.terminate(), void (this._worker = null); switch (t.msg) { case m.default.INIT_SEGMENT: case m.default.MEDIA_SEGMENT: this._emitter.emit(t.msg, n.type, n.data); break; case m.default.LOADING_COMPLETE: case m.default.RECOVERED_EARLY_EOF: this._emitter.emit(t.msg); break; case m.default.MEDIA_INFO: Object.setPrototypeOf(n, y.default.prototype), this._emitter.emit(t.msg, n); break; case m.default.METADATA_ARRIVED: case m.default.SCRIPTDATA_ARRIVED: case m.default.STATISTICS_INFO: this._emitter.emit(t.msg, n); break; case m.default.IO_ERROR: case m.default.DEMUX_ERROR: this._emitter.emit(t.msg, n.type, n.info); break; case m.default.RECOMMEND_SEEKPOINT: this._emitter.emit(t.msg, n); break; case "logcat_callback": l.default.emitter.emit("log", n.type, n.logcat) } } }]), t }(); n.default = E
        }, { "../utils/logger.js": 41, "../utils/logging-control.js": 42, "./media-info.js": 7, "./transmuxing-controller.js": 12, "./transmuxing-events.js": 13, "./transmuxing-worker.js": 14, events: 2, webworkify: 4 }], 12: [function (e, t, n) { "use strict"; function i(e) { return e && e.__esModule ? e : { default: e } } function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(n, "__esModule", { value: !0 }); var s = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), a = e("events"), o = i(a), u = e("../utils/logger.js"), l = i(u), d = e("../utils/browser.js"), h = i(d), f = e("./media-info.js"), c = i(f), _ = e("../demux/flv-demuxer.js"), m = i(_), p = e("../remux/mp4-remuxer.js"), v = i(p), g = e("../demux/demux-errors.js"), y = i(g), E = e("../io/io-controller.js"), b = i(E), S = e("./transmuxing-events.js"), k = i(S), L = (e("../io/loader.js"), function () { function e(t, n) { r(this, e), this.TAG = "TransmuxingController", this._emitter = new o.default, this._config = n, t.segments || (t.segments = [{ duration: t.duration, filesize: t.filesize, url: t.url }]), "boolean" != typeof t.cors && (t.cors = !0), "boolean" != typeof t.withCredentials && (t.withCredentials = !1), this._mediaDataSource = t, this._currentSegmentIndex = 0; var i = 0; this._mediaDataSource.segments.forEach(function (e) { e.timestampBase = i, i += e.duration, e.cors = t.cors, e.withCredentials = t.withCredentials, n.referrerPolicy && (e.referrerPolicy = n.referrerPolicy) }), isNaN(i) || this._mediaDataSource.duration === i || (this._mediaDataSource.duration = i), this._mediaInfo = null, this._demuxer = null, this._remuxer = null, this._ioctl = null, this._pendingSeekTime = null, this._pendingResolveSeekPoint = null, this._statisticsReporter = null } return s(e, [{ key: "destroy", value: function () { this._mediaInfo = null, this._mediaDataSource = null, this._statisticsReporter && this._disableStatisticsReporter(), this._ioctl && (this._ioctl.destroy(), this._ioctl = null), this._demuxer && (this._demuxer.destroy(), this._demuxer = null), this._remuxer && (this._remuxer.destroy(), this._remuxer = null), this._emitter.removeAllListeners(), this._emitter = null } }, { key: "on", value: function (e, t) { this._emitter.addListener(e, t) } }, { key: "off", value: function (e, t) { this._emitter.removeListener(e, t) } }, { key: "start", value: function () { this._loadSegment(0), this._enableStatisticsReporter() } }, { key: "_loadSegment", value: function (e, t) { this._currentSegmentIndex = e; var n = this._mediaDataSource.segments[e], i = this._ioctl = new b.default(n, this._config, e); i.onError = this._onIOException.bind(this), i.onSeeked = this._onIOSeeked.bind(this), i.onComplete = this._onIOComplete.bind(this), i.onRedirect = this._onIORedirect.bind(this), i.onRecoveredEarlyEof = this._onIORecoveredEarlyEof.bind(this), t ? this._demuxer.bindDataSource(this._ioctl) : i.onDataArrival = this._onInitChunkArrival.bind(this), i.open(t) } }, { key: "stop", value: function () { this._internalAbort(), this._disableStatisticsReporter() } }, { key: "_internalAbort", value: function () { this._ioctl && (this._ioctl.destroy(), this._ioctl = null) } }, { key: "pause", value: function () { this._ioctl && this._ioctl.isWorking() && (this._ioctl.pause(), this._disableStatisticsReporter()) } }, { key: "resume", value: function () { this._ioctl && this._ioctl.isPaused() && (this._ioctl.resume(), this._enableStatisticsReporter()) } }, { key: "seek", value: function (e) { if (null != this._mediaInfo && this._mediaInfo.isSeekable()) { var t = this._searchSegmentIndexContains(e); if (t === this._currentSegmentIndex) { var n = this._mediaInfo.segments[t]; if (void 0 == n) this._pendingSeekTime = e; else { var i = n.getNearestKeyframe(e); this._remuxer.seek(i.milliseconds), this._ioctl.seek(i.fileposition), this._pendingResolveSeekPoint = i.milliseconds } } else { var r = this._mediaInfo.segments[t]; if (void 0 == r) this._pendingSeekTime = e, this._internalAbort(), this._remuxer.seek(), this._remuxer.insertDiscontinuity(), this._loadSegment(t); else { var s = r.getNearestKeyframe(e); this._internalAbort(), this._remuxer.seek(e), this._remuxer.insertDiscontinuity(), this._demuxer.resetMediaInfo(), this._demuxer.timestampBase = this._mediaDataSource.segments[t].timestampBase, this._loadSegment(t, s.fileposition), this._pendingResolveSeekPoint = s.milliseconds, this._reportSegmentMediaInfo(t) } } this._enableStatisticsReporter() } } }, { key: "_searchSegmentIndexContains", value: function (e) { for (var t = this._mediaDataSource.segments, n = t.length - 1, i = 0; i < t.length; i++)if (e < t[i].timestampBase) { n = i - 1; break } return n } }, { key: "_onInitChunkArrival", value: function (e, t) { var n = this, i = null, r = 0; if (t > 0) this._demuxer.bindDataSource(this._ioctl), this._demuxer.timestampBase = this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase, r = this._demuxer.parseChunks(e, t); else if ((i = m.default.probe(e)).match) { this._demuxer = new m.default(i, this._config), this._remuxer || (this._remuxer = new v.default(this._config)); var s = this._mediaDataSource; void 0 == s.duration || isNaN(s.duration) || (this._demuxer.overridedDuration = s.duration), "boolean" == typeof s.hasAudio && (this._demuxer.overridedHasAudio = s.hasAudio), "boolean" == typeof s.hasVideo && (this._demuxer.overridedHasVideo = s.hasVideo), this._demuxer.timestampBase = s.segments[this._currentSegmentIndex].timestampBase, this._demuxer.onError = this._onDemuxException.bind(this), this._demuxer.onMediaInfo = this._onMediaInfo.bind(this), this._demuxer.onMetaDataArrived = this._onMetaDataArrived.bind(this), this._demuxer.onScriptDataArrived = this._onScriptDataArrived.bind(this), this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)), this._remuxer.onInitSegment = this._onRemuxerInitSegmentArrival.bind(this), this._remuxer.onMediaSegment = this._onRemuxerMediaSegmentArrival.bind(this), r = this._demuxer.parseChunks(e, t) } else i = null, l.default.e(this.TAG, "Non-FLV, Unsupported media type!"), Promise.resolve().then(function () { n._internalAbort() }), this._emitter.emit(k.default.DEMUX_ERROR, y.default.FORMAT_UNSUPPORTED, "Non-FLV, Unsupported media type"), r = 0; return r } }, { key: "_onMediaInfo", value: function (e) { var t = this; null == this._mediaInfo && (this._mediaInfo = Object.assign({}, e), this._mediaInfo.keyframesIndex = null, this._mediaInfo.segments = [], this._mediaInfo.segmentCount = this._mediaDataSource.segments.length, Object.setPrototypeOf(this._mediaInfo, c.default.prototype)); var n = Object.assign({}, e); Object.setPrototypeOf(n, c.default.prototype), this._mediaInfo.segments[this._currentSegmentIndex] = n, this._reportSegmentMediaInfo(this._currentSegmentIndex), null != this._pendingSeekTime && Promise.resolve().then(function () { var e = t._pendingSeekTime; t._pendingSeekTime = null, t.seek(e) }) } }, { key: "_onMetaDataArrived", value: function (e) { this._emitter.emit(k.default.METADATA_ARRIVED, e) } }, { key: "_onScriptDataArrived", value: function (e) { this._emitter.emit(k.default.SCRIPTDATA_ARRIVED, e) } }, { key: "_onIOSeeked", value: function () { this._remuxer.insertDiscontinuity() } }, { key: "_onIOComplete", value: function (e) { var t = e, n = t + 1; n < this._mediaDataSource.segments.length ? (this._internalAbort(), this._remuxer.flushStashedSamples(), this._loadSegment(n)) : (this._remuxer.flushStashedSamples(), this._emitter.emit(k.default.LOADING_COMPLETE), this._disableStatisticsReporter()) } }, { key: "_onIORedirect", value: function (e) { var t = this._ioctl.extraData; this._mediaDataSource.segments[t].redirectedURL = e } }, { key: "_onIORecoveredEarlyEof", value: function () { this._emitter.emit(k.default.RECOVERED_EARLY_EOF) } }, { key: "_onIOException", value: function (e, t) { l.default.e(this.TAG, "IOException: type = " + e + ", code = " + t.code + ", msg = " + t.msg), this._emitter.emit(k.default.IO_ERROR, e, t), this._disableStatisticsReporter() } }, { key: "_onDemuxException", value: function (e, t) { l.default.e(this.TAG, "DemuxException: type = " + e + ", info = " + t), this._emitter.emit(k.default.DEMUX_ERROR, e, t) } }, { key: "_onRemuxerInitSegmentArrival", value: function (e, t) { this._emitter.emit(k.default.INIT_SEGMENT, e, t) } }, { key: "_onRemuxerMediaSegmentArrival", value: function (e, t) { if (null == this._pendingSeekTime && (this._emitter.emit(k.default.MEDIA_SEGMENT, e, t), null != this._pendingResolveSeekPoint && "video" === e)) { var n = t.info.syncPoints, i = this._pendingResolveSeekPoint; this._pendingResolveSeekPoint = null, h.default.safari && n.length > 0 && n[0].originalDts === i && (i = n[0].pts), this._emitter.emit(k.default.RECOMMEND_SEEKPOINT, i) } } }, { key: "_enableStatisticsReporter", value: function () { null == this._statisticsReporter && (this._statisticsReporter = self.setInterval(this._reportStatisticsInfo.bind(this), this._config.statisticsInfoReportInterval)) } }, { key: "_disableStatisticsReporter", value: function () { this._statisticsReporter && (self.clearInterval(this._statisticsReporter), this._statisticsReporter = null) } }, { key: "_reportSegmentMediaInfo", value: function (e) { var t = this._mediaInfo.segments[e], n = Object.assign({}, t); n.duration = this._mediaInfo.duration, n.segmentCount = this._mediaInfo.segmentCount, delete n.segments, delete n.keyframesIndex, this._emitter.emit(k.default.MEDIA_INFO, n) } }, { key: "_reportStatisticsInfo", value: function () { var e = {}; e.url = this._ioctl.currentURL, e.hasRedirect = this._ioctl.hasRedirect, e.hasRedirect && (e.redirectedURL = this._ioctl.currentRedirectedURL), e.speed = this._ioctl.currentSpeed, e.loaderType = this._ioctl.loaderType, e.currentSegmentIndex = this._currentSegmentIndex, e.totalSegmentCount = this._mediaDataSource.segments.length, this._emitter.emit(k.default.STATISTICS_INFO, e) } }]), e }()); n.default = L }, { "../demux/demux-errors.js": 16, "../demux/flv-demuxer.js": 18, "../io/io-controller.js": 23, "../io/loader.js": 24, "../remux/mp4-remuxer.js": 38, "../utils/browser.js": 39, "../utils/logger.js": 41, "./media-info.js": 7, "./transmuxing-events.js": 13, events: 2 }], 13: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }); var i = { IO_ERROR: "io_error", DEMUX_ERROR: "demux_error", INIT_SEGMENT: "init_segment", MEDIA_SEGMENT: "media_segment", LOADING_COMPLETE: "loading_complete", RECOVERED_EARLY_EOF: "recovered_early_eof", MEDIA_INFO: "media_info", METADATA_ARRIVED: "metadata_arrived", SCRIPTDATA_ARRIVED: "scriptdata_arrived", STATISTICS_INFO: "statistics_info", RECOMMEND_SEEKPOINT: "recommend_seekpoint" }; n.default = i }, {}], 14: [function (e, t, n) { "use strict"; function i(e) { return e && e.__esModule ? e : { default: e } } Object.defineProperty(n, "__esModule", { value: !0 }); var r = e("../utils/logger.js"), s = (i(r), e("../utils/logging-control.js")), a = i(s), o = e("../utils/polyfill.js"), u = i(o), l = e("./transmuxing-controller.js"), d = i(l), h = e("./transmuxing-events.js"), f = i(h), c = function (e) { function t(t, n) { var i = { msg: f.default.INIT_SEGMENT, data: { type: t, data: n } }; e.postMessage(i, [n.data]) } function n(t, n) { var i = { msg: f.default.MEDIA_SEGMENT, data: { type: t, data: n } }; e.postMessage(i, [n.data]) } function i() { var t = { msg: f.default.LOADING_COMPLETE }; e.postMessage(t) } function r() { var t = { msg: f.default.RECOVERED_EARLY_EOF }; e.postMessage(t) } function s(t) { var n = { msg: f.default.MEDIA_INFO, data: t }; e.postMessage(n) } function o(t) { var n = { msg: f.default.METADATA_ARRIVED, data: t }; e.postMessage(n) } function l(t) { var n = { msg: f.default.SCRIPTDATA_ARRIVED, data: t }; e.postMessage(n) } function h(t) { var n = { msg: f.default.STATISTICS_INFO, data: t }; e.postMessage(n) } function c(t, n) { e.postMessage({ msg: f.default.IO_ERROR, data: { type: t, info: n } }) } function _(t, n) { e.postMessage({ msg: f.default.DEMUX_ERROR, data: { type: t, info: n } }) } function m(t) { e.postMessage({ msg: f.default.RECOMMEND_SEEKPOINT, data: t }) } function p(t, n) { e.postMessage({ msg: "logcat_callback", data: { type: t, logcat: n } }) } var v = null, g = p.bind(this); u.default.install(), e.addEventListener("message", function (u) { switch (u.data.cmd) { case "init": v = new d.default(u.data.param[0], u.data.param[1]), v.on(f.default.IO_ERROR, c.bind(this)), v.on(f.default.DEMUX_ERROR, _.bind(this)), v.on(f.default.INIT_SEGMENT, t.bind(this)), v.on(f.default.MEDIA_SEGMENT, n.bind(this)), v.on(f.default.LOADING_COMPLETE, i.bind(this)), v.on(f.default.RECOVERED_EARLY_EOF, r.bind(this)), v.on(f.default.MEDIA_INFO, s.bind(this)), v.on(f.default.METADATA_ARRIVED, o.bind(this)), v.on(f.default.SCRIPTDATA_ARRIVED, l.bind(this)), v.on(f.default.STATISTICS_INFO, h.bind(this)), v.on(f.default.RECOMMEND_SEEKPOINT, m.bind(this)); break; case "destroy": v && (v.destroy(), v = null), e.postMessage({ msg: "destroyed" }); break; case "start": v.start(); break; case "stop": v.stop(); break; case "seek": v.seek(u.data.param); break; case "pause": v.pause(); break; case "resume": v.resume(); break; case "logging_config": var p = u.data.param; a.default.applyConfig(p), !0 === p.enableCallback ? a.default.addLogListener(g) : a.default.removeLogListener(g) } }) }; n.default = c }, { "../utils/logger.js": 41, "../utils/logging-control.js": 42, "../utils/polyfill.js": 43, "./transmuxing-controller.js": 12, "./transmuxing-events.js": 13 }], 15: [function (e, t, n) { "use strict"; function i(e) { return e && e.__esModule ? e : { default: e } } function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(n, "__esModule", { value: !0 }); var s = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), a = e("../utils/logger.js"), o = i(a), u = e("../utils/utf8-conv.js"), l = i(u), d = e("../utils/exception.js"), h = function () { var e = new ArrayBuffer(2); return new DataView(e).setInt16(0, 256, !0), 256 === new Int16Array(e)[0] }(), f = function () { function e() { r(this, e) } return s(e, null, [{ key: "parseScriptData", value: function (t, n, i) { var r = {}; try { var s = e.parseValue(t, n, i), a = e.parseValue(t, n + s.size, i - s.size); r[s.data] = a.data } catch (e) { o.default.e("AMF", e.toString()) } return r } }, { key: "parseObject", value: function (t, n, i) { if (i < 3) throw new d.IllegalStateException("Data not enough when parse ScriptDataObject"); var r = e.parseString(t, n, i), s = e.parseValue(t, n + r.size, i - r.size), a = s.objectEnd; return { data: { name: r.data, value: s.data }, size: r.size + s.size, objectEnd: a } } }, { key: "parseVariable", value: function (t, n, i) { return e.parseObject(t, n, i) } }, { key: "parseString", value: function (e, t, n) { if (n < 2) throw new d.IllegalStateException("Data not enough when parse String"); var i = new DataView(e, t, n), r = i.getUint16(0, !h), s = void 0; return s = r > 0 ? (0, l.default)(new Uint8Array(e, t + 2, r)) : "", { data: s, size: 2 + r } } }, { key: "parseLongString", value: function (e, t, n) { if (n < 4) throw new d.IllegalStateException("Data not enough when parse LongString"); var i = new DataView(e, t, n), r = i.getUint32(0, !h), s = void 0; return s = r > 0 ? (0, l.default)(new Uint8Array(e, t + 4, r)) : "", { data: s, size: 4 + r } } }, { key: "parseDate", value: function (e, t, n) { if (n < 10) throw new d.IllegalStateException("Data size invalid when parse Date"); var i = new DataView(e, t, n), r = i.getFloat64(0, !h); return r += 60 * i.getInt16(8, !h) * 1e3, { data: new Date(r), size: 10 } } }, { key: "parseValue", value: function (t, n, i) { if (i < 1) throw new d.IllegalStateException("Data not enough when parse Value"); var r = new DataView(t, n, i), s = 1, a = r.getUint8(0), u = void 0, l = !1; try { switch (a) { case 0: u = r.getFloat64(1, !h), s += 8; break; case 1: u = !!r.getUint8(1), s += 1; break; case 2: var f = e.parseString(t, n + 1, i - 1); u = f.data, s += f.size; break; case 3: u = {}; var c = 0; for (9 == (16777215 & r.getUint32(i - 4, !h)) && (c = 3); s < i - 4;) { var _ = e.parseObject(t, n + s, i - s - c); if (_.objectEnd) break; u[_.data.name] = _.data.value, s += _.size } if (s <= i - 3) { 9 === (16777215 & r.getUint32(s - 1, !h)) && (s += 3) } break; case 8: u = {}, s += 4; var m = 0; for (9 == (16777215 & r.getUint32(i - 4, !h)) && (m = 3); s < i - 8;) { var p = e.parseVariable(t, n + s, i - s - m); if (p.objectEnd) break; u[p.data.name] = p.data.value, s += p.size } if (s <= i - 3) { 9 === (16777215 & r.getUint32(s - 1, !h)) && (s += 3) } break; case 9: u = void 0, s = 1, l = !0; break; case 10: u = []; var v = r.getUint32(1, !h); s += 4; for (var g = 0; g < v; g++) { var y = e.parseValue(t, n + s, i - s); u.push(y.data), s += y.size } break; case 11: var E = e.parseDate(t, n + 1, i - 1); u = E.data, s += E.size; break; case 12: var b = e.parseString(t, n + 1, i - 1); u = b.data, s += b.size; break; default: s = i, o.default.w("AMF", "Unsupported AMF value type " + a) } } catch (e) { o.default.e("AMF", e.toString()) } return { data: u, size: s, objectEnd: l } } }]), e }(); n.default = f }, { "../utils/exception.js": 40, "../utils/logger.js": 41, "../utils/utf8-conv.js": 44 }], 16: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }); var i = { OK: "OK", FORMAT_ERROR: "FormatError", FORMAT_UNSUPPORTED: "FormatUnsupported", CODEC_UNSUPPORTED: "CodecUnsupported" }; n.default = i }, {}], 17: [function (e, t, n) { "use strict"; function i(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(n, "__esModule", { value: !0 }); var r = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), s = e("../utils/exception.js"), a = function () { function e(t) { i(this, e), this.TAG = "ExpGolomb", this._buffer = t, this._buffer_index = 0, this._total_bytes = t.byteLength, this._total_bits = 8 * t.byteLength, this._current_word = 0, this._current_word_bits_left = 0 } return r(e, [{ key: "destroy", value: function () { this._buffer = null } }, { key: "_fillCurrentWord", value: function () { var e = this._total_bytes - this._buffer_index; if (e <= 0) throw new s.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available"); var t = Math.min(4, e), n = new Uint8Array(4); n.set(this._buffer.subarray(this._buffer_index, this._buffer_index + t)), this._current_word = new DataView(n.buffer).getUint32(0, !1), this._buffer_index += t, this._current_word_bits_left = 8 * t } }, { key: "readBits", value: function (e) { if (e > 32) throw new s.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!"); if (e <= this._current_word_bits_left) { var t = this._current_word >>> 32 - e; return this._current_word <<= e, this._current_word_bits_left -= e, t } var n = this._current_word_bits_left ? this._current_word : 0; n >>>= 32 - this._current_word_bits_left; var i = e - this._current_word_bits_left; this._fillCurrentWord(); var r = Math.min(i, this._current_word_bits_left), a = this._current_word >>> 32 - r; return this._current_word <<= r, this._current_word_bits_left -= r, n = n << r | a } }, { key: "readBool", value: function () { return 1 === this.readBits(1) } }, { key: "readByte", value: function () { return this.readBits(8) } }, { key: "_skipLeadingZero", value: function () { var e = void 0; for (e = 0; e < this._current_word_bits_left; e++)if (0 != (this._current_word & 2147483648 >>> e)) return this._current_word <<= e, this._current_word_bits_left -= e, e; return this._fillCurrentWord(), e + this._skipLeadingZero() } }, { key: "readUEG", value: function () { var e = this._skipLeadingZero(); return this.readBits(e + 1) - 1 } }, { key: "readSEG", value: function () { var e = this.readUEG(); return 1 & e ? e + 1 >>> 1 : -1 * (e >>> 1) } }]), e }(); n.default = a }, { "../utils/exception.js": 40 }], 18: [function (e, t, n) {
            "use strict"; function i(e) { return e && e.__esModule ? e : { default: e } } function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function s(e, t) { return e[t] << 24 | e[t + 1] << 16 | e[t + 2] << 8 | e[t + 3] } Object.defineProperty(n, "__esModule", { value: !0 }); var a = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, o = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), u = e("../utils/logger.js"), l = i(u), d = e("./amf-parser.js"), h = i(d), f = e("./sps-parser.js"), c = i(f), _ = e("./demux-errors.js"), m = i(_), p = e("../core/media-info.js"), v = i(p), g = e("../utils/exception.js"), y = function () {
                function e(t, n) { r(this, e), this.TAG = "FLVDemuxer", this._config = n, this._onError = null, this._onMediaInfo = null, this._onMetaDataArrived = null, this._onScriptDataArrived = null, this._onTrackMetadata = null, this._onDataAvailable = null, this._dataOffset = t.dataOffset, this._firstParse = !0, this._dispatch = !1, this._hasAudio = t.hasAudioTrack, this._hasVideo = t.hasVideoTrack, this._hasAudioFlagOverrided = !1, this._hasVideoFlagOverrided = !1, this._audioInitialMetadataDispatched = !1, this._videoInitialMetadataDispatched = !1, this._mediaInfo = new v.default, this._mediaInfo.hasAudio = this._hasAudio, this._mediaInfo.hasVideo = this._hasVideo, this._metadata = null, this._audioMetadata = null, this._videoMetadata = null, this._naluLengthSize = 4, this._timestampBase = 0, this._timescale = 1e3, this._duration = 0, this._durationOverrided = !1, this._referenceFrameRate = { fixed: !0, fps: 23.976, fps_num: 23976, fps_den: 1e3 }, this._flvSoundRateTable = [5500, 11025, 22050, 44100, 48e3], this._mpegSamplingRates = [96e3, 88200, 64e3, 48e3, 44100, 32e3, 24e3, 22050, 16e3, 12e3, 11025, 8e3, 7350], this._mpegAudioV10SampleRateTable = [44100, 48e3, 32e3, 0], this._mpegAudioV20SampleRateTable = [22050, 24e3, 16e3, 0], this._mpegAudioV25SampleRateTable = [11025, 12e3, 8e3, 0], this._mpegAudioL1BitRateTable = [0, 32, 64, 96, 128, 160, 192, 224, 256, 288, 320, 352, 384, 416, 448, -1], this._mpegAudioL2BitRateTable = [0, 32, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 384, -1], this._mpegAudioL3BitRateTable = [0, 32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, -1], this._videoTrack = { type: "video", id: 1, sequenceNumber: 0, samples: [], length: 0 }, this._audioTrack = { type: "audio", id: 2, sequenceNumber: 0, samples: [], length: 0 }, this._littleEndian = function () { var e = new ArrayBuffer(2); return new DataView(e).setInt16(0, 256, !0), 256 === new Int16Array(e)[0] }() } return o(e, [{ key: "destroy", value: function () { this._mediaInfo = null, this._metadata = null, this._audioMetadata = null, this._videoMetadata = null, this._videoTrack = null, this._audioTrack = null, this._onError = null, this._onMediaInfo = null, this._onMetaDataArrived = null, this._onScriptDataArrived = null, this._onTrackMetadata = null, this._onDataAvailable = null } }, { key: "bindDataSource", value: function (e) { return e.onDataArrival = this.parseChunks.bind(this), this } }, { key: "resetMediaInfo", value: function () { this._mediaInfo = new v.default } }, { key: "_isInitialMetadataDispatched", value: function () { return this._hasAudio && this._hasVideo ? this._audioInitialMetadataDispatched && this._videoInitialMetadataDispatched : this._hasAudio && !this._hasVideo ? this._audioInitialMetadataDispatched : !(this._hasAudio || !this._hasVideo) && this._videoInitialMetadataDispatched } }, { key: "parseChunks", value: function (t, n) { if (!(this._onError && this._onMediaInfo && this._onTrackMetadata && this._onDataAvailable)) throw new g.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified"); var i = 0, r = this._littleEndian; if (0 === n) { if (!(t.byteLength > 13)) return 0; i = e.probe(t).dataOffset } if (this._firstParse) { this._firstParse = !1, n + i !== this._dataOffset && l.default.w(this.TAG, "First time parsing but chunk byteStart invalid!"); 0 !== new DataView(t, i).getUint32(0, !r) && l.default.w(this.TAG, "PrevTagSize0 !== 0 !!!"), i += 4 } for (; i < t.byteLength;) { this._dispatch = !0; var s = new DataView(t, i); if (i + 11 + 4 > t.byteLength) break; var a = s.getUint8(0), o = 16777215 & s.getUint32(0, !r); if (i + 11 + o + 4 > t.byteLength) break; if (8 === a || 9 === a || 18 === a) { var u = s.getUint8(4), d = s.getUint8(5), h = s.getUint8(6), f = s.getUint8(7), c = h | d << 8 | u << 16 | f << 24; 0 !== (16777215 & s.getUint32(7, !r)) && l.default.w(this.TAG, "Meet tag which has StreamID != 0!"); var _ = i + 11; switch (a) { case 8: this._parseAudioData(t, _, o, c); break; case 9: this._parseVideoData(t, _, o, c, n + i); break; case 18: this._parseScriptData(t, _, o) }var m = s.getUint32(11 + o, !r); m !== 11 + o && l.default.w(this.TAG, "Invalid PrevTagSize " + m), i += 11 + o + 4 } else l.default.w(this.TAG, "Unsupported tag type " + a + ", skipped"), i += 11 + o + 4 } return this._isInitialMetadataDispatched() && this._dispatch && (this._audioTrack.length || this._videoTrack.length) && this._onDataAvailable(this._audioTrack, this._videoTrack), i } }, { key: "_parseScriptData", value: function (e, t, n) { var i = h.default.parseScriptData(e, t, n); if (i.hasOwnProperty("onMetaData")) { if (null == i.onMetaData || "object" !== a(i.onMetaData)) return void l.default.w(this.TAG, "Invalid onMetaData structure!"); this._metadata && l.default.w(this.TAG, "Found another onMetaData tag!"), this._metadata = i; var r = this._metadata.onMetaData; if (this._onMetaDataArrived && this._onMetaDataArrived(Object.assign({}, r)), "boolean" == typeof r.hasAudio && !1 === this._hasAudioFlagOverrided && (this._hasAudio = r.hasAudio, this._mediaInfo.hasAudio = this._hasAudio), "boolean" == typeof r.hasVideo && !1 === this._hasVideoFlagOverrided && (this._hasVideo = r.hasVideo, this._mediaInfo.hasVideo = this._hasVideo), "number" == typeof r.audiodatarate && (this._mediaInfo.audioDataRate = r.audiodatarate), "number" == typeof r.videodatarate && (this._mediaInfo.videoDataRate = r.videodatarate), "number" == typeof r.width && (this._mediaInfo.width = r.width), "number" == typeof r.height && (this._mediaInfo.height = r.height), "number" == typeof r.duration) { if (!this._durationOverrided) { var s = Math.floor(r.duration * this._timescale); this._duration = s, this._mediaInfo.duration = s } } else this._mediaInfo.duration = 0; if ("number" == typeof r.framerate) { var o = Math.floor(1e3 * r.framerate); if (o > 0) { var u = o / 1e3; this._referenceFrameRate.fixed = !0, this._referenceFrameRate.fps = u, this._referenceFrameRate.fps_num = o, this._referenceFrameRate.fps_den = 1e3, this._mediaInfo.fps = u } } if ("object" === a(r.keyframes)) { this._mediaInfo.hasKeyframesIndex = !0; var d = r.keyframes; this._mediaInfo.keyframesIndex = this._parseKeyframesIndex(d), r.keyframes = null } else this._mediaInfo.hasKeyframesIndex = !1; this._dispatch = !1, this._mediaInfo.metadata = r, l.default.v(this.TAG, "Parsed onMetaData"), this._mediaInfo.isComplete() && this._onMediaInfo(this._mediaInfo) } Object.keys(i).length > 0 && this._onScriptDataArrived && this._onScriptDataArrived(Object.assign({}, i)) } }, { key: "_parseKeyframesIndex", value: function (e) { for (var t = [], n = [], i = 1; i < e.times.length; i++) { var r = this._timestampBase + Math.floor(1e3 * e.times[i]); t.push(r), n.push(e.filepositions[i]) } return { times: t, filepositions: n } } }, {
                    key: "_parseAudioData", value: function (e, t, n, i) {
                        if (n <= 1) return void l.default.w(this.TAG, "Flv: Invalid audio packet, missing SoundData payload!"); if (!0 !== this._hasAudioFlagOverrided || !1 !== this._hasAudio) {
                            var r = (this._littleEndian, new DataView(e, t, n)), s = r.getUint8(0), a = s >>> 4; if (2 !== a && 10 !== a) return void this._onError(m.default.CODEC_UNSUPPORTED, "Flv: Unsupported audio codec idx: " + a); var o = 0, u = (12 & s) >>> 2; if (!(u >= 0 && u <= 4)) return void this._onError(m.default.FORMAT_ERROR, "Flv: Invalid audio sample rate idx: " + u); o = this._flvSoundRateTable[u]; var d = 1 & s, h = this._audioMetadata, f = this._audioTrack; if (h || (!1 === this._hasAudio && !1 === this._hasAudioFlagOverrided && (this._hasAudio = !0, this._mediaInfo.hasAudio = !0), h = this._audioMetadata = {}, h.type = "audio", h.id = f.id, h.timescale = this._timescale, h.duration = this._duration, h.audioSampleRate = o, h.channelCount = 0 === d ? 1 : 2), 10 === a) {
                                var c = this._parseAACAudioData(e, t + 1, n - 1); if (void 0 == c) return; if (0 === c.packetType) {
                                    h.config && l.default.w(this.TAG, "Found another AudioSpecificConfig!"); var _ = c.data; h.audioSampleRate = _.samplingRate, h.channelCount = _.channelCount, h.codec = _.codec, h.originalCodec = _.originalCodec, h.config = _.config,
                                        h.refSampleDuration = 1024 / h.audioSampleRate * h.timescale, l.default.v(this.TAG, "Parsed AudioSpecificConfig"), this._isInitialMetadataDispatched() ? this._dispatch && (this._audioTrack.length || this._videoTrack.length) && this._onDataAvailable(this._audioTrack, this._videoTrack) : this._audioInitialMetadataDispatched = !0, this._dispatch = !1, this._onTrackMetadata("audio", h); var p = this._mediaInfo; p.audioCodec = h.originalCodec, p.audioSampleRate = h.audioSampleRate, p.audioChannelCount = h.channelCount, p.hasVideo ? null != p.videoCodec && (p.mimeType = 'video/x-flv; codecs="' + p.videoCodec + "," + p.audioCodec + '"') : p.mimeType = 'video/x-flv; codecs="' + p.audioCodec + '"', p.isComplete() && this._onMediaInfo(p)
                                } else if (1 === c.packetType) { var v = this._timestampBase + i, g = { unit: c.data, length: c.data.byteLength, dts: v, pts: v }; f.samples.push(g), f.length += c.data.length } else l.default.e(this.TAG, "Flv: Unsupported AAC data type " + c.packetType)
                            } else if (2 === a) { if (!h.codec) { var y = this._parseMP3AudioData(e, t + 1, n - 1, !0); if (void 0 == y) return; h.audioSampleRate = y.samplingRate, h.channelCount = y.channelCount, h.codec = y.codec, h.originalCodec = y.originalCodec, h.refSampleDuration = 1152 / h.audioSampleRate * h.timescale, l.default.v(this.TAG, "Parsed MPEG Audio Frame Header"), this._audioInitialMetadataDispatched = !0, this._onTrackMetadata("audio", h); var E = this._mediaInfo; E.audioCodec = h.codec, E.audioSampleRate = h.audioSampleRate, E.audioChannelCount = h.channelCount, E.audioDataRate = y.bitRate, E.hasVideo ? null != E.videoCodec && (E.mimeType = 'video/x-flv; codecs="' + E.videoCodec + "," + E.audioCodec + '"') : E.mimeType = 'video/x-flv; codecs="' + E.audioCodec + '"', E.isComplete() && this._onMediaInfo(E) } var b = this._parseMP3AudioData(e, t + 1, n - 1, !1); if (void 0 == b) return; var S = this._timestampBase + i, k = { unit: b, length: b.byteLength, dts: S, pts: S }; f.samples.push(k), f.length += b.length }
                        }
                    }
                }, { key: "_parseAACAudioData", value: function (e, t, n) { if (n <= 1) return void l.default.w(this.TAG, "Flv: Invalid AAC packet, missing AACPacketType or/and Data!"); var i = {}, r = new Uint8Array(e, t, n); return i.packetType = r[0], 0 === r[0] ? i.data = this._parseAACAudioSpecificConfig(e, t + 1, n - 1) : i.data = r.subarray(1), i } }, { key: "_parseAACAudioSpecificConfig", value: function (e, t, n) { var i = new Uint8Array(e, t, n), r = null, s = 0, a = 0, o = 0, u = null; if (s = a = i[0] >>> 3, (o = (7 & i[0]) << 1 | i[1] >>> 7) < 0 || o >= this._mpegSamplingRates.length) return void this._onError(m.default.FORMAT_ERROR, "Flv: AAC invalid sampling frequency index!"); var l = this._mpegSamplingRates[o], d = (120 & i[1]) >>> 3; if (d < 0 || d >= 8) return void this._onError(m.default.FORMAT_ERROR, "Flv: AAC invalid channel configuration"); 5 === s && (u = (7 & i[1]) << 1 | i[2] >>> 7, i[2]); var h = self.navigator.userAgent.toLowerCase(); return -1 !== h.indexOf("firefox") ? o >= 6 ? (s = 5, r = new Array(4), u = o - 3) : (s = 2, r = new Array(2), u = o) : -1 !== h.indexOf("android") ? (s = 2, r = new Array(2), u = o) : (s = 5, u = o, r = new Array(4), o >= 6 ? u = o - 3 : 1 === d && (s = 2, r = new Array(2), u = o)), r[0] = s << 3, r[0] |= (15 & o) >>> 1, r[1] = (15 & o) << 7, r[1] |= (15 & d) << 3, 5 === s && (r[1] |= (15 & u) >>> 1, r[2] = (1 & u) << 7, r[2] |= 8, r[3] = 0), { config: r, samplingRate: l, channelCount: d, codec: "mp4a.40." + s, originalCodec: "mp4a.40." + a } } }, { key: "_parseMP3AudioData", value: function (e, t, n, i) { if (n < 4) return void l.default.w(this.TAG, "Flv: Invalid MP3 packet, header missing!"); var r = (this._littleEndian, new Uint8Array(e, t, n)), s = null; if (i) { if (255 !== r[0]) return; var a = r[1] >>> 3 & 3, o = (6 & r[1]) >> 1, u = (240 & r[2]) >>> 4, d = (12 & r[2]) >>> 2, h = r[3] >>> 6 & 3, f = 3 !== h ? 2 : 1, c = 0, _ = 0; switch (a) { case 0: c = this._mpegAudioV25SampleRateTable[d]; break; case 2: c = this._mpegAudioV20SampleRateTable[d]; break; case 3: c = this._mpegAudioV10SampleRateTable[d] }switch (o) { case 1: 34, u < this._mpegAudioL3BitRateTable.length && (_ = this._mpegAudioL3BitRateTable[u]); break; case 2: 33, u < this._mpegAudioL2BitRateTable.length && (_ = this._mpegAudioL2BitRateTable[u]); break; case 3: 32, u < this._mpegAudioL1BitRateTable.length && (_ = this._mpegAudioL1BitRateTable[u]) }s = { bitRate: _, samplingRate: c, channelCount: f, codec: "mp3", originalCodec: "mp3" } } else s = r; return s } }, { key: "_parseVideoData", value: function (e, t, n, i, r) { if (n <= 1) return void l.default.w(this.TAG, "Flv: Invalid video packet, missing VideoData payload!"); if (!0 !== this._hasVideoFlagOverrided || !1 !== this._hasVideo) { var s = new Uint8Array(e, t, n)[0], a = (240 & s) >>> 4, o = 15 & s; if (7 !== o) return void this._onError(m.default.CODEC_UNSUPPORTED, "Flv: Unsupported codec in video frame: " + o); this._parseAVCVideoPacket(e, t + 1, n - 1, i, r, a) } } }, { key: "_parseAVCVideoPacket", value: function (e, t, n, i, r, s) { if (n < 4) return void l.default.w(this.TAG, "Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime"); var a = this._littleEndian, o = new DataView(e, t, n), u = o.getUint8(0), d = 16777215 & o.getUint32(0, !a), h = d << 8 >> 8; if (0 === u) this._parseAVCDecoderConfigurationRecord(e, t + 4, n - 4); else if (1 === u) this._parseAVCVideoData(e, t + 4, n - 4, i, r, s, h); else if (2 !== u) return void this._onError(m.default.FORMAT_ERROR, "Flv: Invalid video packet type " + u) } }, { key: "_parseAVCDecoderConfigurationRecord", value: function (e, t, n) { if (n < 7) return void l.default.w(this.TAG, "Flv: Invalid AVCDecoderConfigurationRecord, lack of data!"); var i = this._videoMetadata, r = this._videoTrack, s = this._littleEndian, a = new DataView(e, t, n); i ? void 0 !== i.avcc && l.default.w(this.TAG, "Found another AVCDecoderConfigurationRecord!") : (!1 === this._hasVideo && !1 === this._hasVideoFlagOverrided && (this._hasVideo = !0, this._mediaInfo.hasVideo = !0), i = this._videoMetadata = {}, i.type = "video", i.id = r.id, i.timescale = this._timescale, i.duration = this._duration); var o = a.getUint8(0), u = a.getUint8(1); a.getUint8(2), a.getUint8(3); if (1 !== o || 0 === u) return void this._onError(m.default.FORMAT_ERROR, "Flv: Invalid AVCDecoderConfigurationRecord"); if (this._naluLengthSize = 1 + (3 & a.getUint8(4)), 3 !== this._naluLengthSize && 4 !== this._naluLengthSize) return void this._onError(m.default.FORMAT_ERROR, "Flv: Strange NaluLengthSizeMinusOne: " + (this._naluLengthSize - 1)); var d = 31 & a.getUint8(5); if (0 === d) return void this._onError(m.default.FORMAT_ERROR, "Flv: Invalid AVCDecoderConfigurationRecord: No SPS"); d > 1 && l.default.w(this.TAG, "Flv: Strange AVCDecoderConfigurationRecord: SPS Count = " + d); for (var h = 6, f = 0; f < d; f++) { var _ = a.getUint16(h, !s); if (h += 2, 0 !== _) { var p = new Uint8Array(e, t + h, _); h += _; var v = c.default.parseSPS(p); if (0 === f) { i.codecWidth = v.codec_size.width, i.codecHeight = v.codec_size.height, i.presentWidth = v.present_size.width, i.presentHeight = v.present_size.height, i.profile = v.profile_string, i.level = v.level_string, i.bitDepth = v.bit_depth, i.chromaFormat = v.chroma_format, i.sarRatio = v.sar_ratio, i.frameRate = v.frame_rate, !1 !== v.frame_rate.fixed && 0 !== v.frame_rate.fps_num && 0 !== v.frame_rate.fps_den || (i.frameRate = this._referenceFrameRate); var g = i.frameRate.fps_den, y = i.frameRate.fps_num; i.refSampleDuration = i.timescale * (g / y); for (var E = p.subarray(1, 4), b = "avc1.", S = 0; S < 3; S++) { var k = E[S].toString(16); k.length < 2 && (k = "0" + k), b += k } i.codec = b; var L = this._mediaInfo; L.width = i.codecWidth, L.height = i.codecHeight, L.fps = i.frameRate.fps, L.profile = i.profile, L.level = i.level, L.refFrames = v.ref_frames, L.chromaFormat = v.chroma_format_string, L.sarNum = i.sarRatio.width, L.sarDen = i.sarRatio.height, L.videoCodec = b, L.hasAudio ? null != L.audioCodec && (L.mimeType = 'video/x-flv; codecs="' + L.videoCodec + "," + L.audioCodec + '"') : L.mimeType = 'video/x-flv; codecs="' + L.videoCodec + '"', L.isComplete() && this._onMediaInfo(L) } } } var R = a.getUint8(h); if (0 === R) return void this._onError(m.default.FORMAT_ERROR, "Flv: Invalid AVCDecoderConfigurationRecord: No PPS"); R > 1 && l.default.w(this.TAG, "Flv: Strange AVCDecoderConfigurationRecord: PPS Count = " + R), h++; for (var A = 0; A < R; A++) { var w = a.getUint16(h, !s); h += 2, 0 !== w && (h += w) } i.avcc = new Uint8Array(n), i.avcc.set(new Uint8Array(e, t, n), 0), l.default.v(this.TAG, "Parsed AVCDecoderConfigurationRecord"), this._isInitialMetadataDispatched() ? this._dispatch && (this._audioTrack.length || this._videoTrack.length) && this._onDataAvailable(this._audioTrack, this._videoTrack) : this._videoInitialMetadataDispatched = !0, this._dispatch = !1, this._onTrackMetadata("video", i) } }, { key: "_parseAVCVideoData", value: function (e, t, n, i, r, s, a) { for (var o = this._littleEndian, u = new DataView(e, t, n), d = [], h = 0, f = 0, c = this._naluLengthSize, _ = this._timestampBase + i, m = 1 === s; f < n;) { if (f + 4 >= n) { l.default.w(this.TAG, "Malformed Nalu near timestamp " + _ + ", offset = " + f + ", dataSize = " + n); break } var p = u.getUint32(f, !o); if (3 === c && (p >>>= 8), p > n - c) return void l.default.w(this.TAG, "Malformed Nalus near timestamp " + _ + ", NaluSize > DataSize!"); var v = 31 & u.getUint8(f + c); 5 === v && (m = !0); var g = new Uint8Array(e, t + f, c + p), y = { type: v, data: g }; d.push(y), h += g.byteLength, f += c + p } if (d.length) { var E = this._videoTrack, b = { units: d, length: h, isKeyframe: m, dts: _, cts: a, pts: _ + a }; m && (b.fileposition = r), E.samples.push(b), E.length += h } } }, { key: "onTrackMetadata", get: function () { return this._onTrackMetadata }, set: function (e) { this._onTrackMetadata = e } }, { key: "onMediaInfo", get: function () { return this._onMediaInfo }, set: function (e) { this._onMediaInfo = e } }, { key: "onMetaDataArrived", get: function () { return this._onMetaDataArrived }, set: function (e) { this._onMetaDataArrived = e } }, { key: "onScriptDataArrived", get: function () { return this._onScriptDataArrived }, set: function (e) { this._onScriptDataArrived = e } }, { key: "onError", get: function () { return this._onError }, set: function (e) { this._onError = e } }, { key: "onDataAvailable", get: function () { return this._onDataAvailable }, set: function (e) { this._onDataAvailable = e } }, { key: "timestampBase", get: function () { return this._timestampBase }, set: function (e) { this._timestampBase = e } }, { key: "overridedDuration", get: function () { return this._duration }, set: function (e) { this._durationOverrided = !0, this._duration = e, this._mediaInfo.duration = e } }, { key: "overridedHasAudio", set: function (e) { this._hasAudioFlagOverrided = !0, this._hasAudio = e, this._mediaInfo.hasAudio = e } }, { key: "overridedHasVideo", set: function (e) { this._hasVideoFlagOverrided = !0, this._hasVideo = e, this._mediaInfo.hasVideo = e } }], [{ key: "probe", value: function (e) { var t = new Uint8Array(e), n = { match: !1 }; if (70 !== t[0] || 76 !== t[1] || 86 !== t[2] || 1 !== t[3]) return n; var i = (4 & t[4]) >>> 2 != 0, r = 0 != (1 & t[4]), a = s(t, 5); return a < 9 ? n : { match: !0, consumed: a, dataOffset: a, hasAudioTrack: i, hasVideoTrack: r } } }]), e
            }(); n.default = y
        }, { "../core/media-info.js": 7, "../utils/exception.js": 40, "../utils/logger.js": 41, "./amf-parser.js": 15, "./demux-errors.js": 16, "./sps-parser.js": 19 }], 19: [function (e, t, n) { "use strict"; function i(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(n, "__esModule", { value: !0 }); var r = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), s = e("./exp-golomb.js"), a = function (e) { return e && e.__esModule ? e : { default: e } }(s), o = function () { function e() { i(this, e) } return r(e, null, [{ key: "_ebsp2rbsp", value: function (e) { for (var t = e, n = t.byteLength, i = new Uint8Array(n), r = 0, s = 0; s < n; s++)s >= 2 && 3 === t[s] && 0 === t[s - 1] && 0 === t[s - 2] || (i[r] = t[s], r++); return new Uint8Array(i.buffer, 0, r) } }, { key: "parseSPS", value: function (t) { var n = e._ebsp2rbsp(t), i = new a.default(n); i.readByte(); var r = i.readByte(); i.readByte(); var s = i.readByte(); i.readUEG(); var o = e.getProfileString(r), u = e.getLevelString(s), l = 1, d = 420, h = [0, 420, 422, 444], f = 8; if ((100 === r || 110 === r || 122 === r || 244 === r || 44 === r || 83 === r || 86 === r || 118 === r || 128 === r || 138 === r || 144 === r) && (l = i.readUEG(), 3 === l && i.readBits(1), l <= 3 && (d = h[l]), f = i.readUEG() + 8, i.readUEG(), i.readBits(1), i.readBool())) for (var c = 3 !== l ? 8 : 12, _ = 0; _ < c; _++)i.readBool() && (_ < 6 ? e._skipScalingList(i, 16) : e._skipScalingList(i, 64)); i.readUEG(); var m = i.readUEG(); if (0 === m) i.readUEG(); else if (1 === m) { i.readBits(1), i.readSEG(), i.readSEG(); for (var p = i.readUEG(), v = 0; v < p; v++)i.readSEG() } var g = i.readUEG(); i.readBits(1); var y = i.readUEG(), E = i.readUEG(), b = i.readBits(1); 0 === b && i.readBits(1), i.readBits(1); var S = 0, k = 0, L = 0, R = 0; i.readBool() && (S = i.readUEG(), k = i.readUEG(), L = i.readUEG(), R = i.readUEG()); var A = 1, w = 1, T = 0, O = !0, C = 0, I = 0; if (i.readBool()) { if (i.readBool()) { var D = i.readByte(), x = [1, 12, 10, 16, 40, 24, 20, 32, 80, 18, 15, 64, 160, 4, 3, 2], M = [1, 11, 11, 11, 33, 11, 11, 11, 33, 11, 11, 33, 99, 3, 2, 1]; D > 0 && D < 16 ? (A = x[D - 1], w = M[D - 1]) : 255 === D && (A = i.readByte() << 8 | i.readByte(), w = i.readByte() << 8 | i.readByte()) } if (i.readBool() && i.readBool(), i.readBool() && (i.readBits(4), i.readBool() && i.readBits(24)), i.readBool() && (i.readUEG(), i.readUEG()), i.readBool()) { var B = i.readBits(32), j = i.readBits(32); O = i.readBool(), C = j, I = 2 * B, T = C / I } } var P = 1; 1 === A && 1 === w || (P = A / w); var U = 0, N = 0; if (0 === l) U = 1, N = 2 - b; else { var F = 3 === l ? 1 : 2, G = 1 === l ? 2 : 1; U = F, N = G * (2 - b) } var V = 16 * (y + 1), z = 16 * (E + 1) * (2 - b); V -= (S + k) * U, z -= (L + R) * N; var H = Math.ceil(V * P); return i.destroy(), i = null, { profile_string: o, level_string: u, bit_depth: f, ref_frames: g, chroma_format: d, chroma_format_string: e.getChromaFormatString(d), frame_rate: { fixed: O, fps: T, fps_den: I, fps_num: C }, sar_ratio: { width: A, height: w }, codec_size: { width: V, height: z }, present_size: { width: H, height: z } } } }, { key: "_skipScalingList", value: function (e, t) { for (var n = 8, i = 8, r = 0, s = 0; s < t; s++)0 !== i && (r = e.readSEG(), i = (n + r + 256) % 256), n = 0 === i ? n : i } }, { key: "getProfileString", value: function (e) { switch (e) { case 66: return "Baseline"; case 77: return "Main"; case 88: return "Extended"; case 100: return "High"; case 110: return "High10"; case 122: return "High422"; case 244: return "High444"; default: return "Unknown" } } }, { key: "getLevelString", value: function (e) { return (e / 10).toFixed(1) } }, { key: "getChromaFormatString", value: function (e) { switch (e) { case 420: return "4:2:0"; case 422: return "4:2:2"; case 444: return "4:4:4"; default: return "Unknown" } } }]), e }(); n.default = o }, { "./exp-golomb.js": 17 }], 20: [function (e, t, n) { "use strict"; function i(e) { return e && e.__esModule ? e : { default: e } } function r(e, t) { var n = e; if (null == n || "object" !== (void 0 === n ? "undefined" : o(n))) throw new S.InvalidArgumentException("MediaDataSource must be an javascript object!"); if (!n.hasOwnProperty("type")) throw new S.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!"); switch (n.type) { case "flv": return new _.default(n, t); default: return new p.default(n, t) } } function s() { return h.default.supportMSEH264Playback() } function a() { return h.default.getFeatureList() } Object.defineProperty(n, "__esModule", { value: !0 }); var o = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, u = e("./utils/polyfill.js"), l = i(u), d = e("./core/features.js"), h = i(d), f = e("./io/loader.js"), c = e("./player/flv-player.js"), _ = i(c), m = e("./player/native-player.js"), p = i(m), v = e("./player/player-events.js"), g = i(v), y = e("./player/player-errors.js"), E = e("./utils/logging-control.js"), b = i(E), S = e("./utils/exception.js"); l.default.install(); var k = {}; k.createPlayer = r, k.isSupported = s, k.getFeatureList = a, k.BaseLoader = f.BaseLoader, k.LoaderStatus = f.LoaderStatus, k.LoaderErrors = f.LoaderErrors, k.Events = g.default, k.ErrorTypes = y.ErrorTypes, k.ErrorDetails = y.ErrorDetails, k.FlvPlayer = _.default, k.NativePlayer = p.default, k.LoggingControl = b.default, Object.defineProperty(k, "version", { enumerable: !0, get: function () { return "1.5.0" } }), n.default = k }, { "./core/features.js": 6, "./io/loader.js": 24, "./player/flv-player.js": 32, "./player/native-player.js": 33, "./player/player-errors.js": 34, "./player/player-events.js": 35, "./utils/exception.js": 40, "./utils/logging-control.js": 42, "./utils/polyfill.js": 43 }], 21: [function (e, t, n) { "use strict"; t.exports = e("./flv.js").default }, { "./flv.js": 20 }], 22: [function (e, t, n) { "use strict"; function i(e) { return e && e.__esModule ? e : { default: e } } function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function s(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t } function a(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) } Object.defineProperty(n, "__esModule", { value: !0 }); var o = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, u = function e(t, n, i) { null === t && (t = Function.prototype); var r = Object.getOwnPropertyDescriptor(t, n); if (void 0 === r) { var s = Object.getPrototypeOf(t); return null === s ? void 0 : e(s, n, i) } if ("value" in r) return r.value; var a = r.get; if (void 0 !== a) return a.call(i) }, l = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), d = e("../utils/logger.js"), h = (i(d), e("../utils/browser.js")), f = i(h), c = e("./loader.js"), _ = e("../utils/exception.js"), m = function (e) { function t(e, n) { r(this, t); var i = s(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "fetch-stream-loader")); return i.TAG = "FetchStreamLoader", i._seekHandler = e, i._config = n, i._needStash = !0, i._requestAbort = !1, i._contentLength = null, i._receivedLength = 0, i } return a(t, e), l(t, null, [{ key: "isSupported", value: function () { try { var e = f.default.msedge && f.default.version.minor >= 15048, t = !f.default.msedge || e; return self.fetch && self.ReadableStream && t } catch (e) { return !1 } } }]), l(t, [{ key: "destroy", value: function () { this.isWorking() && this.abort(), u(t.prototype.__proto__ || Object.getPrototypeOf(t.prototype), "destroy", this).call(this) } }, { key: "open", value: function (e, t) { var n = this; this._dataSource = e, this._range = t; var i = e.url; this._config.reuseRedirectedURL && void 0 != e.redirectedURL && (i = e.redirectedURL); var r = this._seekHandler.getConfig(i, t), s = new self.Headers; if ("object" === o(r.headers)) { var a = r.headers; for (var u in a) a.hasOwnProperty(u) && s.append(u, a[u]) } var l = { method: "GET", headers: s, mode: "cors", cache: "default", referrerPolicy: "no-referrer-when-downgrade" }; if ("object" === o(this._config.headers)) for (var d in this._config.headers) s.append(d, this._config.headers[d]); !1 === e.cors && (l.mode = "same-origin"), e.withCredentials && (l.credentials = "include"), e.referrerPolicy && (l.referrerPolicy = e.referrerPolicy), this._status = c.LoaderStatus.kConnecting, self.fetch(r.url, l).then(function (e) { if (n._requestAbort) return n._requestAbort = !1, void (n._status = c.LoaderStatus.kIdle); if (e.ok && e.status >= 200 && e.status <= 299) { if (e.url !== r.url && n._onURLRedirect) { var t = n._seekHandler.removeURLParameters(e.url); n._onURLRedirect(t) } var i = e.headers.get("Content-Length"); return null != i && (n._contentLength = parseInt(i), 0 !== n._contentLength && n._onContentLengthKnown && n._onContentLengthKnown(n._contentLength)), n._pump.call(n, e.body.getReader()) } if (n._status = c.LoaderStatus.kError, !n._onError) throw new _.RuntimeException("FetchStreamLoader: Http code invalid, " + e.status + " " + e.statusText); n._onError(c.LoaderErrors.HTTP_STATUS_CODE_INVALID, { code: e.status, msg: e.statusText }) }).catch(function (e) { if (n._status = c.LoaderStatus.kError, !n._onError) throw e; n._onError(c.LoaderErrors.EXCEPTION, { code: -1, msg: e.message }) }) } }, { key: "abort", value: function () { this._requestAbort = !0 } }, { key: "_pump", value: function (e) { var t = this; return e.read().then(function (n) { if (n.done) if (null !== t._contentLength && t._receivedLength < t._contentLength) { t._status = c.LoaderStatus.kError; var i = c.LoaderErrors.EARLY_EOF, r = { code: -1, msg: "Fetch stream meet Early-EOF" }; if (!t._onError) throw new _.RuntimeException(r.msg); t._onError(i, r) } else t._status = c.LoaderStatus.kComplete, t._onComplete && t._onComplete(t._range.from, t._range.from + t._receivedLength - 1); else { if (!0 === t._requestAbort) return t._requestAbort = !1, t._status = c.LoaderStatus.kComplete, e.cancel(); t._status = c.LoaderStatus.kBuffering; var s = n.value.buffer, a = t._range.from + t._receivedLength; t._receivedLength += s.byteLength, t._onDataArrival && t._onDataArrival(s, a, t._receivedLength), t._pump(e) } }).catch(function (e) { if (11 !== e.code || !f.default.msedge) { t._status = c.LoaderStatus.kError; var n = 0, i = null; if (19 !== e.code && "network error" !== e.message || !(null === t._contentLength || null !== t._contentLength && t._receivedLength < t._contentLength) ? (n = c.LoaderErrors.EXCEPTION, i = { code: e.code, msg: e.message }) : (n = c.LoaderErrors.EARLY_EOF, i = { code: e.code, msg: "Fetch stream meet Early-EOF" }), !t._onError) throw new _.RuntimeException(i.msg); t._onError(n, i) } }) } }]), t }(c.BaseLoader); n.default = m }, { "../utils/browser.js": 39, "../utils/exception.js": 40, "../utils/logger.js": 41, "./loader.js": 24 }], 23: [function (e, t, n) { "use strict"; function i(e) { return e && e.__esModule ? e : { default: e } } function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(n, "__esModule", { value: !0 }); var s = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), a = e("../utils/logger.js"), o = i(a), u = e("./speed-sampler.js"), l = i(u), d = e("./loader.js"), h = e("./fetch-stream-loader.js"), f = i(h), c = e("./xhr-moz-chunked-loader.js"), _ = i(c), m = e("./xhr-msstream-loader.js"), p = (i(m), e("./xhr-range-loader.js")), v = i(p), g = e("./websocket-loader.js"), y = i(g), E = e("./range-seek-handler.js"), b = i(E), S = e("./param-seek-handler.js"), k = i(S), L = e("../utils/exception.js"), R = function () { function e(t, n, i) { r(this, e), this.TAG = "IOController", this._config = n, this._extraData = i, this._stashInitialSize = 393216, void 0 != n.stashInitialSize && n.stashInitialSize > 0 && (this._stashInitialSize = n.stashInitialSize), this._stashUsed = 0, this._stashSize = this._stashInitialSize, this._bufferSize = 3145728, this._stashBuffer = new ArrayBuffer(this._bufferSize), this._stashByteStart = 0, this._enableStash = !0, !1 === n.enableStashBuffer && (this._enableStash = !1), this._loader = null, this._loaderClass = null, this._seekHandler = null, this._dataSource = t, this._isWebSocketURL = /wss?:\/\/(.+?)/.test(t.url), this._refTotalLength = t.filesize ? t.filesize : null, this._totalLength = this._refTotalLength, this._fullRequestFlag = !1, this._currentRange = null, this._redirectedURL = null, this._speedNormalized = 0, this._speedSampler = new l.default, this._speedNormalizeList = [64, 128, 256, 384, 512, 768, 1024, 1536, 2048, 3072, 4096], this._isEarlyEofReconnecting = !1, this._paused = !1, this._resumeFrom = 0, this._onDataArrival = null, this._onSeeked = null, this._onError = null, this._onComplete = null, this._onRedirect = null, this._onRecoveredEarlyEof = null, this._selectSeekHandler(), this._selectLoader(), this._createLoader() } return s(e, [{ key: "destroy", value: function () { this._loader.isWorking() && this._loader.abort(), this._loader.destroy(), this._loader = null, this._loaderClass = null, this._dataSource = null, this._stashBuffer = null, this._stashUsed = this._stashSize = this._bufferSize = this._stashByteStart = 0, this._currentRange = null, this._speedSampler = null, this._isEarlyEofReconnecting = !1, this._onDataArrival = null, this._onSeeked = null, this._onError = null, this._onComplete = null, this._onRedirect = null, this._onRecoveredEarlyEof = null, this._extraData = null } }, { key: "isWorking", value: function () { return this._loader && this._loader.isWorking() && !this._paused } }, { key: "isPaused", value: function () { return this._paused } }, { key: "_selectSeekHandler", value: function () { var e = this._config; if ("range" === e.seekType) this._seekHandler = new b.default(this._config.rangeLoadZeroStart); else if ("param" === e.seekType) { var t = e.seekParamStart || "bstart", n = e.seekParamEnd || "bend"; this._seekHandler = new k.default(t, n) } else { if ("custom" !== e.seekType) throw new L.InvalidArgumentException("Invalid seekType in config: " + e.seekType); if ("function" != typeof e.customSeekHandler) throw new L.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!"); this._seekHandler = new e.customSeekHandler } } }, { key: "_selectLoader", value: function () { if (null != this._config.customLoader) this._loaderClass = this._config.customLoader; else if (this._isWebSocketURL) this._loaderClass = y.default; else if (f.default.isSupported()) this._loaderClass = f.default; else if (_.default.isSupported()) this._loaderClass = _.default; else { if (!v.default.isSupported()) throw new L.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!"); this._loaderClass = v.default } } }, { key: "_createLoader", value: function () { this._loader = new this._loaderClass(this._seekHandler, this._config), !1 === this._loader.needStashBuffer && (this._enableStash = !1), this._loader.onContentLengthKnown = this._onContentLengthKnown.bind(this), this._loader.onURLRedirect = this._onURLRedirect.bind(this), this._loader.onDataArrival = this._onLoaderChunkArrival.bind(this), this._loader.onComplete = this._onLoaderComplete.bind(this), this._loader.onError = this._onLoaderError.bind(this) } }, { key: "open", value: function (e) { this._currentRange = { from: 0, to: -1 }, e && (this._currentRange.from = e), this._speedSampler.reset(), e || (this._fullRequestFlag = !0), this._loader.open(this._dataSource, Object.assign({}, this._currentRange)) } }, { key: "abort", value: function () { this._loader.abort(), this._paused && (this._paused = !1, this._resumeFrom = 0) } }, { key: "pause", value: function () { this.isWorking() && (this._loader.abort(), 0 !== this._stashUsed ? (this._resumeFrom = this._stashByteStart, this._currentRange.to = this._stashByteStart - 1) : this._resumeFrom = this._currentRange.to + 1, this._stashUsed = 0, this._stashByteStart = 0, this._paused = !0) } }, { key: "resume", value: function () { if (this._paused) { this._paused = !1; var e = this._resumeFrom; this._resumeFrom = 0, this._internalSeek(e, !0) } } }, { key: "seek", value: function (e) { this._paused = !1, this._stashUsed = 0, this._stashByteStart = 0, this._internalSeek(e, !0) } }, { key: "_internalSeek", value: function (e, t) { this._loader.isWorking() && this._loader.abort(), this._flushStashBuffer(t), this._loader.destroy(), this._loader = null; var n = { from: e, to: -1 }; this._currentRange = { from: n.from, to: -1 }, this._speedSampler.reset(), this._stashSize = this._stashInitialSize, this._createLoader(), this._loader.open(this._dataSource, n), this._onSeeked && this._onSeeked() } }, { key: "updateUrl", value: function (e) { if (!e || "string" != typeof e || 0 === e.length) throw new L.InvalidArgumentException("Url must be a non-empty string!"); this._dataSource.url = e } }, { key: "_expandBuffer", value: function (e) { for (var t = this._stashSize; t + 1048576 < e;)t *= 2; if ((t += 1048576) !== this._bufferSize) { var n = new ArrayBuffer(t); if (this._stashUsed > 0) { var i = new Uint8Array(this._stashBuffer, 0, this._stashUsed); new Uint8Array(n, 0, t).set(i, 0) } this._stashBuffer = n, this._bufferSize = t } } }, { key: "_normalizeSpeed", value: function (e) { var t = this._speedNormalizeList, n = t.length - 1, i = 0, r = 0, s = n; if (e < t[0]) return t[0]; for (; r <= s;) { if ((i = r + Math.floor((s - r) / 2)) === n || e >= t[i] && e < t[i + 1]) return t[i]; t[i] < e ? r = i + 1 : s = i - 1 } } }, { key: "_adjustStashSize", value: function (e) { var t = 0; (t = this._config.isLive ? e : e < 512 ? e : e >= 512 && e <= 1024 ? Math.floor(1.5 * e) : 2 * e) > 8192 && (t = 8192); var n = 1024 * t + 1048576; this._bufferSize < n && this._expandBuffer(n), this._stashSize = 1024 * t } }, { key: "_dispatchChunks", value: function (e, t) { return this._currentRange.to = t + e.byteLength - 1, this._onDataArrival(e, t) } }, { key: "_onURLRedirect", value: function (e) { this._redirectedURL = e, this._onRedirect && this._onRedirect(e) } }, { key: "_onContentLengthKnown", value: function (e) { e && this._fullRequestFlag && (this._totalLength = e, this._fullRequestFlag = !1) } }, { key: "_onLoaderChunkArrival", value: function (e, t, n) { if (!this._onDataArrival) throw new L.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!"); if (!this._paused) { this._isEarlyEofReconnecting && (this._isEarlyEofReconnecting = !1, this._onRecoveredEarlyEof && this._onRecoveredEarlyEof()), this._speedSampler.addBytes(e.byteLength); var i = this._speedSampler.lastSecondKBps; if (0 !== i) { var r = this._normalizeSpeed(i); this._speedNormalized !== r && (this._speedNormalized = r, this._adjustStashSize(r)) } if (this._enableStash) if (0 === this._stashUsed && 0 === this._stashByteStart && (this._stashByteStart = t), this._stashUsed + e.byteLength <= this._stashSize) { var s = new Uint8Array(this._stashBuffer, 0, this._stashSize); s.set(new Uint8Array(e), this._stashUsed), this._stashUsed += e.byteLength } else { var a = new Uint8Array(this._stashBuffer, 0, this._bufferSize); if (this._stashUsed > 0) { var o = this._stashBuffer.slice(0, this._stashUsed), u = this._dispatchChunks(o, this._stashByteStart); if (u < o.byteLength) { if (u > 0) { var l = new Uint8Array(o, u); a.set(l, 0), this._stashUsed = l.byteLength, this._stashByteStart += u } } else this._stashUsed = 0, this._stashByteStart += u; this._stashUsed + e.byteLength > this._bufferSize && (this._expandBuffer(this._stashUsed + e.byteLength), a = new Uint8Array(this._stashBuffer, 0, this._bufferSize)), a.set(new Uint8Array(e), this._stashUsed), this._stashUsed += e.byteLength } else { var d = this._dispatchChunks(e, t); if (d < e.byteLength) { var h = e.byteLength - d; h > this._bufferSize && (this._expandBuffer(h), a = new Uint8Array(this._stashBuffer, 0, this._bufferSize)), a.set(new Uint8Array(e, d), 0), this._stashUsed += h, this._stashByteStart = t + d } } } else if (0 === this._stashUsed) { var f = this._dispatchChunks(e, t); if (f < e.byteLength) { var c = e.byteLength - f; c > this._bufferSize && this._expandBuffer(c); var _ = new Uint8Array(this._stashBuffer, 0, this._bufferSize); _.set(new Uint8Array(e, f), 0), this._stashUsed += c, this._stashByteStart = t + f } } else { this._stashUsed + e.byteLength > this._bufferSize && this._expandBuffer(this._stashUsed + e.byteLength); var m = new Uint8Array(this._stashBuffer, 0, this._bufferSize); m.set(new Uint8Array(e), this._stashUsed), this._stashUsed += e.byteLength; var p = this._dispatchChunks(this._stashBuffer.slice(0, this._stashUsed), this._stashByteStart); if (p < this._stashUsed && p > 0) { var v = new Uint8Array(this._stashBuffer, p); m.set(v, 0) } this._stashUsed -= p, this._stashByteStart += p } } } }, { key: "_flushStashBuffer", value: function (e) { if (this._stashUsed > 0) { var t = this._stashBuffer.slice(0, this._stashUsed), n = this._dispatchChunks(t, this._stashByteStart), i = t.byteLength - n; if (n < t.byteLength) { if (!e) { if (n > 0) { var r = new Uint8Array(this._stashBuffer, 0, this._bufferSize), s = new Uint8Array(t, n); r.set(s, 0), this._stashUsed = s.byteLength, this._stashByteStart += n } return 0 } o.default.w(this.TAG, i + " bytes unconsumed data remain when flush buffer, dropped") } return this._stashUsed = 0, this._stashByteStart = 0, i } return 0 } }, { key: "_onLoaderComplete", value: function (e, t) { this._flushStashBuffer(!0), this._onComplete && this._onComplete(this._extraData) } }, { key: "_onLoaderError", value: function (e, t) { switch (o.default.e(this.TAG, "Loader error, code = " + t.code + ", msg = " + t.msg), this._flushStashBuffer(!1), this._isEarlyEofReconnecting && (this._isEarlyEofReconnecting = !1, e = d.LoaderErrors.UNRECOVERABLE_EARLY_EOF), e) { case d.LoaderErrors.EARLY_EOF: if (!this._config.isLive && this._totalLength) { var n = this._currentRange.to + 1; return void (n < this._totalLength && (o.default.w(this.TAG, "Connection lost, trying reconnect..."), this._isEarlyEofReconnecting = !0, this._internalSeek(n, !1))) } e = d.LoaderErrors.UNRECOVERABLE_EARLY_EOF; break; case d.LoaderErrors.UNRECOVERABLE_EARLY_EOF: case d.LoaderErrors.CONNECTING_TIMEOUT: case d.LoaderErrors.HTTP_STATUS_CODE_INVALID: case d.LoaderErrors.EXCEPTION: }if (!this._onError) throw new L.RuntimeException("IOException: " + t.msg); this._onError(e, t) } }, { key: "status", get: function () { return this._loader.status } }, { key: "extraData", get: function () { return this._extraData }, set: function (e) { this._extraData = e } }, { key: "onDataArrival", get: function () { return this._onDataArrival }, set: function (e) { this._onDataArrival = e } }, { key: "onSeeked", get: function () { return this._onSeeked }, set: function (e) { this._onSeeked = e } }, { key: "onError", get: function () { return this._onError }, set: function (e) { this._onError = e } }, { key: "onComplete", get: function () { return this._onComplete }, set: function (e) { this._onComplete = e } }, { key: "onRedirect", get: function () { return this._onRedirect }, set: function (e) { this._onRedirect = e } }, { key: "onRecoveredEarlyEof", get: function () { return this._onRecoveredEarlyEof }, set: function (e) { this._onRecoveredEarlyEof = e } }, { key: "currentURL", get: function () { return this._dataSource.url } }, { key: "hasRedirect", get: function () { return null != this._redirectedURL || void 0 != this._dataSource.redirectedURL } }, { key: "currentRedirectedURL", get: function () { return this._redirectedURL || this._dataSource.redirectedURL } }, { key: "currentSpeed", get: function () { return this._loaderClass === v.default ? this._loader.currentSpeed : this._speedSampler.lastSecondKBps } }, { key: "loaderType", get: function () { return this._loader.type } }]), e }(); n.default = R }, {
            "../utils/exception.js": 40, "../utils/logger.js": 41, "./fetch-stream-loader.js": 22, "./loader.js": 24,
            "./param-seek-handler.js": 25, "./range-seek-handler.js": 26, "./speed-sampler.js": 27, "./websocket-loader.js": 28, "./xhr-moz-chunked-loader.js": 29, "./xhr-msstream-loader.js": 30, "./xhr-range-loader.js": 31
        }], 24: [function (e, t, n) { "use strict"; function i(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(n, "__esModule", { value: !0 }), n.BaseLoader = n.LoaderErrors = n.LoaderStatus = void 0; var r = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), s = e("../utils/exception.js"), a = n.LoaderStatus = { kIdle: 0, kConnecting: 1, kBuffering: 2, kError: 3, kComplete: 4 }; n.LoaderErrors = { OK: "OK", EXCEPTION: "Exception", HTTP_STATUS_CODE_INVALID: "HttpStatusCodeInvalid", CONNECTING_TIMEOUT: "ConnectingTimeout", EARLY_EOF: "EarlyEof", UNRECOVERABLE_EARLY_EOF: "UnrecoverableEarlyEof" }, n.BaseLoader = function () { function e(t) { i(this, e), this._type = t || "undefined", this._status = a.kIdle, this._needStash = !1, this._onContentLengthKnown = null, this._onURLRedirect = null, this._onDataArrival = null, this._onError = null, this._onComplete = null } return r(e, [{ key: "destroy", value: function () { this._status = a.kIdle, this._onContentLengthKnown = null, this._onURLRedirect = null, this._onDataArrival = null, this._onError = null, this._onComplete = null } }, { key: "isWorking", value: function () { return this._status === a.kConnecting || this._status === a.kBuffering } }, { key: "open", value: function (e, t) { throw new s.NotImplementedException("Unimplemented abstract function!") } }, { key: "abort", value: function () { throw new s.NotImplementedException("Unimplemented abstract function!") } }, { key: "type", get: function () { return this._type } }, { key: "status", get: function () { return this._status } }, { key: "needStashBuffer", get: function () { return this._needStash } }, { key: "onContentLengthKnown", get: function () { return this._onContentLengthKnown }, set: function (e) { this._onContentLengthKnown = e } }, { key: "onURLRedirect", get: function () { return this._onURLRedirect }, set: function (e) { this._onURLRedirect = e } }, { key: "onDataArrival", get: function () { return this._onDataArrival }, set: function (e) { this._onDataArrival = e } }, { key: "onError", get: function () { return this._onError }, set: function (e) { this._onError = e } }, { key: "onComplete", get: function () { return this._onComplete }, set: function (e) { this._onComplete = e } }]), e }() }, { "../utils/exception.js": 40 }], 25: [function (e, t, n) { "use strict"; function i(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(n, "__esModule", { value: !0 }); var r = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), s = function () { function e(t, n) { i(this, e), this._startName = t, this._endName = n } return r(e, [{ key: "getConfig", value: function (e, t) { var n = e; if (0 !== t.from || -1 !== t.to) { var i = !0; -1 === n.indexOf("?") && (n += "?", i = !1), i && (n += "&"), n += this._startName + "=" + t.from.toString(), -1 !== t.to && (n += "&" + this._endName + "=" + t.to.toString()) } return { url: n, headers: {} } } }, { key: "removeURLParameters", value: function (e) { var t = e.split("?")[0], n = void 0, i = e.indexOf("?"); -1 !== i && (n = e.substring(i + 1)); var r = ""; if (void 0 != n && n.length > 0) for (var s = n.split("&"), a = 0; a < s.length; a++) { var o = s[a].split("="), u = a > 0; o[0] !== this._startName && o[0] !== this._endName && (u && (r += "&"), r += s[a]) } return 0 === r.length ? t : t + "?" + r } }]), e }(); n.default = s }, {}], 26: [function (e, t, n) { "use strict"; function i(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(n, "__esModule", { value: !0 }); var r = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), s = function () { function e(t) { i(this, e), this._zeroStart = t || !1 } return r(e, [{ key: "getConfig", value: function (e, t) { var n = {}; if (0 !== t.from || -1 !== t.to) { var i = void 0; i = -1 !== t.to ? "bytes=" + t.from.toString() + "-" + t.to.toString() : "bytes=" + t.from.toString() + "-", n.Range = i } else this._zeroStart && (n.Range = "bytes=0-"); return { url: e, headers: n } } }, { key: "removeURLParameters", value: function (e) { return e } }]), e }(); n.default = s }, {}], 27: [function (e, t, n) { "use strict"; function i(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(n, "__esModule", { value: !0 }); var r = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), s = function () { function e() { i(this, e), this._firstCheckpoint = 0, this._lastCheckpoint = 0, this._intervalBytes = 0, this._totalBytes = 0, this._lastSecondBytes = 0, self.performance && self.performance.now ? this._now = self.performance.now.bind(self.performance) : this._now = Date.now } return r(e, [{ key: "reset", value: function () { this._firstCheckpoint = this._lastCheckpoint = 0, this._totalBytes = this._intervalBytes = 0, this._lastSecondBytes = 0 } }, { key: "addBytes", value: function (e) { 0 === this._firstCheckpoint ? (this._firstCheckpoint = this._now(), this._lastCheckpoint = this._firstCheckpoint, this._intervalBytes += e, this._totalBytes += e) : this._now() - this._lastCheckpoint < 1e3 ? (this._intervalBytes += e, this._totalBytes += e) : (this._lastSecondBytes = this._intervalBytes, this._intervalBytes = e, this._totalBytes += e, this._lastCheckpoint = this._now()) } }, { key: "currentKBps", get: function () { this.addBytes(0); var e = (this._now() - this._lastCheckpoint) / 1e3; return 0 == e && (e = 1), this._intervalBytes / e / 1024 } }, { key: "lastSecondKBps", get: function () { return this.addBytes(0), 0 !== this._lastSecondBytes ? this._lastSecondBytes / 1024 : this._now() - this._lastCheckpoint >= 500 ? this.currentKBps : 0 } }, { key: "averageKBps", get: function () { var e = (this._now() - this._firstCheckpoint) / 1e3; return this._totalBytes / e / 1024 } }]), e }(); n.default = s }, {}], 28: [function (e, t, n) { "use strict"; function i(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function r(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t } function s(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) } Object.defineProperty(n, "__esModule", { value: !0 }); var a = function e(t, n, i) { null === t && (t = Function.prototype); var r = Object.getOwnPropertyDescriptor(t, n); if (void 0 === r) { var s = Object.getPrototypeOf(t); return null === s ? void 0 : e(s, n, i) } if ("value" in r) return r.value; var a = r.get; if (void 0 !== a) return a.call(i) }, o = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), u = e("../utils/logger.js"), l = (function (e) { e && e.__esModule }(u), e("./loader.js")), d = e("../utils/exception.js"), h = function (e) { function t() { i(this, t); var e = r(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "websocket-loader")); return e.TAG = "WebSocketLoader", e._needStash = !0, e._ws = null, e._requestAbort = !1, e._receivedLength = 0, e } return s(t, e), o(t, null, [{ key: "isSupported", value: function () { try { return void 0 !== self.WebSocket } catch (e) { return !1 } } }]), o(t, [{ key: "destroy", value: function () { this._ws && this.abort(), a(t.prototype.__proto__ || Object.getPrototypeOf(t.prototype), "destroy", this).call(this) } }, { key: "open", value: function (e) { try { var t = this._ws = new self.WebSocket(e.url); t.binaryType = "arraybuffer", t.onopen = this._onWebSocketOpen.bind(this), t.onclose = this._onWebSocketClose.bind(this), t.onmessage = this._onWebSocketMessage.bind(this), t.onerror = this._onWebSocketError.bind(this), this._status = l.LoaderStatus.kConnecting } catch (e) { this._status = l.LoaderStatus.kError; var n = { code: e.code, msg: e.message }; if (!this._onError) throw new d.RuntimeException(n.msg); this._onError(l.LoaderErrors.EXCEPTION, n) } } }, { key: "abort", value: function () { var e = this._ws; !e || 0 !== e.readyState && 1 !== e.readyState || (this._requestAbort = !0, e.close()), this._ws = null, this._status = l.LoaderStatus.kComplete } }, { key: "_onWebSocketOpen", value: function (e) { this._status = l.LoaderStatus.kBuffering } }, { key: "_onWebSocketClose", value: function (e) { if (!0 === this._requestAbort) return void (this._requestAbort = !1); this._status = l.LoaderStatus.kComplete, this._onComplete && this._onComplete(0, this._receivedLength - 1) } }, { key: "_onWebSocketMessage", value: function (e) { var t = this; if (e.data instanceof ArrayBuffer) this._dispatchArrayBuffer(e.data); else if (e.data instanceof Blob) { var n = new FileReader; n.onload = function () { t._dispatchArrayBuffer(n.result) }, n.readAsArrayBuffer(e.data) } else { this._status = l.LoaderStatus.kError; var i = { code: -1, msg: "Unsupported WebSocket message type: " + e.data.constructor.name }; if (!this._onError) throw new d.RuntimeException(i.msg); this._onError(l.LoaderErrors.EXCEPTION, i) } } }, { key: "_dispatchArrayBuffer", value: function (e) { var t = e, n = this._receivedLength; this._receivedLength += t.byteLength, this._onDataArrival && this._onDataArrival(t, n, this._receivedLength) } }, { key: "_onWebSocketError", value: function (e) { this._status = l.LoaderStatus.kError; var t = { code: e.code, msg: e.message }; if (!this._onError) throw new d.RuntimeException(t.msg); this._onError(l.LoaderErrors.EXCEPTION, t) } }]), t }(l.BaseLoader); n.default = h }, { "../utils/exception.js": 40, "../utils/logger.js": 41, "./loader.js": 24 }], 29: [function (e, t, n) { "use strict"; function i(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function r(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t } function s(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) } Object.defineProperty(n, "__esModule", { value: !0 }); var a = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, o = function e(t, n, i) { null === t && (t = Function.prototype); var r = Object.getOwnPropertyDescriptor(t, n); if (void 0 === r) { var s = Object.getPrototypeOf(t); return null === s ? void 0 : e(s, n, i) } if ("value" in r) return r.value; var a = r.get; if (void 0 !== a) return a.call(i) }, u = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), l = e("../utils/logger.js"), d = function (e) { return e && e.__esModule ? e : { default: e } }(l), h = e("./loader.js"), f = e("../utils/exception.js"), c = function (e) { function t(e, n) { i(this, t); var s = r(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "xhr-moz-chunked-loader")); return s.TAG = "MozChunkedLoader", s._seekHandler = e, s._config = n, s._needStash = !0, s._xhr = null, s._requestAbort = !1, s._contentLength = null, s._receivedLength = 0, s } return s(t, e), u(t, null, [{ key: "isSupported", value: function () { try { var e = new XMLHttpRequest; return e.open("GET", "https://example.com", !0), e.responseType = "moz-chunked-arraybuffer", "moz-chunked-arraybuffer" === e.responseType } catch (e) { return d.default.w("MozChunkedLoader", e.message), !1 } } }]), u(t, [{ key: "destroy", value: function () { this.isWorking() && this.abort(), this._xhr && (this._xhr.onreadystatechange = null, this._xhr.onprogress = null, this._xhr.onloadend = null, this._xhr.onerror = null, this._xhr = null), o(t.prototype.__proto__ || Object.getPrototypeOf(t.prototype), "destroy", this).call(this) } }, { key: "open", value: function (e, t) { this._dataSource = e, this._range = t; var n = e.url; this._config.reuseRedirectedURL && void 0 != e.redirectedURL && (n = e.redirectedURL); var i = this._seekHandler.getConfig(n, t); this._requestURL = i.url; var r = this._xhr = new XMLHttpRequest; if (r.open("GET", i.url, !0), r.responseType = "moz-chunked-arraybuffer", r.onreadystatechange = this._onReadyStateChange.bind(this), r.onprogress = this._onProgress.bind(this), r.onloadend = this._onLoadEnd.bind(this), r.onerror = this._onXhrError.bind(this), e.withCredentials && (r.withCredentials = !0), "object" === a(i.headers)) { var s = i.headers; for (var o in s) s.hasOwnProperty(o) && r.setRequestHeader(o, s[o]) } if ("object" === a(this._config.headers)) { var u = this._config.headers; for (var l in u) u.hasOwnProperty(l) && r.setRequestHeader(l, u[l]) } this._status = h.LoaderStatus.kConnecting, r.send() } }, { key: "abort", value: function () { this._requestAbort = !0, this._xhr && this._xhr.abort(), this._status = h.LoaderStatus.kComplete } }, { key: "_onReadyStateChange", value: function (e) { var t = e.target; if (2 === t.readyState) { if (void 0 != t.responseURL && t.responseURL !== this._requestURL && this._onURLRedirect) { var n = this._seekHandler.removeURLParameters(t.responseURL); this._onURLRedirect(n) } if (0 !== t.status && (t.status < 200 || t.status > 299)) { if (this._status = h.LoaderStatus.kError, !this._onError) throw new f.RuntimeException("MozChunkedLoader: Http code invalid, " + t.status + " " + t.statusText); this._onError(h.LoaderErrors.HTTP_STATUS_CODE_INVALID, { code: t.status, msg: t.statusText }) } else this._status = h.LoaderStatus.kBuffering } } }, { key: "_onProgress", value: function (e) { if (this._status !== h.LoaderStatus.kError) { null === this._contentLength && null !== e.total && 0 !== e.total && (this._contentLength = e.total, this._onContentLengthKnown && this._onContentLengthKnown(this._contentLength)); var t = e.target.response, n = this._range.from + this._receivedLength; this._receivedLength += t.byteLength, this._onDataArrival && this._onDataArrival(t, n, this._receivedLength) } } }, { key: "_onLoadEnd", value: function (e) { if (!0 === this._requestAbort) return void (this._requestAbort = !1); this._status !== h.LoaderStatus.kError && (this._status = h.LoaderStatus.kComplete, this._onComplete && this._onComplete(this._range.from, this._range.from + this._receivedLength - 1)) } }, { key: "_onXhrError", value: function (e) { this._status = h.LoaderStatus.kError; var t = 0, n = null; if (this._contentLength && e.loaded < this._contentLength ? (t = h.LoaderErrors.EARLY_EOF, n = { code: -1, msg: "Moz-Chunked stream meet Early-Eof" }) : (t = h.LoaderErrors.EXCEPTION, n = { code: -1, msg: e.constructor.name + " " + e.type }), !this._onError) throw new f.RuntimeException(n.msg); this._onError(t, n) } }]), t }(h.BaseLoader); n.default = c }, { "../utils/exception.js": 40, "../utils/logger.js": 41, "./loader.js": 24 }], 30: [function (e, t, n) { "use strict"; function i(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function r(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t } function s(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) } Object.defineProperty(n, "__esModule", { value: !0 }); var a = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, o = function e(t, n, i) { null === t && (t = Function.prototype); var r = Object.getOwnPropertyDescriptor(t, n); if (void 0 === r) { var s = Object.getPrototypeOf(t); return null === s ? void 0 : e(s, n, i) } if ("value" in r) return r.value; var a = r.get; if (void 0 !== a) return a.call(i) }, u = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), l = e("../utils/logger.js"), d = function (e) { return e && e.__esModule ? e : { default: e } }(l), h = e("./loader.js"), f = e("../utils/exception.js"), c = function (e) { function t(e, n) { i(this, t); var s = r(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "xhr-msstream-loader")); return s.TAG = "MSStreamLoader", s._seekHandler = e, s._config = n, s._needStash = !0, s._xhr = null, s._reader = null, s._totalRange = null, s._currentRange = null, s._currentRequestURL = null, s._currentRedirectedURL = null, s._contentLength = null, s._receivedLength = 0, s._bufferLimit = 16777216, s._lastTimeBufferSize = 0, s._isReconnecting = !1, s } return s(t, e), u(t, null, [{ key: "isSupported", value: function () { try { if (void 0 === self.MSStream || void 0 === self.MSStreamReader) return !1; var e = new XMLHttpRequest; return e.open("GET", "https://example.com", !0), e.responseType = "ms-stream", "ms-stream" === e.responseType } catch (e) { return d.default.w("MSStreamLoader", e.message), !1 } } }]), u(t, [{ key: "destroy", value: function () { this.isWorking() && this.abort(), this._reader && (this._reader.onprogress = null, this._reader.onload = null, this._reader.onerror = null, this._reader = null), this._xhr && (this._xhr.onreadystatechange = null, this._xhr = null), o(t.prototype.__proto__ || Object.getPrototypeOf(t.prototype), "destroy", this).call(this) } }, { key: "open", value: function (e, t) { this._internalOpen(e, t, !1) } }, { key: "_internalOpen", value: function (e, t, n) { this._dataSource = e, n ? this._currentRange = t : this._totalRange = t; var i = e.url; this._config.reuseRedirectedURL && (void 0 != this._currentRedirectedURL ? i = this._currentRedirectedURL : void 0 != e.redirectedURL && (i = e.redirectedURL)); var r = this._seekHandler.getConfig(i, t); this._currentRequestURL = r.url; var s = this._reader = new self.MSStreamReader; s.onprogress = this._msrOnProgress.bind(this), s.onload = this._msrOnLoad.bind(this), s.onerror = this._msrOnError.bind(this); var o = this._xhr = new XMLHttpRequest; if (o.open("GET", r.url, !0), o.responseType = "ms-stream", o.onreadystatechange = this._xhrOnReadyStateChange.bind(this), o.onerror = this._xhrOnError.bind(this), e.withCredentials && (o.withCredentials = !0), "object" === a(r.headers)) { var u = r.headers; for (var l in u) u.hasOwnProperty(l) && o.setRequestHeader(l, u[l]) } if ("object" === a(this._config.headers)) { var d = this._config.headers; for (var f in d) d.hasOwnProperty(f) && o.setRequestHeader(f, d[f]) } this._isReconnecting ? this._isReconnecting = !1 : this._status = h.LoaderStatus.kConnecting, o.send() } }, { key: "abort", value: function () { this._internalAbort(), this._status = h.LoaderStatus.kComplete } }, { key: "_internalAbort", value: function () { this._reader && (1 === this._reader.readyState && this._reader.abort(), this._reader.onprogress = null, this._reader.onload = null, this._reader.onerror = null, this._reader = null), this._xhr && (this._xhr.abort(), this._xhr.onreadystatechange = null, this._xhr = null) } }, { key: "_xhrOnReadyStateChange", value: function (e) { var t = e.target; if (2 === t.readyState) if (t.status >= 200 && t.status <= 299) { if (this._status = h.LoaderStatus.kBuffering, void 0 != t.responseURL) { var n = this._seekHandler.removeURLParameters(t.responseURL); t.responseURL !== this._currentRequestURL && n !== this._currentRedirectedURL && (this._currentRedirectedURL = n, this._onURLRedirect && this._onURLRedirect(n)) } var i = t.getResponseHeader("Content-Length"); if (null != i && null == this._contentLength) { var r = parseInt(i); r > 0 && (this._contentLength = r, this._onContentLengthKnown && this._onContentLengthKnown(this._contentLength)) } } else { if (this._status = h.LoaderStatus.kError, !this._onError) throw new f.RuntimeException("MSStreamLoader: Http code invalid, " + t.status + " " + t.statusText); this._onError(h.LoaderErrors.HTTP_STATUS_CODE_INVALID, { code: t.status, msg: t.statusText }) } else if (3 === t.readyState && t.status >= 200 && t.status <= 299) { this._status = h.LoaderStatus.kBuffering; var s = t.response; this._reader.readAsArrayBuffer(s) } } }, { key: "_xhrOnError", value: function (e) { this._status = h.LoaderStatus.kError; var t = h.LoaderErrors.EXCEPTION, n = { code: -1, msg: e.constructor.name + " " + e.type }; if (!this._onError) throw new f.RuntimeException(n.msg); this._onError(t, n) } }, { key: "_msrOnProgress", value: function (e) { var t = e.target, n = t.result; if (null == n) return void this._doReconnectIfNeeded(); var i = n.slice(this._lastTimeBufferSize); this._lastTimeBufferSize = n.byteLength; var r = this._totalRange.from + this._receivedLength; this._receivedLength += i.byteLength, this._onDataArrival && this._onDataArrival(i, r, this._receivedLength), n.byteLength >= this._bufferLimit && (d.default.v(this.TAG, "MSStream buffer exceeded max size near " + (r + i.byteLength) + ", reconnecting..."), this._doReconnectIfNeeded()) } }, { key: "_doReconnectIfNeeded", value: function () { if (null == this._contentLength || this._receivedLength < this._contentLength) { this._isReconnecting = !0, this._lastTimeBufferSize = 0, this._internalAbort(); var e = { from: this._totalRange.from + this._receivedLength, to: -1 }; this._internalOpen(this._dataSource, e, !0) } } }, { key: "_msrOnLoad", value: function (e) { this._status = h.LoaderStatus.kComplete, this._onComplete && this._onComplete(this._totalRange.from, this._totalRange.from + this._receivedLength - 1) } }, { key: "_msrOnError", value: function (e) { this._status = h.LoaderStatus.kError; var t = 0, n = null; if (this._contentLength && this._receivedLength < this._contentLength ? (t = h.LoaderErrors.EARLY_EOF, n = { code: -1, msg: "MSStream meet Early-Eof" }) : (t = h.LoaderErrors.EARLY_EOF, n = { code: -1, msg: e.constructor.name + " " + e.type }), !this._onError) throw new f.RuntimeException(n.msg); this._onError(t, n) } }]), t }(h.BaseLoader); n.default = c }, { "../utils/exception.js": 40, "../utils/logger.js": 41, "./loader.js": 24 }], 31: [function (e, t, n) { "use strict"; function i(e) { return e && e.__esModule ? e : { default: e } } function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function s(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t } function a(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) } Object.defineProperty(n, "__esModule", { value: !0 }); var o = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, u = function e(t, n, i) { null === t && (t = Function.prototype); var r = Object.getOwnPropertyDescriptor(t, n); if (void 0 === r) { var s = Object.getPrototypeOf(t); return null === s ? void 0 : e(s, n, i) } if ("value" in r) return r.value; var a = r.get; if (void 0 !== a) return a.call(i) }, l = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), d = e("../utils/logger.js"), h = i(d), f = e("./speed-sampler.js"), c = i(f), _ = e("./loader.js"), m = e("../utils/exception.js"), p = function (e) { function t(e, n) { r(this, t); var i = s(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "xhr-range-loader")); return i.TAG = "RangeLoader", i._seekHandler = e, i._config = n, i._needStash = !1, i._chunkSizeKBList = [128, 256, 384, 512, 768, 1024, 1536, 2048, 3072, 4096, 5120, 6144, 7168, 8192], i._currentChunkSizeKB = 384, i._currentSpeedNormalized = 0, i._zeroSpeedChunkCount = 0, i._xhr = null, i._speedSampler = new c.default, i._requestAbort = !1, i._waitForTotalLength = !1, i._totalLengthReceived = !1, i._currentRequestURL = null, i._currentRedirectedURL = null, i._currentRequestRange = null, i._totalLength = null, i._contentLength = null, i._receivedLength = 0, i._lastTimeLoaded = 0, i } return a(t, e), l(t, null, [{ key: "isSupported", value: function () { try { var e = new XMLHttpRequest; return e.open("GET", "https://example.com", !0), e.responseType = "arraybuffer", "arraybuffer" === e.responseType } catch (e) { return h.default.w("RangeLoader", e.message), !1 } } }]), l(t, [{ key: "destroy", value: function () { this.isWorking() && this.abort(), this._xhr && (this._xhr.onreadystatechange = null, this._xhr.onprogress = null, this._xhr.onload = null, this._xhr.onerror = null, this._xhr = null), u(t.prototype.__proto__ || Object.getPrototypeOf(t.prototype), "destroy", this).call(this) } }, { key: "open", value: function (e, t) { this._dataSource = e, this._range = t, this._status = _.LoaderStatus.kConnecting; var n = !1; void 0 != this._dataSource.filesize && 0 !== this._dataSource.filesize && (n = !0, this._totalLength = this._dataSource.filesize), this._totalLengthReceived || n ? this._openSubRange() : (this._waitForTotalLength = !0, this._internalOpen(this._dataSource, { from: 0, to: -1 })) } }, { key: "_openSubRange", value: function () { var e = 1024 * this._currentChunkSizeKB, t = this._range.from + this._receivedLength, n = t + e; null != this._contentLength && n - this._range.from >= this._contentLength && (n = this._range.from + this._contentLength - 1), this._currentRequestRange = { from: t, to: n }, this._internalOpen(this._dataSource, this._currentRequestRange) } }, { key: "_internalOpen", value: function (e, t) { this._lastTimeLoaded = 0; var n = e.url; this._config.reuseRedirectedURL && (void 0 != this._currentRedirectedURL ? n = this._currentRedirectedURL : void 0 != e.redirectedURL && (n = e.redirectedURL)); var i = this._seekHandler.getConfig(n, t); this._currentRequestURL = i.url; var r = this._xhr = new XMLHttpRequest; if (r.open("GET", i.url, !0), r.responseType = "arraybuffer", r.onreadystatechange = this._onReadyStateChange.bind(this), r.onprogress = this._onProgress.bind(this), r.onload = this._onLoad.bind(this), r.onerror = this._onXhrError.bind(this), e.withCredentials && (r.withCredentials = !0), "object" === o(i.headers)) { var s = i.headers; for (var a in s) s.hasOwnProperty(a) && r.setRequestHeader(a, s[a]) } if ("object" === o(this._config.headers)) { var u = this._config.headers; for (var l in u) u.hasOwnProperty(l) && r.setRequestHeader(l, u[l]) } r.send() } }, { key: "abort", value: function () { this._requestAbort = !0, this._internalAbort(), this._status = _.LoaderStatus.kComplete } }, { key: "_internalAbort", value: function () { this._xhr && (this._xhr.onreadystatechange = null, this._xhr.onprogress = null, this._xhr.onload = null, this._xhr.onerror = null, this._xhr.abort(), this._xhr = null) } }, { key: "_onReadyStateChange", value: function (e) { var t = e.target; if (2 === t.readyState) { if (void 0 != t.responseURL) { var n = this._seekHandler.removeURLParameters(t.responseURL); t.responseURL !== this._currentRequestURL && n !== this._currentRedirectedURL && (this._currentRedirectedURL = n, this._onURLRedirect && this._onURLRedirect(n)) } if (t.status >= 200 && t.status <= 299) { if (this._waitForTotalLength) return; this._status = _.LoaderStatus.kBuffering } else { if (this._status = _.LoaderStatus.kError, !this._onError) throw new m.RuntimeException("RangeLoader: Http code invalid, " + t.status + " " + t.statusText); this._onError(_.LoaderErrors.HTTP_STATUS_CODE_INVALID, { code: t.status, msg: t.statusText }) } } } }, { key: "_onProgress", value: function (e) { if (this._status !== _.LoaderStatus.kError) { if (null === this._contentLength) { var t = !1; if (this._waitForTotalLength) { this._waitForTotalLength = !1, this._totalLengthReceived = !0, t = !0; var n = e.total; this._internalAbort(), null != n & 0 !== n && (this._totalLength = n) } if (-1 === this._range.to ? this._contentLength = this._totalLength - this._range.from : this._contentLength = this._range.to - this._range.from + 1, t) return void this._openSubRange(); this._onContentLengthKnown && this._onContentLengthKnown(this._contentLength) } var i = e.loaded - this._lastTimeLoaded; this._lastTimeLoaded = e.loaded, this._speedSampler.addBytes(i) } } }, { key: "_normalizeSpeed", value: function (e) { var t = this._chunkSizeKBList, n = t.length - 1, i = 0, r = 0, s = n; if (e < t[0]) return t[0]; for (; r <= s;) { if ((i = r + Math.floor((s - r) / 2)) === n || e >= t[i] && e < t[i + 1]) return t[i]; t[i] < e ? r = i + 1 : s = i - 1 } } }, { key: "_onLoad", value: function (e) { if (this._status !== _.LoaderStatus.kError) { if (this._waitForTotalLength) return void (this._waitForTotalLength = !1); this._lastTimeLoaded = 0; var t = this._speedSampler.lastSecondKBps; if (0 === t && ++this._zeroSpeedChunkCount >= 3 && (t = this._speedSampler.currentKBps), 0 !== t) { var n = this._normalizeSpeed(t); this._currentSpeedNormalized !== n && (this._currentSpeedNormalized = n, this._currentChunkSizeKB = n) } var i = e.target.response, r = this._range.from + this._receivedLength; this._receivedLength += i.byteLength; var s = !1; null != this._contentLength && this._receivedLength < this._contentLength ? this._openSubRange() : s = !0, this._onDataArrival && this._onDataArrival(i, r, this._receivedLength), s && (this._status = _.LoaderStatus.kComplete, this._onComplete && this._onComplete(this._range.from, this._range.from + this._receivedLength - 1)) } } }, { key: "_onXhrError", value: function (e) { this._status = _.LoaderStatus.kError; var t = 0, n = null; if (this._contentLength && this._receivedLength > 0 && this._receivedLength < this._contentLength ? (t = _.LoaderErrors.EARLY_EOF, n = { code: -1, msg: "RangeLoader meet Early-Eof" }) : (t = _.LoaderErrors.EXCEPTION, n = { code: -1, msg: e.constructor.name + " " + e.type }), !this._onError) throw new m.RuntimeException(n.msg); this._onError(t, n) } }, { key: "currentSpeed", get: function () { return this._speedSampler.lastSecondKBps } }]), t }(_.BaseLoader); n.default = p }, { "../utils/exception.js": 40, "../utils/logger.js": 41, "./loader.js": 24, "./speed-sampler.js": 27 }], 32: [function (e, t, n) {
            "use strict"; function i(e) { return e && e.__esModule ? e : { default: e } } function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(n, "__esModule", { value: !0 }); var s = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, a = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), o = e("events"), u = i(o), l = e("../utils/logger.js"), d = i(l), h = e("../utils/browser.js"), f = i(h), c = e("./player-events.js"), _ = i(c), m = e("../core/transmuxer.js"), p = i(m), v = e("../core/transmuxing-events.js"), g = i(v), y = e("../core/mse-controller.js"), E = i(y), b = e("../core/mse-events.js"), S = i(b), k = e("./player-errors.js"), L = e("../config.js"), R = e("../utils/exception.js"), A = function () {
                function e(t, n) { if (r(this, e), this.TAG = "FlvPlayer", this._type = "FlvPlayer", this._emitter = new u.default, this._config = (0, L.createDefaultConfig)(), "object" === (void 0 === n ? "undefined" : s(n)) && Object.assign(this._config, n), "flv" !== t.type.toLowerCase()) throw new R.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!"); !0 === t.isLive && (this._config.isLive = !0), this.e = { onvLoadedMetadata: this._onvLoadedMetadata.bind(this), onvSeeking: this._onvSeeking.bind(this), onvCanPlay: this._onvCanPlay.bind(this), onvStalled: this._onvStalled.bind(this), onvProgress: this._onvProgress.bind(this) }, self.performance && self.performance.now ? this._now = self.performance.now.bind(self.performance) : this._now = Date.now, this._pendingSeekTime = null, this._requestSetTime = !1, this._seekpointRecord = null, this._progressChecker = null, this._mediaDataSource = t, this._mediaElement = null, this._msectl = null, this._transmuxer = null, this._mseSourceOpened = !1, this._hasPendingLoad = !1, this._receivedCanPlay = !1, this._mediaInfo = null, this._statisticsInfo = null; var i = f.default.chrome && (f.default.version.major < 50 || 50 === f.default.version.major && f.default.version.build < 2661); this._alwaysSeekKeyframe = !!(i || f.default.msedge || f.default.msie), this._alwaysSeekKeyframe && (this._config.accurateSeek = !1) } return a(e, [{ key: "destroy", value: function () { null != this._progressChecker && (window.clearInterval(this._progressChecker), this._progressChecker = null), this._transmuxer && this.unload(), this._mediaElement && this.detachMediaElement(), this.e = null, this._mediaDataSource = null, this._emitter.removeAllListeners(), this._emitter = null } }, { key: "on", value: function (e, t) { var n = this; e === _.default.MEDIA_INFO ? null != this._mediaInfo && Promise.resolve().then(function () { n._emitter.emit(_.default.MEDIA_INFO, n.mediaInfo) }) : e === _.default.STATISTICS_INFO && null != this._statisticsInfo && Promise.resolve().then(function () { n._emitter.emit(_.default.STATISTICS_INFO, n.statisticsInfo) }), this._emitter.addListener(e, t) } }, { key: "off", value: function (e, t) { this._emitter.removeListener(e, t) } }, {
                    key: "attachMediaElement", value: function (e) { var t = this; if (this._mediaElement = e, e.addEventListener("loadedmetadata", this.e.onvLoadedMetadata), e.addEventListener("seeking", this.e.onvSeeking), e.addEventListener("canplay", this.e.onvCanPlay), e.addEventListener("stalled", this.e.onvStalled), e.addEventListener("progress", this.e.onvProgress), this._msectl = new E.default(this._config), this._msectl.on(S.default.UPDATE_END, this._onmseUpdateEnd.bind(this)), this._msectl.on(S.default.BUFFER_FULL, this._onmseBufferFull.bind(this)), this._msectl.on(S.default.SOURCE_OPEN, function () { t._mseSourceOpened = !0, t._hasPendingLoad && (t._hasPendingLoad = !1, t.load()) }), this._msectl.on(S.default.ERROR, function (e) { t._emitter.emit(_.default.ERROR, k.ErrorTypes.MEDIA_ERROR, k.ErrorDetails.MEDIA_MSE_ERROR, e) }), this._msectl.attachMediaElement(e), null != this._pendingSeekTime) try { e.currentTime = this._pendingSeekTime, this._pendingSeekTime = null } catch (e) { } }
                }, { key: "detachMediaElement", value: function () { this._mediaElement && (this._msectl.detachMediaElement(), this._mediaElement.removeEventListener("loadedmetadata", this.e.onvLoadedMetadata), this._mediaElement.removeEventListener("seeking", this.e.onvSeeking), this._mediaElement.removeEventListener("canplay", this.e.onvCanPlay), this._mediaElement.removeEventListener("stalled", this.e.onvStalled), this._mediaElement.removeEventListener("progress", this.e.onvProgress), this._mediaElement = null), this._msectl && (this._msectl.destroy(), this._msectl = null) } }, { key: "load", value: function () { var e = this; if (!this._mediaElement) throw new R.IllegalStateException("HTMLMediaElement must be attached before load()!"); if (this._transmuxer) throw new R.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!"); if (!this._hasPendingLoad) { if (this._config.deferLoadAfterSourceOpen && !1 === this._mseSourceOpened) return void (this._hasPendingLoad = !0); this._mediaElement.readyState > 0 && (this._requestSetTime = !0, this._mediaElement.currentTime = 0), this._transmuxer = new p.default(this._mediaDataSource, this._config), this._transmuxer.on(g.default.INIT_SEGMENT, function (t, n) { e._msectl.appendInitSegment(n) }), this._transmuxer.on(g.default.MEDIA_SEGMENT, function (t, n) { if (e._msectl.appendMediaSegment(n), e._config.lazyLoad && !e._config.isLive) { var i = e._mediaElement.currentTime; n.info.endDts >= 1e3 * (i + e._config.lazyLoadMaxDuration) && null == e._progressChecker && (d.default.v(e.TAG, "Maximum buffering duration exceeded, suspend transmuxing task"), e._suspendTransmuxer()) } }), this._transmuxer.on(g.default.LOADING_COMPLETE, function () { e._msectl.endOfStream(), e._emitter.emit(_.default.LOADING_COMPLETE) }), this._transmuxer.on(g.default.RECOVERED_EARLY_EOF, function () { e._emitter.emit(_.default.RECOVERED_EARLY_EOF) }), this._transmuxer.on(g.default.IO_ERROR, function (t, n) { e._emitter.emit(_.default.ERROR, k.ErrorTypes.NETWORK_ERROR, t, n) }), this._transmuxer.on(g.default.DEMUX_ERROR, function (t, n) { e._emitter.emit(_.default.ERROR, k.ErrorTypes.MEDIA_ERROR, t, { code: -1, msg: n }) }), this._transmuxer.on(g.default.MEDIA_INFO, function (t) { e._mediaInfo = t, e._emitter.emit(_.default.MEDIA_INFO, Object.assign({}, t)) }), this._transmuxer.on(g.default.METADATA_ARRIVED, function (t) { e._emitter.emit(_.default.METADATA_ARRIVED, t) }), this._transmuxer.on(g.default.SCRIPTDATA_ARRIVED, function (t) { e._emitter.emit(_.default.SCRIPTDATA_ARRIVED, t) }), this._transmuxer.on(g.default.STATISTICS_INFO, function (t) { e._statisticsInfo = e._fillStatisticsInfo(t), e._emitter.emit(_.default.STATISTICS_INFO, Object.assign({}, e._statisticsInfo)) }), this._transmuxer.on(g.default.RECOMMEND_SEEKPOINT, function (t) { e._mediaElement && !e._config.accurateSeek && (e._requestSetTime = !0, e._mediaElement.currentTime = t / 1e3) }), this._transmuxer.open() } } }, { key: "unload", value: function () { this._mediaElement && this._mediaElement.pause(), this._msectl && this._msectl.seek(0), this._transmuxer && (this._transmuxer.close(), this._transmuxer.destroy(), this._transmuxer = null) } }, { key: "play", value: function () { return this._mediaElement.play() } }, { key: "pause", value: function () { this._mediaElement.pause() } }, { key: "_fillStatisticsInfo", value: function (e) { if (e.playerType = this._type, !(this._mediaElement instanceof HTMLVideoElement)) return e; var t = !0, n = 0, i = 0; if (this._mediaElement.getVideoPlaybackQuality) { var r = this._mediaElement.getVideoPlaybackQuality(); n = r.totalVideoFrames, i = r.droppedVideoFrames } else void 0 != this._mediaElement.webkitDecodedFrameCount ? (n = this._mediaElement.webkitDecodedFrameCount, i = this._mediaElement.webkitDroppedFrameCount) : t = !1; return t && (e.decodedFrames = n, e.droppedFrames = i), e } }, { key: "_onmseUpdateEnd", value: function () { if (this._config.lazyLoad && !this._config.isLive) { for (var e = this._mediaElement.buffered, t = this._mediaElement.currentTime, n = 0, i = 0; i < e.length; i++) { var r = e.start(i), s = e.end(i); if (r <= t && t < s) { r, n = s; break } } n >= t + this._config.lazyLoadMaxDuration && null == this._progressChecker && (d.default.v(this.TAG, "Maximum buffering duration exceeded, suspend transmuxing task"), this._suspendTransmuxer()) } } }, { key: "_onmseBufferFull", value: function () { d.default.v(this.TAG, "MSE SourceBuffer is full, suspend transmuxing task"), null == this._progressChecker && this._suspendTransmuxer() } }, { key: "_suspendTransmuxer", value: function () { this._transmuxer && (this._transmuxer.pause(), null == this._progressChecker && (this._progressChecker = window.setInterval(this._checkProgressAndResume.bind(this), 1e3))) } }, { key: "_checkProgressAndResume", value: function () { for (var e = this._mediaElement.currentTime, t = this._mediaElement.buffered, n = !1, i = 0; i < t.length; i++) { var r = t.start(i), s = t.end(i); if (e >= r && e < s) { e >= s - this._config.lazyLoadRecoverDuration && (n = !0); break } } n && (window.clearInterval(this._progressChecker), this._progressChecker = null, n && (d.default.v(this.TAG, "Continue loading from paused position"), this._transmuxer.resume())) } }, { key: "_isTimepointBuffered", value: function (e) { for (var t = this._mediaElement.buffered, n = 0; n < t.length; n++) { var i = t.start(n), r = t.end(n); if (e >= i && e < r) return !0 } return !1 } }, { key: "_internalSeek", value: function (e) { var t = this._isTimepointBuffered(e), n = !1, i = 0; if (e < 1 && this._mediaElement.buffered.length > 0) { var r = this._mediaElement.buffered.start(0); (r < 1 && e < r || f.default.safari) && (n = !0, i = f.default.safari ? .1 : r) } if (n) this._requestSetTime = !0, this._mediaElement.currentTime = i; else if (t) { if (this._alwaysSeekKeyframe) { var s = this._msectl.getNearestKeyframe(Math.floor(1e3 * e)); this._requestSetTime = !0, this._mediaElement.currentTime = null != s ? s.dts / 1e3 : e } else this._requestSetTime = !0, this._mediaElement.currentTime = e; null != this._progressChecker && this._checkProgressAndResume() } else null != this._progressChecker && (window.clearInterval(this._progressChecker), this._progressChecker = null), this._msectl.seek(e), this._transmuxer.seek(Math.floor(1e3 * e)), this._config.accurateSeek && (this._requestSetTime = !0, this._mediaElement.currentTime = e) } }, { key: "_checkAndApplyUnbufferedSeekpoint", value: function () { if (this._seekpointRecord) if (this._seekpointRecord.recordTime <= this._now() - 100) { var e = this._mediaElement.currentTime; this._seekpointRecord = null, this._isTimepointBuffered(e) || (null != this._progressChecker && (window.clearTimeout(this._progressChecker), this._progressChecker = null), this._msectl.seek(e), this._transmuxer.seek(Math.floor(1e3 * e)), this._config.accurateSeek && (this._requestSetTime = !0, this._mediaElement.currentTime = e)) } else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this), 50) } }, { key: "_checkAndResumeStuckPlayback", value: function (e) { var t = this._mediaElement; if (e || !this._receivedCanPlay || t.readyState < 2) { var n = t.buffered; n.length > 0 && t.currentTime < n.start(0) && (d.default.w(this.TAG, "Playback seems stuck at " + t.currentTime + ", seek to " + n.start(0)), this._requestSetTime = !0, this._mediaElement.currentTime = n.start(0), this._mediaElement.removeEventListener("progress", this.e.onvProgress)) } else this._mediaElement.removeEventListener("progress", this.e.onvProgress) } }, { key: "_onvLoadedMetadata", value: function (e) { null != this._pendingSeekTime && (this._mediaElement.currentTime = this._pendingSeekTime, this._pendingSeekTime = null) } }, { key: "_onvSeeking", value: function (e) { var t = this._mediaElement.currentTime, n = this._mediaElement.buffered; if (this._requestSetTime) return void (this._requestSetTime = !1); if (t < 1 && n.length > 0) { var i = n.start(0); if (i < 1 && t < i || f.default.safari) return this._requestSetTime = !0, void (this._mediaElement.currentTime = f.default.safari ? .1 : i) } if (this._isTimepointBuffered(t)) { if (this._alwaysSeekKeyframe) { var r = this._msectl.getNearestKeyframe(Math.floor(1e3 * t)); null != r && (this._requestSetTime = !0, this._mediaElement.currentTime = r.dts / 1e3) } return void (null != this._progressChecker && this._checkProgressAndResume()) } this._seekpointRecord = { seekPoint: t, recordTime: this._now() }, window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this), 50) } }, { key: "_onvCanPlay", value: function (e) { this._receivedCanPlay = !0, this._mediaElement.removeEventListener("canplay", this.e.onvCanPlay) } }, { key: "_onvStalled", value: function (e) { this._checkAndResumeStuckPlayback(!0) } }, { key: "_onvProgress", value: function (e) { this._checkAndResumeStuckPlayback() } }, { key: "type", get: function () { return this._type } }, { key: "buffered", get: function () { return this._mediaElement.buffered } }, { key: "duration", get: function () { return this._mediaElement.duration } }, { key: "volume", get: function () { return this._mediaElement.volume }, set: function (e) { this._mediaElement.volume = e } }, { key: "muted", get: function () { return this._mediaElement.muted }, set: function (e) { this._mediaElement.muted = e } }, { key: "currentTime", get: function () { return this._mediaElement ? this._mediaElement.currentTime : 0 }, set: function (e) { this._mediaElement ? this._internalSeek(e) : this._pendingSeekTime = e } }, { key: "mediaInfo", get: function () { return Object.assign({}, this._mediaInfo) } }, { key: "statisticsInfo", get: function () { return null == this._statisticsInfo && (this._statisticsInfo = {}), this._statisticsInfo = this._fillStatisticsInfo(this._statisticsInfo), Object.assign({}, this._statisticsInfo) } }]), e
            }(); n.default = A
        }, { "../config.js": 5, "../core/mse-controller.js": 9, "../core/mse-events.js": 10, "../core/transmuxer.js": 11, "../core/transmuxing-events.js": 13, "../utils/browser.js": 39, "../utils/exception.js": 40, "../utils/logger.js": 41, "./player-errors.js": 34, "./player-events.js": 35, events: 2 }], 33: [function (e, t, n) { "use strict"; function i(e) { return e && e.__esModule ? e : { default: e } } function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(n, "__esModule", { value: !0 }); var s = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, a = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), o = e("events"), u = i(o), l = e("./player-events.js"), d = i(l), h = e("../config.js"), f = e("../utils/exception.js"), c = function () { function e(t, n) { if (r(this, e), this.TAG = "NativePlayer", this._type = "NativePlayer", this._emitter = new u.default, this._config = (0, h.createDefaultConfig)(), "object" === (void 0 === n ? "undefined" : s(n)) && Object.assign(this._config, n), "flv" === t.type.toLowerCase()) throw new f.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!"); if (t.hasOwnProperty("segments")) throw new f.InvalidArgumentException("NativePlayer(" + t.type + ") doesn't support multipart playback!"); this.e = { onvLoadedMetadata: this._onvLoadedMetadata.bind(this) }, this._pendingSeekTime = null, this._statisticsReporter = null, this._mediaDataSource = t, this._mediaElement = null } return a(e, [{ key: "destroy", value: function () { this._mediaElement && (this.unload(), this.detachMediaElement()), this.e = null, this._mediaDataSource = null, this._emitter.removeAllListeners(), this._emitter = null } }, { key: "on", value: function (e, t) { var n = this; e === d.default.MEDIA_INFO ? null != this._mediaElement && 0 !== this._mediaElement.readyState && Promise.resolve().then(function () { n._emitter.emit(d.default.MEDIA_INFO, n.mediaInfo) }) : e === d.default.STATISTICS_INFO && null != this._mediaElement && 0 !== this._mediaElement.readyState && Promise.resolve().then(function () { n._emitter.emit(d.default.STATISTICS_INFO, n.statisticsInfo) }), this._emitter.addListener(e, t) } }, { key: "off", value: function (e, t) { this._emitter.removeListener(e, t) } }, { key: "attachMediaElement", value: function (e) { if (this._mediaElement = e, e.addEventListener("loadedmetadata", this.e.onvLoadedMetadata), null != this._pendingSeekTime) try { e.currentTime = this._pendingSeekTime, this._pendingSeekTime = null } catch (e) { } } }, { key: "detachMediaElement", value: function () { this._mediaElement && (this._mediaElement.src = "", this._mediaElement.removeAttribute("src"), this._mediaElement.removeEventListener("loadedmetadata", this.e.onvLoadedMetadata), this._mediaElement = null), null != this._statisticsReporter && (window.clearInterval(this._statisticsReporter), this._statisticsReporter = null) } }, { key: "load", value: function () { if (!this._mediaElement) throw new f.IllegalStateException("HTMLMediaElement must be attached before load()!"); this._mediaElement.src = this._mediaDataSource.url, this._mediaElement.readyState > 0 && (this._mediaElement.currentTime = 0), this._mediaElement.preload = "auto", this._mediaElement.load(), this._statisticsReporter = window.setInterval(this._reportStatisticsInfo.bind(this), this._config.statisticsInfoReportInterval) } }, { key: "unload", value: function () { this._mediaElement && (this._mediaElement.src = "", this._mediaElement.removeAttribute("src")), null != this._statisticsReporter && (window.clearInterval(this._statisticsReporter), this._statisticsReporter = null) } }, { key: "play", value: function () { return this._mediaElement.play() } }, { key: "pause", value: function () { this._mediaElement.pause() } }, { key: "_onvLoadedMetadata", value: function (e) { null != this._pendingSeekTime && (this._mediaElement.currentTime = this._pendingSeekTime, this._pendingSeekTime = null), this._emitter.emit(d.default.MEDIA_INFO, this.mediaInfo) } }, { key: "_reportStatisticsInfo", value: function () { this._emitter.emit(d.default.STATISTICS_INFO, this.statisticsInfo) } }, { key: "type", get: function () { return this._type } }, { key: "buffered", get: function () { return this._mediaElement.buffered } }, { key: "duration", get: function () { return this._mediaElement.duration } }, { key: "volume", get: function () { return this._mediaElement.volume }, set: function (e) { this._mediaElement.volume = e } }, { key: "muted", get: function () { return this._mediaElement.muted }, set: function (e) { this._mediaElement.muted = e } }, { key: "currentTime", get: function () { return this._mediaElement ? this._mediaElement.currentTime : 0 }, set: function (e) { this._mediaElement ? this._mediaElement.currentTime = e : this._pendingSeekTime = e } }, { key: "mediaInfo", get: function () { var e = this._mediaElement instanceof HTMLAudioElement ? "audio/" : "video/", t = { mimeType: e + this._mediaDataSource.type }; return this._mediaElement && (t.duration = Math.floor(1e3 * this._mediaElement.duration), this._mediaElement instanceof HTMLVideoElement && (t.width = this._mediaElement.videoWidth, t.height = this._mediaElement.videoHeight)), t } }, { key: "statisticsInfo", get: function () { var e = { playerType: this._type, url: this._mediaDataSource.url }; if (!(this._mediaElement instanceof HTMLVideoElement)) return e; var t = !0, n = 0, i = 0; if (this._mediaElement.getVideoPlaybackQuality) { var r = this._mediaElement.getVideoPlaybackQuality(); n = r.totalVideoFrames, i = r.droppedVideoFrames } else void 0 != this._mediaElement.webkitDecodedFrameCount ? (n = this._mediaElement.webkitDecodedFrameCount, i = this._mediaElement.webkitDroppedFrameCount) : t = !1; return t && (e.decodedFrames = n, e.droppedFrames = i), e } }]), e }(); n.default = c }, { "../config.js": 5, "../utils/exception.js": 40, "./player-events.js": 35, events: 2 }], 34: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }), n.ErrorDetails = n.ErrorTypes = void 0; var i = e("../io/loader.js"), r = e("../demux/demux-errors.js"), s = function (e) { return e && e.__esModule ? e : { default: e } }(r); n.ErrorTypes = { NETWORK_ERROR: "NetworkError", MEDIA_ERROR: "MediaError", OTHER_ERROR: "OtherError" }, n.ErrorDetails = { NETWORK_EXCEPTION: i.LoaderErrors.EXCEPTION, NETWORK_STATUS_CODE_INVALID: i.LoaderErrors.HTTP_STATUS_CODE_INVALID, NETWORK_TIMEOUT: i.LoaderErrors.CONNECTING_TIMEOUT, NETWORK_UNRECOVERABLE_EARLY_EOF: i.LoaderErrors.UNRECOVERABLE_EARLY_EOF, MEDIA_MSE_ERROR: "MediaMSEError", MEDIA_FORMAT_ERROR: s.default.FORMAT_ERROR, MEDIA_FORMAT_UNSUPPORTED: s.default.FORMAT_UNSUPPORTED, MEDIA_CODEC_UNSUPPORTED: s.default.CODEC_UNSUPPORTED } }, { "../demux/demux-errors.js": 16, "../io/loader.js": 24 }], 35: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }); var i = { ERROR: "error", LOADING_COMPLETE: "loading_complete", RECOVERED_EARLY_EOF: "recovered_early_eof", MEDIA_INFO: "media_info", METADATA_ARRIVED: "metadata_arrived", SCRIPTDATA_ARRIVED: "scriptdata_arrived", STATISTICS_INFO: "statistics_info" }; n.default = i }, {}], 36: [function (e, t, n) { "use strict"; function i(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(n, "__esModule", { value: !0 }); var r = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), s = function () { function e() { i(this, e) } return r(e, null, [{ key: "getSilentFrame", value: function (e, t) { if ("mp4a.40.2" === e) { if (1 === t) return new Uint8Array([0, 200, 0, 128, 35, 128]); if (2 === t) return new Uint8Array([33, 0, 73, 144, 2, 25, 0, 35, 128]); if (3 === t) return new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 142]); if (4 === t) return new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 128, 44, 128, 8, 2, 56]); if (5 === t) return new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 130, 48, 4, 153, 0, 33, 144, 2, 56]); if (6 === t) return new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 130, 48, 4, 153, 0, 33, 144, 2, 0, 178, 0, 32, 8, 224]) } else { if (1 === t) return new Uint8Array([1, 64, 34, 128, 163, 78, 230, 128, 186, 8, 0, 0, 0, 28, 6, 241, 193, 10, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 94]); if (2 === t) return new Uint8Array([1, 64, 34, 128, 163, 94, 230, 128, 186, 8, 0, 0, 0, 0, 149, 0, 6, 241, 161, 10, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 94]); if (3 === t) return new Uint8Array([1, 64, 34, 128, 163, 94, 230, 128, 186, 8, 0, 0, 0, 0, 149, 0, 6, 241, 161, 10, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 94]) } return null } }]), e }(); n.default = s }, {}], 37: [function (e, t, n) { "use strict"; function i(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(n, "__esModule", { value: !0 }); var r = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), s = function () { function e() { i(this, e) } return r(e, null, [{ key: "init", value: function () { e.types = { avc1: [], avcC: [], btrt: [], dinf: [], dref: [], esds: [], ftyp: [], hdlr: [], mdat: [], mdhd: [], mdia: [], mfhd: [], minf: [], moof: [], moov: [], mp4a: [], mvex: [], mvhd: [], sdtp: [], stbl: [], stco: [], stsc: [], stsd: [], stsz: [], stts: [], tfdt: [], tfhd: [], traf: [], trak: [], trun: [], trex: [], tkhd: [], vmhd: [], smhd: [], ".mp3": [] }; for (var t in e.types) e.types.hasOwnProperty(t) && (e.types[t] = [t.charCodeAt(0), t.charCodeAt(1), t.charCodeAt(2), t.charCodeAt(3)]); var n = e.constants = {}; n.FTYP = new Uint8Array([105, 115, 111, 109, 0, 0, 0, 1, 105, 115, 111, 109, 97, 118, 99, 49]), n.STSD_PREFIX = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1]), n.STTS = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]), n.STSC = n.STCO = n.STTS, n.STSZ = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]), n.HDLR_VIDEO = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 118, 105, 100, 101, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86, 105, 100, 101, 111, 72, 97, 110, 100, 108, 101, 114, 0]), n.HDLR_AUDIO = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 115, 111, 117, 110, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 83, 111, 117, 110, 100, 72, 97, 110, 100, 108, 101, 114, 0]), n.DREF = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 12, 117, 114, 108, 32, 0, 0, 0, 1]), n.SMHD = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]), n.VMHD = new Uint8Array([0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0]) } }, { key: "box", value: function (e) { for (var t = 8, n = null, i = Array.prototype.slice.call(arguments, 1), r = i.length, s = 0; s < r; s++)t += i[s].byteLength; n = new Uint8Array(t), n[0] = t >>> 24 & 255, n[1] = t >>> 16 & 255, n[2] = t >>> 8 & 255, n[3] = 255 & t, n.set(e, 4); for (var a = 8, o = 0; o < r; o++)n.set(i[o], a), a += i[o].byteLength; return n } }, { key: "generateInitSegment", value: function (t) { var n = e.box(e.types.ftyp, e.constants.FTYP), i = e.moov(t), r = new Uint8Array(n.byteLength + i.byteLength); return r.set(n, 0), r.set(i, n.byteLength), r } }, { key: "moov", value: function (t) { var n = e.mvhd(t.timescale, t.duration), i = e.trak(t), r = e.mvex(t); return e.box(e.types.moov, n, i, r) } }, { key: "mvhd", value: function (t, n) { return e.box(e.types.mvhd, new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, t >>> 24 & 255, t >>> 16 & 255, t >>> 8 & 255, 255 & t, n >>> 24 & 255, n >>> 16 & 255, n >>> 8 & 255, 255 & n, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255])) } }, { key: "trak", value: function (t) { return e.box(e.types.trak, e.tkhd(t), e.mdia(t)) } }, { key: "tkhd", value: function (t) { var n = t.id, i = t.duration, r = t.presentWidth, s = t.presentHeight; return e.box(e.types.tkhd, new Uint8Array([0, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 0, n >>> 24 & 255, n >>> 16 & 255, n >>> 8 & 255, 255 & n, 0, 0, 0, 0, i >>> 24 & 255, i >>> 16 & 255, i >>> 8 & 255, 255 & i, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 0, 0, r >>> 8 & 255, 255 & r, 0, 0, s >>> 8 & 255, 255 & s, 0, 0])) } }, { key: "mdia", value: function (t) { return e.box(e.types.mdia, e.mdhd(t), e.hdlr(t), e.minf(t)) } }, { key: "mdhd", value: function (t) { var n = t.timescale, i = t.duration; return e.box(e.types.mdhd, new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, n >>> 24 & 255, n >>> 16 & 255, n >>> 8 & 255, 255 & n, i >>> 24 & 255, i >>> 16 & 255, i >>> 8 & 255, 255 & i, 85, 196, 0, 0])) } }, { key: "hdlr", value: function (t) { var n = null; return n = "audio" === t.type ? e.constants.HDLR_AUDIO : e.constants.HDLR_VIDEO, e.box(e.types.hdlr, n) } }, { key: "minf", value: function (t) { var n = null; return n = "audio" === t.type ? e.box(e.types.smhd, e.constants.SMHD) : e.box(e.types.vmhd, e.constants.VMHD), e.box(e.types.minf, n, e.dinf(), e.stbl(t)) } }, { key: "dinf", value: function () { return e.box(e.types.dinf, e.box(e.types.dref, e.constants.DREF)) } }, { key: "stbl", value: function (t) { return e.box(e.types.stbl, e.stsd(t), e.box(e.types.stts, e.constants.STTS), e.box(e.types.stsc, e.constants.STSC), e.box(e.types.stsz, e.constants.STSZ), e.box(e.types.stco, e.constants.STCO)) } }, { key: "stsd", value: function (t) { return "audio" === t.type ? "mp3" === t.codec ? e.box(e.types.stsd, e.constants.STSD_PREFIX, e.mp3(t)) : e.box(e.types.stsd, e.constants.STSD_PREFIX, e.mp4a(t)) : e.box(e.types.stsd, e.constants.STSD_PREFIX, e.avc1(t)) } }, { key: "mp3", value: function (t) { var n = t.channelCount, i = t.audioSampleRate, r = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, n, 0, 16, 0, 0, 0, 0, i >>> 8 & 255, 255 & i, 0, 0]); return e.box(e.types[".mp3"], r) } }, { key: "mp4a", value: function (t) { var n = t.channelCount, i = t.audioSampleRate, r = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, n, 0, 16, 0, 0, 0, 0, i >>> 8 & 255, 255 & i, 0, 0]); return e.box(e.types.mp4a, r, e.esds(t)) } }, { key: "esds", value: function (t) { var n = t.config || [], i = n.length, r = new Uint8Array([0, 0, 0, 0, 3, 23 + i, 0, 1, 0, 4, 15 + i, 64, 21, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5].concat([i]).concat(n).concat([6, 1, 2])); return e.box(e.types.esds, r) } }, { key: "avc1", value: function (t) { var n = t.avcc, i = t.codecWidth, r = t.codecHeight, s = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, i >>> 8 & 255, 255 & i, r >>> 8 & 255, 255 & r, 0, 72, 0, 0, 0, 72, 0, 0, 0, 0, 0, 0, 0, 1, 10, 120, 113, 113, 47, 102, 108, 118, 46, 106, 115, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 255, 255]); return e.box(e.types.avc1, s, e.box(e.types.avcC, n)) } }, { key: "mvex", value: function (t) { return e.box(e.types.mvex, e.trex(t)) } }, { key: "trex", value: function (t) { var n = t.id, i = new Uint8Array([0, 0, 0, 0, n >>> 24 & 255, n >>> 16 & 255, n >>> 8 & 255, 255 & n, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1]); return e.box(e.types.trex, i) } }, { key: "moof", value: function (t, n) { return e.box(e.types.moof, e.mfhd(t.sequenceNumber), e.traf(t, n)) } }, { key: "mfhd", value: function (t) { var n = new Uint8Array([0, 0, 0, 0, t >>> 24 & 255, t >>> 16 & 255, t >>> 8 & 255, 255 & t]); return e.box(e.types.mfhd, n) } }, { key: "traf", value: function (t, n) { var i = t.id, r = e.box(e.types.tfhd, new Uint8Array([0, 0, 0, 0, i >>> 24 & 255, i >>> 16 & 255, i >>> 8 & 255, 255 & i])), s = e.box(e.types.tfdt, new Uint8Array([0, 0, 0, 0, n >>> 24 & 255, n >>> 16 & 255, n >>> 8 & 255, 255 & n])), a = e.sdtp(t), o = e.trun(t, a.byteLength + 16 + 16 + 8 + 16 + 8 + 8); return e.box(e.types.traf, r, s, o, a) } }, { key: "sdtp", value: function (t) { for (var n = t.samples || [], i = n.length, r = new Uint8Array(4 + i), s = 0; s < i; s++) { var a = n[s].flags; r[s + 4] = a.isLeading << 6 | a.dependsOn << 4 | a.isDependedOn << 2 | a.hasRedundancy } return e.box(e.types.sdtp, r) } }, { key: "trun", value: function (t, n) { var i = t.samples || [], r = i.length, s = 12 + 16 * r, a = new Uint8Array(s); n += 8 + s, a.set([0, 0, 15, 1, r >>> 24 & 255, r >>> 16 & 255, r >>> 8 & 255, 255 & r, n >>> 24 & 255, n >>> 16 & 255, n >>> 8 & 255, 255 & n], 0); for (var o = 0; o < r; o++) { var u = i[o].duration, l = i[o].size, d = i[o].flags, h = i[o].cts; a.set([u >>> 24 & 255, u >>> 16 & 255, u >>> 8 & 255, 255 & u, l >>> 24 & 255, l >>> 16 & 255, l >>> 8 & 255, 255 & l, d.isLeading << 2 | d.dependsOn, d.isDependedOn << 6 | d.hasRedundancy << 4 | d.isNonSync, 0, 0, h >>> 24 & 255, h >>> 16 & 255, h >>> 8 & 255, 255 & h], 12 + 16 * o) } return e.box(e.types.trun, a) } }, { key: "mdat", value: function (t) { return e.box(e.types.mdat, t) } }]), e }(); s.init(), n.default = s }, {}], 38: [function (e, t, n) {
            "use strict"; function i(e) { return e && e.__esModule ? e : { default: e } } function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(n, "__esModule", { value: !0 }); var s = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), a = e("../utils/logger.js"), o = i(a), u = e("./mp4-generator.js"), l = i(u), d = e("./aac-silent.js"), h = i(d), f = e("../utils/browser.js"), c = i(f), _ = e("../core/media-segment-info.js"), m = e("../utils/exception.js"), p = function () {
                function e(t) { r(this, e), this.TAG = "MP4Remuxer", this._config = t, this._isLive = !0 === t.isLive, this._dtsBase = -1, this._dtsBaseInited = !1, this._audioDtsBase = 1 / 0, this._videoDtsBase = 1 / 0, this._audioNextDts = void 0, this._videoNextDts = void 0, this._audioStashedLastSample = null, this._videoStashedLastSample = null, this._audioMeta = null, this._videoMeta = null, this._audioSegmentInfoList = new _.MediaSegmentInfoList("audio"), this._videoSegmentInfoList = new _.MediaSegmentInfoList("video"), this._onInitSegment = null, this._onMediaSegment = null, this._forceFirstIDR = !(!c.default.chrome || !(c.default.version.major < 50 || 50 === c.default.version.major && c.default.version.build < 2661)), this._fillSilentAfterSeek = c.default.msedge || c.default.msie, this._mp3UseMpegAudio = !c.default.firefox, this._fillAudioTimestampGap = this._config.fixAudioTimestampGap } return s(e, [{ key: "destroy", value: function () { this._dtsBase = -1, this._dtsBaseInited = !1, this._audioMeta = null, this._videoMeta = null, this._audioSegmentInfoList.clear(), this._audioSegmentInfoList = null, this._videoSegmentInfoList.clear(), this._videoSegmentInfoList = null, this._onInitSegment = null, this._onMediaSegment = null } }, { key: "bindDataSource", value: function (e) { return e.onDataAvailable = this.remux.bind(this), e.onTrackMetadata = this._onTrackMetadataReceived.bind(this), this } }, { key: "insertDiscontinuity", value: function () { this._audioNextDts = this._videoNextDts = void 0 } }, { key: "seek", value: function (e) { this._audioStashedLastSample = null, this._videoStashedLastSample = null, this._videoSegmentInfoList.clear(), this._audioSegmentInfoList.clear() } }, { key: "remux", value: function (e, t) { if (!this._onMediaSegment) throw new m.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!"); this._dtsBaseInited || this._calculateDtsBase(e, t), this._remuxVideo(t), this._remuxAudio(e) } }, { key: "_onTrackMetadataReceived", value: function (e, t) { var n = null, i = "mp4", r = t.codec; if ("audio" === e) this._audioMeta = t, "mp3" === t.codec && this._mp3UseMpegAudio ? (i = "mpeg", r = "", n = new Uint8Array) : n = l.default.generateInitSegment(t); else { if ("video" !== e) return; this._videoMeta = t, n = l.default.generateInitSegment(t) } if (!this._onInitSegment) throw new m.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!"); this._onInitSegment(e, { type: e, data: n.buffer, codec: r, container: e + "/" + i, mediaDuration: t.duration }) } }, { key: "_calculateDtsBase", value: function (e, t) { this._dtsBaseInited || (e.samples && e.samples.length && (this._audioDtsBase = e.samples[0].dts), t.samples && t.samples.length && (this._videoDtsBase = t.samples[0].dts), this._dtsBase = Math.min(this._audioDtsBase, this._videoDtsBase), this._dtsBaseInited = !0) } }, { key: "flushStashedSamples", value: function () { var e = this._videoStashedLastSample, t = this._audioStashedLastSample, n = { type: "video", id: 1, sequenceNumber: 0, samples: [], length: 0 }; null != e && (n.samples.push(e), n.length = e.length); var i = { type: "audio", id: 2, sequenceNumber: 0, samples: [], length: 0 }; null != t && (i.samples.push(t), i.length = t.length), this._videoStashedLastSample = null, this._audioStashedLastSample = null, this._remuxVideo(n, !0), this._remuxAudio(i, !0) } }, {
                    key: "_remuxAudio", value: function (e, t) {
                        if (null != this._audioMeta) {
                            var n = e, i = n.samples, r = void 0, s = -1, a = -1, u = this._audioMeta.refSampleDuration, d = "mp3" === this._audioMeta.codec && this._mp3UseMpegAudio, f = this._dtsBaseInited && void 0 === this._audioNextDts, m = !1; if (i && 0 !== i.length && (1 !== i.length || t)) {
                                var p = 0, v = null, g = 0; d ? (p = 0, g = n.length) : (p = 8, g = 8 + n.length); var y = null; if (i.length > 1 && (y = i.pop(), g -= y.length), null != this._audioStashedLastSample) { var E = this._audioStashedLastSample; this._audioStashedLastSample = null, i.unshift(E), g += E.length } null != y && (this._audioStashedLastSample = y); var b = i[0].dts - this._dtsBase; if (this._audioNextDts) r = b - this._audioNextDts; else if (this._audioSegmentInfoList.isEmpty()) r = 0, this._fillSilentAfterSeek && !this._videoSegmentInfoList.isEmpty() && "mp3" !== this._audioMeta.originalCodec && (m = !0); else { var S = this._audioSegmentInfoList.getLastSampleBefore(b); if (null != S) { var k = b - (S.originalDts + S.duration); k <= 3 && (k = 0); var L = S.dts + S.duration + k; r = b - L } else r = 0 } if (m) { var R = b - r, A = this._videoSegmentInfoList.getLastSegmentBefore(b); if (null != A && A.beginDts < R) { var w = h.default.getSilentFrame(this._audioMeta.originalCodec, this._audioMeta.channelCount); if (w) { var T = A.beginDts, O = R - A.beginDts; o.default.v(this.TAG, "InsertPrefixSilentAudio: dts: " + T + ", duration: " + O), i.unshift({ unit: w, dts: T, pts: T }), g += w.byteLength } } else m = !1 } for (var C = [], I = 0; I < i.length; I++) { var D = i[I], x = D.unit, M = D.dts - this._dtsBase, B = M - r; -1 === s && (s = B); var j = 0; if (I !== i.length - 1) { j = i[I + 1].dts - this._dtsBase - r - B } else if (null != y) { var P = y.dts - this._dtsBase - r; j = P - B } else j = C.length >= 1 ? C[C.length - 1].duration : Math.floor(u); var U = !1, N = null; if (j > 1.5 * u && "mp3" !== this._audioMeta.codec && this._fillAudioTimestampGap && !c.default.safari) { U = !0; var F = Math.abs(j - u), G = Math.ceil(F / u), V = B + u; o.default.w(this.TAG, "Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.\ndts: " + (B + j) + " ms, expected: " + (B + Math.round(u)) + " ms, delta: " + Math.round(F) + " ms, generate: " + G + " frames"); var z = h.default.getSilentFrame(this._audioMeta.originalCodec, this._audioMeta.channelCount); null == z && (o.default.w(this.TAG, "Unable to generate silent frame for " + this._audioMeta.originalCodec + " with " + this._audioMeta.channelCount + " channels, repeat last frame"), z = x), N = []; for (var H = 0; H < G; H++) { var K = Math.round(V); if (N.length > 0) { var q = N[N.length - 1]; q.duration = K - q.dts } var W = { dts: K, pts: K, cts: 0, unit: z, size: z.byteLength, duration: 0, originalDts: M, flags: { isLeading: 0, dependsOn: 1, isDependedOn: 0, hasRedundancy: 0 } }; N.push(W), g += W.size, V += u } var X = N[N.length - 1]; X.duration = B + j - X.dts, j = Math.round(u) } C.push({ dts: B, pts: B, cts: 0, unit: D.unit, size: D.unit.byteLength, duration: j, originalDts: M, flags: { isLeading: 0, dependsOn: 1, isDependedOn: 0, hasRedundancy: 0 } }), U && C.push.apply(C, N) } d ? v = new Uint8Array(g) : (v = new Uint8Array(g), v[0] = g >>> 24 & 255, v[1] = g >>> 16 & 255, v[2] = g >>> 8 & 255, v[3] = 255 & g, v.set(l.default.types.mdat, 4)); for (var Y = 0; Y < C.length; Y++) { var Z = C[Y].unit; v.set(Z, p), p += Z.byteLength } var Q = C[C.length - 1]; a = Q.dts + Q.duration, this._audioNextDts = a; var J = new _.MediaSegmentInfo; J.beginDts = s, J.endDts = a, J.beginPts = s, J.endPts = a, J.originalBeginDts = C[0].originalDts, J.originalEndDts = Q.originalDts + Q.duration,
                                    J.firstSample = new _.SampleInfo(C[0].dts, C[0].pts, C[0].duration, C[0].originalDts, !1), J.lastSample = new _.SampleInfo(Q.dts, Q.pts, Q.duration, Q.originalDts, !1), this._isLive || this._audioSegmentInfoList.append(J), n.samples = C, n.sequenceNumber++; var $ = null; $ = d ? new Uint8Array : l.default.moof(n, s), n.samples = [], n.length = 0; var ee = { type: "audio", data: this._mergeBoxes($, v).buffer, sampleCount: C.length, info: J }; d && f && (ee.timestampOffset = s), this._onMediaSegment("audio", ee)
                            }
                        }
                    }
                }, { key: "_remuxVideo", value: function (e, t) { if (null != this._videoMeta) { var n = e, i = n.samples, r = void 0, s = -1, a = -1, o = -1, u = -1; if (i && 0 !== i.length && (1 !== i.length || t)) { var d = 8, h = null, f = 8 + e.length, c = null; if (i.length > 1 && (c = i.pop(), f -= c.length), null != this._videoStashedLastSample) { var m = this._videoStashedLastSample; this._videoStashedLastSample = null, i.unshift(m), f += m.length } null != c && (this._videoStashedLastSample = c); var p = i[0].dts - this._dtsBase; if (this._videoNextDts) r = p - this._videoNextDts; else if (this._videoSegmentInfoList.isEmpty()) r = 0; else { var v = this._videoSegmentInfoList.getLastSampleBefore(p); if (null != v) { var g = p - (v.originalDts + v.duration); g <= 3 && (g = 0); var y = v.dts + v.duration + g; r = p - y } else r = 0 } for (var E = new _.MediaSegmentInfo, b = [], S = 0; S < i.length; S++) { var k = i[S], L = k.dts - this._dtsBase, R = k.isKeyframe, A = L - r, w = k.cts, T = A + w; -1 === s && (s = A, o = T); var O = 0; if (S !== i.length - 1) { O = i[S + 1].dts - this._dtsBase - r - A } else if (null != c) { var C = c.dts - this._dtsBase - r; O = C - A } else O = b.length >= 1 ? b[b.length - 1].duration : Math.floor(this._videoMeta.refSampleDuration); if (R) { var I = new _.SampleInfo(A, T, O, k.dts, !0); I.fileposition = k.fileposition, E.appendSyncPoint(I) } b.push({ dts: A, pts: T, cts: w, units: k.units, size: k.length, isKeyframe: R, duration: O, originalDts: L, flags: { isLeading: 0, dependsOn: R ? 2 : 1, isDependedOn: R ? 1 : 0, hasRedundancy: 0, isNonSync: R ? 0 : 1 } }) } h = new Uint8Array(f), h[0] = f >>> 24 & 255, h[1] = f >>> 16 & 255, h[2] = f >>> 8 & 255, h[3] = 255 & f, h.set(l.default.types.mdat, 4); for (var D = 0; D < b.length; D++)for (var x = b[D].units; x.length;) { var M = x.shift(), B = M.data; h.set(B, d), d += B.byteLength } var j = b[b.length - 1]; if (a = j.dts + j.duration, u = j.pts + j.duration, this._videoNextDts = a, E.beginDts = s, E.endDts = a, E.beginPts = o, E.endPts = u, E.originalBeginDts = b[0].originalDts, E.originalEndDts = j.originalDts + j.duration, E.firstSample = new _.SampleInfo(b[0].dts, b[0].pts, b[0].duration, b[0].originalDts, b[0].isKeyframe), E.lastSample = new _.SampleInfo(j.dts, j.pts, j.duration, j.originalDts, j.isKeyframe), this._isLive || this._videoSegmentInfoList.append(E), n.samples = b, n.sequenceNumber++, this._forceFirstIDR) { var P = b[0].flags; P.dependsOn = 2, P.isNonSync = 0 } var U = l.default.moof(n, s); n.samples = [], n.length = 0, this._onMediaSegment("video", { type: "video", data: this._mergeBoxes(U, h).buffer, sampleCount: b.length, info: E }) } } } }, { key: "_mergeBoxes", value: function (e, t) { var n = new Uint8Array(e.byteLength + t.byteLength); return n.set(e, 0), n.set(t, e.byteLength), n } }, { key: "onInitSegment", get: function () { return this._onInitSegment }, set: function (e) { this._onInitSegment = e } }, { key: "onMediaSegment", get: function () { return this._onMediaSegment }, set: function (e) { this._onMediaSegment = e } }]), e
            }(); n.default = p
        }, { "../core/media-segment-info.js": 8, "../utils/browser.js": 39, "../utils/exception.js": 40, "../utils/logger.js": 41, "./aac-silent.js": 36, "./mp4-generator.js": 37 }], 39: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }); var i = {}; !function () { var e = self.navigator.userAgent.toLowerCase(), t = /(edge)\/([\w.]+)/.exec(e) || /(opr)[\/]([\w.]+)/.exec(e) || /(chrome)[ \/]([\w.]+)/.exec(e) || /(iemobile)[\/]([\w.]+)/.exec(e) || /(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e) || /(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e) || /(webkit)[ \/]([\w.]+)/.exec(e) || /(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e) || /(msie) ([\w.]+)/.exec(e) || e.indexOf("trident") >= 0 && /(rv)(?::| )([\w.]+)/.exec(e) || e.indexOf("compatible") < 0 && /(firefox)[ \/]([\w.]+)/.exec(e) || [], n = /(ipad)/.exec(e) || /(ipod)/.exec(e) || /(windows phone)/.exec(e) || /(iphone)/.exec(e) || /(kindle)/.exec(e) || /(android)/.exec(e) || /(windows)/.exec(e) || /(mac)/.exec(e) || /(linux)/.exec(e) || /(cros)/.exec(e) || [], r = { browser: t[5] || t[3] || t[1] || "", version: t[2] || t[4] || "0", majorVersion: t[4] || t[2] || "0", platform: n[0] || "" }, s = {}; if (r.browser) { s[r.browser] = !0; var a = r.majorVersion.split("."); s.version = { major: parseInt(r.majorVersion, 10), string: r.version }, a.length > 1 && (s.version.minor = parseInt(a[1], 10)), a.length > 2 && (s.version.build = parseInt(a[2], 10)) } r.platform && (s[r.platform] = !0), (s.chrome || s.opr || s.safari) && (s.webkit = !0), (s.rv || s.iemobile) && (s.rv && delete s.rv, r.browser = "msie", s.msie = !0), s.edge && (delete s.edge, r.browser = "msedge", s.msedge = !0), s.opr && (r.browser = "opera", s.opera = !0), s.safari && s.android && (r.browser = "android", s.android = !0), s.name = r.browser, s.platform = r.platform; for (var o in i) i.hasOwnProperty(o) && delete i[o]; Object.assign(i, s) }(), n.default = i }, {}], 40: [function (e, t, n) { "use strict"; function i(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t } function r(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) } function s(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(n, "__esModule", { value: !0 }); var a = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), o = n.RuntimeException = function () { function e(t) { s(this, e), this._message = t } return a(e, [{ key: "toString", value: function () { return this.name + ": " + this.message } }, { key: "name", get: function () { return "RuntimeException" } }, { key: "message", get: function () { return this._message } }]), e }(); n.IllegalStateException = function (e) { function t(e) { return s(this, t), i(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, e)) } return r(t, e), a(t, [{ key: "name", get: function () { return "IllegalStateException" } }]), t }(o), n.InvalidArgumentException = function (e) { function t(e) { return s(this, t), i(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, e)) } return r(t, e), a(t, [{ key: "name", get: function () { return "InvalidArgumentException" } }]), t }(o), n.NotImplementedException = function (e) { function t(e) { return s(this, t), i(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, e)) } return r(t, e), a(t, [{ key: "name", get: function () { return "NotImplementedException" } }]), t }(o) }, {}], 41: [function (e, t, n) { "use strict"; function i(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(n, "__esModule", { value: !0 }); var r = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), s = e("events"), a = function (e) { return e && e.__esModule ? e : { default: e } }(s), o = function () { function e() { i(this, e) } return r(e, null, [{ key: "e", value: function (t, n) { t && !e.FORCE_GLOBAL_TAG || (t = e.GLOBAL_TAG); var i = "[" + t + "] > " + n; e.ENABLE_CALLBACK && e.emitter.emit("log", "error", i), e.ENABLE_ERROR && (console.error ? console.error(i) : console.warn ? console.warn(i) : console.log(i)) } }, { key: "i", value: function (t, n) { t && !e.FORCE_GLOBAL_TAG || (t = e.GLOBAL_TAG); var i = "[" + t + "] > " + n; e.ENABLE_CALLBACK && e.emitter.emit("log", "info", i), e.ENABLE_INFO && (console.info ? console.info(i) : console.log(i)) } }, { key: "w", value: function (t, n) { t && !e.FORCE_GLOBAL_TAG || (t = e.GLOBAL_TAG); var i = "[" + t + "] > " + n; e.ENABLE_CALLBACK && e.emitter.emit("log", "warn", i), e.ENABLE_WARN && (console.warn ? console.warn(i) : console.log(i)) } }, { key: "d", value: function (t, n) { t && !e.FORCE_GLOBAL_TAG || (t = e.GLOBAL_TAG); var i = "[" + t + "] > " + n; e.ENABLE_CALLBACK && e.emitter.emit("log", "debug", i), e.ENABLE_DEBUG && (console.debug ? console.debug(i) : console.log(i)) } }, { key: "v", value: function (t, n) { t && !e.FORCE_GLOBAL_TAG || (t = e.GLOBAL_TAG); var i = "[" + t + "] > " + n; e.ENABLE_CALLBACK && e.emitter.emit("log", "verbose", i), e.ENABLE_VERBOSE && console.log(i) } }]), e }(); o.GLOBAL_TAG = "flv.js", o.FORCE_GLOBAL_TAG = !1, o.ENABLE_ERROR = !0, o.ENABLE_INFO = !0, o.ENABLE_WARN = !0, o.ENABLE_DEBUG = !0, o.ENABLE_VERBOSE = !0, o.ENABLE_CALLBACK = !1, o.emitter = new a.default, n.default = o }, { events: 2 }], 42: [function (e, t, n) { "use strict"; function i(e) { return e && e.__esModule ? e : { default: e } } function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(n, "__esModule", { value: !0 }); var s = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), a = e("events"), o = i(a), u = e("./logger.js"), l = i(u), d = function () { function e() { r(this, e) } return s(e, null, [{ key: "getConfig", value: function () { return { globalTag: l.default.GLOBAL_TAG, forceGlobalTag: l.default.FORCE_GLOBAL_TAG, enableVerbose: l.default.ENABLE_VERBOSE, enableDebug: l.default.ENABLE_DEBUG, enableInfo: l.default.ENABLE_INFO, enableWarn: l.default.ENABLE_WARN, enableError: l.default.ENABLE_ERROR, enableCallback: l.default.ENABLE_CALLBACK } } }, { key: "applyConfig", value: function (e) { l.default.GLOBAL_TAG = e.globalTag, l.default.FORCE_GLOBAL_TAG = e.forceGlobalTag, l.default.ENABLE_VERBOSE = e.enableVerbose, l.default.ENABLE_DEBUG = e.enableDebug, l.default.ENABLE_INFO = e.enableInfo, l.default.ENABLE_WARN = e.enableWarn, l.default.ENABLE_ERROR = e.enableError, l.default.ENABLE_CALLBACK = e.enableCallback } }, { key: "_notifyChange", value: function () { var t = e.emitter; if (t.listenerCount("change") > 0) { var n = e.getConfig(); t.emit("change", n) } } }, { key: "registerListener", value: function (t) { e.emitter.addListener("change", t) } }, { key: "removeListener", value: function (t) { e.emitter.removeListener("change", t) } }, { key: "addLogListener", value: function (t) { l.default.emitter.addListener("log", t), l.default.emitter.listenerCount("log") > 0 && (l.default.ENABLE_CALLBACK = !0, e._notifyChange()) } }, { key: "removeLogListener", value: function (t) { l.default.emitter.removeListener("log", t), 0 === l.default.emitter.listenerCount("log") && (l.default.ENABLE_CALLBACK = !1, e._notifyChange()) } }, { key: "forceGlobalTag", get: function () { return l.default.FORCE_GLOBAL_TAG }, set: function (t) { l.default.FORCE_GLOBAL_TAG = t, e._notifyChange() } }, { key: "globalTag", get: function () { return l.default.GLOBAL_TAG }, set: function (t) { l.default.GLOBAL_TAG = t, e._notifyChange() } }, { key: "enableAll", get: function () { return l.default.ENABLE_VERBOSE && l.default.ENABLE_DEBUG && l.default.ENABLE_INFO && l.default.ENABLE_WARN && l.default.ENABLE_ERROR }, set: function (t) { l.default.ENABLE_VERBOSE = t, l.default.ENABLE_DEBUG = t, l.default.ENABLE_INFO = t, l.default.ENABLE_WARN = t, l.default.ENABLE_ERROR = t, e._notifyChange() } }, { key: "enableDebug", get: function () { return l.default.ENABLE_DEBUG }, set: function (t) { l.default.ENABLE_DEBUG = t, e._notifyChange() } }, { key: "enableVerbose", get: function () { return l.default.ENABLE_VERBOSE }, set: function (t) { l.default.ENABLE_VERBOSE = t, e._notifyChange() } }, { key: "enableInfo", get: function () { return l.default.ENABLE_INFO }, set: function (t) { l.default.ENABLE_INFO = t, e._notifyChange() } }, { key: "enableWarn", get: function () { return l.default.ENABLE_WARN }, set: function (t) { l.default.ENABLE_WARN = t, e._notifyChange() } }, { key: "enableError", get: function () { return l.default.ENABLE_ERROR }, set: function (t) { l.default.ENABLE_ERROR = t, e._notifyChange() } }]), e }(); d.emitter = new o.default, n.default = d }, { "./logger.js": 41, events: 2 }], 43: [function (e, t, n) { "use strict"; function i(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(n, "__esModule", { value: !0 }); var r = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), s = function () { function t() { i(this, t) } return r(t, null, [{ key: "install", value: function () { Object.setPrototypeOf = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, Object.assign = Object.assign || function (e) { if (void 0 === e || null === e) throw new TypeError("Cannot convert undefined or null to object"); for (var t = Object(e), n = 1; n < arguments.length; n++) { var i = arguments[n]; if (void 0 !== i && null !== i) for (var r in i) i.hasOwnProperty(r) && (t[r] = i[r]) } return t }, "function" != typeof self.Promise && e("es6-promise").polyfill() } }]), t }(); s.install(), n.default = s }, { "es6-promise": 1 }], 44: [function (e, t, n) { "use strict"; function i(e, t, n) { var i = e; if (t + n < i.length) { for (; n--;)if (128 != (192 & i[++t])) return !1; return !0 } return !1 } function r(e) { for (var t = [], n = e, r = 0, s = e.length; r < s;)if (n[r] < 128) t.push(String.fromCharCode(n[r])), ++r; else { if (n[r] < 192); else if (n[r] < 224) { if (i(n, r, 1)) { var a = (31 & n[r]) << 6 | 63 & n[r + 1]; if (a >= 128) { t.push(String.fromCharCode(65535 & a)), r += 2; continue } } } else if (n[r] < 240) { if (i(n, r, 2)) { var o = (15 & n[r]) << 12 | (63 & n[r + 1]) << 6 | 63 & n[r + 2]; if (o >= 2048 && 55296 != (63488 & o)) { t.push(String.fromCharCode(65535 & o)), r += 3; continue } } } else if (n[r] < 248 && i(n, r, 3)) { var u = (7 & n[r]) << 18 | (63 & n[r + 1]) << 12 | (63 & n[r + 2]) << 6 | 63 & n[r + 3]; if (u > 65536 && u < 1114112) { u -= 65536, t.push(String.fromCharCode(u >>> 10 | 55296)), t.push(String.fromCharCode(1023 & u | 56320)), r += 4; continue } } t.push(String.fromCharCode(65533)), ++r } return t.join("") } Object.defineProperty(n, "__esModule", { value: !0 }), n.default = r }, {}]
    }, {}, [21])(21)
});
    </script>
    <script type="text/javascript">
        new ChimeePlayer({
            wrapper: '#mse',
            src: '%播放路径%',
            autoplay: true,
            controls: true
        });
    </script>

</body>
</html>